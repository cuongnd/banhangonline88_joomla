(function(){var e=function(e){var t=this,n=e;e.require().stylesheet("imgareaselect/default").done(function(){var e=function(){(function(e){function s(){return e("<div/>")}var t=Math.abs,n=Math.max,r=Math.min,i=Math.round;e.imgAreaSelect=function(o,u){function Q(e){return e+y.left-S.left}function G(e){return e+y.top-S.top}function Y(e){return e-y.left+S.left}function Z(e){return e-y.top+S.top}function et(e){return e.pageX-S.left}function tt(e){return e.pageY-S.top}function nt(e){var t=e||k,n=e||L;return{x1:i(q.x1*t),y1:i(q.y1*n),x2:i(q.x2*t),y2:i(q.y2*n),width:i(q.x2*t)-i(q.x1*t),height:i(q.y2*n)-i(q.y1*n)}}function rt(e,t,n,r,s){var o=s||k,u=s||L;q={x1:i(e/o||0),y1:i(t/u||0),x2:i(n/o||0),y2:i(r/u||0)},q.width=q.x2-q.x1,q.height=q.y2-q.y1}function it(){if(!a.width())return;y={left:i(a.offset().left),top:i(a.offset().top)},b=a.innerWidth(),w=a.innerHeight(),y.top+=a.outerHeight()-w>>1,y.left+=a.outerWidth()-b>>1,O=i(u.minWidth/k)||0,M=i(u.minHeight/L)||0,_=i(r(u.maxWidth/k||1<<24,b)),D=i(r(u.maxHeight/L||1<<24,w)),e().jquery=="1.3.2"&&T=="fixed"&&!R.getBoundingClientRect&&(y.top+=n(document.body.scrollTop,R.scrollTop),y.left+=n(document.body.scrollLeft,R.scrollLeft)),S=/absolute|relative/.test(E.css("position"))?{left:i(E.offset().left)-E.scrollLeft(),top:i(E.offset().top)-E.scrollTop()}:T=="fixed"?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},m=Q(0),g=G(0),(q.x2>b||q.y2>w)&&ht()}function st(t){if(!H)return;l.css({left:Q(q.x1),top:G(q.y1)}).add(c).width(V=q.width).height(J=q.height),c.add(h).add(d).css({left:0,top:0}),h.width(n(V-h.outerWidth()+h.innerWidth(),0)).height(n(J-h.outerHeight()+h.innerHeight(),0)),e(p[0]).css({left:m,top:g,width:q.x1,height:w}),e(p[1]).css({left:m+q.x1,top:g,width:V,height:q.y1}),e(p[2]).css({left:m+q.x2,top:g,width:b-q.x2,height:w}),e(p[3]).css({left:m+q.x1,top:g+q.y2,width:V,height:w-q.y2}),V-=d.outerWidth(),J-=d.outerHeight();switch(d.length){case 8:e(d[4]).css({left:V>>1}),e(d[5]).css({left:V,top:J>>1}),e(d[6]).css({left:V>>1,top:J}),e(d[7]).css({top:J>>1});case 4:d.slice(1,3).css({left:V}),d.slice(2,4).css({top:J})}t!==!1&&(e.imgAreaSelect.keyPress!=Et&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),u.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=Et)),e.browser.msie&&h.outerWidth()-h.innerWidth()==2&&(h.css("margin",0),setTimeout(function(){h.css("margin","auto")},0))}function ot(e){it(),st(e),B=Q(q.x1),j=G(q.y1),F=Q(q.x2),I=G(q.y2)}function ut(e,t){u.fadeSpeed?e.fadeOut(u.fadeSpeed,t):e.hide()}function at(e){var t=Y(et(e))-q.x1,n=Z(tt(e))-q.y1;K||(it(),K=!0,l.one("mouseout",function(){K=!1})),A="",u.resizable&&(n>u.resizeMargin?n>=q.height-u.resizeMargin&&(A="s"):A="n",t>u.resizeMargin?t>=q.width-u.resizeMargin&&(A+="e"):A+="w"),l.css("cursor",A?A+"-resize":u.movable?"move":""),v&&v.toggle()}function ft(t){e("body").css("cursor",""),(u.autoHide||q.width*q.height==0)&&ut(l.add(p),function(){e(this).hide()}),e(document).unbind("mousemove",pt),l.mousemove(at),u.onSelectEnd(o,nt())}function lt(t){return t.which!=1?!1:(it(),A?(e("body").css("cursor",A+"-resize"),B=Q(q[/w/.test(A)?"x2":"x1"]),j=G(q[/n/.test(A)?"y2":"y1"]),e(document).mousemove(pt).one("mouseup",ft),l.unbind("mousemove",at)):u.movable?(N=m+q.x1-et(t),C=g+q.y1-tt(t),l.unbind("mousemove",at),e(document).mousemove(vt).one("mouseup",function(){u.onSelectEnd(o,nt()),e(document).unbind("mousemove",vt),l.mousemove(at)})):a.mousedown(t),!1)}function ct(e){P&&(e?(F=n(m,r(m+b,B+t(I-j)*P*(F>B||-1))),I=i(n(g,r(g+w,j+t(F-B)/P*(I>j||-1)))),F=i(F)):(I=n(g,r(g+w,j+t(F-B)/P*(I>j||-1))),F=i(n(m,r(m+b,B+t(I-j)*P*(F>B||-1)))),I=i(I)))}function ht(){B=r(B,m+b),j=r(j,g+w),t(F-B)<O&&(F=B-O*(F<B||-1),F<m?B=m+O:F>m+b&&(B=m+b-O)),t(I-j)<M&&(I=j-M*(I<j||-1),I<g?j=g+M:I>g+w&&(j=g+w-M)),F=n(m,r(F,m+b)),I=n(g,r(I,g+w)),ct(t(F-B)<t(I-j)*P),t(F-B)>_&&(F=B-_*(F<B||-1),ct()),t(I-j)>D&&(I=j-D*(I<j||-1),ct(!0)),q={x1:Y(r(B,F)),x2:Y(n(B,F)),y1:Z(r(j,I)),y2:Z(n(j,I)),width:t(F-B),height:t(I-j)},st(),u.onSelectChange(o,nt())}function pt(e){return F=/w|e|^$/.test(A)||P?et(e):Q(q.x2),I=/n|s|^$/.test(A)||P?tt(e):G(q.y2),ht(),!1}function dt(t,n){F=(B=t)+q.width,I=(j=n)+q.height,e.extend(q,{x1:Y(B),y1:Z(j),x2:Y(F),y2:Z(I)}),st(),u.onSelectChange(o,nt())}function vt(e){return B=n(m,r(N+et(e),m+b-q.width)),j=n(g,r(C+tt(e),g+w-q.height)),dt(B,j),e.preventDefault(),!1}function mt(){e(document).unbind("mousemove",mt),it(),F=B,I=j,ht(),A="",p.is(":visible")||l.add(p).hide().fadeIn(u.fadeSpeed||0),H=!0,e(document).unbind("mouseup",gt).mousemove(pt).one("mouseup",ft),l.unbind("mousemove",at),u.onSelectStart(o,nt())}function gt(){e(document).unbind("mousemove",mt).unbind("mouseup",gt),ut(l.add(p)),rt(Y(B),Z(j),Y(B),Z(j)),this instanceof e.imgAreaSelect||(u.onSelectChange(o,nt()),u.onSelectEnd(o,nt()))}function yt(t){return t.which!=1||p.is(":animated")?!1:(it(),N=B=et(t),C=j=tt(t),e(document).mousemove(mt).mouseup(gt),!1)}function bt(){ot(!1)}function wt(){f=!0,xt(u=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},u)),l.add(p).css({visibility:""}),u.show&&(H=!0,it(),st(),l.add(p).hide().fadeIn(u.fadeSpeed||0)),setTimeout(function(){u.onInit(o,nt())},0)}function St(e,t){for(var n in t)u[n]!==undefined&&e.css(t[n],u[n])}function xt(t){t.parent&&(E=e(t.parent)).append(l.add(p)),e.extend(u,t),it();if(t.handles!=null){d.remove(),d=e([]),W=t.handles?t.handles=="corners"?4:8:0;while(W--)d=d.add(s());d.addClass(u.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:x+1||1}),!parseInt(d.css("width"))>=0&&d.width(5).height(5),(X=u.borderWidth)&&d.css({borderWidth:X,borderStyle:"solid"}),St(d,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}k=u.imageWidth/b||1,L=u.imageHeight/w||1,t.x1!=null&&(rt(t.x1,t.y1,t.x2,t.y2),t.show=!t.hide),t.keys&&(u.keys=e.extend({shift:1,ctrl:"resize"},t.keys)),p.addClass(u.classPrefix+"-outer"),c.addClass(u.classPrefix+"-selection");for(W=0;W++<4;)e(h[W-1]).addClass(u.classPrefix+"-border"+W);St(c,{selectionColor:"background-color",selectionOpacity:"opacity"}),St(h,{borderOpacity:"opacity",borderWidth:"border-width"}),St(p,{outerColor:"background-color",outerOpacity:"opacity"}),(X=u.borderColor1)&&e(h[0]).css({borderStyle:"solid",borderColor:X}),(X=u.borderColor2)&&e(h[1]).css({borderStyle:"dashed",borderColor:X}),l.append(c.add(h).add(v).add(d)),e.browser.msie&&((X=(p.css("filter")||"").match(/opacity=(\d+)/))&&p.css("opacity",X[1]/100),(X=(h.css("filter")||"").match(/opacity=(\d+)/))&&h.css("opacity",X[1]/100)),t.hide?ut(l.add(p)):t.show&&f&&(H=!0,l.add(p).fadeIn(u.fadeSpeed||0),ot()),P=(z=(u.aspectRatio||"").split(/:/))[0]/z[1],a.add(p).unbind("mousedown",yt);if(u.disable||u.enable===!1)l.unbind("mousemove",at).unbind("mousedown",lt),e(window).unbind("resize",bt);else{if(u.enable||u.disable===!1)(u.resizable||u.movable)&&l.mousemove(at).mousedown(lt),e(window).resize(bt);u.persistent||a.add(p).mousedown(yt)}u.enable=u.disable=undefined}var a=e(o),f,l=s(),c=s(),h=s().add(s()).add(s()).add(s()),p=s().add(s()).add(s()).add(s()),d=e([]),v,m,g,y={left:0,top:0},b,w,E,S={left:0,top:0},x=0,T="absolute",N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q={x1:0,y1:0,x2:0,y2:0,width:0,height:0},R=document.documentElement,U,z,W,X,V,J,K,Et=function(e){var t=u.keys,i,s,o=e.keyCode;i=!isNaN(t.alt)&&(e.altKey||e.originalEvent.altKey)?t.alt:!isNaN(t.ctrl)&&e.ctrlKey?t.ctrl:!isNaN(t.shift)&&e.shiftKey?t.shift:isNaN(t.arrows)?10:t.arrows;if(t.arrows=="resize"||t.shift=="resize"&&e.shiftKey||t.ctrl=="resize"&&e.ctrlKey||t.alt=="resize"&&(e.altKey||e.originalEvent.altKey)){switch(o){case 37:i=-i;case 39:s=n(B,F),B=r(B,F),F=n(s+i,B),ct();break;case 38:i=-i;case 40:s=n(j,I),j=r(j,I),I=n(s+i,j),ct(!0);break;default:return}ht()}else{B=r(B,F),j=r(j,I);switch(o){case 37:dt(n(B-i,m),j);break;case 38:dt(B,n(j-i,g));break;case 39:dt(B+r(i,b-Y(F)),j);break;case 40:dt(B,j+r(i,w-Z(I)));break;default:return}}return!1};this.remove=function(){xt({disable:!0}),l.add(p).remove()},this.getOptions=function(){return u},this.setOptions=xt,this.getSelection=nt,this.setSelection=rt,this.cancelSelection=gt,this.update=ot,U=a;while(U.length)x=n(x,isNaN(U.css("z-index"))?x:U.css("z-index")),U.css("position")=="fixed"&&(T="fixed"),U=U.parent(":not(body)");x=u.zIndex||x,e.browser.msie&&a.attr("unselectable","on"),e.imgAreaSelect.keyPress=e.browser.msie||e.browser.safari?"keydown":"keypress",e.browser.opera&&(v=s().css({width:"100%",height:"100%",position:"absolute",zIndex:x+2||2})),l.add(p).css({visibility:"hidden",position:T,overflow:"hidden",zIndex:x||"0"}),l.css({zIndex:x+2||2}),c.add(h).css({position:"absolute",fontSize:0}),o.complete||o.readyState=="complete"||!a.is("img")?wt():a.one("load",wt),!f&&e.browser.msie&&e.browser.version>=7&&(o.src=o.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(t.enable===undefined&&t.disable===undefined&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}})(n)};e(),t.resolveWith(e)})};dispatch("imgareaselect").containing(e).to("Foundry/2.1 Modules")})();