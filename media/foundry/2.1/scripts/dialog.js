(function(){var e=function(e){var t=this;e.require().library("mvc/controller","ui/core","ui/position","throttle-debounce","easing").stylesheet("dialog/default").template("dialog/default").done(function(){e.Controller("dialog",{defaults:{title:"",content:"",buttons:{},customClass:"",width:"auto",height:"auto",css:{position:"absolute",width:"auto",height:"auto",zIndex:10001},position:{my:"center center",at:"center center",of:window},offset:100,showOverlay:!0,overlay:{css:{background:"#000",opacity:"0.4",position:"fixed",top:0,left:0,zIndex:1e4,width:"100%",height:"100%",display:"none"}},body:{css:{minWidth:400,minHeight:200,overflow:"auto"}},iframe:{css:{width:"100%",height:"100%",border:"none"}},transition:{show:"zoom",hide:"zoom"},beforeShow:function(){},afterShow:function(){},beforeHide:function(){},afterHide:function(){},dialogHead:".dialog-head",dialogBody:".dialog-body",dialogFooter:".dialog-footer",dialogTitle:".dialog-title",dialogContent:".dialog-content",dialogButtons:".dialog-buttons",dialogLoader:".dialog-loader",closeButton:".dialog-closeButton"}},function(t){return{ready:!1,contentReady:!1,init:function(){var t=this;this.setInitOptions(this.options),this.initElement=this.element.clone(),this.element.finalizeContent=function(){return t.finalizeContent.apply(t)},e.each(["dialogHead","dialogBody","dialogFooter","dialogTitle","dialogContent","dialogButtons","dialogLoader"],function(e,n){t[n]=t.find(t.options[n])});if(this.options.content===undefined)return;this.display()},setInitOptions:function(t){var n=this;this.initOptions=e.extend(!0,{},t),e.each(["beforeShow","afterShow","beforeHide","afterHide"],function(e,t){n.initOptions[t]=function(){}}),this.initOptions.title=null,this.initOptions.content=null,this.initOptions.buttons=null},update:function(t){if(t){var t=e.extend(!0,{},this.initOptions,t);this.setInitOptions(t),this.display(t)}return this},displayQueue:[],display:function(t){if(this.resizing)return this.displayQueue.push(t);e.isPlainObject(t)&&(this.options=e.extend(!0,{},this.Class.defaults,t)),this.ready||this.options.showOverlay&&this.createOverlay(),this.contentReady=this.options.content===null;var n=this.options.transition;typeof n=="string"&&(this.options.transition={show:n,hide:n});var r=this;this.contentType="html",e.isUrl(this.options.content)&&(this.contentType="iframe"),e.isDeferred(this.options.content)&&(this.contentType="deferred");switch(this.contentType){case"html":this.hideLoader(),this.show();break;case"iframe":var i=e(document.createElement("iframe")),s=this.options.content,o=this.options.iframe.css,u=this.options.buttons,a=this.dialogContent,f=e.extend(!0,{},this.options,{content:i,buttons:u});this.showLoader(function(){onIframeLoaded=function(){return function(e){try{i[0].contentWindow.parentDialog=r}catch(t){}r.update(f)}}(),i.appendTo(a).css(o).css({position:"absolute",visibility:"hidden"}).one("load",onIframeLoaded).attr("src",s)});break;case"deferred":var l=this.options.content,c=this.options;this.showLoader(function(){l.done(function(t){r.update(e.extend(!0,{},c,{content:t}))})})}},loading:!1,showLoader:function(e){var t=this,n=function(){return t.dialogLoader.show().css({width:t.dialogBody.width(),height:t.dialogBody.height()}).position({my:"top left",at:"top left",of:t.options.dialogContent}),e&&e()};return this.ready?n():this.update({title:this.options.title,content:"",width:this.initOptions.body.css.minWidth,height:this.initOptions.body.css.minHeight,afterShow:n})},hideLoader:function(){this.dialogLoader.hide()},autoSize:function(){return this.initOptions.css.width=="auto"||this.initOptions.css.height=="auto"},finalizeContent:function(){var t=this;this.element.css(this.options.css),this.dialogContent.css(this.options.body.css),this.options.title!==null&&this.dialogTitle.html(this.options.title);if(this.options.content!==null){var n=e(this.options.content).is("iframe");this.dialogBody.toggleClass("type-iframe",n);if(n){var r=this.options.content.parent()[0],i=0;while(r.childNodes.length>1){var s=r.childNodes[i];s!==t.options.content[0]&&r.removeChild(s),i++}this.options.content.css({position:"relative",visibility:"visible"})}else this.dialogContent.html(this.options.content)}return this.contentReady||this.finalizeButtons(),this.element},finalizeSize:function(t){var n=this.refElement;if(!t){n=this.refElement=this.initElement.clone().removeClass("global").insertAfter(this.element),refTitle=n.find(this.options.dialogTitle),refBody=n.find(this.options.dialogBody),refFooter=n.find(this.options.dialogFooter),refButtons=n.find(this.options.dialogButtons),n.css(this.initOptions.css).css({display:"block"}),refTitle.html(this.options.title),e.isEmptyObject(this.options.buttons)?refFooter.hide():(refFooter.show(),refButtons.append("<button>test</button>"));var r=e(this.options.content).is("iframe"),i=r?document.createElement("div"):this.options.content;this.options.body.css.width=r&&this.options.width=="auto"?this.options.content.contents().width():this.options.width,this.options.body.css.height=r&&this.options.height=="auto"?this.options.content.contents().height():this.options.height,refBody.css(this.options.body.css).toggleClass("type-iframe",r).html(i),this.options.body.css.width=refBody.width(),this.options.body.css.height=refBody.height();var s=this.options.offset,o=n.width(),u=n.height(),a=e(window).width()-s,f=e(window).height()-s,l=o>a,c=u>f;this.options.css.width=l?a:o,this.options.css.height=c?f:u,this.options.body.css.width-=o-this.options.css.width,this.options.body.css.height-=u-this.options.css.height,this.options.body.css.minWidth=this.options.body.css.minHeight="auto",refBody.css(this.options.body.css),this.options.body.css.overflowX=!l||r||refBody[0].scrollWidth<=this.options.body.css.width?"auto":"scroll",this.options.body.css.overflowY=!c||r||refBody[0].scrollHeight<=this.options.body.css.height?"auto":"scroll",refBody.html("")}n.css(this.options.css).css("visibility","hidden").position(this.options.position),this.options.css.top=n.css("top"),this.options.css.left=n.css("left")},finalizeButtons:function(){var t=this.dialogFooter,n=this.dialogButtons;n.empty();if(e.isEmptyObject(this.options.buttons)){t.hide();return}e.each(this.options.buttons,function(t,r){var i=e.extend({},r);delete i.name,e(document.createElement("button")).attr("type","button").html(r.name).bind(i).appendTo(n)}),t.show()},show:function(t){var n=this;if(this.ready&&this.resizing)return;this.refElement&&this.refElement.remove(),this.contentReady||this.options.beforeShow.apply(this),this.resizing=!0,this.finalizeSize(),this.element.addClass("resizing"),this.transition[this.options.transition.show].show.apply(this,[function(){n.ready||(n.bind(window,"resize scroll",e.debounce(150,function(){n.refresh()})),n.ready=!0),n.contentReady||(t&&t.apply(n),n.options.afterShow.apply(n)),n.element.removeClass("resizing"),n.contentReady=!0,n.element.css({width:"auto",height:"auto"}),n.displayQueue.length>0?setTimeout(function(){n.resizing=!1,n.display(n.displayQueue.shift())},500):n.resizing=!1}])},hide:function(e){var t=this;this.contentReady||this.options.beforeHide.apply(this),this.transition[this.options.transition.hide].hide.apply(this,[function(){e&&e.apply(t),t.options.afterHide.apply(t)}])},refresh:function(){if(this.closing)return;var e=this;this.finalizeSize(!0),this.resizing=!0,this.transition[this.options.transition.show].show.apply(this,[function(){e.resizing=!1,e.element.css({width:"auto",height:"auto"})}])},transition:{none:{show:function(e){this.ready||this.overlay.show(),this.element.finalizeContent().show(0,e)},hide:function(e){this.overlay.hide(),this.element.hide(0,e)}},fade:{show:function(e){var t=this;this.ready||this.overlay.fadeOut(0).fadeIn("normal");if(!!this.contentReady)return this.element.finalizeContent(),e&&e();this.element.fadeOut(this.contentReady?"fast":0,function(){t.element.finalizeContent().fadeIn("normal","easeInCubic",e)})},hide:function(e){this.overlay.fadeOut("normal","easeOutCubic"),this.element.fadeOut("normal","easeOutCubic",e)}},zoom:{show:function(e){var t=this,n=this.dialogBody,r=this.dialogFooter;this.ready||(this.overlay.fadeIn("fast"),this.element.finalizeContent().css({top:parseInt(this.options.css.top)+parseInt(this.options.css.height)/2,left:parseInt(this.options.css.left)+parseInt(this.options.css.width)/2,width:0,height:0})),this.contentReady||(n.css({opacity:0}),r.css({opacity:0})),this.element.animate({top:this.options.css.top,left:this.options.css.left,width:this.options.css.width,height:this.options.css.height},"normal","easeInCubic",function(){return t.element.finalizeContent(),n.css({opacity:1}),r.css({opacity:1}),e&&e()})},hide:function(e){var t=this;this.element.animate({top:parseInt(this.options.css.top)+parseInt(this.options.css.height)/2,left:parseInt(this.options.css.left)+parseInt(this.options.css.width)/2,width:0,height:0},"normal","easeOutCubic",function(){return t.overlay.fadeOut("fast"),e&&e()})}}},overlay:e("<div></div>"),createOverlay:function(){var e=this;this.overlay.css(this.options.overlay.css).click(function(){e.close()}).appendTo("body")},closing:!1,close:function(){if(this.closing)return;this.closing=!0,this.hide(function(){this.element.remove(),this.refElement.remove()})},"{closeButton} click":function(){this.close()},content:function(){var e=this.dialogContent,t=e.find("> iframe");return t.length>0?t.contents():e}}}),e.dialog=function(t){if(window.parentDialog)return window.parentDialog.update(t);var n=e(".foundryDialog.global"),r=n.controllers("dialog")[0];if(arguments.length<1&&r)return r;n.length<1&&(n=e(e.View("dialog/default")).addClass("global").addClass(t.customClass).appendTo("body"));if(typeof t=="string"||e.isDeferred(t)){var i=arguments[1];t={content:t,afterShow:e.isFunction(i)?i:e.noop}}return r?r.update(t):r=n.implement("dialog",t,function(){}).controllers("dialog")[0],r},t.resolve()})};dispatch("dialog").containing(e).to("Foundry/2.1 Modules")})();