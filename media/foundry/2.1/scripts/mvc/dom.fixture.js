(function(){var e=function(e){var t=this;e.require().script("mvc/lang.object","mvc/lang.string").done(function(){var n=function(){e.ajaxPrefilter(function(t,n,r){if(!e.fixture.on)return;var s=i(t);if(!t.fixture){window.location.protocol==="file:";return}typeof t.fixture=="string"&&e.fixture[t.fixture]&&(t.fixture=e.fixture[t.fixture]);if(typeof t.fixture=="string"){var o=t.fixture;/^\/\//.test(o)&&(o=steal.root.mapJoin(t.fixture.substr(2))+""),t.url=o,t.data=null,t.type="GET",t.error||(t.error=function(e,t,n){throw"fixtures.js Error "+t+" "+n})}else t.dataTypes.splice(0,0,"fixture"),s&&e.extend(n.data,s)}),e.ajaxTransport("fixture",function(t,n){t.dataTypes.shift();var r=t.dataTypes[0],i;return{send:function(s,o){i=setTimeout(function(){var i=t.fixture(n,t,s);if(!e.isArray(i)){var u=[{}];u[0][r]=i,i=u}typeof i[0]!="number"&&i.unshift(200,"success");if(!i[2]||!i[2][r]){var u={};u[r]=i[2],i[2]=u}o.apply(null,i)},e.fixture.delay)},abort:function(){clearTimeout(i)}}});var t=/^(script|json|test|jsonp)$/,n=[],r=function(e,t){for(var r=0;r<n.length;r++)if(o._similar(e,n[r],t))return r;return-1},i=function(e){var t=r(e);if(t>-1)return e.fixture=n[t].fixture,o._getData(n[t].url,e.url)},s=function(e){var t=e.data.id;return t===undefined&&typeof e.data=="number"&&(t=e.data),t===undefined&&e.url.replace(/\/(\d+)(\/|$|\.)/g,function(e,n){t=n}),t===undefined&&(t=e.url.replace(/\/(\w+)(\/|$|\.)/g,function(e,n){n!="update"&&(t=n)})),t===undefined&&(t=Math.round(Math.random()*1e3)),t},o=e.fixture=function(e,t){if(t!==undefined){if(typeof e=="string"){var i=e.match(/(GET|POST|PUT|DELETE) (.+)/i);i?e={url:i[2],type:i[1]}:e={url:e}}var s=r(e,!!t);s>-1&&n.splice(s,1);if(t==null)return;e.fixture=t,n.push(e)}},u=e.String._regs.replacer;e.extend(e.fixture,{_similar:function(t,n,r){return r?e.Object.same(t,n,{fixture:null}):e.Object.subset(t,n,e.fixture._compare)},_compare:{url:function(e,t){return!!o._getData(t,e)},fixture:null,type:"i"},_getData:function(t,n){var r=[],i=t.replace(".","\\.").replace("?","\\?"),s=RegExp(i.replace(u,function(e,t){return r.push(t),"([^/]+)"})+"$").exec(n),o={};return s?(s.shift(),e.each(r,function(e,t){o[t]=s.shift()}),o):null},"-restUpdate":function(e){return[200,"succes",{id:s(e)},{location:e.url+"/"+s(e)}]},"-restDestroy":function(e,t){return{}},"-restCreate":function(e,t,n,r){var r=r||parseInt(Math.random()*1e5,10);return[200,"succes",{id:r},{location:e.url+"/"+r}]},make:function(t,n,r,i){typeof t=="string"&&(t=[t+"s",t]);var o=e.fixture["~"+t[0]]=[],u=function(e){for(var t=0;t<o.length;t++)if(e==o[t].id)return o[t]};for(var a=0;a<n;a++){var f=r(a,o);f.id||(f.id=a),o.push(f)}return e.fixture["-"+t[0]]=function(t){var n=o.slice(0);t.data=t.data||{},e.each((t.data.order||[]).slice(0).reverse(),function(e,t){var r=t.split(" ");n=n.sort(function(e,t){return r[1].toUpperCase()!=="ASC"?e[r[0]]<t[r[0]]?1:e[r[0]]==t[r[0]]?0:-1:e[r[0]]<t[r[0]]?-1:e[r[0]]==t[r[0]]?0:1})}),e.each((t.data.group||[]).slice(0).reverse(),function(e,t){var r=t.split(" ");n=n.sort(function(e,t){return e[r[0]]>t[r[0]]})});var r=parseInt(t.data.offset,10)||0,s=parseInt(t.data.limit,10)||o.length-r,u=0;for(var a in t.data){u=0;if(t.data[a]!==undefined&&(a.indexOf("Id")!=-1||a.indexOf("_id")!=-1))while(u<n.length)t.data[a]!=n[u][a]?n.splice(u,1):u++}if(i){u=0;while(u<n.length)i(n[u],t)?u++:n.splice(u,1)}return[{count:n.length,limit:t.data.limit,offset:t.data.offset,data:n.slice(r,r+s)}]},e.fixture["-"+t[1]]=function(e){var t=u(s(e));return t?[t]:[]},e.fixture["-"+t[1]+"Update"]=function(t,n){var r=s(t);return e.extend(u(r),t.data),e.fixture["-restUpdate"](t,n)},e.fixture["-"+t[1]+"Destroy"]=function(t,n){var r=s(t);for(var i=0;i<o.length;i++)if(o[i].id==r){o.splice(i,1);break}return e.extend(u(r),t.data),e.fixture["-restDestroy"](t,n)},e.fixture["-"+t[1]+"Create"]=function(t,n){var i=r(o.length,o);return e.extend(i,t.data),i.id||(i.id=o.length),o.push(i),e.fixture["-restCreate"](t,n,undefined,i.id)},{getId:s,findOne:u,find:function(e){return u(s(e))}}},rand:function(e,t,n){if(typeof e=="number")return typeof t=="number"?e+Math.floor(Math.random()*(t-e)):Math.floor(Math.random()*e);var r=arguments.callee;if(t===undefined)return r(e,r(e.length+1));var i=[];e=e.slice(0),n||(n=t),n=t+Math.round(r(n-t));for(var s=0;s<n;s++)i.push(e.splice(r(e.length),1)[0]);return i},xhr:function(t){return e.extend({},{abort:e.noop,getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},open:e.noop,overrideMimeType:e.noop,readyState:4,responseText:"",responseXML:null,send:e.noop,setRequestHeader:e.noop,status:200,statusText:"OK"},t)},on:!0}),e.fixture.delay=200,e.fixture["-handleFunction"]=function(t){return typeof t.fixture=="string"&&e.fixture[t.fixture]&&(t.fixture=e.fixture[t.fixture]),typeof t.fixture=="function"?(setTimeout(function(){t.success&&t.success.apply(null,t.fixture(t,"success")),t.complete&&t.complete.apply(null,t.fixture(t,"complete"))},e.fixture.delay),!0):!1},e.fixture.overwrites=n};n(),t.resolveWith(n)})};dispatch("mvc/dom.fixture").containing(e).to("Foundry/2.1 Modules")})();