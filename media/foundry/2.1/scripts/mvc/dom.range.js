(function(){var e=function(e){var t=this;e.require().script("mvc/dom.compare").done(function(){var n=function(){e.fn.range=function(){return e.Range(this[0])};var t=function(e){return e.replace(/([a-z])([a-z]+)/gi,function(e,t,n){return t+n.toLowerCase()}).replace(/_/g,"")},n=function(e){return e.replace(/^([a-z]+)_TO_([a-z]+)/i,function(e,t,n){return n+"_TO_"+t})},r=function(e){return e?e.ownerDocument.defaultView||e.ownerDocument.parentWindow:window},i=function(e,t,n){if(n-t==1)return},s={};e.Range=function(t){if(this.constructor!==e.Range)return new e.Range(t);t&&t.jquery&&(t=t[0]),!t||t.nodeType?(this.win=r(t),this.win.document.createRange?this.range=this.win.document.createRange():this.range=this.win.document.body.createTextRange(),t&&this.select(t)):t.clientX!=null||t.pageX!=null||t.left!=null?this.moveToPoint(t):t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches.length?this.moveToPoint(t.originalEvent.touches[0]):t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches.length?this.moveToPoint(t.originalEvent.changedTouches[0]):this.range=t},e.Range.current=function(t){var n=r(t),i;return n.getSelection?(i=n.getSelection(),new e.Range(i.rangeCount?i.getRangeAt(0):n.document.createRange())):new e.Range(n.document.selection.createRange())},e.extend(e.Range.prototype,{moveToPoint:function(t){var n=t.clientX,r=t.clientY;if(!n){var i=c();n=(t.pageX||t.left||0)-i.left,r=(t.pageY||t.top||0)-i.top}if(s.moveToPoint)return this.range=e.Range().range,this.range.moveToPoint(n,r),this;var u=document.elementFromPoint(n,r);for(var a=0;a<u.childNodes.length;a++){var f=u.childNodes[a];if(f.nodeType===3||f.nodeType===4){var l=e.Range(f),h=(l+"").length;for(var p=1;p<h+1;p++){var d=l.end(p).rect();if(d.left<=n&&d.left+d.width>=n&&d.top<=r&&d.top+d.height>=r){l.start(p-1),this.range=l.range;return}}}}var v;o(u.childNodes,function(n){var r=e.Range(n);if(r.rect().top>t.clientY)return!1;v=r}),v?(v.start((v+"").length),this.range=v.range):this.range=e.Range(u).range},window:function(){return this.win||window},overlaps:function(t){t.nodeType&&(t=e.Range(t).select(t));var n=this.compare("START_TO_START",t),r=this.compare("END_TO_END",t);return n>0||r<0?n<0||this.compare("START_TO_END",t)>0?this.compare("END_TO_START",t)<0||r>0?!1:!0:!0:!0},collapse:function(e){return this.range.collapse(e===undefined?!0:e),this},toString:function(){return typeof this.range.text=="string"?this.range.text:this.range+""},start:function(t){if(t===undefined){if(this.range.startContainer)return{container:this.range.startContainer,offset:this.range.startOffset};var n=this.clone().collapse().parent(),r=e.Range(n).select(n).collapse();return r.move("END_TO_START",this),{container:n,offset:(r+"").length}}if(!this.range.setStart)throw"todo";return typeof t=="number"?this.range.setStart(this.range.startContainer,t):typeof t=="string"?this.range.setStart(this.range.startContainer,this.range.startOffset+parseInt(t,10)):this.range.setStart(t.container,t.offset),this},end:function(t){if(t===undefined){if(this.range.startContainer)return{container:this.range.endContainer,offset:this.range.endOffset};var n=this.clone().collapse(!1).parent(),r=e.Range(n).select(n).collapse();return r.move("END_TO_END",this),{container:n,offset:(r+"").length}}if(!this.range.setEnd)throw"todo";return typeof t=="number"?this.range.setEnd(this.range.endContainer,t):this.range.setEnd(t.container,t.offset),this},parent:function(){if(this.range.commonAncestorContainer)return this.range.commonAncestorContainer;var t=this.range.parentElement(),n=this.range;return o(t.childNodes,function(r){if(e.Range(r).range.inRange(n))return t=r,!1}),t},rect:function(t){var n=this.range.getBoundingClientRect();if(t==="page"){var r=c();n=e.extend({},n),n.top+=r.top,n.left+=r.left}return n},rects:function(t){var n=e.makeArray(this.range.getClientRects()).sort(function(e,t){return t.width*t.height-e.width*e.height}),r=0,i,s=n.length;while(r<n.length){var o=n[r],u=!1;i=r+1;for(i=r+1;i<n.length;i++)if(l(o,n[i])){u=n[i];break}u?n.splice(r,1):r++}if(t=="page"){var a=c();return e.map(n,function(t){var n=e.extend({},t);return n.top+=a.top,n.left+=a.left,n})}return n}}),function(){var r=e.Range.prototype,i=e.Range().range;r.compare=i.compareBoundaryPoints?function(e,t){return this.range.compareBoundaryPoints(this.window().Range[n(e)],t.range)}:function(e,n){return this.range.compareEndPoints(t(e),n.range)},r.move=i.setStart?function(e,t){var n=t.range;switch(e){case"START_TO_END":this.range.setStart(n.endContainer,n.endOffset);break;case"START_TO_START":this.range.setStart(n.startContainer,n.startOffset);break;case"END_TO_END":this.range.setEnd(n.endContainer,n.endOffset);break;case"END_TO_START":this.range.setEnd(n.startContainer,n.startOffset)}return this}:function(e,n){return this.range.setEndPoint(t(e),n.range),this};var s=i.cloneRange?"cloneRange":"duplicate",u=i.selectNodeContents?"selectNodeContents":"moveToElementText";r.clone=function(){return e.Range(this.range[s]())},r.select=i.selectNodeContents?function(e){return e?this.range.selectNodeContents(e):this.window().getSelection().addRange(this.range),this}:function(e){if(!e)this.range.select();else if(e.nodeType===3){var t=e.parentNode,n=0,r;o(t.childNodes,function(t){if(t===e)return r=n+t.nodeValue.length,!1;n+=t.nodeValue.length}),this.range.moveToElementText(t),this.range.moveEnd("character",r-this.range.text.length),this.range.moveStart("character",n)}else this.range.moveToElementText(e);return this}}();var o=function(e,t){var n,r;for(var i=0;e[i];i++){n=e[i];if(n.nodeType===3||n.nodeType===4){if(t(n)===!1)return!1}else if(n.nodeType!==8&&o(n.childNodes,t)===!1)return!1}},u,a=function(e){return u==null&&(u="isElementContentWhitespace"in e),u?e.isElementContentWhitespace:e.nodeType===3&&""==e.data.trim()},f=function(e,t){return e.left<=t.clientX&&e.left+e.width>=t.clientX&&e.top<=t.clientY&&e.top+e.height>=t.clientY},l=function(e,t){return f(e,{clientX:t.left,clientY:t.top})&&f(e,{clientX:t.left+t.width,clientY:t.top})&&f(e,{clientX:t.left,clientY:t.top+t.height})&&f(e,{clientX:t.left+t.width,clientY:t.top+t.height})},c=function(e){var e=e||window;return doc=e.document.documentElement,body=e.document.body,{left:(doc&&doc.scrollLeft||body&&body.scrollLeft||0)+(doc.clientLeft||0),top:(doc&&doc.scrollTop||body&&body.scrollTop||0)+(doc.clientTop||0)}};s.moveToPoint=!!e.Range().range.moveToPoint};n(),t.resolveWith(n)})};dispatch("mvc/dom.range").containing(e).to("Foundry/2.1 Modules")})();