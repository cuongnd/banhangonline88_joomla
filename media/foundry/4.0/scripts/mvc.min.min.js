FD40.plugin("mvc",function($){(function(){var regs={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},getNext=function(current,nextPart,add){return current[nextPart]!==undefined?current[nextPart]:add&&(current[nextPart]={})},isContainer=function(current){var type=typeof current;return current&&(type=="function"||type=="object")},getObject,str=$.String=$.extend($.String||{},{getObject:getObject=function(name,
roots,add){var parts=name?name.split(regs.dot):[],length=parts.length,current,ret,i,r=0,type;roots=$.isArray(roots)?roots:[roots||window];if(length==0)return roots[0];while(current=roots[r++]){for(i=0;i<length-1&&isContainer(current);i++)current=getNext(current,parts[i],add);if(isContainer(current)){ret=getNext(current,parts[i],add);if(ret!==undefined){if(add===false)delete current[parts[i]];return ret}}}},capitalize:function(s,cache){return s.charAt(0).toUpperCase()+s.substr(1)},camelize:function(s){s=
str.classize(s);return s.charAt(0).toLowerCase()+s.substr(1)},classize:function(s,join){var parts=s.split(regs.undHash),i=0;for(;i<parts.length;i++)parts[i]=str.capitalize(parts[i]);return parts.join(join||"")},niceName:function(s){return str.classize(s," ")},underscore:function(s){return s.replace(regs.colons,"/").replace(regs.words,"$1_$2").replace(regs.lowUp,"$1_$2").replace(regs.dash,"_").toLowerCase()},sub:function(s,data,remove){var obs=[];obs.push(s.replace(regs.replacer,function(whole,inside){var ob=
getObject(whole,data,typeof remove=="boolean"?!remove:remove)||getObject(inside,data,typeof remove=="boolean"?!remove:remove),type=typeof ob;if((type==="object"||type==="function")&&type!==null){obs.push(ob);return""}else return""+ob}));return obs.length<=1?obs[0]:obs},_regs:regs});$.extend($,str)})();(function(){$.String.rsplit=function(string,regex){var result=regex.exec(string),retArr=[],first_idx,last_idx;while(result!==null){first_idx=result.index;last_idx=regex.lastIndex;if(first_idx!==0){retArr.push(string.substring(0,
first_idx));string=string.slice(first_idx)}retArr.push(result[0]);string=string.slice(result[0].length);result=regex.exec(string)}if(string!=="")retArr.push(string);return retArr}})();(function(){var digitTest=/^\d+$/,keyBreaker=/([^\[\]]+)|(\[\])/g,plus=/\+/g,paramTest=/([^?#]*)(#.*)?$/;$.String=$.extend($.String||{},{deparam:function(params){if(!params||!paramTest.test(params))return{};var data={},pairs=params.split("&"),current;for(var i=0;i<pairs.length;i++){current=data;var pair=pairs[i].split("=");
if(pair.length!=2)pair=[pair[0],pair.slice(1).join("=")];var key=decodeURIComponent(pair[0].replace(plus," ")),value=decodeURIComponent(pair[1].replace(plus," ")),parts=key.match(keyBreaker);for(var j=0;j<parts.length-1;j++){var part=parts[j];if(!current[part])current[part]=digitTest.test(parts[j+1])||parts[j+1]=="[]"?[]:{};current=current[part]}lastPart=parts[parts.length-1];if(lastPart=="[]")current.push(value);else current[lastPart]=value}return data}})})();(function(){var oldClean=$.cleanData;
$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!==undefined;i++)$(elem).triggerHandler("destroyed");oldClean(elems)}})();(function(){var oldClosest=$.fn._closest=$.fn.closest;$.fn.closest=function(selectors,context){var rooted={},res,result,thing,i,j,selector,rootedIsEmpty=true,selector,selectorsArr=selectors;if(typeof selectors=="string")selectorsArr=[selectors];$.each(selectorsArr,function(i,selector){if(selector.indexOf(">")==0){if(selector.indexOf(" ")!=-1)throw" closest does not work with > followed by spaces!";
rooted[selectorsArr[i]=selector.substr(1)]=selector;if(typeof selectors=="string")selectors=selector.substr(1);rootedIsEmpty=false}});res=oldClosest.call(this,selectors,context);if(rootedIsEmpty)return res;i=0;while(i<res.length){result=res[i],selector=result.selector;if(rooted[selector]!==undefined){result.selector=rooted[selector];rooted[selector]=false;if(typeof result.selector!=="string"||result.elem.parentNode!==context){res.splice(i,1);continue}}i++}return res}})();(function(){$.cookie=function(name,
value,options){if(typeof value!="undefined"){options=options||{};if(value===null){value="";options.expires=-1}if(typeof value=="object"&&jQuery.toJSON)value=jQuery.toJSON(value);var expires="";if(options.expires&&(typeof options.expires=="number"||options.expires.toUTCString)){var date;if(typeof options.expires=="number"){date=new Date;date.setTime(date.getTime()+options.expires*24*60*60*1E3)}else date=options.expires;expires="; expires="+date.toUTCString()}var path=options.path?"; path="+options.path:
"";var domain=options.domain?"; domain="+options.domain:"";var secure=options.secure?"; secure":"";document.cookie=[name,"=",encodeURIComponent(value),expires,path,domain,secure].join("")}else{var cookieValue=null;if(document.cookie&&document.cookie!=""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}if(jQuery.evalJSON&&
cookieValue&&cookieValue.match(/^\s*\{/))try{cookieValue=jQuery.evalJSON(cookieValue)}catch(e){}return cookieValue}}})();(function(){var initializing=false,makeArray=$.makeArray,isFunction=$.isFunction,isArray=$.isArray,extend=$.extend,getObject=$.String.getObject,concatArgs=function(arr,args){return arr.concat(makeArray(args))},fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,inheritProps=function(newProps,oldProps,addTo){addTo=addTo||newProps;for(var name in newProps)addTo[name]=isFunction(newProps[name])&&
isFunction(oldProps[name])&&fnTest.test(newProps[name])?function(name,fn){return function(){var tmp=this._super,ret;this._super=oldProps[name];ret=fn.apply(this,arguments);this._super=tmp;return ret}}(name,newProps[name]):newProps[name]},STR_PROTOTYPE="prototype";clss=$.Class=function(){if(arguments.length)clss.extend.apply(clss,arguments)};extend(clss,{proxy:function(funcs){var args=makeArray(arguments),self;funcs=args.shift();if(!isArray(funcs))funcs=[funcs];self=this;return function class_cb(){var cur=
concatArgs(args,arguments),isString,length=funcs.length,f=0,func;for(;f<length;f++){func=funcs[f];if(!func)continue;isString=typeof func=="string";if(isString&&self._set_called)self.called=func;cur=(isString?self[func]:func).apply(self,cur||[]);if(f<length-1)cur=!isArray(cur)||cur._use_call?[cur]:cur}return cur}},newInstance:function(){var inst=this.rawInstance(),args;if(inst.setup)args=inst.setup.apply(inst,arguments);if(inst.init)inst.init.apply(inst,isArray(args)?args:arguments);return inst},setup:function(baseClass,
fullName){this.defaults=extend(true,{},baseClass.defaults,this.defaults);return arguments},rawInstance:function(){initializing=true;var inst=new this;initializing=false;return inst},extend:function(fullName,klass,proto){if(typeof fullName!="string"){proto=klass;klass=fullName;fullName=null}if(!proto){proto=klass;klass=null}proto=proto||{};var _super_class=this,_super=this[STR_PROTOTYPE],name,shortName,namespace,prototype;initializing=true;prototype=new this;initializing=false;inheritProps(proto,_super,
prototype);function Class(){if(initializing)return;if(this.constructor!==Class&&arguments.length)return arguments.callee.extend.apply(arguments.callee,arguments);else return this.Class.newInstance.apply(this.Class,arguments)}for(name in this)if(this.hasOwnProperty(name))Class[name]=this[name];inheritProps(klass,this,Class);if(fullName){var root;if(klass&&klass.root){root=klass.root;if($.isString(root))root=getObject(root,window,true)}var parts=fullName.split(/\./),shortName=parts.pop(),current=getObject(parts.join("."),
root||window,true),namespace=current;extend(true,Class,current[shortName]);current[shortName]=Class}extend(Class,{prototype:prototype,namespace:namespace,shortName:shortName,constructor:Class,fullName:fullName});Class[STR_PROTOTYPE].Class=Class[STR_PROTOTYPE].constructor=Class;var args=Class.setup.apply(Class,concatArgs([_super_class],arguments));if(Class.init)Class.init.apply(Class,args||concatArgs([_super_class],arguments));return Class}});clss.callback=clss[STR_PROTOTYPE].callback=clss[STR_PROTOTYPE].proxy=
clss.proxy})();(function(){var bind=function(el,ev,callback,eventData){var wrappedCallback,binder=el.bind&&el.unbind?el:$(isFunction(el)?[el]:el);if(ev.indexOf(">")===0){ev=ev.substr(1);wrappedCallback=function(event){if(event.target===el)callback.apply(this,arguments)}}if(eventData)binder.bind(ev,eventData,wrappedCallback||callback);else binder.bind(ev,wrappedCallback||callback);return function(){binder.unbind(ev,wrappedCallback||callback);el=ev=callback=wrappedCallback=null}},makeArray=$.makeArray,
isArray=$.isArray,isFunction=$.isFunction,isString=$.isString,extend=$.extend,Str=$.String,each=$.each,getObject=Str.getObject,STR_PROTOTYPE="prototype",STR_CONSTRUCTOR="constructor",slice=Array[STR_PROTOTYPE].slice,delegate=function(el,selector,ev,callback,eventData){if(selector.indexOf(">")===0)selector=(el.data("directSelector")+" "||"")+selector;var binder=el.delegate&&el.undelegate?el:$(isFunction(el)?[el]:el);if(eventData)binder.delegate(selector,ev,eventData,callback);else binder.delegate(selector,
ev,callback);return function(){binder.undelegate(selector,ev,callback);binder=el=ev=callback=selector=null}},binder=function(el,ev,callback,selector,eventData){return selector?delegate(el,selector,ev,callback,eventData):bind(el,ev,callback,eventData)},shifter=function shifter(context,name){var method=typeof name=="string"?context[name]:name;if(isArray(method)&&isFunction(method[1]))method=method[1];return function(){context.called=name;return method.apply(context,[this.nodeName?$(this):this].concat(slice.call(arguments,
0)))}},dotsReg=/\./g,controllersReg=/_?controllers?/ig,underscoreAndRemoveController=function(className){return Str.underscore(className.replace($.globalNamespace+".","").replace(dotsReg,"_").replace(controllersReg,""))},actionMatcher=/^\S(.*)\s(.*)/,parameterReplacer=/\{([^\}]+)\}/g,controllerReplacer=/\{([^\.]+[\.][^\.]+)\}/g,breaker=/^(?:(.*?)\s)?([\w\.\:>]+)$/,basicProcessor,data=function(el,data){return $.data(el,"controllers",data)};var controllerRoot=$.globalNamespace+".Controller";$.Controller=
function(name){var args=makeArray(arguments),_static={root:controllerRoot},_prototype;if(args.length>2){_static=$.extend(_static,args[1]);_prototype=args[2]}else _prototype=args[1];if(_static.namespace)name=_static.namespace+"."+name;return $.Controller.Class(name,_static,_prototype)};var controllerClass=controllerRoot+".Class";$.Class(controllerClass,{setup:function(baseClass,name){this._super.apply(this,arguments);if(!this.shortName||this.fullName==controllerClass)return;var elements=this.elements||
[],i=0,defaults=this.defaults;while(element=elements[i++]){var start=element.indexOf("{"),end=element.indexOf("}"),length=element.length,prefix=element.slice(0,start),suffix=element.slice(end+1),names=element.slice(start+1,end).split("|"),j=0;while(name=names[j++]){var prop="{"+$.camelize(name)+"}";!$.has(defaults,prop)&&(defaults[prop]=prefix+name+suffix)}}this._fullName=underscoreAndRemoveController(this.fullName);this._shortName=underscoreAndRemoveController(this.shortName);var controller=this,
funcName,forLint;if(isString(this.pluginName)){var _fullName=this._fullName;var pluginname=this.pluginName;if(!$.fn[pluginname])$.fn[pluginname]=function(options){var args=makeArray(arguments);if($.isString(options)&&options==="controller"){var controllers=data(this[0]),instance=controllers&&controllers[_fullName];return instance}return this.each(function(){var controllers=data(this),instance=controllers&&controllers[_fullName];if(instance){if($.isString(options)){var method=instance[options];$.isFunction(method)&&
method.apply(instance,args.slice(1));return}instance.update.apply(instance,args)}else controller.newInstance.apply(controller,[this].concat(args))})}}var args=makeArray(arguments),prototype=this[STR_PROTOTYPE],protoFactory=args[args.length>3?3:2];if(isFunction(protoFactory)){this.protoFactory=protoFactory;prototype=this.protoFactory.call(this,null)}this.actions={};for(funcName in prototype){if(funcName=="constructor")continue;if(this._isAction(funcName)){var method=prototype[funcName],isMethod=isFunction(method)||
isArray(method)&&isFunction(method[1]);if(!isMethod)continue;this.actions[funcName]=this._action(funcName)}}$.module("$:/Controllers/"+this.fullName).resolve(this)},hookup:function(el){return new this(el)},_isAction:function(methodName){if(actionMatcher.test(methodName))return true;else return $.inArray(methodName,this.listensTo)>-1||$.event.special[methodName]||processors[methodName]},_action:function(methodName,options){parameterReplacer.lastIndex=0;if(!options&&parameterReplacer.test(methodName))return null;
methodName=methodName.replace("{self} ","");var convertedName=methodName;if(options){var bindingOtherController=false;if(controllerReplacer.test(methodName)){var controller,selector="";convertedName=methodName.replace(controllerReplacer,function(whole,inside){var parts=inside.split(".");controller=options["{"+parts[0]+"}"]||{};if($.isControllerInstance(controller))selector=(controller[parts[1]]||{})["selector"];return selector}).match(breaker);bindingOtherController=!!selector;convertedName=[controller.element].concat(convertedName||
[])}if(!bindingOtherController)convertedName=Str.sub(methodName,[options,window])}var arr=isArray(convertedName),parts=(arr?convertedName[1]:convertedName).match(breaker),event=parts[2],processor=processors[event]||basicProcessor;return{processor:processor,parts:parts,delegate:arr?convertedName[0]:undefined}},processors:{},listensTo:[],defaults:{},hostname:"parent"},{setup:function(elem,options){var instance=this,Class=instance[STR_CONSTRUCTOR],prototype=instance[STR_PROTOTYPE];var _fullName=Class._fullName;
instance.instanceId=$.uid(_fullName+"_");var instanceOptions=instance.options=extend(true,{},Class.defaults,Class.defaultOptions,options);var element=instance.element=$(elem);if(Class.protoFactory){prototype=Class.protoFactory.apply(Class,[instance,instanceOptions,element]);extend(true,instance,prototype)}(data(elem)||data(elem,{}))[_fullName]=instance;if(!element.data("directSelector")){var selector=$.uid("DS");element.addClass(selector).data("directSelector","."+selector)}for(name in instanceOptions){if(!name.match(/^\{.+\}$/))continue;
var key=name.replace(/^\{|\}$/g,""),val=instanceOptions[name];if(isString(val)){var selectorFuncExtension=instance[key];instance[key]=function(instance,selector,funcName){selector=/^(\.|\#)$/.test(selector)?selector+funcName:selector;var selectorFunc=function(filter){var elements=instance.element.find(selector);if($.isString(filter))elements=elements.filter(filter);if($.isPlainObject(filter))$.each(filter,function(key,val){elements=elements.filterBy(key,val)});return elements};selectorFunc.selector=
selector;selectorFunc.css=function(){var cssRule=selectorFunc.cssRule;if(!cssRule){var directSelector=element.data("directSelector"),ruleSelector=$.map(selector.split(","),function(selector){return directSelector+" "+selector});cssRule=selectorFunc.cssRule=$.cssRule(ruleSelector);cssRule.important=true}return arguments.length?cssRule.css.apply(cssRule,arguments):cssRule};selectorFunc.inside=function(el){return $(el).find(selector)};selectorFunc.of=function(el){return $(el).parents(selector).eq(0)};
if($.isPlainObject(selectorFuncExtension))$.extend(selectorFunc,selectorFuncExtension);return selectorFunc}(instance,val,key)}else instance[key]=val}var views=instanceOptions.view;var __view=instance.view;instance.view=function(){return __view.apply(this,arguments)};each(views||{},function(name,view){instance.view[name]=function(useHtml){var args=makeArray(arguments);if($.isBoolean(useHtml))args=args.slice(1);else useHtml=false;return instance.view.apply(instance,[useHtml,name].concat(args))}});$.extend(instance,
instanceOptions.controller);instance.pluginInstances={};instance.called="init";instance._bind();var __init=instance.init||$.noop;instance.init=function(){instance.init=__init;result=__init.apply(instance,arguments);instance.trigger("init."+Class.fullName.toLowerCase(),[instance]);return result};return[element,instanceOptions].concat(makeArray(arguments).slice(2))},on:function(eventName){var args=makeArray(arguments),element=this.element,length=args.length;if(length==2)return this._binder(element,
eventName,args[1]);if(length==3&&isString(args[1]))return this._binder(element,eventName,args[2],args[1]);else return this._binder(args[1],eventName,args[2]);if(length==4)return this._binder($(args[1]),eventName,args[3],args[2])},_bind:function(){var instance=this,Class=instance[STR_CONSTRUCTOR],actions=Class.actions,bindings=instance._bindings=[],element=instance.element;each(actions||{},function(name,action){if(!actions.hasOwnProperty(name))return;var ready=Class.actions[name]||Class._action(name,
instance.options);if($.isControllerInstance(ready.delegate))ready.delegate=ready.delegate.element;bindings.push(ready.processor(ready.delegate||element,ready.parts[2],ready.parts[1],name,instance))});var destroyCB=shifter(this,"destroy");element.bind("destroyed",destroyCB);bindings.push(function(el){$(el).unbind("destroyed",destroyCB)});return bindings.length},_binder:function(el,eventName,func,selector){if(typeof func=="string")func=shifter(this,func);this._bindings.push(binder(el,eventName,func,
selector));return this._bindings.length},_unbind:function(){var el=this.element[0];each(this._bindings,function(key,value){value(el)});this._bindings=[]},trigger:function(name){var el=this.element;if(!el)return;var event=$.Event(name);el.trigger.apply(el,[event].concat($.makeArray(arguments).slice(1)));return event},delegate:function(element,selector,eventName,func){if(typeof element=="string"){func=eventName;eventName=selector;selector=element;element=this.element}return this._binder(element,eventName,
func,selector)},update:function(options){extend(this.options,options);this._unbind();this._bind()},destroy:function(){if(this._destroyed)return;var fname=this[STR_CONSTRUCTOR]._fullName,controllers;for(pname in this.pluginInstances)this.removePlugin(pname);this._destroyed=true;this.element.removeClass(fname);this._unbind();delete this._actions;delete this.element.data("controllers")[fname];$(this).triggerHandler("destroyed");this.element=$()},find:function(selector){return this.element.find(selector)},
view:function(){var args=makeArray(arguments),name,options=args,useHtml=false,context=this[STR_CONSTRUCTOR].component||$,html="",view=this.options.view||{};if(typeof args[0]=="boolean"){useHtml=args[0];options=args.slice(1)}name=options[0]=view[options[0]];if(name==undefined)return useHtml?"":$("");html=context.View.apply(context,options);return useHtml?html:$($.parseHTML($.trim(html)))},getPlugin:function(name){return this.pluginInstances[name]},addSubscriber:function(instance){var instances=$.isArray(instance)?
instance:[instance||{}];var host=this,hostname=this.Class.hostname,options={};options["{"+hostname+"}"]=host;$.map(instances,function(instance,i){if(!$.isControllerInstance(instance))return false;if(instance.options[hostname]===this)return instance;instance[hostname]=host;return instance.update(options)});return instances},addPlugin:function(name,plugin,options){if(!name)return;if(!plugin&&!options||$.isPlainObject(plugin)){options=plugin;plugin=[this.Class.root,this.Class.fullName,$.String.capitalize(name)].join(".")}if($.isString(plugin))plugin=
$.getController(plugin);var isPluginInstance=$.isControllerInstance(plugin);if(!isFunction(plugin)&&!isPluginInstance)return;var pluginOptions=this.Class.pluginExtendsInstance?this.options[name]:(this.options.plugin||{})[name];options=$.extend(true,{element:this.element},options,pluginOptions);var type=isPluginInstance?"instance":$.isController(plugin)?"controller":"function";this.trigger("addPlugin",[name,plugin,options,type]);var hostname=this.Class.hostname;options["{"+hostname+"}"]=this;var pluginInstance;
switch(type){case "instance":pluginInstance=plugin;plugin.update(options);plugin[hostname]=this;break;case "controller":pluginInstance=options.element.addController(plugin,options);break;case "function":pluginInstance=plugin(this,options);break}if(!pluginInstance)return;this.pluginInstances[name]=pluginInstance;if(this.Class.pluginExtendsInstance)this[name]=pluginInstance;if(type!=="function"){var hostOptions={};hostOptions["{"+name+"}"]=pluginInstance;this.update(hostOptions)}this.trigger("registerPlugin",
[name,pluginInstance,options,type]);return pluginInstance},removePlugin:function(name){var plugin=this.getPlugin(name);if(!plugin)return;this.trigger("removePlugin",[name,plugin]);delete this.pluginInstances[name];return $.isFunction(plugin.destroy)?plugin.destroy():null},invokePlugin:function(name,method,args){var plugin=this.getPlugin(name);if(!plugin)return;if(!$.isFunction(plugin[method]))return;this.trigger("invokePlugin",[name,plugin,args]);return plugin[method].apply(this,args)},getMessageGroup:function(){var messageGroup=
$.isFunction(this.messageGroup)?this.messageGroup():this.element.find("[data-message-group]");if(messageGroup.length<1)messageGroup=$("<div data-message-group></div>").prependTo(this.element);return messageGroup},setMessage:function(message,type){var defaultOptions={type:"warning",message:"",parent:this.getMessageGroup(),element:$('<div class="alert fade in"><button type="button" class="close" data-bs-dismiss="alert">\u00d7</button></div>')},userOptions={},isDeferred=$.isDeferred(message);if($.isPlainObject(message)&&
!isDeferred)userOptions=message;else userOptions={message:message,type:type||"warning"};var options=$.extend({},defaultOptions,userOptions),element=options.element;if($.isDeferred(message)){var myself=arguments.callee,context=this;message.done(function(message,type){options.message=message;options.type=type||"warning";myself.call(context,options);element.show()})}else{element.addClass("alert-"+options.type).append(options.message);if($("html").has(element).length<1)element.appendTo(options.parent)}return element},
clearMessage:function(){this.getMessageGroup().empty()},_set_called:true});var processors=$.Controller.Class.processors,basicProcessor=function(el,event,selector,methodName,controller){var method=controller[methodName],eventData;if(isArray(method)&&isFunction(method[1]))eventData=method[0];return binder(el,event,shifter(controller,methodName),selector,eventData)};each("change click contextmenu dblclick keydown keyup keypress mousedown mousemove mouseout mouseover mouseup reset resize scroll select submit focusin focusout mouseenter mouseleave".split(" "),
function(i,v){processors[v]=basicProcessor});var normalizeController=function(controller){return controller.replace("$.Controller",controllerRoot)};var getController=function(controller){if(isString(controller)){controller=normalizeController(controller);controller=getObject(controller)||getObject(controllerRoot+"."+controller)}if(isController(controller))return controller};var isController=function(controller){return isFunction(controller)&&controller.hasOwnProperty("_fullName")};var flattenControllers=
function(controllers){return $.map(controllers,function(controller){return isArray(controller)?flattenControllers(controller):getController(controller)})};$.getController=getController;$.isController=function(controller){return!!getController(controller)};$.isControllerInstance=function(instance){return instance&&instance[STR_CONSTRUCTOR]&&isController(instance[STR_CONSTRUCTOR])};$.isControllerOf=function(instance,controllers){if(!controllers)return false;if(!isArray(controllers))controllers=[controllers];
for(var i=0;i<controllers.length;i++){var controller=getController(controllers[i]);if(instance instanceof controller)return true}return false};$.fn.extend({controllers:function(){var candidates=flattenControllers(makeArray(arguments)),instances=[];this.each(function(){var controllers=$.data(this,"controllers");each(controllers||{},function(_fullName,instance){if(!controllers.hasOwnProperty(_fullName))return;if(!candidates.length||$.isControllerOf(instance,candidates))instances.push(instance)})});
return instances},controller:function(controller,options){if(options===undefined)return this.controllers(controller)[0];this.addController.apply(this,arguments);return this},hasController:function(controller){var _fullName=(getController(controller)||{})._fullName||(isString(controller)?underscoreAndRemoveController(normalizeController(controller)):"");return!_fullName?false:($(this).data("controllers")||{}).hasOwnProperty(_fullName)},addController:function(controller,options,callback){var Controller=
getController(controller);if(!Controller)return;var instances=[];this.each(function(){if(this.nodeType!==1||this.nodeName=="SCRIPT")return;var existingInstance=$(this).controller(controller);if(existingInstance){instances.push(existingInstance);return}var instance=new Controller(this,options);isFunction(callback)&&callback.apply(instance,[$(this),instance]);instances.push(instance)});return instances.length>1?instances:instances[0]},removeController:function(controller){this.each(function(){var instances=
$(this).controllers(controller);while(instances.length)instances.shift().destroy()});return this},addControllerWhenAvailable:function(controller){var elements=this,args=arguments,task=$.Deferred();if($.isController(controller))controller=controller.fullName;if(!isString(controller))return task.reject();$.module("$:/Controllers/"+controller).pipe(function(){var instance=elements.addController.apply(elements,args);task.resolveWith(instance,[elements,instance])},task.reject,task.fail);return task},implement:function(){this.addController.apply(this,
arguments);return this}});(function(){var fns=["is","find"],_fns={},fn;while(fn=fns.shift()){_fns[fn]=$.fn[fn];$.fn[fn]=function(fn){return function(obj){return _fns[fn].apply(this,(obj||{}).hasOwnProperty("of")?[obj.selector]:arguments)}}(fn)}})()})();(function(){var toId=function(src){return src.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},makeArray=$.makeArray,id=1;var $view=$.View=function(view,data,helpers,callback){if(typeof helpers==="function"){callback=helpers;helpers=undefined}var deferreds=
getDeferreds(data);if(deferreds.length){var deferred=$.Deferred();deferreds.push(get(view,true));$.when.apply($,deferreds).then(function(resolved){var objs=makeArray(arguments),renderer=objs.pop()[0],result;if(isDeferred(data))data=usefulPart(resolved);else for(var prop in data)if(isDeferred(data[prop]))data[prop]=usefulPart(objs.shift());result=renderer(data,helpers);deferred.resolve(result);callback&&callback(result)});return deferred.promise()}else{var response,async=typeof callback==="function",
deferred=get(view,async);if(async){response=deferred;deferred.done(function(renderer){callback(renderer(data,helpers))})}else deferred.done(function(renderer){response=renderer(data,helpers)});return response}},checkText=function(text,url){if(!text.match(/[^\s]/))throw"$.View ERROR: There is no template or an empty template at "+url;},get=function(url,async){return $.ajax({url:url,dataType:"view",async:async})},isDeferred=function(obj){return obj&&$.isFunction(obj.always)},getDeferreds=function(data){var deferreds=
[];if(isDeferred(data))return[data];else for(var prop in data)if(isDeferred(data[prop]))deferreds.push(data[prop]);return deferreds},usefulPart=function(resolved){return $.isArray(resolved)&&resolved.length===3&&resolved[1]==="success"?resolved[0]:resolved};$.ajaxTransport("view",function(options,orig){var url=orig.url,suffix=url.match(/\.[\w\d]+$/),type,el,id,jqXHR,response=function(text){var func=type.renderer(id,text);if($view.cache)$view.cached[id]=func;return{view:func}};if(el=document.getElementById(url))suffix=
"."+el.type.match(/\/(x\-)?(.+)/)[2];if(!suffix){suffix=$view.ext;url=url+$view.ext}id=toId(url);if(url.match(/^\/\//)){var sub=url.substr(2);url=typeof steal==="undefined"?url="/"+sub:steal.root.mapJoin(sub)+""}type=$view.types[suffix];var template=$.template()[orig.url];return{send:function(headers,callback){if(template){type=$view.types["."+template.type];return callback(200,"success",response(template.content))}else if($view.cached[id])return callback(200,"success",{view:$view.cached[id]});else if(el)callback(200,
"success",response(el.innerHTML));else jqXHR=$.ajax({async:orig.async,url:url,dataType:"text",error:function(){checkText("",url);callback(404)},success:function(text){checkText(text,url);callback(200,"success",response(text))}})},abort:function(){jqXHR&&jqXHR.abort()}}});$.extend($view,{hookups:{},hookup:function(cb){var myid=++id;$view.hookups[myid]=cb;return myid},cached:{},cache:true,register:function(info){this.types["."+info.suffix]=info;if(window.steal)steal.type(info.suffix+" view js",function(options,
success,error){var type=$view.types["."+options.type],id=toId(options.rootSrc+"");options.text=type.script(id,options.text);success()})},types:{},ext:".ejs",registerScript:function(type,id,src){return"$.View.preload('"+id+"',"+$view.types["."+type].script(id,src)+");"},preload:function(id,renderer){$view.cached[id]=function(data,helpers){return renderer.call(data,data,helpers)}}});if(window.steal)steal.type("view js",function(options,success,error){var type=$view.types["."+options.type],id=toId(options.rootSrc+
"");options.text="steal('"+(type.plugin||"jquery/view/"+options.type)+"').then(function($){"+"$.View.preload('"+id+"',"+options.text+");\n})";success()});var convert,modify,isTemplate,isHTML,isDOM,getCallback,hookupView,funcs,noHookup={"val":true,"text":true};convert=function(func_name){var old=$.fn[func_name];$.fn[func_name]=function(){var args=makeArray(arguments),callbackNum,callback,self=this,result;if(isDeferred(args[0])){args[0].done(function(res){modify.call(self,[res],old)});return this}else if(isTemplate(args)){if(callbackNum=
getCallback(args)){callback=args[callbackNum];args[callbackNum]=function(result){modify.call(self,[result],old);callback.call(self,result)};$view.apply($view,args);return this}result=$view.apply($view,args);if(!isDeferred(result))args=[result];else{result.done(function(res){modify.call(self,[res],old)});return this}}return noHookup[func_name]?old.apply(this,args):modify.call(this,args,old)}};modify=function(args,old){var res,stub,hooks;for(var hasHookups in $view.hookups)break;if(hasHookups&&args[0]&&
isHTML(args[0])){hooks=$view.hookups;$view.hookups={};args[0]=$(args[0])}res=old.apply(this,args);if(hooks)hookupView(args[0],hooks);return res};isTemplate=function(args){var secArgType=typeof args[1];return typeof args[0]=="string"&&(secArgType=="object"||secArgType=="function")&&!isDOM(args[1])};isDOM=function(arg){return arg.nodeType||arg.jquery};isHTML=function(arg){if(isDOM(arg))return true;else if(typeof arg==="string"){arg=$.trim(arg);return arg.substr(0,1)==="<"&&arg.substr(arg.length-1,1)===
">"&&arg.length>=3}else return false};getCallback=function(args){return typeof args[3]==="function"?3:typeof args[2]==="function"&&2};hookupView=function(els,hooks){var hookupEls,len,i=0,id,func;els=els.filter(function(){return this.nodeType!=3});hookupEls=els.add("[data-view-id]",els);len=hookupEls.length;for(;i<len;i++)if(hookupEls[i].getAttribute&&(id=hookupEls[i].getAttribute("data-view-id"))&&(func=hooks[id])){func(hookupEls[i],id);delete hooks[id];hookupEls[i].removeAttribute("data-view-id")}$.extend($view.hookups,
hooks)};$.fn.hookup=function(){var hooks=$view.hookups;$view.hookups={};hookupView(this,hooks);return this};$.each(["prepend","append","after","before","text","html","replaceWith","val"],function(i,func){convert(func)})})();(function(){var myEval=function(script){eval(script)},rSplit=$.String.rsplit,extend=$.extend,isArray=$.isArray,returnReg=/\r\n/g,retReg=/\r/g,newReg=/\n/g,nReg=/\n/,slashReg=/\\/g,quoteReg=/"/g,singleQuoteReg=/'/g,tabReg=/\t/g,leftBracket=/\{/g,rightBracket=/\}/g,quickFunc=/\s*\(([\$\w]+)\)\s*->([^\n]*)/,
clean=function(content){return content.replace(slashReg,"\\\\").replace(newReg,"\\n").replace(quoteReg,'\\"').replace(tabReg,"\\t")},escapeHTML=function(content){return content.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(quoteReg,"&#34;").replace(singleQuoteReg,"&#39;")},$View=$.View,bracketNum=function(content){var lefts=content.match(leftBracket),rights=content.match(rightBracket);return(lefts?lefts.length:0)-(rights?rights.length:0)},EJS=function(options){if(this.constructor!=
EJS){var ejs=new EJS(options);return function(data,helpers){return ejs.render(data,helpers)}}if(typeof options=="function"){this.template={fn:options};return}extend(this,EJS.options,options);this.template=compile(this.text,this.type,this.name)};$&&($.EJS=EJS);EJS.prototype.render=function(object,extraHelpers){object=object||{};this._extra_helpers=extraHelpers;var v=new EJS.Helpers(object,extraHelpers||{});return this.template.fn.call(object,object,v)};extend(EJS,{text:function(input){if(typeof input==
"string")return input;if(input===null||input===undefined)return"";var hook=input.hookup&&function(el,id){input.hookup.call(input,el,id)}||typeof input=="function"&&input||isArray(input)&&function(el,id){for(var i=0;i<input.length;i++)input[i].hookup?input[i].hookup(el,id):input[i](el,id)};if(hook)return"data-view-id='"+$View.hookup(hook)+"'";return input.toString?input.toString():""},clean:function(text){if(typeof text=="string")return escapeHTML(text);else if(typeof text=="number")return text;else return EJS.text(text)},
options:{type:"[",ext:".ejs"}});var scan=function(scanner,source,block){var source_split=rSplit(source,nReg),i=0;for(;i<source_split.length;i++)scanline(scanner,source_split[i],block)},scanline=function(scanner,line,block){scanner.lines++;var line_split=rSplit(line,scanner.splitter),token;for(var i=0;i<line_split.length;i++){token=line_split[i];if(token!==null)block(token,scanner)}},makeScanner=function(left,right){var scanner={};extend(scanner,{left:left+"%",right:"%"+right,dLeft:left+"%%",dRight:"%%"+
right,eeLeft:left+"%==",eLeft:left+"%=",cmnt:left+"%#",cleanLeft:left+"%~",scan:scan,lines:0});scanner.splitter=new RegExp("("+[scanner.dLeft,scanner.dRight,scanner.eeLeft,scanner.eLeft,scanner.cmnt,scanner.left,scanner.right+"\n",scanner.right,"\n"].join(")|(").replace(/\[/g,"\\[").replace(/\]/g,"\\]")+")");return scanner},compile=function(source,left,name){source=source.replace(returnReg,"\n").replace(retReg,"\n");left=left||"[";var put_cmd="___v1ew.push(",insert_cmd=put_cmd,startTxt="var ___v1ew = [];",
finishTxt="return ___v1ew.join('')",buff=new EJS.Buffer([startTxt],[]),content="",put=function(content){buff.push(put_cmd,'"',clean(content),'");')},startTag=null,empty=function(){content=""},doubleParen="));",endStack=[];scan(makeScanner(left,left==="["?"]":">"),source||"",function(token,scanner){var bn;if(startTag===null)switch(token){case "\n":content=content+"\n";put(content);buff.cr();empty();break;case scanner.left:case scanner.eLeft:case scanner.eeLeft:case scanner.cmnt:startTag=token;if(content.length>
0)put(content);empty();break;case scanner.dLeft:content+=scanner.left;break;default:content+=token;break}else switch(token){case scanner.right:switch(startTag){case scanner.left:bn=bracketNum(content);var last=endStack.length&&bn==-1?endStack.pop():";";if(last===doubleParen)buff.push(finishTxt);buff.push(content,last);if(bn===1)endStack.push(";");break;case scanner.eLeft:bn=bracketNum(content);if(bn)endStack.push(doubleParen);if(quickFunc.test(content)){var parts=content.match(quickFunc);content=
"function(__){var "+parts[1]+"=$(__);"+parts[2]+"}"}buff.push(insert_cmd,$.globalNamespace+".EJS.clean(",content,bn?startTxt:doubleParen);break;case scanner.eeLeft:bn=bracketNum(content);if(bn)endStack.push(doubleParen);buff.push(insert_cmd,$.globalNamespace+".EJS.text(",content,bn?startTxt:doubleParen);break}startTag=null;empty();break;case scanner.dRight:content+=scanner.right;break;default:content+=token;break}});if(content.length>0)buff.push(put_cmd,'"',clean(content)+'");');var template=buff.close(),
out={out:"try { with(_VIEW) { with (_CONTEXT) {"+template+" "+finishTxt+"}}}catch(e){e.lineNumber=null;throw e;}"};myEval.call(out,"this.fn = (function(_CONTEXT,_VIEW){ var $ = "+$.globalNamespace+";"+out.out+"});");return out};EJS.Buffer=function(pre_cmd,post){this.line=[];this.script=[];this.post=post;this.push.apply(this,pre_cmd)};EJS.Buffer.prototype={push:function(){this.line.push.apply(this.line,arguments)},cr:function(){this.script.push(this.line.join(""),"\n");this.line=[]},close:function(){if(this.line.length>
0){this.script.push(this.line.join(""));this.line=[]}this.post.length&&this.push.apply(this,this.post);this.script.push(";");return this.script.join("")}};EJS.Helpers=function(data,extras){this._data=data;this._extras=extras;extend(this,extras)};EJS.Helpers.prototype={plugin:function(name){var args=$.makeArray(arguments),widget=args.shift();return function(el){var jq=$(el);jq[widget].apply(jq,args)}},view:function(url,data,helpers){helpers=helpers||this._extras;data=data||this._data;return $View(url,
data,helpers)}};$View.register({suffix:"ejs",script:function(id,src){console.log(src);return $.globalNamespace+".EJS(function(_CONTEXT,_VIEW) { "+(new EJS({text:src,name:id})).template.out+" })"},renderer:function(id,text){return EJS({text:text,name:id})}})})();(function(){var isArray=$.isArray,isObject=function(obj){return typeof obj==="object"&&obj!==null&&obj},makeArray=$.makeArray,each=$.each,hookup=function(val,prop,parent){if(val instanceof $.Observe)unhookup([val],parent._namespace);else if(isArray(val))val=
new $.Observe.List(val);else val=new $.Observe(val);val.bind("change"+parent._namespace,function(ev,attr){var args=$.makeArray(arguments),ev=args.shift();if(prop==="*")args[0]=parent.indexOf(val)+"."+args[0];else args[0]=prop+"."+args[0];$.event.trigger(ev,args,parent)});return val},unhookup=function(items,namespace){var item;for(var i=0;i<items.length;i++){item=items[i];if(item&&item.unbind)item.unbind("change"+namespace)}},id=0,collecting=null,collect=function(){if(!collecting){collecting=[];return true}},
trigger=function(item,event,args){if(item._init)return;if(!collecting)return $.event.trigger(event,args,item,true);else collecting.push({t:item,ev:event,args:args})},batchNum=0,sendCollection=function(){var len=collecting.length,items=collecting.slice(0),cur;collecting=null;batchNum++;for(var i=0;i<len;i++){cur=items[i];$.event.trigger({type:cur.ev,batchNum:batchNum},cur.args,cur.t)}},serialize=function(observe,how,where){observe.each(function(name,val){where[name]=isObject(val)&&typeof val[how]==
"function"?val[how]():val});return where};$.Class($.globalNamespace+".Observe",{init:function(obj){this._data={};this._namespace=".observe"+ ++id;this._init=true;this.attrs(obj);delete this._init},attr:function(attr,val){if(val===undefined)return this._get(attr);else{this._set(attr,val);return this}},each:function(){return each.apply(null,[this.__get()].concat(makeArray(arguments)))},removeAttr:function(attr){var parts=isArray(attr)?attr:attr.split("."),prop=parts.shift(),current=this._data[prop];
if(parts.length)return current.removeAttr(parts);else{delete this._data[prop];trigger(this,"change",[prop,"remove",undefined,current]);return current}},_get:function(attr){var parts=isArray(attr)?attr:(""+attr).split("."),current=this.__get(parts.shift());if(parts.length)return current?current._get(parts):undefined;else return current},__get:function(attr){return attr?this._data[attr]:this._data},_set:function(attr,value){var parts=isArray(attr)?attr:(""+attr).split("."),prop=parts.shift(),current=
this.__get(prop);if(isObject(current)&&parts.length)current._set(parts,value);else if(!parts.length){if(value!==current){var changeType=this.__get().hasOwnProperty(prop)?"set":"add";this.__set(prop,isObject(value)?hookup(value,prop,this):value);trigger(this,"change",[prop,changeType,value,current]);current&&unhookup([current],this._namespace)}}else throw"jQuery.Observe: set a property on an object that does not exist";},__set:function(prop,val){this._data[prop]=val;if(!(prop in this.constructor.prototype))this[prop]=
val},bind:function(eventType,handler){$.fn.bind.apply($([this]),arguments);return this},unbind:function(eventType,handler){$.fn.unbind.apply($([this]),arguments);return this},serialize:function(){return serialize(this,"serialize",{})},attrs:function(props,remove){if(props===undefined)return serialize(this,"attrs",{});props=$.extend(true,{},props);var prop,collectingStarted=collect();for(prop in this._data){var curVal=this._data[prop],newVal=props[prop];if(newVal===undefined){remove&&this.removeAttr(prop);
continue}if(isObject(curVal)&&isObject(newVal))curVal.attrs(newVal,remove);else if(curVal!=newVal)this._set(prop,newVal);else;delete props[prop]}for(var prop in props){newVal=props[prop];this._set(prop,newVal)}if(collectingStarted)sendCollection()}});var list=$.Observe($.globalNamespace+".Observe.List",{init:function(instances,options){this.length=0;this._namespace=".list"+ ++id;this._init=true;this.bind("change",this.proxy("_changes"));this.push.apply(this,makeArray(instances||[]));$.extend(this,
options);if(this.comparator)this.sort();delete this._init},_changes:function(ev,attr,how,newVal,oldVal){if(this.comparator&&/^\d+./.test(attr)){var index=+/^\d+/.exec(attr)[0],item=this[index],newIndex=this.sortedIndex(item);if(newIndex!==index){[].splice.call(this,index,1);[].splice.call(this,newIndex,0,item);trigger(this,"move",[item,newIndex,index]);ev.stopImmediatePropagation();trigger(this,"change",[attr.replace(/^\d+/,newIndex),how,newVal,oldVal]);return}}if(attr.indexOf(".")===-1)if(how===
"add")trigger(this,how,[newVal,+attr]);else if(how==="remove")trigger(this,how,[oldVal,+attr])},sortedIndex:function(item){var itemCompare=item.attr(this.comparator),equaled=0,i;for(var i=0;i<this.length;i++){if(item===this[i]){equaled=-1;continue}if(itemCompare<=this[i].attr(this.comparator))return i+equaled}return i+equaled},__get:function(attr){return attr?this[attr]:this},__set:function(attr,val){this[attr]=val},serialize:function(){return serialize(this,"serialize",[])},splice:function(index,
count){var args=makeArray(arguments),i;for(i=2;i<args.length;i++){var val=args[i];if(isObject(val))args[i]=hookup(val,"*",this)}if(count===undefined)count=args[1]=this.length-index;var removed=[].splice.apply(this,args);if(count>0){trigger(this,"change",[""+index,"remove",undefined,removed]);unhookup(removed,this._namespace)}if(args.length>2)trigger(this,"change",[""+index,"add",args.slice(2),removed]);return removed},attrs:function(props,remove){if(props===undefined)return serialize(this,"attrs",
[]);props=props.slice(0);var len=Math.min(props.length,this.length),collectingStarted=collect();for(var prop=0;prop<len;prop++){var curVal=this[prop],newVal=props[prop];if(isObject(curVal)&&isObject(newVal))curVal.attrs(newVal,remove);else if(curVal!=newVal)this._set(prop,newVal);else;}if(props.length>this.length)this.push(props.slice(this.length));else if(props.length<this.length&&remove)this.splice(props.length);if(collectingStarted)sendCollection()},sort:function(method,silent){var comparator=
this.comparator,args=comparator?[function(a,b){a=a[comparator];b=b[comparator];return a===b?0:a<b?-1:1}]:[],res=[].sort.apply(this,args);!silent&&trigger(this,"reset")}}),getArgs=function(args){if(args[0]&&$.isArray(args[0]))return args[0];else return makeArray(args)};each({push:"length",unshift:0},function(name,where){list.prototype[name]=function(){var args=getArgs(arguments),len=where?this.length:0;for(var i=0;i<args.length;i++){var val=args[i];if(isObject(val))args[i]=hookup(val,"*",this)}if(args.length==
1&&this.comparator){var index=this.sortedIndex(args[0]);this.splice(index,0,args[0]);return this.length}var res=[][name].apply(this,args);if(this.comparator&&args.length>1){this.sort(null,true);trigger(this,"reset",[args])}else trigger(this,"change",[""+len,"add",args,undefined]);return res}});each({pop:"length",shift:0},function(name,where){list.prototype[name]=function(){var args=getArgs(arguments),len=where&&this.length?this.length-1:0;var res=[][name].apply(this,args);trigger(this,"change",[""+
len,"remove",undefined,[res]]);if(res&&res.unbind)res.unbind("change"+this._namespace);return res}});list.prototype.indexOf=[].indexOf||function(item){return $.inArray(item,this)};$.O=function(data,options){if(isArray(data)||data instanceof $.Observe.List)return new $.Observe.List(data,options);else return new $.Observe(data,options)}})()});
