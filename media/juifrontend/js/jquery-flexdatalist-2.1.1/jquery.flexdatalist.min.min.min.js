jQuery.fn.flexdatalist=function(_option,_value){var destroy=function($flex){$flex.each(function(){var $this=$(this),data=$this.data("flexdatalist");$this.removeClass("flexdatalist-set").attr("type","text").val(data&&data.originalValue?data.originalValue:"").removeData("flexdatalist").next(".flexdatalist-alias, ul.flexdatalist-multiple").remove()})};if(typeof _option==="string"&&_option!=="reset"){var target=this[0];if(_option==="destroy")destroy($(this));else if(_option==="value"){if(typeof _value===
"undefined")return target.fvalue.get();target.fvalue.set(_value)}else if(_option==="add"){if(typeof _value==="undefined")return target.debug("Missing value to add!");target.fvalue.add(_value)}else if(_option==="toggle"){if(typeof _value==="undefined")return target.debug("Missing value to toggle!");target.fvalue.toggle(_value)}else if(_option==="remove"){if(typeof _value==="undefined")return target.debug("Missing value to remove!");target.fvalue.remove(_value)}else if(_option==="disabled"){if(typeof _value===
"undefined")return target.fdisabled();target.fdisabled(_value)}else if(typeof _option==="string"){if(typeof _value==="undefined")return target.options.get(_option);target.options.set(_option,_value)}return this}if(this&&typeof this[0]!=="undefined"&&typeof this[0].fvalue!=="undefined")destroy($(this));var $=jQuery;var _options=$.extend({url:null,data:[],params:{},relatives:null,chainedRelatives:false,cache:true,cacheLifetime:60,minLength:2,groupBy:false,selectionRequired:false,focusFirstResult:false,
textProperty:null,valueProperty:null,visibleProperties:[],iconProperty:"thumb",searchIn:["label"],searchContain:false,searchEqual:false,searchByWord:false,searchDisabled:false,searchDelay:300,normalizeString:null,multiple:null,disabled:null,maxShownResults:100,removeOnBackspace:true,noResultsText:'No results found for "{keyword}"',toggleSelected:false,allowDuplicateValues:false,redoSearchOnFocus:true,requestType:"get",requestContentType:"x-www-form-urlencoded",resultsProperty:"results",keywordParamName:"keyword",
limitOfValues:0,valuesSeparator:",",debug:true},_option);return this.each(function(id){var $this=$(this),_this=this,_searchTimeout=null,_values=[],fid="flex"+id,$alias=null,$multiple=null;this.init=function(){var options=this.options.init();this.set.up();this.fvalue.clear()._load(options.originalValue,function(){_this.fdisabled(options.disabled)});$alias.on("focusin",function(event){_this.action.redoSearchFocus(event);_this.action.showAllResults(event);if($multiple)$multiple.addClass("focus")}).on("input keydown",
function(event){if(_this.keyNum(event)===9)_this.results.remove();_this.action.keypressValue(event,188);_this.action.backSpaceKeyRemove(event)}).on("input keyup",function(event){_this.action.keypressValue(event,13);_this.action.keypressSearch(event);_this.action.copyValue(event);_this.action.backSpaceKeyRemove(event)}).on("focusout",function(){if($multiple)$multiple.removeClass("focus")});window.onresize=function(event){_this.position()}};this.action={keypressValue:function(event,keyCode){var key=
_this.keyNum(event),val=$alias[0].value,options=_this.options.get();if(val.length>0&&key===keyCode&&!options.selectionRequired&&options.multiple){var val=$alias[0].value;event.preventDefault();_this.fvalue.extract(val);_this.results.remove()}},keypressSearch:function(event){var key=_this.keyNum(event),keyword=$alias.val(),length=keyword.length,options=_this.options.get();clearTimeout(_searchTimeout);if(options.minLength===0&&length===0&&(key===9||key===16))return;if(length===0&&options.minLength>
0||length<options.minLength)_this.results.remove();else if(!key||key!==13&&(key<37||key>40)){_this.results.remove();_searchTimeout=setTimeout(function(){if(options.minLength===0&&length>0||options.minLength>0&&length>=options.minLength)_this.data.load(function(data){_this.search.get(keyword,data,function(matches){_this.results.show(matches)})});else _this.results.remove()},options.searchDelay)}},redoSearchFocus:function(event){var val=_this.fvalue.get(),options=_this.options.get(),alias=$alias.val();
if(options.redoSearchOnFocus&&(alias.length>0&&options.multiple||alias.length>0&&val.length===0))this.keypressSearch(event)},copyValue:function(event){if(_this.keyNum(event)!==13){var keyword=$alias.val(),options=_this.options.get();if(!options.multiple)if(!options.selectionRequired){_this.fvalue.extract(keyword);if(keyword.length===0)_values=[]}else _this.fvalue.clear()}},backSpaceKeyRemove:function(event){var options=_this.options.get();if(options.removeOnBackspace){var val=$alias.val(),$remove=
$alias.data("_remove");if($remove){_this.fvalue.remove($remove);$alias.data("_remove",null)}else if(val.length===0&&options.multiple&&_this.keyNum(event)===8)$alias.data("_remove",$alias.parents("li:eq(0)").prev())}},showAllResults:function(event){var val=$alias.val();val=$.trim(val);if(val===""&&_this.options.get("minLength")===0)_this.data.load(function(data){_this.results.show(data)})}};this.set={up:function(){$alias=this.alias();if(_this.options.get("multiple"))$multiple=this.multipleInput($alias);
else $alias.insertAfter($this);if($alias.attr("autofocus"))$alias.focus();this.chained()},alias:function(){var $alias=$this.clone(false).attr({"list":null,"name":$this.attr("name")?"flexdatalist-"+$this.attr("name"):null,"id":$this.attr("id")?$this.attr("id")+"-flexdatalist":null,"value":""}).addClass("flexdatalist-alias").removeClass("flexdatalist").attr("autocomplete","off");$this.addClass("flexdatalist flexdatalist-set").prop("type","hidden");return $alias},multipleInput:function($alias){$multiple=
$('<ul tabindex="1">').addClass("flexdatalist-multiple").css({"border-color":$this.css("border-left-color"),"border-width":$this.css("border-left-width"),"border-style":$this.css("border-left-style"),"border-radius":$this.css("border-top-left-radius"),"background-color":$this.css("background-color")}).insertAfter($this).click(function(){$(this).find("input").focus()});$('<li class="input-container">').addClass("flexdatalist-multiple-value").append($alias).appendTo($multiple);return $multiple},chained:function(){var options=
_this.options.get();if(options.relatives&&options.chainedRelatives){var toggle=function(init){options.relatives.each(function(){var emptyRelative=_this.isEmpty($(this).val()),empty=_this.isEmpty($this[0].value);if(emptyRelative||!empty)_this.fvalue.clear();_this.fdisabled(emptyRelative)})};options.relatives.on("change",function(){toggle()});toggle(true)}}};this.fvalue={get:function(asString){var val=_this.value,options=_this.options.get();if((options.multiple||this.isJSON())&&!asString)return this.toObj(val);
return val},set:function(val,append){if(!_this.fdisabled()){if(!append)this.clear(true);this._load(val)}return $this},add:function(val){if(_this.options.get("multiple"))this.set(val,true);return this},toggle:function(val){if(!_this.fdisabled())this.multiple.toggle(val);return this},remove:function(val){if(!_this.fdisabled()){val=this.toObj(val);$this.trigger("before:flexdatalist.remove",[val]);var result=[];if($.isArray(val))$.each(val,function(i,value){var removed=_this.fvalue.multiple.remove(value);
if(removed)result.push(removed)});else{var _result=this.multiple.remove(val);if(_result)result.push(_result)}$this.trigger("after:flexdatalist.remove",[val,result]).trigger("change:flexdatalist",[result,_this.options.get()]).trigger("change")}return this},_load:function(values,callback){var options=_this.options.get(),_values=this.toStr(values),_val=this.get(true);callback=callback?callback:$.noop;if(_values.length==0&&_val.length==0){callback(values);return}values=this.toObj(values);if(!_this.isEmpty(values)&&
typeof options.valueProperty==="string"&&!this.isJSON(values)){var _searchIn=options.searchIn,_searchEqual=options.searchEqual;options.searchIn=options.valueProperty.split(",");options.searchEqual=true;_this.data.load(function(data){_this.search.get(values,data,function(matches){if(!_this.isEmpty(matches))_this.fvalue.extract(matches);callback(values);options.searchIn=_searchIn;options.searchEqual=_searchEqual})},values);return}_this.fvalue.extract(values);callback(values)},extract:function(values){var options=
_this.options.get(),result=[];$this.trigger("before:flexdatalist.value",[values,options]);if($.isArray(values))$.each(values,function(i,value){result.push(_this.fvalue._extract(value))});else result=_this.fvalue._extract(values);$this.trigger("after:flexdatalist.value",[result,options]).trigger("change:flexdatalist",[result,options]).trigger("change")},_extract:function(val){var txt=this.text(val),value=this.value(val),current=$this[0].value,options=_this.options.get();if(options.multiple){if(!_this.isEmpty(txt)){if(_this.isDup(txt))return;
_values.push(txt);this.multiple.add(value,txt)}}else this.single(value,txt);return{value:value,text:txt}},single:function(val,txt){if(txt&&txt!==$alias.val())$alias.val(txt,true);$this[0].value=val},multiple:{add:function(val,txt){var _multiple=this,$li=this.li(val,txt),options=_this.options.get();$li.click(function(){_multiple.toggle($(this))}).find(".fdl-remove").click(function(){_multiple.remove($(this).parent())});this.push(val);$alias.val("",true);this.checkLimit()},push:function(val,index){var current=
_this.fvalue.get();val=_this.fvalue.toObj(val);current.push(val);val=_this.fvalue.toStr(current);$this[0].value=val},toggle:function(val){var options=_this.options.get();if(!options.toggleSelected)return;var $li=this.findLi(val);if($li){var index=$li.index(),data=$li.data(),action=$li.hasClass("disabled")?"enable":"disable",current=_this.fvalue.get(),args=[{value:data.value,text:data.text,action:action},options];$this.trigger("before:flexdatalist.toggle",args);if(action==="enable"){var value=$li.data("value");
current.splice(index,0,value);$li.removeClass("disabled")}else{current.splice(index,1);$li.addClass("disabled")}current=_this.fvalue.toStr(current);_this.value=current;$this.trigger("after:flexdatalist.toggle",args).trigger("change:flexdatalist",args).trigger("change")}},remove:function(val){var $li=this.findLi(val);if($li){var values=_this.fvalue.get(),index=$li.index(),data=$li.data(),options=_this.options.get(),arg={value:data.value,text:data.text};values.splice(index,1);values=_this.fvalue.toStr(values);
$this[0].value=values;$li.remove();_this.fvalue.multiple.checkLimit();_values.splice(index,1);return arg}},removeAll:function(){var values=_this.fvalue.get(),options=_this.options.get();$this.trigger("before:flexdatalist.remove.all",[values,options]);$multiple.find("li:not(.input-container)").remove();$this[0].value="";_values=[];$this.trigger("after:flexdatalist.remove.all",[values,options])},li:function(val,txt){var $inputContainer=$multiple.find("li.input-container");return $("<li>").addClass("value"+
(_this.options.get("toggleSelected")?" toggle":"")).append('<span class="text">'+txt+"</span>").append('<span class="fdl-remove">&times;</span>').data({"text":txt,"value":val}).insertBefore($inputContainer)},checkLimit:function(){var limit=_this.options.get("limitOfValues");if(limit>0){var $input=$multiple.find("li.input-container"),count=_values.length;limit==count?$input.hide():$input.show()}},findLi:function($li){if(!($li instanceof jQuery)){var val=$li;$li=null;$multiple.find("li:not(.input-container)").each(function(){var $_li=
$(this);if($_li.data("value")===val){$li=$_li;return false}})}else if($li.length===0)$li=null;return $li},isEmpty:function(){return this.get().length>0}},value:function(item){var value=item,options=_this.options.get();if(_this.isObject(item))if(this.isJSON()||this.isMixed()){delete item.name_highlight;value=this.toStr(item)}else if(_this.isDefined(item,options.valueProperty))value=item[options.valueProperty];else if(_this.isDefined(item,options.searchIn[0]))value=item[options.searchIn[0]];else value=
null;return value},text:function(item){var text=item,options=_this.options.get();if(_this.isObject(item)){text=item[options.searchIn[0]];if(_this.isDefined(item,options.textProperty))text=item[options.textProperty];else text=this.placeholders.replace(item,options.textProperty,text)}return $("<div>").html(text).text()},placeholders:{replace:function(item,pattern,fallback){if(_this.isObject(item)&&typeof pattern==="string"){var properties=this.parse(pattern);if(!_this.isEmpty(item)&&properties){$.each(properties,
function(string,property){if(_this.isDefined(item,property))pattern=pattern.replace(string,item[property])});return pattern}}return fallback},parse:function(pattern){var matches=pattern.match(/\{.+?\}/g);if(matches){var properties={};matches.map(function(string){properties[string]=string.slice(1,-1)});return properties}return false}},clear:function(alias){var current=$this[0].value,options=_this.options.get();if(options.multiple)this.multiple.removeAll();$this[0].value="";if(current!=="")$this.trigger("change:flexdatalist",
[null,options]).trigger("change");if(alias)$alias[0].value="";_values=[];return this},toObj:function(val){if(typeof val!=="object"){var options=_this.options.get();if(_this.isEmpty(val)||!_this.isDefined(val))val=options.multiple?[]:this.isJSON()?{}:"";else if(this.isCSV()){val=val.toString().split(options.valuesSeparator);val=$.map(val,function(v){return $.trim(v)})}else if(this.isJSON()||this.isMixed()&&this.isJSON(val))val=JSON.parse(val)}return val},toStr:function(val){if(typeof val!=="string")if(_this.isEmpty(val)||
!_this.isDefined(val))val="";else if(typeof val==="number")val=val.toString();else if(this.isCSV())val=val.join(_this.options.get("valuesSeparator"));else if(this.isJSON()||this.isMixed())val=JSON.stringify(val);return $.trim(val)},isJSON:function(str){if(typeof str!=="undefined"){if(_this.isObject(str))str=JSON.stringify(str);else if(typeof str!=="string")return false;return str.indexOf("{")===0||str.indexOf("[{")===0}var options=_this.options.get(),prop=options.valueProperty;return options.selectionRequired&&
(_this.isObject(prop)||prop==="*")},isMixed:function(){var options=_this.options.get();return!options.selectionRequired&&options.valueProperty==="*"},isCSV:function(){return!this.isJSON()&&_this.options.get("multiple")}};this.data={load:function(callback,load){var __this=this,data=[];$this.trigger("before:flexdatalist.data");this.url(function(remote){data=data.concat(remote);__this.static(function(_static){data=data.concat(_static);__this.datalist(function(list){data=data.concat(list);$this.trigger("after:flexdatalist.data",
[data]);callback(data)})})},load)},static:function(callback){var __this=this,options=_this.options.get();if(typeof options.data==="string"){var url=options.data,cache=_this.cache.read(url,true);if(cache){callback(cache);return}this.remote({url:url,success:function(data){options.data=data;callback(data);_this.cache.write(url,data,options.cacheLifetime,true)}})}else{if(typeof options.data!=="object")options.data=[];callback(options.data)}},datalist:function(callback){var list=$this.attr("list"),datalist=
[];if(!_this.isEmpty(list))$("#"+list).find("option").each(function(){var $option=$(this),val=$option.val(),label=$option.text();datalist.push({label:label.length>0?label:val,value:val})});callback(datalist)},url:function(callback,load){var __this=this,keyword=$alias.val(),options=_this.options.get(),keywordParamName=options.keywordParamName,value=_this.fvalue.get(),relatives=this.relativesData();if(_this.isEmpty(options.url))return callback([]);var _opts={};if(options.requestType==="post"){$.each(options,
function(option,value){if(option.indexOf("_")==0||option=="data")return;_opts[option]=value});delete _opts.relatives}var cacheKey=_this.cache.keyGen({relative:relatives,load:load,keyword:keyword,contain:options.searchContain},options.url),cache=_this.cache.read(cacheKey);if(cache){callback(cache);return}var data=$.extend(relatives,options.params,{load:load,contain:options.searchContain,selected:value,original:options.originalValue,options:_opts});data[keywordParamName]=keyword;this.remote({url:options.url,
data:data,success:function(_data){var _keyword=$alias.val();if(_keyword.length>=keyword.length)callback(_data);_this.cache.write(cacheKey,_data,options.cacheLifetime)}})},remote:function(settings){var __this=this,options=_this.options.get();if($this.hasClass("flexdatalist-loading"))return;$this.addClass("flexdatalist-loading");if(options.requestContentType==="json")settings.data=JSON.stringify(data);$.ajax($.extend({type:options.requestType,dataType:"json",contentType:"application/"+options.requestContentType+
"; charset=UTF-8",complete:function(){$this.removeClass("flexdatalist-loading")}},settings,{success:function(data){data=__this.extractRemoteData(data);settings.success(data)}}))},extractRemoteData:function(data){var options=_this.options.get(),_data=_this.isDefined(data,options.resultsProperty)?data[options.resultsProperty]:data;if(typeof _data==="string"&&_data.indexOf("[{")===0)_data=JSON.parse(_data);if(_data&&_data.options)_this.options.set($.extend({},options,_data.options));if(_this.isObject(_data))return _data;
return[]},relativesData:function(){var relatives=_this.options.get("relatives"),data={};if(relatives){data["relatives"]={};relatives.each(function(){var $_input=$(this),name=$_input.attr("name").split("][").join("-").split("]").join("-").split("[").join("-").replace(/^\|+|\-+$/g,"");data["relatives"][name]=$_input.val()})}return data}};this.search={get:function(keywords,data,callback){var __this=this,options=_this.options.get();if(!options.searchDisabled){var matches=_this.cache.read(keywords);if(!matches){$this.trigger("before:flexdatalist.search",
[keywords,data]);if(!_this.isEmpty(keywords)){matches=[];var words=__this.split(keywords);for(var index=0;index<data.length;index++){var item=data[index];if(_this.isDup(item))continue;item=__this.matches(item,words);if(item)matches.push(item)}}_this.cache.write(keywords,matches,2);$this.trigger("after:flexdatalist.search",[keywords,data,matches])}}else matches=data;callback(matches)},matches:function(item,keywords){var hasMatches=false,_item=$.extend({},item),found=[],options=_this.options.get(),
searchIn=options.searchIn;if(keywords.length>0)for(var index=0;index<searchIn.length;index++){var searchProperty=searchIn[index];if(!_this.isDefined(item,searchProperty)||!item[searchProperty])continue;var text=item[searchProperty].toString(),highlight=text,strings=this.split(text);for(var kwindex=0;kwindex<keywords.length;kwindex++){var keyword=keywords[kwindex];if(this.find(keyword,strings)){found.push(keyword);highlight=this.highlight(keyword,highlight)}}if(highlight!==text)_item[searchProperty+
"_highlight"]=this.highlight(highlight)}if(found.length===0||options.searchByWord&&found.length<keywords.length-1)return false;return _item},highlight:function(keyword,text){if(text)return text.replace(new RegExp(keyword,_this.options.get("searchContain")?"ig":"i"),"|:|$&|::|");keyword=keyword.split("|:|").join('<span class="highlight">');return keyword.split("|::|").join("</span>")},find:function(keyword,splitted){var options=_this.options.get();for(var index=0;index<splitted.length;index++){var text=
splitted[index];text=this.normalizeString(text),keyword=this.normalizeString(keyword);if(options.searchEqual)return text==keyword;if(options.searchContain?text.indexOf(keyword)>=0:text.indexOf(keyword)===0)return true}return false},split:function(keywords){if(typeof keywords==="string")keywords=[$.trim(keywords)];if(_this.options.get("searchByWord"))for(var index=0;index<keywords.length;index++){var keyword=$.trim(keywords[index]);if(keyword.indexOf(" ")>0){var words=keyword.split(" ");$.merge(keywords,
words)}}return keywords},normalizeString:function(string){if(typeof string==="string"){var normalizeString=_this.options.get("normalizeString");if(typeof normalizeString==="function")string=normalizeString(string);return string.toUpperCase()}return string}};this.results={show:function(results){var __this=this,options=_this.options.get();this.remove(true);if(!results)return;else if(results.length===0){this.empty(options.noResultsText);return}var $ul=this.container();if(!options.groupBy)this.items(results,
$ul);else{results=this.group(results);Object.keys(results).forEach(function(groupName,index){var items=results[groupName],property=options.groupBy,groupText=_this.results.highlight(items[0],property,groupName);var $li=$("<li>").addClass("group").append($("<span>").addClass("group-name").html(groupText)).append($("<span>").addClass("group-item-count").text(" "+items.length)).appendTo($ul);__this.items(items,$ul)})}var $li=$ul.find("li:not(.group)");$li.on("click",function(event){var item=$(this).data("item");
if(item){_this.fvalue.extract(item);__this.remove();$this.trigger("select:flexdatalist",[item,options])}}).hover(function(){$li.removeClass("active");$(this).addClass("active")},function(){$(this).removeClass("active")});if(options.focusFirstResult)$li.filter(":first").addClass("active")},empty:function(text){if(_this.isEmpty(text))return;var $container=this.container(),keyword=$alias.val();text=text.split("{keyword}").join(keyword);$("<li>").addClass("item no-results").append(text).appendTo($container)},
items:function(items,$resultsContainer){var max=_this.options.get("maxShownResults");$this.trigger("show:flexdatalist.results",[items]);for(var index=0;index<items.length;index++){if(max>0&&max===index)break;this.item(items[index]).appendTo($resultsContainer)}$this.trigger("shown:flexdatalist.results",[items])},item:function(item){var $li=$("<li>").data("item",item).addClass("item"),options=_this.options.get(),visibleProperties=options.visibleProperties;for(var index=0;index<visibleProperties.length;index++){var visibleProperty=
visibleProperties[index];if(options.groupBy&&options.groupBy===visibleProperty||!_this.isDefined(item,visibleProperty))continue;var $item={};if(visibleProperty===options.iconProperty)$item=$("<img>").addClass("item item-"+visibleProperty).attr("src",item[visibleProperty]);else{var propertyText=_this.results.highlight(item,visibleProperty);$item=$("<span>").addClass("item item-"+visibleProperty).html(propertyText+" ")}$item.appendTo($li)}return $li},container:function(){var $target=$this;if($multiple)$target=
$multiple;var $container=$("ul.flexdatalist-results");if($container.length===0){$container=$("<ul>").addClass("flexdatalist-results").appendTo("body").css({"border-color":$target.css("border-left-color"),"border-width":"1px","border-bottom-left-radius":$target.css("border-bottom-left-radius"),"border-bottom-right-radius":$target.css("border-bottom-right-radius")}).data({target:$alias,input:$this});_this.position($alias)}return $container},group:function(results){var data=[],groupProperty=_this.options.get("groupBy");
for(var index=0;index<results.length;index++){var _data=results[index];if(_this.isDefined(_data,groupProperty)){var propertyValue=_data[groupProperty];if(!_this.isDefined(data,propertyValue))data[propertyValue]=[];data[propertyValue].push(_data)}}return data},highlight:function(item,property,fallback){if(_this.isDefined(item,property+"_highlight"))return item[property+"_highlight"];return _this.isDefined(item,property)?item[property]:fallback},remove:function(itemsOnly){var selector="ul.flexdatalist-results";
if(itemsOnly)selector="ul.flexdatalist-results li";$(selector).remove();$this.trigger("removed:flexdatalist.results")}};this.cache={write:function(key,value,lifetime,global){if(_this.cache.isSupported()){key=this.keyGen(key,undefined,global);var object={value:value,timestamp:_this.unixtime(),lifetime:lifetime?lifetime:false};localStorage.setItem(key,JSON.stringify(object))}},read:function(key,global){if(_this.cache.isSupported()){key=this.keyGen(key,undefined,global);var data=localStorage.getItem(key);
if(data){var object=JSON.parse(data);if(object.lifetime){var diff=_this.unixtime()-object.timestamp;if(object.lifetime>diff)return object.value;_this.cache.delete(key);return null}return object.value}}return null},delete:function(key,global){if(_this.cache.isSupported()){key=this.keyGen(key,undefined,global);localStorage.removeItem(key)}},clear:function(){if(_this.cache.isSupported()){for(var key in localStorage)if(key.indexOf(fid)>-1||key.indexOf("global")>-1)_this.cache.delete(key);localStorage.clear()}},
isSupported:function(){if(_this.options.get("cache"))try{return"localStorage"in window&&window["localStorage"]!==null}catch(e){return false}return false},keyGen:function(str,seed,global){if(typeof str==="object")str=JSON.stringify(str);var i,l,hval=seed===undefined?2166136261:seed;for(i=0,l=str.length;i<l;i++){hval^=str.charCodeAt(i);hval+=(hval<<1)+(hval<<4)+(hval<<7)+(hval<<8)+(hval<<24)}return(global?"global":fid)+("0000000"+(hval>>>0).toString(16)).substr(-8)}};this.options={init:function(){var options=
$.extend({},_options,$this.data(),{multiple:_options.multiple===null?$this.is("[multiple]"):_options.multiple,disabled:_options.disabled===null?$this.is("[disabled]"):_options.disabled,originalValue:$this[0].value});this.set(options);return options},get:function(option){var options=$this.data("flexdatalist");if(!option)return options;return _this.isDefined(options,option)?options[option]:null},set:function(option,value){var options=this.get();if(_this.isDefined(options,option)&&_this.isDefined(value))options[option]=
value;else if(_this.isObject(option))options=this._normalize(option);$this.data("flexdatalist",options);return $this},_normalize:function(options){options.searchIn=_this.csvToArray(options.searchIn);options.relatives=options.relatives&&$(options.relatives).length>0?$(options.relatives):null;options.textProperty=options.textProperty===null?options.searchIn[0]:options.textProperty;options.visibleProperties=_this.csvToArray(options.visibleProperties,options.searchIn);if(options.valueProperty==="*"&&
options.multiple&&!options.selectionRequired)throw new Error("Selection must be required for multiple, JSON fields!");return options}};this.position=function(){var $target=$alias;if($multiple)$target=$multiple;$("ul.flexdatalist-results").css({"width":$target.outerWidth()+"px","top":$target.offset().top+$target.outerHeight()+"px","left":$target.offset().left+"px"})};this.fdisabled=function(disabled){if(this.isDefined(disabled)){$this.prop("disabled",disabled);$alias.prop("disabled",disabled);if($multiple){$multiple.css("background-color",
$this.css("background-color"));var $btns=$multiple.find("li .fdl-remove"),$input=$multiple.find("li.input-container");if(disabled){$multiple.addClass("disabled");$input.hide();$btns.hide()}else{$multiple.removeClass("disabled");$input.show();$btns.show()}}this.options.set("disabled",disabled)}return this.options.get("disabled")};this.isDup=function(val){if(!this.options.get("allowDuplicateValues"))return _values.length>0&&_values.indexOf(this.fvalue.text(val))>-1;return false};this.keyNum=function(event){return event.which||
event.keyCode};this.isEmpty=function(value){if(!_this.isDefined(value))return true;else if(value===null)return true;else if(value===true)return false;else if(this.length(value)===0)return true;else if($.trim(value)==="")return true;return false};this.isObject=function(value){return value&&typeof value==="object"};this.length=function(value){if(this.isObject(value))return Object.keys(value).length;else if(typeof value==="number"||typeof value.length==="number")return value.toString().length;return 0};
this.isDefined=function(variable,property){var _variable=typeof variable!=="undefined";if(_variable&&typeof property!=="undefined")return typeof variable[property]!=="undefined";return _variable};this.unixtime=function(time){var date=new Date;if(time)date=new Date(time);return Math.round(date.getTime()/1E3)};this.csvToArray=function(value,_default){if(value.length===0)return _default;return typeof value==="string"?value.split(_this.options.get("valuesSeparator")):value};this.debug=function(msg,data){var options=
_this.options.get();if(!options.debug)return;if(!data)data={};msg="Flexdatalist: "+msg;console.warn(msg);console.log($.extend({inputName:$this.attr("name"),options:options},data));console.log("--- /flexdatalist ---")};this.init()})};
jQuery(function($){var $document=$(document);if(!$document.data("flexdatalist"))$(document).mouseup(function(event){var $container=$(".flexdatalist-results"),$target=$container.data("target");if((!$target||!$target.is(":focus"))&&!$container.is(event.target)&&$container.has(event.target).length===0)$container.remove()}).keydown(function(event){var $ul=$(".flexdatalist-results"),$li=$ul.find("li"),$active=$li.filter(".active"),index=$active.index(),length=$li.length,keynum=event.which||event.keyCode;
if(length===0)return;if(keynum===27){$ul.remove();return}if(keynum===13){event.preventDefault();$active.click()}else if(keynum===40||keynum===38){event.preventDefault();if(keynum===40)if(index<length&&$active.nextAll(".item").first().length>0)$active=$active.removeClass("active").nextAll(".item").first().addClass("active");else $active=$li.removeClass("active").filter(".item:first").addClass("active");else if(keynum===38)if(index>0&&$active.prevAll(".item").first().length>0)$active=$active.removeClass("active").prevAll(".item").first().addClass("active");
else $active=$li.removeClass("active").filter(".item:last").addClass("active");var position=($active.prev().length===0?$active:$active.prev()).position().top;$ul.animate({scrollTop:position+$ul.scrollTop()},100)}}).data("flexdatalist",true);jQuery("input.flexdatalist:not(.flexdatalist-set)").flexdatalist()});
(function($){var jVal=$.fn.val;$.fn.val=function(value){var isFlex=$(this).hasClass("flexdatalist");if(typeof value==="undefined")return isFlex?this[0].fvalue.get(true):jVal.call(this);return isFlex?this[0].fvalue.set(value):jVal.call(this,value)}})(jQuery);
