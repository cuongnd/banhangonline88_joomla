EasyDiscuss.module("comments",function(e){var t=this;EasyDiscuss.require().language("COM_EASYDISCUSS_TERMS_PLEASE_ACCEPT","COM_EASYDISCUSS_COMMENT_SUCESSFULLY_ADDED","COM_EASYDISCUSS_COMMENT_LOAD_MORE","COM_EASYDISCUSS_COMMENT_LOADING_MORE_COMMENTS","COM_EASYDISCUSS_COMMENT_LOAD_ERROR").done(function(){EasyDiscuss.Controller("Comment.List",{defaultOptions:{"{commentItems}":".commentItem"}},function(e){return{init:function(){e.commentItems().implement(EasyDiscuss.Controller.Comment.List.Item)}}}),EasyDiscuss.Controller("Comment.List.Item",{defaultOptions:{id:null,postId:null,"{deleteCommentLink}":".deleteComment","{convertCommentLink}":"[data-comment-convert-link]"}},function(e){return{init:function(){e.options.id=e.element.data("id"),e.options.postId=e.element.data("post-id")},"{deleteCommentLink} click":function(){disjax.loadingDialog(),disjax.load("comment","confirmDelete",e.options.id+"")},"{convertCommentLink} click":function(){disjax.loadingDialog(),disjax.load("comment","confirmConvert",e.options.id+"",e.options.postId+"")}}}),EasyDiscuss.Controller("Comment.LoadMore",{defaultOptions:{id:null,currentCount:0}},function(t){return{init:function(){t.options.id=t.element.data("postid"),t.doneLoading=!1},"{self} click":function(n){n.enabled()&&(n.disabled(!0),t.element.addClass("btn-loading").html(e.language("COM_EASYDISCUSS_COMMENT_LOADING_MORE_COMMENTS")),EasyDiscuss.ajax("site.views.post.getComments",{id:t.options.id,start:t.list.commentItems().length}).done(function(r,i){var s=e(r).filter("li");s.implement(EasyDiscuss.Controller.Comment.List.Item),t.list.element.append(s),i?t.element.html(e.language("COM_EASYDISCUSS_COMMENT_LOAD_MORE")):(t.doneLoading=!0,t.element.hide()),n.enabled(!0)}).fail(function(){t.element.addClass("btn-danger").html(e.language("COM_EASYDISCUSS_COMMENT_LOAD_ERROR"))}).always(function(){t.element.removeClass("btn-loading")}))}}}),EasyDiscuss.Controller("Comment.Form",{defaultOptions:{container:null,notification:null,commentsList:null,loadMore:null,termsCondition:null,"{commentMessage}":".commentMessage","{postId}":".postId","{commentTnc}":".commentTnc","{saveButton}":".saveButton","{cancelButton}":".cancelButton","{termsLink}":".termsLink","{commentLoader}":".commentLoader"}},function(t){return{init:function(){},resetForm:function(){t.commentMessage().val(""),t.commentTnc().attr("checked",!1)},"{termsLink} click":function(){disjax.load("comment","tnc")},"{cancelButton} click":function(){t.options.container.toggle()},"{saveButton} click":function(){if(!t.commentTnc().is(":checked")&&t.options.termsCondition)return t.options.notification.html(e.language("COM_EASYDISCUSS_TERMS_PLEASE_ACCEPT")).addClass("alert alert-error"),!1;EasyDiscuss.ajax("site.views.comment.save",{comment:t.commentMessage().val(),id:t.postId().val(),tnc:"1"},{beforeSend:function(){t.commentLoader().show()}}).done(function(n){t.options.notification.html(e.language("COM_EASYDISCUSS_COMMENT_SUCESSFULLY_ADDED")).removeClass("alert alert-error").addClass("alert alert-success"),t.resetForm(),t.options.container.hide(),t.commentLoader().hide(),EasyDiscuss.commentsCount=EasyDiscuss.commentsCount===undefined?1:EasyDiscuss.commentsCount+1,(t.options.loadMore.length<1||t.options.loadMore.controller().doneLoading)&&t.options.commentsList.append(n)}).fail(function(e){t.options.notification.html(e).addClass("alert alert-error"),t.commentLoader().hide()})}}}),t.resolve()})});