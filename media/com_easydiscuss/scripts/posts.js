EasyDiscuss.module("posts",function(e){var t=this;EasyDiscuss.require().view("comment.form","post.notification").script("comments","location").language("COM_EASYDISCUSS_NOTIFICATION_NEW_REPLIES","COM_EASYDISCUSS_NOTIFICATION_NEW_COMMENTS","COM_EASYDISCUSS_PLEASE_SELECT_CATEGORY_DESC","COM_EASYDISCUSS_POST_TITLE_CANNOT_EMPTY","COM_EASYDISCUSS_POST_CONTENT_IS_EMPTY").done(function(){EasyDiscuss.Controller("Post.Ask",{defaultOptions:{"{submitDiscussion}":".submitDiscussion"}},function(t){return{init:function(){},"{submitDiscussion} click":function(){if(e(this).attr("disabled"))return;e(this).attr("disabled","disabled");var t="",n=!1,r=e(".discuss-form *[name=category_id]").val();if(r==0||r.length==0){var i=e.language("COM_EASYDISCUSS_PLEASE_SELECT_CATEGORY_DESC");t+="<li>"+i+"</li>",n=!0}if(e("#ez-title").val()==""&&e("#post-topic-title").val()==""){var i=e.language("COM_EASYDISCUSS_POST_TITLE_CANNOT_EMPTY");t+="<li>"+i+"</li>",n=!0}var s=discuss.getContent();if(s==""){var i=e.language("COM_EASYDISCUSS_POST_CONTENT_IS_EMPTY");t+="<li>"+i+"</li>",n=!0}return n?(t='<div class="alert alert-error"><ul class="unstyled">'+t+"</ul></div>",e(".ask-notification").html(""),e(".ask-notification").append(t),e(document).scrollTop(e(".ask-notification").offset().top),!1):(e("#dc_submit").submit(),!1)}}}),EasyDiscuss.Controller("Post.Moderator",{defaultOptions:{"{moderatorBtn}":".moderatorBtn","{postModeratorList}":".post-moderator-list","{moderatorList}":".moderatorList"}},function(t){return{init:function(){t.moderatorBtn().parent(".dropdown_").hasClass("open")&&t.loadModeratorList()},loadModeratorList:function(){length=t.postModeratorList().size();if(length>0)return;t.moderatorList().empty();var e='<li style="height:10px;"><div class="discuss-loader" style="margin-left:15px;"></div></li>';t.moderatorList().append(e),EasyDiscuss.ajax("site.views.post.getModerators",{id:t.element.data("id"),category_id:t.element.data("category")},{success:function(e){t.moderatorList().empty(),t.moderatorList().append(e)},fail:function(){}})},"{moderatorBtn} click":function(){t.loadModeratorList()},"{postModeratorList} click":function(t){var n=e(t).data("userid"),r=e(t).data("postid");EasyDiscuss.ajax("site.views.post.ajaxModeratorAssign",{userId:n,postId:r},{success:function(t){e(".discuss-post-assign").html(t)},fail:function(t){e(".discuss-post-assign").html(t)}})}}}),EasyDiscuss.Controller("Post.Question",{defaultOptions:{id:null,view:{commentForm:"comment.form"},"{addCommentButton}":".addComment","{commentFormContainer}":".commentFormContainer","{commentNotification}":".commentNotification","{commentsList}":".commentsList","{commentLoadMore}":".commentLoadMore","{postLocation}":".postLocation","{locationData}":".locationData"}},function(t){return{init:function(){t.commentsList().implement(EasyDiscuss.Controller.Comment.List),t.commentLoadMore().length>0&&t.commentLoadMore().implement(EasyDiscuss.Controller.Comment.LoadMore,{controller:{list:t.commentsList().controller()}}),t.options.id=t.element.data("id");if(t.locationData().length>0){var n=e.parseJSON(t.locationData().val());t.postLocation().implement("EasyDiscuss.Controller.Location.Map",n)}},"{addCommentButton} click":function(){var n=t.view.commentForm({id:t.options.id});e(n).implement(EasyDiscuss.Controller.Comment.Form,{container:t.commentFormContainer(),notification:t.commentNotification(),commentsList:t.commentsList(),loadMore:t.commentLoadMore(),termsCondition:t.options.termsCondition}),t.commentFormContainer().html(n).toggle()}}}),EasyDiscuss.Controller("PostItems",{defaultOptions:{activefiltertype:null,"{allPostsFilter}":".allPostsFilter","{newPostsFilter}":".newPostsFilter","{unResolvedFilter}":".unResolvedFilter","{unAnsweredFilter}":".unAnsweredFilter","{resolvedFilter}":"[data-filters-resolved]","{sortLatest}":".sortLatest","{sortPopular}":".sortPopular","{ulList}":"ul.normal","{loader}":".loader","{pagination}":".dc-pagination"}},function(t){return{init:function(){},doSort:function(e){filterType=t.options.activefiltertype,t.doFilter(filterType,e)},doFilter:function(e,n){t.options.activefiltertype=e,n===undefined&&(n="latest"),t.loader().toggle(),t.sortPopular().show(),t.sortLatest().tab("show"),t.ulList().children("li").remove(),EasyDiscuss.ajax("site.views.index.filter",{filter:e,sort:n,id:t.element.data("id"),view:t.element.data("view")},{success:function(e,n){t.loader().toggle(),t.ulList().append(e),t.pagination().html(n)},fail:function(){t.loader().toggle()}})},"{resolvedFilter} click":function(){e(".filterItem").removeClass("active"),t.doFilter("resolved"),t.resolvedFilter().parent().addClass("active")},"{sortLatest} click":function(){t.doSort("latest")},"{sortPopular} click":function(){t.doSort("popular")},"{allPostsFilter} click":function(){e(".filterItem").removeClass("active"),t.doFilter("allposts"),t.allPostsFilter().parent().addClass("active")},"{newPostsFilter} click":function(){e(".filterItem").removeClass("active"),t.doFilter("unread"),t.newPostsFilter().parent().addClass("active"),t.sortPopular().hide()},"{unResolvedFilter} click":function(){e(".filterItem").removeClass("active"),t.doFilter("unresolved"),t.unResolvedFilter().parent().addClass("active")},"{unAnsweredFilter} click":function(){e(".filterItem").removeClass("active"),t.doFilter("unanswered"),t.unAnsweredFilter().parent().addClass("active")}}}),EasyDiscuss.Controller("Post.CheckNewReplyComment",{defaultOptions:{id:null,interval:10,wrapper:{discuss:"#discuss-wrapper",notificationContainer:".notificationContainer",notification:".discussNotification",replyContainer:".replyContainer",commentContainer:".commentContainer",replyCount:".replyCount",commentCount:".commentCount",replyText:".replyText",commentText:".commentText"},discusswrapper:"#discuss-wrapper",notificationwrapper:".discussNotification",view:{postNotification:"post.notification"}}},function(t){return{init:function(){t.options.id=t.element.data("id"),t.getCount().done(function(e,n){EasyDiscuss.repliesCount=e,EasyDiscuss.commentsCount=n,t.autoCheck()}),e(t.options.wrapper.discuss).append('<div class="notifications top-left notificationContainer"></div>')},autoCheck:function(){t.check=setTimeout(function(){t.checkCount().done(function(){t.autoCheck()})},t.options.interval*1e3)},stopCheck:function(){clearTimeout(t.check)},getCount:function(){return EasyDiscuss.ajax("site.views.post.getUpdateCount",{id:t.options.id})},checkCount:function(){var n=e.Deferred(),r=!1,i=!1;return t.getCount().done(function(e,s){r=e-EasyDiscuss.repliesCount,i=s-EasyDiscuss.commentsCount,t.newRepliesCount=e,t.newCommentsCount=s,(r>0||i>0)&&t.notify(r,i),n.resolve()}),n},notify:function(n,r){var i=e(t.options.wrapper.notification);if(i.length<1){var s=t.view.postNotification({newReply:n,newComment:r});e(t.options.wrapper.notificationContainer).notify({message:{html:s.toHTML()},fadeOut:{enabled:!1},onClosed:function(){EasyDiscuss.repliesCount=t.newRepliesCount,EasyDiscuss.commentsCount=t.newCommentsCount}}).show()}else{var o=i.find(t.options.wrapper.replyContainer),u=i.find(t.options.wrapper.commentContainer),a=i.find(t.options.wrapper.replyCount),f=i.find(t.options.wrapper.commentCount),l=i.find(t.options.wrapper.replyText),c=i.find(t.options.wrapper.commentText);n>0&&o.length>0&&a.text(n)&&o.is(":hidden")&&o.show(),r>0&&u.length>0&&f.text(r)&&u.is(":hidden")&&u.show(),n>1&&l.text(e.language("COM_EASYDISCUSS_NOTIFICATION_NEW_REPLIES")),r>1&&c.text(e.language("COM_EASYDISCUSS_NOTIFICATION_NEW_COMMENTS"))}}}}),t.resolve()})});