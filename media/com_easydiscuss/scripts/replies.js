EasyDiscuss.module("replies",function(e){var t=this;EasyDiscuss.require().view("comment.form").script("comments","votes","location").language("COM_EASYDISCUSS_REPLY_LOADING_MORE_COMMENTS","COM_EASYDISCUSS_REPLY_LOAD_ERROR").done(function(){EasyDiscuss.Controller("Replies",{defaultOptions:{termsCondition:null,sort:null,"{replyItem}":".discussReplyItem"}},function(t){return{init:function(){t.initItem(t.replyItem())},initItem:function(e,n){e.implement(EasyDiscuss.Controller.Reply.Item,{controller:{parent:t},reinit:n,termsCondition:t.options.termsCondition,enableMap:t.options.enableMap})},addItem:function(n,r){var i=e(n);t.options.sort=="latest"?i.prependTo(t.element):e(".replyLoadMore").length==0?i.appendTo(t.element):e(".replyLoadMore").controller().loadedAllReplies&&i.appendTo(t.element),t.initItem(i,r)},replaceItem:function(n,r){var i=e(r);t.replyItem("[data-id="+n+"]").replaceWith(i),t.initItem(i)}}}),EasyDiscuss.Controller("Reply.Item",{defaultOptions:{id:null,termsCondition:null,reinit:null,view:{commentForm:"comment.form"},"{addCommentButton}":".addComment","{commentFormContainer}":".commentFormContainer","{commentNotification}":".commentNotification","{commentsList}":".commentsList","{commentLoadMore}":".commentLoadMore","{editReplyButton}":".editReplyButton","{cancelReplyButton}":".cancel-reply","{composerContainer}":".discuss-editor","{composer}":".discuss-composer","{alertMessage}":".alertMessage","{postLocation}":".postLocation","{locationData}":".locationData"}},function(t){return{init:function(){t.options.id=t.element.data("id");if(t.locationData().length>0){var n=e.parseJSON(t.locationData().val());t.postLocation().implement("EasyDiscuss.Controller.Location.Map",n)}t.commentsList().implement(EasyDiscuss.Controller.Comment.List),t.commentLoadMore().length>0&&t.commentLoadMore().implement(EasyDiscuss.Controller.Comment.LoadMore,{controller:{list:t.commentsList().controller()}});if(t.options.reinit){var r=t.element.find(".postLocation");if(r.length>0){var i=e.parseJSON(r.find(".locationData").val());EasyDiscuss.require().script("location").done(function(e){r.implement("EasyDiscuss.Controller.Location.Map",i)})}EasyDiscuss.main_syntax_highlighter&&EasyDiscuss.require().script("syntaxhighlighter").done(function(e){t.element.find(".discuss-content-item pre").each(function(e,t){hljs.highlightBlock(t)})}),t.find(".discuss-vote").implement(EasyDiscuss.Controller.Votes,{viewVotes:EasyDiscuss.view_votes}),t.find(".attachmentsItem").implement(EasyDiscuss.Controller.Attachments.Item,{})}},"{editReplyButton} click":function(){t.edit()},alert:function(n,r,i){r===undefined&&(r="info"),t.removeAlert(),e('<div class="alert alertMessage"></div>').addClass("alert-"+r).html(n).prependTo(t.composerContainer()),i&&setTimeout(function(){t.alertMessage().fadeOut("slow",function(){t.removeAlert()})},i)},removeAlert:function(){t.alertMessage().remove()},edit:function(){t.editReplyButton().addClass("btn-loading"),EasyDiscuss.ajax("site.views.post.editReply",{id:t.options.id}).done(function(e,n){t.composer().remove(),t.composerContainer().append(n),discuss.composer.init("."+e)}).fail(function(){t.alert("Unable to load composer.","error",3e3)}).always(function(){t.editReplyButton().removeClass("btn-loading")})},"{composer} save":function(n,r,i){var s=e(i).filter(".discussReplyItem");if(s.length>0){t.parent.replaceItem(t.options.id,s);var o=e(".discussionReplies").controller();o.initItem(s,!0)}},"{composer} cancel":function(){t.composer().remove()},"{addCommentButton} click":function(){var n=t.view.commentForm({id:t.options.id});e(n).implement(EasyDiscuss.Controller.Comment.Form,{container:t.commentFormContainer(),notification:t.commentNotification(),commentsList:t.commentsList(),loadMore:t.commentLoadMore(),termsCondition:t.options.termsCondition}),t.commentFormContainer().html(n).toggle()}}}),EasyDiscuss.Controller("Replies.LoadMore",{defaultOptions:{id:null,sort:null}},function(t){return{init:function(){t.loadedAllReplies=!1},"{self} click":function(n){n.enabled()&&(n.disabled(!0),n.addClass("btn-loading").html(e.language("COM_EASYDISCUSS_REPLY_LOADING_MORE_COMMENTS")),EasyDiscuss.ajax("site.views.post.getReplies",{id:t.options.id,start:t.list.replyItem().length,sort:t.options.sort}).done(function(r,i){r=e(r),r.appendTo(t.list.element);var s=r.filter("li").find(".discussReplyItem");s.implement(EasyDiscuss.Controller.Reply.Item,{controller:{parent:t.list},termsCondition:t.list.options.termsCondition,reinit:!0}),i?n.enabled(!0):(n.hide(),t.loadedAllReplies=!0)}).fail(function(){n.addClass("btn-danger").html(e.language("COM_EASYDISCUSS_REPLY_LOAD_ERROR"))}).always(function(){n.removeClass("btn-loading")}))}}}),t.resolve()})});