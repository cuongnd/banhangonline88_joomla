FD40.plugin("component",function($){var Component=$.Component=function(name,options){if(arguments.length<1)return Component.registry;if(arguments.length<2)return Component.registry[name];return Component.register(name,options)};Component.registry={};Component.proxy=function(component,property,value){if($.isFunction(value))component[property]=$.proxy(value,component);else component[property]=value};Component.register=function(name,options){var abstractComponent;if($.isFunction(name)){abstractComponent=
name;name=abstractComponent.className;options=abstractComponent.options}var self=Component.registry[name]=window[name]=function(command){return $.isFunction(command)?command($):component};$.each(Component.prototype,function(property,value){Component.proxy(self,property,value)});self.$=$;self.options=options;self.className=name;self.identifier="easysocial";self.componentName="com_easysocial";self.prefix=self.identifier+"/";self.version=options.version;self.safeVersion=self.version.replace(/\./g,"");
self.environment=options.environment||$.environment;self.mode=options.mode||$.mode;self.debug=self.environment==="development";self.console=Component.console(self);self.language=options.language||$.locale.lang||"en";self.baseUrl=options.baseUrl||$.indexUrl+"?option="+self.componentName;self.ajaxUrl=options.ajaxUrl||$.basePath+"/?option="+self.componentName;self.scriptPath=options.scriptPath||$.rootPath+"/media/"+self.componentName+"/scripts/";self.stylePath=options.stylePath||$.rootPath+"/media/"+
self.componentName+"/styles/";self.templatePath=options.templatePath||options.scriptPath;self.languagePath=options.languagePath||self.ajaxUrl+"&tmpl=component&no_html=1&controller=lang&task=getLanguage";self.viewPath=options.viewPath||self.ajaxUrl+"&tmpl=component&no_html=1&controller=themes&task=getAjaxTemplate";self.optimizeResources=true;self.resourcePath=options.resourcePath||self.ajaxUrl+"&tmpl=component&no_html=1&controller=foundry&task=getResource";self.resourceInterval=1200;self.scriptVersioning=
options.scriptVersioning||false;self.tasks=[];FD40.component(name,self);if(!abstractComponent)return;if(self.debug)abstractComponent.queue.execute();else{var installer,installers=FD40.installer(name);while(installer=installers.shift())self.install.apply(self,installer);$.when(self.install("definitions"),self.install("scripts"),self.install("resources")).done(function(){abstractComponent.queue.execute()})}var storage=self.storage=function(key,val){var prefix=self.prefix,key=prefix+key,length=arguments.length;
if(length==1)return $.Storage.get(key);if(length==2)return key===false?$.Storage.remove(prefix+val):$.Storage.set(key,val);return storage.getAll()};$.extend(self.storage,{getAll:function(){var prefix=self.prefix,i=prefix.length,storage=$.Storage.getAll(),obj={};for(key in storage)if(key.substr(0,i)==prefix)obj[key.substr(i)]=storage[key];return obj},remove:function(key){$.Storage.remove(self.prefix+key)},clear:function(){for(key in storage.getAll())storage.remove(key)}})};Component.extend=function(property,
value){Component.prototype[property]=value;$.each(Component.registry,function(name,component){Component.proxy(component,property,value)})};$.template("component/console",'<div id="[%== component.identifier %]-console" class="foundry-console" style="display: none; z-index: 999999;"><div class="console-header"><div class="console-title">[%= component.className %] [%= component.version %]</div><div class="console-remove-button">x</div></div><div class="console-log-item-group"></div><style type="text/css">.foundry-console{position:fixed;width:50%;height:50%;bottom:0;left:0;background:white;box-shadow: 0 0 5px 0;margin-left: 25px;}.console-log-item-group{width: 100%;height: 100%;overflow-y:scroll;}.console-header{position: absolute;background:red;color:white;font-weight:bold;top:-24px;left: 0;line-height:24px;width:100%}.console-remove-button{text-align:center;cursor: pointer;display:block;width: 24px;float:right}.console-remove-button:hover{color: yellow}.console-title{padding: 0 5px;float:left}.console-log-item{padding: 5px}.console-log-item + .console-log-item{border-top: 1px solid #ccc}</style></div>');
Component.console=function(component){return function(self){var instance=function(method){if(arguments.length<1)return instance.toggle();return instance[method]&&instance[method].apply(instance,arguments)},element;instance.selector="#"+self.identifier+"-console";instance.init=function(){element=$(instance.selector);if(element.length<1){element=$($.View("component/console",{component:self})).appendTo("body");element.find(".console-remove-button").click(function(){element.hide()})}instance.element=
element;return arguments.callee};instance.methods={log:function(message,type,code){type=type||"info";var itemGroup=element.find(".console-log-item-group"),item=$(document.createElement("div")).addClass("console-log-item type-"+type).attr("data-code",code).html(message);itemGroup.append(item);itemGroup[0].scrollTop=itemGroup[0].scrollHeight;if(self.debug)element.show()},toggle:function(){element.toggle()},reset:function(){element.find(".console-log-item-group").empty()}};$.each(instance.methods,function(method,
fn){instance[method]=function(){instance.init();return fn.apply(instance,arguments)}});return instance}(component)};var doc=$(document),proto=Component.prototype;$.extend(proto,{run:function(command){return $.isFunction(command)?command($):this},ready:function(){doc.ready(function(){proto.ready=proto.run});return function(callback){if(!$.isFunction(callback))return;doc.ready(function(){callback($)})}}(),install:function(name,factory){var self=this,task=self.tasks[name]||(self.tasks[name]=$.Deferred());
if(!factory)return task;var install=function(){factory($,self);return task.resolve()};if(name=="definitions")return install();$.when(self.install("definitions")).done(install)},token:function(){var self=this;if(self.token.value)return self.token.value;return self.token.value=window.es.token},template:function(name){var self=this;if(name==undefined)return $.grep($.template(),function(template){return template.indexOf(self.prefix)==0});arguments[0]=self.prefix+name;return $.template.apply(null,arguments)},
require:function(options){var self=this,options=options||{},require=$.require(options),_require={};$.each(["library","script","template","done"],function(i,method){_require[method]=require[method]});require.resource=function(resource){if(!$.isPlainObject(resource))return;if(!resource.type||!resource.name||!$.isDeferred(resource.loader))return;var batch=this;var resourceCollector=self.resourceCollector;if(!resourceCollector){resourceCollector=self.resourceCollector=$.Deferred();$.extend(resourceCollector,
{name:$.uid("ResourceCollector"),manifest:[],loaderList:[],loaders:[],load:function(){delete self.resourceCollector;if(resourceCollector.manifest.length<0){resourceCollector.resolve();return}var retry=0;var loadResources=function(){retry++;$.Ajax({type:"POST",url:self.resourcePath,dataType:"json",data:{resource:resourceCollector.manifest}}).done(function(manifest){if(!$.isArray(manifest)){resourceCollector.reject("Server did not return a valid resource manifest.");return}$.each(manifest,function(i,
resource){var content=resource.content;resourceCollector.loaders[resource.id][content!==undefined?"resolve":"reject"](content)});if(retry>1&&self.debug)console.info("Attempt to try and get resources again was successful!")}).fail(function(){if(retry>2){if(self.debug)console.error("Unable to get resource again. Giving up!");return}if(self.debug)console.warn("Unable to get resource. Trying again...");loadResources()})};loadResources();$.when.apply(null,resourceCollector.loaderList).done(resourceCollector.resolve).fail(resourceCollector.reject)}});
setTimeout(resourceCollector.load,self.resourceCollectionInterval)}var id=resource.id=$.uid("Resource");resourceCollector.loaders[id]=resource.loader;resourceCollector.loaderList.push(resource.loader);delete resource.loader;resourceCollector.manifest.push(resource);return require};require.view=function(){var batch=this,request=batch.expand(arguments,{path:self.viewPath}),loaders={},options=request.options,names=$.map(request.names,function(name){var absoluteName=self.prefix+name,loader=$.require.template.loaders[absoluteName];
if(loader)return;loader=$.require.template.loader(absoluteName);loader.name=absoluteName;batch.addTask(loader);if(self.optimizeResources){require.resource({type:"view",name:name,loader:loader});return}else{loaders[name]=loader;return name}});if(names.length>0)$.Ajax({url:options.path,dataType:"json",data:{names:names}}).done(function(templates){if(!$.isArray(templates))return;$.each(templates,function(i,template){var content=template.content;loaders[template.name][content!==undefined?"resolve":"reject"](content)})});
return require};require.library=function(){_require.script.apply(this,arguments);return require};require.script=function(){var batch=this,request=batch.expand(arguments,{path:self.scriptPath}),names=$.map(request.names,function(name){if($.isArray(name)||$.isUrl(name)||/^(\/|\.)/.test(name))return name;var moduleName=self.prefix+name,moduleUrl=$.uri(request.options.path).toPath("./"+name+"."+(request.options.extension||"js")+(self.scriptVersioning?"?"+"version="+self.safeVersion:"")).toString();return[[moduleName,
moduleUrl,true]]});_require.script.apply(require,[request.options].concat(names));return require};require.template=function(){var batch=this,request=batch.expand(arguments,{path:self.templatePath});_require.template.apply(require,[request.options].concat($.map(request.names,function(name){return[[self.prefix+name,name]]})));return require};require.app=function(){var batch=this,request=batch.expand(arguments,{path:self.scriptPath});names=$.map(request.names,function(name){if($.isArray(name)||$.isUrl(name)||
/^(\/|\.)/.test(name))return name;var parts=name.split("/"),path=$.rootPath+"/media/"+self.componentName+"/apps";if(parts.length===4)path+="/"+parts.shift();path+="/"+parts[0]+"/"+parts[1]+"/scripts/"+parts[2];var moduleName=self.prefix+name,moduleUrl=path+"."+(request.options.extension||"js")+(self.scriptVersioning?"?"+"version="+self.safeVersion:"");return[[moduleName,moduleUrl,true]]});_require.script.apply(require,[request.options].concat(names));return require};require.done=function(callback){return _require.done.call(require,
function(){self.ready(callback)})};return require},module:function(name,factory){var self=this;if($.isArray(name))return;var fullname=self.prefix+name;return factory?$.module.apply(null,[fullname,function(){var module=this;factory.call(module,$)}]):$.module(fullname)}});$.Component.extend("ajax",function(namespace,params,callback){var self=this;var date=new Date;var options={url:self.ajaxUrl+"&_ts="+date.getTime(),data:$.extend(params,{option:self.componentName,namespace:namespace})};options=$.extend(true,
options,self.options.ajax);options.data[self.token()]=1;if(options.data.hasOwnProperty("args"))options.data.args=$.toJSON(options.data.args);if($.isPlainObject(callback)){if(callback.type){switch(callback.type){case "jsonp":callback.dataType="jsonp";callback.crossDomain=true;options.data.transport="jsonp";break;case "iframe":callback.iframe=true;callback.processData=false;callback.files=options.data.files;delete options.data.files;options.data.transport="iframe";break}delete callback.type}$.extend(options,
callback)}if($.isFunction(callback))options.success=callback;var ajax=$.server(options);ajax.progress(function(message,type,code){if(self.debug&&type=="debug")self.console.log(message,type,code)});return ajax});$.Component.extend("Controller",function(){var self=this,args=$.makeArray(arguments),name=args[0],staticProps,protoFactory;if(args.length==1)return $.String.getObject(name);if(args.length>2)staticProps=args[1],protoFactory=args[2];else staticProps={},protoFactory=args[1];$.extend(staticProps,
{root:self.className+".Controller",component:self});return $.Controller.apply(this,[name,staticProps,protoFactory])});$.Component.extend("Model",function(){var self=this,args=$.makeArray(arguments),name=self.className+".Model."+args[0],staticProps,protoFactory;if(args.length==1)return $.String.getObject(args[0]);if(args.length==2)staticProps={},protoFactory=args[1];if(args.length>2)staticProps=args[1],protoFactory=args[2];$.extend(staticProps,{component:self});return $.Model.apply(this,[name,staticProps,
protoFactory])});$.Component.extend("Model.List",function(){var self=this,args=$.makeArray(arguments),name=self.className+".Model.List."+args[0],staticProps,protoFactory;if(args.length==1)return $.String.getObject(args[0]);if(args.length==2)staticProps={},protoFactory=args[1];if(args.length>2)staticProps=args[1],protoFactory=args[2];$.extend(staticProps,{component:self});return $.Model.List.apply(this,[name,staticProps,protoFactory])});$.Component.extend("View",function(name){var self=this;if(arguments.length<
1)return self.template();arguments[0]=self.prefix+arguments[0];return $.View.apply(this,arguments)});FD40.module.execute();$.each(FD40.component(),function(i,abstractComponent){if(abstractComponent.registered)return;$.Component.register(abstractComponent)})});
