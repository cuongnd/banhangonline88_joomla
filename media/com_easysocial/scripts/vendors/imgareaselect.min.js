!function(){var a=function(a){var b=this,c=a,d=function(){!function(a){function f(){return a("<div/>")}var b=Math.abs,c=Math.max,d=Math.min,e=Math.round;a.imgAreaSelect=function(g,h){function X(a){return a+s.left-w.left}function Y(a){return a+s.top-w.top}function Z(a){return a-s.left+w.left}function $(a){return a-s.top+w.top}function _(a){return a.pageX-w.left}function ab(a){return a.pageY-w.top}function bb(a){var b=a||B,c=a||C;return{x1:e(O.x1*b),y1:e(O.y1*c),x2:e(O.x2*b),y2:e(O.y2*c),width:e(O.x2*b)-e(O.x1*b),height:e(O.y2*c)-e(O.y1*c)}
}function cb(a,b,c,d,f){var g=f||B,h=f||C;O={x1:e(a/g||0),y1:e(b/h||0),x2:e(c/g||0),y2:e(d/h||0)},O.width=O.x2-O.x1,O.height=O.y2-O.y1}function db(){i.width()&&(s={left:e(i.offset().left),top:e(i.offset().top)},t=i.innerWidth(),u=i.innerHeight(),s.top+=i.outerHeight()-u>>1,s.left+=i.outerWidth()-t>>1,E=e(h.minWidth/B)||0,F=e(h.minHeight/C)||0,G=e(d(h.maxWidth/B||1<<24,t)),H=e(d(h.maxHeight/C||1<<24,u)),"1.3.2"!=a().jquery||"fixed"!=y||P.getBoundingClientRect||(s.top+=c(document.body.scrollTop,P.scrollTop),s.left+=c(document.body.scrollLeft,P.scrollLeft)),w=/absolute|relative/.test(v.css("position"))?{left:e(v.offset().left)-v.scrollLeft(),top:e(v.offset().top)-v.scrollTop()}:"fixed"==y?{left:a(document).scrollLeft(),top:a(document).scrollTop()}:{left:0,top:0},q=X(0),r=Y(0),(O.x2>t||O.y2>u)&&lb())
}function eb(b){if(J){switch(k.css({left:X(O.x1),top:Y(O.y1)}).add(l).width(U=O.width).height(V=O.height),l.add(m).add(o).css({left:0,top:0}),m.width(c(U-m.outerWidth()+m.innerWidth(),0)).height(c(V-m.outerHeight()+m.innerHeight(),0)),a(n[0]).css({left:q,top:r,width:O.x1,height:u}),a(n[1]).css({left:q+O.x1,top:r,width:U,height:O.y1}),a(n[2]).css({left:q+O.x2,top:r,width:t-O.x2,height:u}),a(n[3]).css({left:q+O.x1,top:r+O.y2,width:U,height:u-O.y2}),U-=o.outerWidth(),V-=o.outerHeight(),o.length){case 8:a(o[4]).css({left:U>>1}),a(o[5]).css({left:U,top:V>>1}),a(o[6]).css({left:U>>1,top:V}),a(o[7]).css({top:V>>1});
case 4:o.slice(1,3).css({left:U}),o.slice(2,4).css({top:V})}b!==!1&&(a.imgAreaSelect.keyPress!=ub&&a(document).unbind(a.imgAreaSelect.keyPress,a.imgAreaSelect.onKeyPress),h.keys&&a(document)[a.imgAreaSelect.keyPress](a.imgAreaSelect.onKeyPress=ub)),a.browser.msie&&m.outerWidth()-m.innerWidth()==2&&(m.css("margin",0),setTimeout(function(){m.css("margin","auto")},0))}}function fb(a){db(),eb(a),K=X(O.x1),L=Y(O.y1),M=X(O.x2),N=Y(O.y2)}function gb(a,b){h.fadeSpeed?a.fadeOut(h.fadeSpeed,b):a.hide()}function hb(a){var b=Z(_(a))-O.x1,c=$(ab(a))-O.y1;
W||(db(),W=!0,k.one("mouseout",function(){W=!1})),D="",h.resizable&&(c<=h.resizeMargin?D="n":c>=O.height-h.resizeMargin&&(D="s"),b<=h.resizeMargin?D+="w":b>=O.width-h.resizeMargin&&(D+="e")),k.css("cursor",D?D+"-resize":h.movable?"move":""),p&&p.toggle()}function ib(){a("body").css("cursor",""),(h.autoHide||O.width*O.height==0)&&gb(k.add(n),function(){a(this).hide()}),a(document).unbind("mousemove",mb),k.mousemove(hb),h.onSelectEnd(g,bb())}function jb(b){return 1!=b.which?!1:(db(),D?(a("body").css("cursor",D+"-resize"),K=X(O[/w/.test(D)?"x2":"x1"]),L=Y(O[/n/.test(D)?"y2":"y1"]),a(document).mousemove(mb).one("mouseup",ib),k.unbind("mousemove",hb)):h.movable?(z=q+O.x1-_(b),A=r+O.y1-ab(b),k.unbind("mousemove",hb),a(document).mousemove(ob).one("mouseup",function(){h.onSelectEnd(g,bb()),a(document).unbind("mousemove",ob),k.mousemove(hb)
})):i.mousedown(b),!1)}function kb(a){I&&(a?(M=c(q,d(q+t,K+b(N-L)*I*(M>K||-1))),N=e(c(r,d(r+u,L+b(M-K)/I*(N>L||-1)))),M=e(M)):(N=c(r,d(r+u,L+b(M-K)/I*(N>L||-1))),M=e(c(q,d(q+t,K+b(N-L)*I*(M>K||-1)))),N=e(N)))}function lb(){K=d(K,q+t),L=d(L,r+u),b(M-K)<E&&(M=K-E*(K>M||-1),q>M?K=q+E:M>q+t&&(K=q+t-E)),b(N-L)<F&&(N=L-F*(L>N||-1),r>N?L=r+F:N>r+u&&(L=r+u-F)),M=c(q,d(M,q+t)),N=c(r,d(N,r+u)),kb(b(M-K)<b(N-L)*I),b(M-K)>G&&(M=K-G*(K>M||-1),kb()),b(N-L)>H&&(N=L-H*(L>N||-1),kb(!0)),O={x1:Z(d(K,M)),x2:Z(c(K,M)),y1:$(d(L,N)),y2:$(c(L,N)),width:b(M-K),height:b(N-L)},eb(),h.onSelectChange(g,bb())
}function mb(a){return M=/w|e|^$/.test(D)||I?_(a):X(O.x2),N=/n|s|^$/.test(D)||I?ab(a):Y(O.y2),lb(),!1}function nb(b,c){M=(K=b)+O.width,N=(L=c)+O.height,a.extend(O,{x1:Z(K),y1:$(L),x2:Z(M),y2:$(N)}),eb(),h.onSelectChange(g,bb())}function ob(a){return K=c(q,d(z+_(a),q+t-O.width)),L=c(r,d(A+ab(a),r+u-O.height)),nb(K,L),a.preventDefault(),!1}function pb(){a(document).unbind("mousemove",pb),db(),M=K,N=L,lb(),D="",n.is(":visible")||k.add(n).hide().fadeIn(h.fadeSpeed||0),J=!0,a(document).unbind("mouseup",qb).mousemove(mb).one("mouseup",ib),k.unbind("mousemove",hb),h.onSelectStart(g,bb())
}function qb(){a(document).unbind("mousemove",pb).unbind("mouseup",qb),gb(k.add(n)),cb(Z(K),$(L),Z(K),$(L)),this instanceof a.imgAreaSelect||(h.onSelectChange(g,bb()),h.onSelectEnd(g,bb()))}function rb(b){return 1!=b.which||n.is(":animated")?!1:(db(),z=K=_(b),A=L=ab(b),a(document).mousemove(pb).mouseup(qb),!1)}function sb(){fb(!1)}function tb(){j=!0,wb(h=a.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},h)),k.add(n).css({visibility:""}),h.show&&(J=!0,db(),eb(),k.add(n).hide().fadeIn(h.fadeSpeed||0)),setTimeout(function(){h.onInit(g,bb())
},0)}function vb(a,b){for(var c in b)void 0!==h[c]&&a.css(b[c],h[c])}function wb(b){if(b.parent&&(v=a(b.parent)).append(k.add(n)),a.extend(h,b),db(),null!=b.handles){for(o.remove(),o=a([]),S=b.handles?"corners"==b.handles?4:8:0;S--;)o=o.add(f());o.addClass(h.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:x+1||1}),!parseInt(o.css("width"))>=0&&o.width(5).height(5),(T=h.borderWidth)&&o.css({borderWidth:T,borderStyle:"solid"}),vb(o,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})
}for(B=h.imageWidth/t||1,C=h.imageHeight/u||1,null!=b.x1&&(cb(b.x1,b.y1,b.x2,b.y2),b.show=!b.hide),b.keys&&(h.keys=a.extend({shift:1,ctrl:"resize"},b.keys)),n.addClass(h.classPrefix+"-outer"),l.addClass(h.classPrefix+"-selection"),S=0;S++<4;)a(m[S-1]).addClass(h.classPrefix+"-border"+S);vb(l,{selectionColor:"background-color",selectionOpacity:"opacity"}),vb(m,{borderOpacity:"opacity",borderWidth:"border-width"}),vb(n,{outerColor:"background-color",outerOpacity:"opacity"}),(T=h.borderColor1)&&a(m[0]).css({borderStyle:"solid",borderColor:T}),(T=h.borderColor2)&&a(m[1]).css({borderStyle:"dashed",borderColor:T}),k.append(l.add(m).add(p).add(o)),a.browser.msie&&((T=(n.css("filter")||"").match(/opacity=(\d+)/))&&n.css("opacity",T[1]/100),(T=(m.css("filter")||"").match(/opacity=(\d+)/))&&m.css("opacity",T[1]/100)),b.hide?gb(k.add(n)):b.show&&j&&(J=!0,k.add(n).fadeIn(h.fadeSpeed||0),fb()),I=(R=(h.aspectRatio||"").split(/:/))[0]/R[1],i.add(n).unbind("mousedown",rb),h.disable||h.enable===!1?(k.unbind("mousemove",hb).unbind("mousedown",jb),a(window).unbind("resize",sb)):((h.enable||h.disable===!1)&&((h.resizable||h.movable)&&k.mousemove(hb).mousedown(jb),a(window).resize(sb)),h.persistent||i.add(n).mousedown(rb)),h.enable=h.disable=void 0
}var j,p,q,r,t,u,v,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,Q,R,S,T,U,V,W,i=a(g),k=f(),l=f(),m=f().add(f()).add(f()).add(f()),n=f().add(f()).add(f()).add(f()),o=a([]),s={left:0,top:0},w={left:0,top:0},x=0,y="absolute",O={x1:0,y1:0,x2:0,y2:0,width:0,height:0},P=document.documentElement,ub=function(a){var e,f,b=h.keys,g=a.keyCode;if(e=isNaN(b.alt)||!a.altKey&&!a.originalEvent.altKey?!isNaN(b.ctrl)&&a.ctrlKey?b.ctrl:!isNaN(b.shift)&&a.shiftKey?b.shift:isNaN(b.arrows)?10:b.arrows:b.alt,"resize"==b.arrows||"resize"==b.shift&&a.shiftKey||"resize"==b.ctrl&&a.ctrlKey||"resize"==b.alt&&(a.altKey||a.originalEvent.altKey)){switch(g){case 37:e=-e;
case 39:f=c(K,M),K=d(K,M),M=c(f+e,K),kb();break;case 38:e=-e;case 40:f=c(L,N),L=d(L,N),N=c(f+e,L),kb(!0);break;default:return}lb()}else switch(K=d(K,M),L=d(L,N),g){case 37:nb(c(K-e,q),L);break;case 38:nb(K,c(L-e,r));break;case 39:nb(K+d(e,t-Z(M)),L);break;case 40:nb(K,L+d(e,u-$(N)));break;default:return}return!1};for(this.remove=function(){wb({disable:!0}),k.add(n).remove()},this.getOptions=function(){return h},this.setOptions=wb,this.getSelection=bb,this.setSelection=cb,this.cancelSelection=qb,this.update=fb,Q=i;Q.length;)x=c(x,isNaN(Q.css("z-index"))?x:Q.css("z-index")),"fixed"==Q.css("position")&&(y="absolute"),Q=Q.parent(":not(body)");
x=h.zIndex||x,a.browser.msie&&i.attr("unselectable","on"),a.imgAreaSelect.keyPress=a.browser.msie||a.browser.safari?"keydown":"keypress",a.browser.opera&&(p=f().css({width:"100%",height:"100%",position:"absolute",zIndex:x+2||2})),k.add(n).css({visibility:"hidden",position:y,overflow:"hidden",zIndex:x||"0"}),k.css({zIndex:x+2||2}),l.add(m).css({position:"absolute",fontSize:0}),g.complete||"complete"==g.readyState||!i.is("img")?tb():i.one("load",tb),!j&&a.browser.msie&&a.browser.version>=7&&(g.src=g.src)},a.fn.imgAreaSelect=function(b){return b=b||{},this.each(function(){a(this).data("imgAreaSelect")?b.remove?(a(this).data("imgAreaSelect").remove(),a(this).removeData("imgAreaSelect")):a(this).data("imgAreaSelect").setOptions(b):b.remove||(void 0===b.enable&&void 0===b.disable&&(b.enable=!0),a(this).data("imgAreaSelect",new a.imgAreaSelect(this,b)))
}),b.instance?a(this).data("imgAreaSelect"):this}}(c)};d(),b.resolveWith(d)};FD40.module("imgareaselect",a)}();