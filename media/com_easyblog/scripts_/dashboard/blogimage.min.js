EasyBlog.module("dashboard/blogimage",function($){var module=this;EasyBlog.require().library("image").done(function(){EasyBlog.Controller("Dashboard.BlogImage",{defaultOptions:{"{placeHolder}":".blogImagePlaceHolder","{imageData}":".imageData","{image}":".image","{selectBlogImageButton}":".selectBlogImage","{removeBlogImageButton}":".removeBlogImage"}},function(self){return{init:function(){EasyBlog.dashboard.registerPlugin("blogImage",self);var meta=$.trim(self.imageData().val());if(meta)self.setImage($.evalJSON(meta))},
"{selectBlogImageButton} click":function(){EasyBlog.mediaManager.browse(null,"blogimage")},"{removeBlogImageButton} click":function(el){self.removeImage();el.blur()},removeImage:function(){self.image().remove();self.element.addClass("empty");self.imageData().val("")},setImage:function(meta){if(!meta)return;self.removeImage();self.element.addClass("loading");clearTimeout(self.imageTimer);var meta=$.extend({},meta);delete meta.data;$.Image.get(meta.thumbnail.url).done(function(image){var resize=function(){var placeHolder=
self.placeHolder();maxWidth=placeHolder.width();maxHeight=placeHolder.height();var size=$.Image.resizeWithin(image.data("width"),image.data("height"),maxWidth,maxHeight);size.top=(maxHeight-size.height)/2;size.left=(maxWidth-size.width)/2;return size};var size=resize();var checkDimension=function(){if(size.width===0||size.height===0)self.imageTimer=setTimeout(function(){size=resize();checkDimension()},1E3);else image.css(size)};checkDimension();image.addClass("image").css(size).appendTo(self.placeHolder());
self.imageData().val($.toJSON(meta));self.element.removeClass("empty")}).fail(function(){self.element.addClass("empty")}).always(function(){self.element.removeClass("loading")})}}});module.resolve()})});
