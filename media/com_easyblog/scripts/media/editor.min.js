EasyBlog.module("media/editor",function(e){var t=this;EasyBlog.require().done(function(){EasyBlog.Controller("Media.Editor",{defaultOptions:{view:{editor:"media/editor",viewport:"media/editor.viewport"},"{modalHeader}":".modalHeader","{modalToolbar}":".modalToolbar","{modalContent}":".modalContent","{navigationPathway}":".navigationPathway","{insertItemButton}":".insertItemButton","{cancelEditingButton}":".cancelEditingButton"}},function(t){return{init:function(){t.element.addClass("editor").html(t.view.editor()),t.navigationPathway().implement(EasyBlog.Controller.Media.Navigation,{controller:{media:t.media},canActivate:!1},function(){t.navigation=this}),t.setLayout()},setLayout:function(){if(t.media.currentModal!=="editor")return;t.modalContent().hide().height(t.element.height()-t.modalHeader().outerHeight()-t.modalToolbar().outerHeight()).show();var e=t.getEditor(t.currentEditor);e&&e.setLayout&&e.setLayout()},editors:[],handlers:[],loadHandler:function(n){var r=t.handlers[n];return r!==undefined?r:(r=e.Deferred(),r.require=EasyBlog.require().script("media/editor."+n).done(function(){var i=EasyBlog.Controller.Media.Editor[e.String.capitalize(n)];i!==undefined?r.resolve(i):(delete t.handlers[n],r.reject())}).fail(function(){r.reject()}),r)},createEditor:function(e,n){t.removeEditor(e);var r=t.media.library.getMeta(e);if(r===undefined)return;t.loadHandler(r.type).done(function(i){var s=new i(t.view.viewport().addClass("editor-type-"+r.type).prependTo(t.modalContent()),{controller:{media:t.media,editor:t,key:t.media.library.getKey(r)}});t.editors[e]=s,n&&n(s)})},removeEditor:function(e){var n=t.editors[e];if(n===undefined)return;n.destroy(),delete t.editors[e]},getEditor:function(e){return t.editors[e]},activateEditor:function(e){t.deactivateEditor(t.currentEditor),t.navigation.setPathway(e);var n=t.getEditor(e),r=function(n){t.currentEditor=e,n.element.addClass("active"),n.activate&&n.activate()};n===undefined?t.createEditor(e,r):r(n)},deactivateEditor:function(){var e=t.getEditor(t.currentEditor);if(e===undefined)return;e.deactivate&&e.deactivate(),e.element.removeClass("active")},"{self} modalActivate":function(e,n,r){t.activateEditor(r)},"{self} modalDeactivate":function(){t.deactivateEditor()},"{insertItemButton} click":function(){var e=t.getEditor(t.currentEditor);if(e===undefined)return;e.trigger("insertItem")},"{cancelEditingButton} click":function(){var e=t.getEditor(t.currentEditor);e&&e.trigger("cancelItem"),t.media.browse()}}}),EasyBlog.Controller("Media.Editor.Panel",{defaultOptions:{"{sectionHeader}":".panelSectionHeader","{sectionContent}":".panelSectionContent"}},function(e){return{init:function(){},"{sectionHeader} click":function(e){var t=e.parent();t.toggleClass("active")}}}),EasyBlog.Controller("Media.Editor.Preview",{defaultOptions:{"{container}":".previewContainer","{dialogGroup}":".previewDialogGroup"}},function(e){return{init:function(){},resetLayout:function(){clearTimeout(e.resetLayoutTimer),e.resetLayoutTimer=setTimeout(function(){var t=e.container(),n=e.element.width(),r=e.element.height(),i=t.width(),s=t.height(),o=0,u=0,a="none";i<n?u=(n-i)/2:a="auto",s<r?o=(r-s)/2:a="auto",e.element.css("overflow",a),t.css({top:o,left:u})},100)},showDialog:function(t){e.dialogGroup().addClass("show-dialog-"+t)},hideDialog:function(t){e.dialogGroup().removeClass("show-dialog-"+t)}}}),t.resolve()})});