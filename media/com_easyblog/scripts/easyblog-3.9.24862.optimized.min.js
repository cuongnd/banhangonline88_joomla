FD31.installer("EasyBlog","definitions",function(a){a.module(["easyblog/admin","easyblog/dashboard","easyblog/dashboard/blogimage","easyblog/dashboard/editor","easyblog/dashboard/medialink","easyblog/easyblog","easyblog/layout/responsive","easyblog/layout/lightbox","easyblog/legacy","easyblog/featured","easyblog/location","easyblog/media","easyblog/media/navigation","easyblog/media/uploader","easyblog/media/browser","easyblog/media/browser.item","easyblog/media/editor","easyblog/","easyblog/media/constrain","easyblog/media/editor.audio","easyblog/media/editor.file","easyblog/media/editor.image","easyblog/media/editor.video","easyblog/media/uploader.item","easyblog/ratings","easyblog/tag"]),a.require.template.loader(["easyblog/media/recent.item","easyblog/media/browser","easyblog/media/browser.item-group","easyblog/media/browser.item","easyblog/media/browser.tree-item-group","easyblog/media/browser.tree-item","easyblog/media/browser.pagination-page","easyblog/media/browser.uploader","easyblog/media/browser.uploader.item","easyblog/media/editor","easyblog/media/editor.viewport","easyblog/media/navigation.item","easyblog/media/navigation.itemgroup","easyblog/media/editor.audio","easyblog/media/editor.audio.player","easyblog/media/editor.file","easyblog/media/editor.file.preview","easyblog/media/editor.image","easyblog/media/editor.image.variation","easyblog/media/editor.image.caption","easyblog/media/editor.video","easyblog/media/editor.video.player","easyblog/dashboard/dashboard.tags.item"]),a.require.language.loader(["COM_EASYBLOG_MM_UNABLE_TO_FIND_EXPORTER","COM_EASYBLOG_MM_GETTING_IMAGE_SIZES","COM_EASYBLOG_MM_UNABLE_TO_RETRIEVE_VARIATIONS","COM_EASYBLOG_MM_ITEM_INSERTED","COM_EASYBLOG_MM_UPLOADING","COM_EASYBLOG_MM_UPLOADING_STATE","COM_EASYBLOG_MM_UPLOADING_PENDING","COM_EASYBLOG_MM_UPLOAD_COMPLETE","COM_EASYBLOG_MM_UPLOAD_PREPARING","COM_EASYBLOG_MM_UPLOAD_UNABLE_PARSE_RESPONSE","COM_EASYBLOG_MM_UPLOADING_LEFT","COM_EASYBLOG_MM_CONFIRM_DELETE_ITEM","COM_EASYBLOG_MM_CANCEL_BUTTON","COM_EASYBLOG_MM_YES_BUTTON","COM_EASYBLOG_MM_ITEM_DELETE_CONFIRMATION"]),function(){var b=["easyblog/fancybox/default"],c=a.stylesheet({content:""})?"resolve":"reject";
a.each(b,function(b,d){a.require.stylesheet.loader(d)[c]()})}()}),FD31.installer("EasyBlog","scripts",function($){EasyBlog.module("admin",function(a){var b=this,c=window.admin={blog:{reject:function(a){ejax.load("Pending","confirmRejectBlog",a)},approve:function(a,b){confirm(b)&&(window.location=eblog_site+"&c=pending&task=approve&cid[]="+a)}},settings:{importSettings:function(){ejax.load("settings","import")}},checkbox:{init:function(){a(".option-enable").click(function(){var b=a(this).parent();a(".option-disable",b).removeClass("selected"),a(this).addClass("selected"),a(".radiobox",b).attr("value",1)
}),a(".option-disable").click(function(){var b=a(this).parent();a(".option-enable",b).removeClass("selected"),a(this).addClass("selected"),a(".radiobox",b).attr("value",0)})}},pending:{reject:function(){}},spools:{preview:function(a){ejax.load("Spools","preview",a)}},teamblog:{markAdmin:function(a,b,c){window.location=eblog_site+"&c=teamblogs&task=markAdmin&teamid="+a+"&userid="+b+"&"+c+"=1"},removeAdmin:function(a,b){window.location=eblog_site+"&c=teamblogs&task=removeAdmin&teamid="+a+"&userid="+b+"&"+token+"=1"
}}};a(function(){var b=a("#submenu").attr("class");if(a("#submenu li").eq(4).length>0&&"settings"!=b&&ejax.load("Easyblog","appendPending"),a("#system-message").length>0&&0==a(".eb-bootstrap").length){var d=a("#system-message").html();a("#system-message").remove(),a('<dl id="system-message">'+d+"</dl>").insertAfter("#toolbar-box")}a("body #settingsForm .admintable tr:odd").addClass("tr-odd"),a(".admintable tr").hover(function(){a(this).addClass("tr-hover")},function(){a(this).removeClass("tr-hover")}),c.checkbox.init()
}),b.resolve()}),EasyBlog.module("dashboard",function(){var b=this;EasyBlog.Controller("Dashboard",{defaultOptions:function(){}},function(a){return{init:function(){EasyBlog.dashboard=a},registerPlugin:function(b,c){void 0===a[b]&&(a[b]=c)}}}),b.resolve()}),EasyBlog.module("dashboard/blogimage",function(a){var b=this;EasyBlog.require().library("image").done(function(){EasyBlog.Controller("Dashboard.BlogImage",{defaultOptions:{"{placeHolder}":".blogImagePlaceHolder","{imageData}":".imageData","{image}":".image","{selectBlogImageButton}":".selectBlogImage","{removeBlogImageButton}":".removeBlogImage"}},function(b){return{init:function(){EasyBlog.dashboard.registerPlugin("blogImage",b);
var c=a.trim(b.imageData().val());c&&b.setImage(a.parseJSON(c))},"{selectBlogImageButton} click":function(){EasyBlog.mediaManager.browse(null,"blogimage")},"{removeBlogImageButton} click":function(a){b.removeImage(),a.blur()},removeImage:function(){b.image().remove(),b.element.addClass("empty"),b.imageData().val("")},setImage:function(c){if(c){b.removeImage(),b.element.addClass("loading"),clearTimeout(b.imageTimer);var c=a.extend({},c);delete c.data,a.Image.get(c.thumbnail.url).done(function(d){var e=function(){var c=b.placeHolder();
maxWidth=c.width(),maxHeight=c.height();var e=a.Image.resizeWithin(d.data("width"),d.data("height"),maxWidth,maxHeight);return e.top=(maxHeight-e.height)/2,e.left=(maxWidth-e.width)/2,e},f=e(),g=function(){0===f.width||0===f.height?b.imageTimer=setTimeout(function(){f=e(),g()},1e3):d.css(f)};g(),d.addClass("image").css(f).appendTo(b.placeHolder()),b.imageData().val(JSON.stringify(c)),b.element.removeClass("empty")}).fail(function(){b.element.addClass("empty")}).always(function(){b.element.removeClass("loading")
})}}}}),b.resolve()})}),EasyBlog.module("dashboard/editor",function(){var b=this;EasyBlog.Controller("Dashboard.Editor",{defaultOptions:{editorId:"write_content"}},function(a){return{init:function(){EasyBlog.dashboard.registerPlugin("editor",a)},insert:function(b){window.jInsertEditorText(b,a.options.editorId)},content:function(a){return void 0!==a&&window.eblog.editor.setContent(a),window.eblog.editor.getContent()}}}),b.resolve()}),EasyBlog.module("dashboard/medialink",function(){var b=this;EasyBlog.Controller("Dashboard.MediaLink",{defaultOptions:{"{menu}":".ui-togmenu","{content}":".ui-togbox"}},function(a){return{init:function(){},"{menu} click":function(b){var c=b.hasClass("active");
a.menu().removeClass("active"),a.content().removeClass("active"),c||(b.addClass("active"),a.content("."+b.attr("togbox")).addClass("active"))}}}),b.resolve()}),EasyBlog.require().library("ui/position","fancybox","bookmarklet","checked","checkList").script("layout/responsive","layout/lightbox","legacy").done(),EasyBlog.module("layout/responsive",function(a){var b=this;EasyBlog.options.responsive&&a(function(){a("#eblog-wrapper").responsive([{at:818,switchTo:"w768"},{at:600,switchTo:"w768 w600"},{at:500,switchTo:"w768 w600 w320"}])
}),b.resolve()}),EasyBlog.module("layout/lightbox",function(){var b=this;EasyBlog.require().library("fancybox").stylesheet("fancybox/default").script("legacy").done(function(){if(window.eblog_enable_lightbox){var a={showOverlay:!0,centerOnScroll:!0,overlayOpacity:.7};window.eblog_lightbox_title||(a.helpers={title:!1}),window.eblog_lightbox_enforce_size&&(a.maxWidth=window.eblog_lightbox_width,a.maxHeight=window.eblog_lightbox_height),eblog.images.initFancybox("a.easyblog-thumb-preview",a)}eblog.images.initCaption("img.easyblog-image-caption"),b.resolve()
})}),EasyBlog.module("legacy",function($){var module=this;window.isSave=!1;var eblog=window.eblog={stream:{load:function(a){ejax.load("dashboard","loadStream",a)}},login:{toggle:function(){$("#easyblog-search-form").hide().siblings().removeClass("active"),$(".user-options").hide().siblings().removeClass("active"),$("#easyblog-login-form").toggle(),$("#easyblog-login-form").siblings().toggleClass("active")}},report:{show:function(a,b){EasyBlog.ajax("site.views.reports.show",{id:a,type:b},function(a,b){ejax.dialog({title:a,content:b})
})}},search:{toggle:function(){$(".user-options").hide().siblings().removeClass("active"),$("#easyblog-login-form").hide().siblings().removeClass("active"),$("#easyblog-search-form").toggle(),$("#easyblog-search-form").siblings().toggleClass("active")}},toolbar:{dashboard:function(){$("#easyblog-search-form").hide(),$("#easyblog-login-form").hide(),$(".user-options").toggle(),$(".user-options").siblings().toggleClass("active")}},images:{initFancybox:function(a,b){window.eblog_lightbox_strip_extension&&window.eblog_lightbox_title?$(a).each(function(){var a=$(this),c=a.attr("title")||"",d=c.split(".").reverse();
/jpg|png|gif|xcf|odg|bmp|jpeg/.test(d[0].toLowerCase())&&d.splice(0,1),c=d.reverse().join("."),a.fancybox($.extend(!0,{},b,{title:c}))}):$(a).fancybox(b)},initCaption:function(a){$(a).each(function(a,b){var b=$(b).removeClass("easyblog-image-caption");if(!(b.parents(".easyblog-image-caption-container").length>0)){var c=$(b).attr("src"),d=b.parent().hasClass("easyblog-thumb-preview"),e=function(a){var a=a[0],b=!1;return $.each(a.parentNode.childNodes,function(c,d){d==a||$(d).hasClass("easyblog-image-caption")||$(d).hasClass("easyblog-thumb-preview")||(b=!0)
}),b};b.one("load",function(){var a=d?b.parent():b,c=a.css("float");if("none"==c&&(c=b.css("float")),"none"==c){var f=(b.attr("style")||"").split(";"),g={};$.each(f,function(a,b){var c=b.split(":");g[$.trim(c[0])]=$.trim(c[1])}),"auto"==g["margin-left"]&&"auto"==g["margin-right"]&&(c="center")}if("none"==c){var h=b.parent().attr("align");switch((void 0===h||"none"==h)&&(h=b.attr("align")),h){case"left":c="left";break;case"right":c="right";break;case"center":case"middle":c="center"}}/none|center/.test(c)||(c=(e(a)?"float":"align")+c);
var i=$("<span>").addClass("easyblog-image-caption-container orientation-"+c);if("center"==c||"alignright"==c||"alignleft"==c){var j=$("<span>");a.wrap(j),a.parent().wrap(i)}else a.wrap(i);var k=$("<span>").addClass("easyblog-image-caption");k.width(a.outerWidth()).html(b.attr("title")),a.after(k)}).removeAttr("src").attr("src",c)}})}},captcha:{reload:function(){var a=$("#captcha-id").val();ejax.load("entry","reloadCaptcha",a)},reloadImage:function(a,b){$("#captcha-image").attr("src",b),$("#captcha-id").val(a),$("#captcha-response").val("")
}},comments:{edit:function(a){ejax.load("entry","editComment",a)},remove:function(a){ejax.load("entry","deleteComment",a)}},checkbox:{render:function(){$(".option-enable").click(function(){var a=$(this).parent();$(".option-disable",a).removeClass("selected"),$(this).addClass("selected"),$(".radiobox",a).attr("value",1)}),$(".option-disable").click(function(){var a=$(this).parent();$(".option-enable",a).removeClass("selected"),$(this).addClass("selected"),$(".radiobox",a).attr("value",0)})}},categories:{loadMore:function(a){$(a).parent().hide().next(".more-subcategories").show()
}},drafts:{getContent:null,frequency:15e3,chars:0,check:function(){var a=eblog.drafts.getContent();if("undefined"!=typeof a){var b=$("#title").val();(a.length>0||b.length>0&&b!=emptyText)&&ejax.load("dashboard","saveDraft",ejax.getFormVal("#blogForm"),a,""),setTimeout("eblog.drafts.check()",eblog.drafts.frequency)}},save:function(){eblog.editor.toggleSave(),$(window).unbind("beforeunload"),$("#form-task").val("savedraft");var a=eblog.editor.getContent(),b=$("<div>").html(a).html();$("#write_content_hidden").val(b),$("#blogForm").submit()
}},subscription:{show:function(a,b){ejax.load("subscription","showForm",a,b)},submit:function(a){eblog.loader.loading("eblog_loader"),ejax.load("subscription","submitForm",a,ejax.getFormVal("#frmSubscribe"))}},dashboard:{logout:function(){$("#eblog-logout").submit()},changeCollab:function(a){$("#blog_contribute_source").val(a)},changeAuthor:function(a,b){ejax.dialog({width:700,height:500,title:a,content:"",beforeDisplay:function(){var a=$(this);a.find(".dialog-middle").css("padding",0)},afterDisplay:function(){var a=$(this);
$("<iframe>").attr("src",b).css({width:a.find(".dialog-middle").width(),height:a.find(".dialog-middle").height(),border:"none"}).appendTo(a.find(".dialog-middle-content"))}})},changeCategory:function(a,b){ejax.dialog({width:700,height:500,title:a,content:"",beforeDisplay:function(){var a=$(this);a.find(".dialog-middle").css("padding",0)},afterDisplay:function(){var a=$(this);$("<iframe>").attr("src",b).css({width:a.find(".dialog-middle").width(),height:a.find(".dialog-middle").height(),border:"none"}).appendTo(a.find(".dialog-middle-content"))
}})},socialshare:{setActive:function(a){$(a).parent().toggleClass("active")}},drafts:{discard:function(a){ejax.load("dashboard","confirmDeleteDraft",a)},discardAll:function(){ejax.load("dashboard","confirmDeleteAllDraft")}},lists:{init:function(a){$("#dashboard-"+a).checkList({checkbox:".stackSelect",masterCheckbox:".stackSelectAll",change:function(a){this.parent(".ui-list-select").toggleClass("active",a.length>0),$("#select-actions").toggle(a.length>0)}})}},toggle:function(a){"block"==$(a).parent().next().css("display")?($(a).parent().addClass("ui-togbox"),$(a).parent().next().hide()):($(a).parent().removeClass("ui-togbox"),$(a).parent().next().show())
},quickpost:{notify:function(a,b){$("#eblog-message").removeClass("error info success").addClass(a),$("#eblog-message div").html(b),$("#eblog-message").show()},save:function(){eblog.loader.loading("quickpost-loading");var a=ejax.getFormVal("#quick-post");ejax.load("dashboard","save",a)},draft:function(){eblog.loader.loading("quickdraft-loading");var a=$("#eblog-post-content").val();ejax.load("dashboard","quickSaveDraft",ejax.getFormVal("#quick-post"),a,"")}},settings:{submit:function(){return""==$("#password").val()&&""==$("#password2").val()||$("#password").val()==$("#password2").val()?($("#dashboard").submit(),void 0):($(".password-notice").show(),!1)
}},categories:{create:function(){return"block"==$("#widget-create-category").css("display")?$("#widget-create-category").slideUp():$("#widget-create-category").slideDown(),!1},edit:function(a){ejax.load("dashboard","editCategory",a)},remove:function(a,b){ejax.load("dashboard","confirmDeleteCategory",b,a)},quicksave:function(a){ejax.load("dashboard","quickSaveCategory",a)}},comments:{publish:function(a,b){ejax.load("dashboard","publishComment",a,b)},publishModerated:function(a,b){ejax.load("dashboard","publishModerateComment",a,b)
},edit:function(a){ejax.load("dashboard","editComment",a)},remove:function(a,b){ejax.load("dashboard","confirmDeleteComment",b,a)}},action:function(a,b){var c=$("#"+a+"-action").val(),d="#"+a+"-form",e="";if($(d+' INPUT[name="cid[]"]').each(function(){$(this).prop("checked")&&(e=0==e.length?$(this).val():e+","+$(this).val())}),""==e)return eblog.system.alert("COM_EASYBLOG_PLEASE_SELECT_ONE_ITEM_TO_CONTINUE","COM_EASYBLOG_WARNING"),void 0;switch(c){case"copy":ejax.load("dashboard","copyForm",e);break;case"discardDraft":eblog.dashboard.drafts.discard(e);
break;case"publishBlog":eblog.blog.togglePublish(e,"publish");break;case"unpublishBlog":eblog.blog.togglePublish(e,"unpublish");break;case"deleteBlog":eblog.blog.confirmDelete(e,b);break;case"rejectBlog":eblog.editor.reject(e);break;case"unpublishComment":eblog.dashboard.comments.publish(e,"unpublish");break;case"publishComment":eblog.dashboard.comments.publish(e,"publish");break;case"removeComment":eblog.dashboard.comments.remove(b,e,"");break;default:eblog.system.alert("COM_EASYBLOG_PLEASE_SELECT_ACTION_TO_PERFORM","COM_EASYBLOG_WARNING")
}},videos:{insert:function(a){var b=$("#video-source").val(),c=$("#video-width").val(),d=$("#video-height").val(),e='[embed=videolink]{"video":"'+b+'","width":"'+c+'","height":"'+d+'"}[/embed]';jInsertEditorText(e,a),ejax.closedlg()},showForm:function(a){try{IeCursorFix()}catch(b){}ejax.load("dashboard","showVideoForm",a)}},preview:function(a){var b=eblog.drafts.getContent();if("undefined"!=typeof b){var c=$("#eblog-wrapper #title").val();b.length>0&&c.length>0&&c!=emptyText?ejax.call("dashboard","saveDraft",[ejax.getFormVal("#blogForm"),b,""],{success:function(){var b=$("#draft_id").val();
if(""!=b){var c=$.rootPath+"/index.php?option=com_easyblog&view=entry&layout=preview&draftid="+b+"&Itemid="+a,d=screen.width,e=screen.height,f=screen.width/2-d/2,g=screen.height/2-e/2;window.open(c,"","toolbar=no, location=no, directories=no, status=yes, menubar=yes, scrollbars=yes, resizable=yes, copyhistory=no, width="+d+", height="+e+", top="+g+", left="+f)}}}):b.length>0?eblog.system.alert("COM_EASYBLOG_PLEASE_SET_TITLE_BEFORE_PREVIEW","COM_EASYBLOG_ENTRY_PREVIEW_MODE"):eblog.system.alert("COM_EASYBLOG_ENTRY_PREVIEW_MODE_NO_CONTENT","COM_EASYBLOG_ENTRY_PREVIEW_MODE")
}}},editor:{checkPublishStatus:function(){var a=$("#published").val(),b=$("#publish_down").val();return""==b||"0000-00-00 00:00:00"==b?(eblog.editor.postSubmit(),!0):(ejax.load("dashboard","checkPublishStatus",a,b),!0)},cancelSubmit:function(){return isSave=!1,$("#save_post").attr("disabled",""),!1},postSubmit:function(){$(window).unbind("beforeunload"),$("#blogForm").submit()},save:function(){eblog.editor.toggleSave();var a=eblog.editor.getContent(),b=a.split('<hr id="system-readmore" />');if(b.length>1)var c=$.sanitizeHTML(b[0]),d=$.sanitizeHTML(b[1]),e=c+'<hr id="system-readmore" />'+d;
else var e=$.sanitizeHTML(a);$("#write_content_hidden").val(e),$("#save_post_button").addClass("ui-disabled"),$("#save_post_button").attr("disabled","disabled"),eblog.editor.checkPublishStatus()},apply:function(){$("input[name=apply]").val(1),eblog.editor.save()},reject:function(a){ejax.load("Dashboard","confirmRejectBlog",a)},search:{load:function(){try{IeCursorFix()}catch(a){}ejax.load("search","search",$("#search-content").val())},insert:function(a,b,c){var d='<a href="'+a+'">'+b+"</a>";switch(c){case"intro":$("#widget-write-introtext .ui-modhead").hasClass("ui-togbox")?eblog.editor.setIntro(d):jInsertEditorText(d,c);
break;case"write_content":$("#widget-writepost .ui-modhead").hasClass("ui-togbox")?eblog.editor.setContent(d):jInsertEditorText(d,c)}}},setIntro:null,setContent:null,getContent:null,datetimepicker:{element:function(a,b){$("#datetime_"+a).addClass("toggle-active"),$("#datetime_edit_"+a).hide();var c,d,e,f,g,h;eblog.editor.datetimepicker.hideEditLink(a);var c,d,e,f,g,h;if(eblog.editor.datetimepicker.hideEditLink(a),"publish_down"==a&&""==$("#"+a).val()){var i=$("#publish_down_reset").val();$("#"+a).val(i)}if(""!=$("#"+a).val()){var j=$("#"+a).val(),k=j.split(" "),l=k[1].split(":"),m=k[0].split("-");
c=m[2],d=m[1],e=m[0],f=l[0],g=l[1]}else today=new Date,c=today.getDate(),d=today.getMonth()+1,e=today.getFullYear(),f=today.getHours(),g=today.getMinutes();f=parseInt(f,10),g.length<=1&&(g="0"+g),h=f>=12?"pm":"am",f>12&&(f-=12),"am"==h&&0==f&&(f=12),10>f&&(f="0"+f);var n="";n+='<div class="dtpicker-wrap" id="dtpicker_'+a+'" style="display: none;">',n+='	<select tabindex="4" name="dt_month" id="dt_month_'+a+'">',n+='		<option value="01" '+("01"==d?'selected="selected"':"")+">"+sJan+"</option>",n+='		<option value="02" '+("02"==d?'selected="selected"':"")+">"+sFeb+"</option>",n+='		<option value="03" '+("03"==d?'selected="selected"':"")+">"+sMar+"</option>",n+='		<option value="04" '+("04"==d?'selected="selected"':"")+">"+sApr+"</option>",n+='		<option value="05" '+("05"==d?'selected="selected"':"")+">"+sMay+"</option>",n+='		<option value="06" '+("06"==d?'selected="selected"':"")+">"+sJun+"</option>",n+='		<option value="07" '+("07"==d?'selected="selected"':"")+">"+sJul+"</option>",n+='		<option value="08" '+("08"==d?'selected="selected"':"")+">"+sAug+"</option>",n+='		<option value="09" '+("09"==d?'selected="selected"':"")+">"+sSep+"</option>",n+='		<option value="10" '+("10"==d?'selected="selected"':"")+">"+sOct+"</option>",n+='		<option value="11" '+("11"==d?'selected="selected"':"")+">"+sNov+"</option>",n+='		<option value="12" '+("12"==d?'selected="selected"':"")+">"+sDec+"</option>",n+="	</select>",n+='	<input type="text" autocomplete="off" tabindex="4" maxlength="2" size="2" value="'+c+'" name="dt_day" id="dt_day_'+a+'">, ',n+='	<input type="text" autocomplete="off" tabindex="4" maxlength="4" size="4" value="'+e+'" name="dt_year" id="dt_year_'+a+'"> @ ',n+='	<input type="text" autocomplete="off" tabindex="4" maxlength="2" size="2" value="'+f+'" name="dt_hour" id="dt_hour_'+a+'"> : ',n+='	<input type="text" autocomplete="off" tabindex="4" maxlength="2" size="2" value="'+g+'" name="dt_min" id="dt_min_'+a+'">',n+='	<select tabindex="4" name="dt_ampm" id="dt_ampm_'+a+'">',n+='		<option value="am" '+("am"==h?'selected="selected"':"")+">"+sAm+"</option>",n+='		<option value="pm" '+("pm"==h?'selected="selected"':"")+">"+sPm+"</option>",n+="	</select>",n+='	<div class="dtpicker-action" id="dtpicker_action_'+a+'">',n+='		<a class="dtpicker-save ui-button" href="javascript:void(0);" onclick="eblog.editor.datetimepicker.save(\''+a+"')\">"+btnOK+"</a>",b&&(n+='		<a class="dtpicker-reset" href="javascript:void(0);" onclick="eblog.editor.datetimepicker.reset(\''+a+"')\">"+btnReset+"</a>"),n+='		<a class="dtpicker-cancel" href="javascript:void(0);" onclick="eblog.editor.datetimepicker.cancel(\''+a+"')\">"+btnCancel+"</a>",n+="	</div>",n+="</div>",$(n).insertAfter("#datetime_"+a),$("#dtpicker_"+a).slideDown("fast")
},reset:function(a){$("#dtpicker_"+a).slideUp("fast"),$("#"+a).val(""),$("#datetime_"+a+" .datetime_caption").html(sNever),eblog.editor.datetimepicker.showEditLink(a)},cancel:function(a){$("#dtpicker_"+a).slideUp("fast"),"publish_down"!=a||""!=$("#publish_down_ori").val()&&"0000-00-00 00:00:00"!=$("#publish_down_ori").val()||$("#"+a).val(""),$("#datetime_"+a).removeClass("toggle-active"),eblog.editor.datetimepicker.showEditLink(a)},save:function(a){$("#dtpicker_"+a).slideUp("fast"),$("#datetime_"+a).removeClass("toggle-active");
var b,c,d,e,f,g;if(b=$("#dtpicker_"+a+" #dt_day_"+a).val(),c=$("#dtpicker_"+a+" #dt_month_"+a).val(),c=parseInt(c,10),10>c&&(c="0"+c),d=$("#dtpicker_"+a+" #dt_year_"+a).val(),e=$("#dtpicker_"+a+" #dt_hour_"+a).val(),g=$("#dtpicker_"+a+" #dt_ampm_"+a).val(),"pm"==g)switch(parseInt(e,10)){case 12:break;default:e=parseInt(e,10)+12}else switch(parseInt(e)){case 12:e="00";break;default:e.length<=1&&(e="0"+e)}f=$("#dtpicker_"+a+" #dt_min_"+a).val(),f.length<=1&&(f="0"+f);var h=d+"-"+c+"-"+b+" "+e+":"+f+":00";$("#"+a).val(h),ejax.load("dashboard","updateDisplayDate",a,h),eblog.editor.datetimepicker.showEditLink(a)
},showEditLink:function(a){$("#datetime_edit_"+a).show()},hideEditLink:function(a){$("#datetime_edit_"+a).hide()}},permalink:{edited:!1,generate:function(){""==$("#title").val()||eblog.editor.permalink.edited||ejax.load("dashboard","getPermalink",$("#title").val())},edit:function(){"none"==$("#permalink-edit").css("display")?(eblog.editor.permalink.edited=!0,$("#permalink-edit").show(),$("#permalink-value").hide()):($("#permalink-edit").hide(),$("#permalink-value").show())},save:function(){$("#permalink-url").html($("#permalink-data").val()),eblog.editor.permalink.edit()
}}},tags:{search:{init:function(){$("#filter-tags").keyup(function(){var a=$.trim($(this).val());$(".post-tags li").hide().filter(function(){return(this.textContent||this.innerText||"").toUpperCase().indexOf(a.toUpperCase())>=0}).show()})}}},loader:{item:null,loading:function(a){eblog.loader.item=a,$("#"+a).addClass("eblog_loader"),$("#"+a).show()},doneLoading:function(){null!=eblog.loader.item&&$("#"+eblog.loader.item).removeClass("eblog_loader")}},comment:{likes:function(a,b,c){eblog.loader.loading("likes-"+a),ejax.load("Entry","likesComment",a,b,c)
},save:function(){$("#eblog-message").removeClass("info error"),$("#eblog-message").html(""),eblog.loader.loading("comment-form-title"),finalData=ejax.getFormVal("#frmComment"),ejax.load("Entry","commentSave",finalData),$("#empty-comment-notice").length>0&&$("#empty-comment-notice").fadeOut("100")},reply:function(a,b,c){$(".cancel_container").hide(),$(".reply_container").show(),$("#comment-reply-form-"+a).show();var d=$("#eblog-wrapper #frmComment").clone();if($("#eblog-wrapper #frmComment").remove(),$("#comment-reply-form-"+a).addClass("comment-form-inline").append(d),$("#parent_id").val(a),$("#comment_depth").val(b),c){var e=$("#comment-title-"+a).text(),f=""!=e?"RE:"+e:"";
$("#title.inputbox").val(f)}$(".comment-reply-no").removeClass("show-this"),$(".comment-reply-yes").addClass("show-this"),$("#toolbar-reply-"+a).removeClass("show-this"),$("#toolbar-cancel-"+a).addClass("show-this"),$("#toolbar-cancel-"+a).parent(".comment-reply").toggleClass("in-action"),$(".markItUpContainer").length>0&&($("#comment").markItUpRemove(),$("#comment").markItUp(EasyBlogBBCodeSettings))},cancel:function(a){var b=$("#eblog-wrapper #comment-reply-form-"+a+" #frmComment").clone();$("#eblog-wrapper #comment-reply-form-"+a+" #frmComment").remove(),$("#eblog-wrapper #comment-separator").after(b),$("#parent_id").val("0"),$("#comment_depth").val("0"),$("#comment-reply-form-"+a).hide(),$("#title.inputbox").val(""),$("#toolbar-reply-"+a).toggleClass("show-this"),$("#toolbar-cancel-"+a).toggleClass("show-this"),$("#toolbar-cancel-"+a).parent(".comment-reply").toggleClass("in-action"),$(".markItUpContainer").length>0&&($("#comment").markItUpRemove(),$("#comment").markItUp(EasyBlogBBCodeSettings))
},edit:function(){$("#eblog-message").removeClass("info error"),$("#eblog-message").html(""),finalData=ejax.getFormVal("#frmComment"),ejax.load("dashboard","updateComment",finalData)},action:function(a,b){var c=0,d="",e=$("#"+a).val();return""==e?(eblog.system.alert("COM_EASYBLOG_PLEASE_SELECT_ACTION_TO_PERFORM","COM_EASYBLOG_WARNING"),void 0):($("#adminForm INPUT[name='cid[]']").each(function(){$(this).attr("checked")&&(d=0==d.length?$(this).val():d+","+$(this).val(),c++)}),0>=c?(eblog.system.alert("COM_EASYBLOG_PLEASE_SELECT_ONE_ITEM_TO_CONTINUE","COM_EASYBLOG_WARNING"),void 0):("unpublishComment"==e?ejax.load("dashboard","publishComment",d,"0","comment"):"publishComment"==e?ejax.load("dashboard","publishComment",d,"1","comment"):"removeComment"==e&&eblog.comment.confirm(b,d,""),void 0))
},confirm:function(a,b){var d=a+"&task=removeComment&commentId="+b,e='window.location = "'+d+'";';eblog.system.dialog("COM_EASYBLOG_ARE_YOU_SURE_YOU_WANT_TO_REMOVE_COMMENT",e,"CONFIRMATION")},displayInlineMsg:function(a,b){$("#eblog-message").removeClass("info error"),$("#eblog-message").html(b),$("#eblog-message").addClass(a),"info"==a&&setTimeout(function(){$("#eblog-message").removeClass("info error"),$("#eblog-message").html("")},6e3)}},featured:{add:function(a,b){ejax.load("Latest","makeFeatured",a,b)},remove:function(a,b){ejax.load("Latest","removeFeatured",a,b)
},slider:{holderWidth:0,element:Array(),autorotate:function(a){var b=$("#ezblog-featured .featured-a").children(),c=!1;$(b).each(function(){$(this).hasClass("active")&&1!=c&&(0==$(this).next().length?$("#ezblog-featured .featured-a :first").click():$(this).next().click(),c=!0)}),setTimeout("eblog.featured.slider.autorotate("+a+");",a)},init:function(a,b,c){eblog.featured.slider.element[a]={width:parseInt($("."+a).parent().width()),element:"."+a};var d=0;$(eblog.featured.slider.element[a].element).children().each(function(){d+=eblog.featured.slider.element[a].width
}),$(eblog.featured.slider.element[a].element).css("width",d),$(eblog.featured.slider.element[a].element).children().css("width",eblog.featured.slider.element[a].width),b&&(c=1e3*parseInt(c),setTimeout("eblog.featured.slider.autorotate("+c+");",c))},slide:function(a,b){var c=0,d=a;1!=a&&(a-=1,c=eblog.featured.slider.element[b].width*parseInt(a)),$(eblog.featured.slider.element[b].element).animate({left:"-"+c+"px"},"slow"),$(eblog.featured.slider.element[b].element).parent().parent().children("div.featured-navi").children().children().removeClass("active"),$(eblog.featured.slider.element[b].element).parent().parent().children("div.featured-navi").children().children(".slider-navi-"+d).addClass("active")
}}},spinner:{show:function(){$("#blogSubmitBtn").hide(),$("#blogSubmitWait").show()},hide:function(){$("#blogSubmitWait").hide(),$("#blogSubmitBtn").show()},publish:function(a,b){1==b?$("#"+a+"Spinner").html('<img src="'+spinnerPath+'" alt="Loading">'):$("#"+a+"Spinner").html("")}},element:{focus:function(a){ele="#"+a,$(ele).focus(),ejax.closedlg()}},blog:{publish:function(a,b,c){var d=a+"&task=toggleBlogStatus&status="+c+"&blogId="+b;window.location=d},remove:function(a,b){var c="",d=b?b:"Dashboard";$.each(a,function(){eblog.spinner.publish(a,1),""!=c&&(c+=","),c+=this
}),ejax.load("Dashboard","deleteBlog",c,d)},confirmDelete:function(a,b){ejax.load("dashboard","confirmDelete",a,b)},confirm:function(a,b){},approve:function(a,b){ejax.load("dashboard","confirmApproveBlog",b,a)},ajaxpublish:function(a,b,c){var d="",e=c?c:"Dashboard";$.each(a,function(){eblog.spinner.publish(a,1),""!=d&&(d+=","),d+=this}),ejax.load("Dashboard","togglePublishStatus",d,b,e)},togglePublish:function(a,b){ejax.load("dashboard","togglePublish",a,b)},action:function(a,b){var c=0,d="",e=$("#"+a).val();
return"default"!=e?($("#adminForm INPUT[name='cid[]']").each(function(){$(this).attr("checked")&&(d=0==d.length?$(this).val():d+","+$(this).val(),c++)}),0>=c?(eblog.system.alert("COM_EASYBLOG_PLEASE_SELECT_ONE_ITEM_TO_CONTINUE","COM_EASYBLOG_WARNING"),void 0):("unpublishBlog"==e?eblog.blog.togglePublish(d,"unpublish"):"publishBlog"==e?eblog.blog.togglePublish(d,"publish"):"deleteBlog"==e&&eblog.blog.confirmDelete(d,b),void 0)):void 0},tab:{init:function(){$(".tab_container").hide(),$("div.tab-wrapper .tab_container:first").show(),$(".tab_item:first").addClass("item-active"),$("ul.tab_button li.tab_item a").click(function(){var a=$(this).parent();
if(a.hasClass("item-active"))return!1;a.siblings().each(function(){$(this).hasClass("item-active")&&$(this).removeClass("item-active")}),a.addClass("item-active"),$(".tab_container").hide();var b=a.attr("id"),c=b.split("-"),d=c[1];return $("#section-"+d).show(),!1})}},unsubscribe:function(a,b){ejax.load("entry","confirmUnsubscribeBlog",a,b)}},tag:{remove:function(a,b){ejax.load("Dashboard","confirmDeleteTag",b,a)},edit:function(a){ejax.load("Dashboard","editTagDialog",a)},action:function(a,b){var c=0,d="",e=$("#"+a).val();
return""==e?(eblog.system.alert("COM_EASYBLOG_PLEASE_SELECT_ACTION_TO_PERFORM","COM_EASYBLOG_WARNING"),void 0):($("#adminForm INPUT[name='cid[]']").each(function(){$(this).attr("checked")&&(d=0==d.length?$(this).val():d+","+$(this).val(),c++)}),0>=c?(eblog.system.alert("COM_EASYBLOG_PLEASE_SELECT_ONE_ITEM_TO_CONTINUE","COM_EASYBLOG_WARNING"),void 0):("deleteTag"==e&&eblog.tag.confirm(b,d,""),void 0))},confirm:function(a,b){var d=a+"&task=deleteTag&tagId="+b,e='window.location = "'+d+'";';eblog.system.dialog("COM_EASYBLOG_ARE_YOU_SURE_YOU_WANT_TO_REMOVE_TAGS",e,"CONFIRMATION")
},save:function(){finalData=ejax.getFormVal("#frmEditTag"),ejax.load("Dashboard","saveTag",finalData)}},socialshare:{share:function(a,b){eblog.spinner.publish(a,1),ejax.load("dashboard","ajaxSocialShare",a,b)}},twitter:{update:function(a){""!=a&&(eblog.spinner.publish(a,1),ejax.load("Dashboard","ajaxUpdateTwitter",a))}},form:{checkbox:{checkall:function(){return $("#adminForm INPUT[type='checkbox']").each(function(){$("#toggle").attr("checked")?$(this).attr("checked",!0):$(this).attr("checked",!1)}),!1}}},trackback:{url:{copy:function(){$("#trackback-url").focus().select()
}}},system:{alert:function(a,b){ejax.alert(ejax.string(a),ejax.string(b),"450","auto")},dialog:function(a,b,c){var d='<div class="dialog-actions"><input type="button" value="'+ejax.string("No")+'" class="button" id="edialog-cancel" name="edialog-cancel" onclick="ejax.closedlg();" /><input type="button" value="'+ejax.string("Yes")+'" class="button" id="edialog-submit" name="edialog-submit" onclick="'+b+'" /></div>',e={title:ejax.string(c),content:ejax.string(a)+d};ejax.dialog(e)},loader:function(a){if(a){$("img#easyblog-loader").length>0&&$("img#easyblog-loader").remove();
var b=new Image;b.src="/components/com_easyblog/assets/images/loader.gif",b.name="easyblog-loader",b.id="easyblog-loader";var c=$("div#eblog-wrapper"),d=c.width();divHeight=window.innerHeight||self.innerHeight||window.parent.document.body.clientHeight,c.prepend(b),$("img#easyblog-loader").css("marginTop",divHeight/2),$("img#easyblog-loader").css("marginLeft",d/2),$("img#easyblog-loader").css("position","absolute"),$("img#easyblog-loader").css("z-index",10)}else $("img#easyblog-loader").length>0&&$("img#easyblog-loader").remove()
}},teamblog:{join:function(a){var b=String(a);ejax.load("TeamBlog","showDialog",b,"join")},leave:function(a){var b=String(a);ejax.load("TeamBlog","showDialog",b,"leave")},leaveteam:function(){eblog.loader.loading("eblog_loader"),ejax.load("teamblog","leaveTeam",ejax.getFormVal("#frmLeave"))},send:function(){eblog.loader.loading("eblog_loader"),ejax.load("teamblog","addJoinRequest",ejax.getFormVal("#frmJoin"))},approve:function(){},reject:function(){}},calendar:{reload:function(a,b,c,d,e,f,g){ejax.load(a,b,c,d,e,f,g)
},showtooltips:function(a){$(".easyblog_calendar_tooltips").hide(),$("#com_easyblog_calendar_day_"+a).show()}}},ejax=window.ejax={http:!1,format:"text",callback:function(){},error:!1,getHTTPObject:function(){var a=!1;if("undefined"!=typeof ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=!1}}else if(XMLHttpRequest)try{a=new XMLHttpRequest}catch(b){a=!1}return a},call:function(a,b,c,d){var e=[{view:a,callback:d},b];e=e.concat(c),ejax.load.apply(this,e)
},load:function(view,method){var callback={success:function(){},error:function(){}};"object"==typeof view&&(callback=$.extend(callback,$.isFunction(view.callback)?{success:view.callback}:view.callback),view=view.view),url=eblog_site,url+="&tmpl=component",url+="&no_html=1",url+="&format=ejax",url+="&"+EasyBlog.getToken()+"=1",url+="&uid="+(new Date).getTime();var parameters="&view="+view+"&layout="+method;if(arguments.length>2)for(var i=2;i<arguments.length;i++){var myArgument=arguments[i];if($.isArray(myArgument))for(var j=0;j<myArgument.length;j++){var argument=myArgument[j];
"string"==typeof argument&&(parameters+="&value"+(i-2)+"[]="+encodeURIComponent(argument))}else{var argument=myArgument;"string"==typeof argument&&(parameters+="&value"+(i-2)+"="+encodeURIComponent(argument))}}var http=this.getHTTPObject();if(http&&view&&method){var ths=this;http.open("POST",url,!0),http.setRequestHeader("Content-type","application/x-www-form-urlencoded"),http.onreadystatechange=function(){if(4==http.readyState)if(200==http.status){var result="";http.responseText&&(result=http.responseText),result=result.replace(/[\n\r]/g,"");
try{result=eval(result)}catch(e){callback.error&&callback.error("Invalid response.")}ths.process(result,callback)}else ths.error&&(ths.error(http.status),callback.error&&callback.error(http.status))},http.send(parameters)}},_string:[],string:function(a){if(void 0!=ejax._string[a])return ejax._string[a];var b=eblog_site+"&tmpl=component&no_html=1&controller=easyblog&task=ajaxGetSystemString",c=$.ajax({type:"POST",url:b,data:"data="+a,async:!1,cache:!0}).responseText;return ejax._string[a]=c,c},getFormVal:function(a){var b=[],c=null;
return $(":input",$(a)).each(function(){c=this.value.replace(/"/g,"&quot;"),c=encodeURIComponent(c),$(this).is(":checkbox")||$(this).is(":radio")?$(this).prop("checked")&&b.push(this.name+"="+escape(c)):b.push(this.name+"="+escape(c))}),b},process:function(result,callback){for(var i=0;i<result.length;i++){var action=result[i][0];switch(action){case"script":var data=result[i][1];eval("EasyBlog(function($){"+data+"});");break;case"after":var id=result[i][1],value=result[i][2];$("#"+id).after(value);break;case"append":var id=result[i][1],value=result[i][2];
$("#"+id).append(value);break;case"assign":var id=result[i][1],value=result[i][2];$("#"+id).html(value);break;case"value":var id=result[i][1],value=result[i][2];$("#"+id).val(value);break;case"prepend":var id=result[i][1],value=result[i][2];$("#"+id).prepend(value);break;case"destroy":var id=result[i][1];$("#"+id).remove();break;case"dialog":ejax.dialog(result[i][1]);break;case"alert":ejax.alert(result[i][1],result[i][2],result[i][3],result[i][4]);break;case"create":break;case"error":var args=result[i].slice(1);
callback.error.apply(this,args);break;case"callback":var args=result[i].slice(1);callback.success.apply(this,args)}}delete result},dialog:function(a){ejax._showPopup(a)},closedlg:function(){var a=$("#eblog-dialog"),b=$("#eblog-overlay"),c=a.data("options");b.hide(),a.fadeOut(function(){c.afterClose.apply(a)}),$(window).unbind(".dialog"),$(document).unbind("keyup",ejax._attachPopupShortcuts)},_attachPopupShortcuts:function(a){27==a.keyCode&&ejax.closedlg()},alert:function(a,b,c,d){var e=ejax.string("COM_EASYBLOG_OK"),f='<div class="dialog-actions"><input type="button" value="'+e+'" class="button" id="edialog-cancel" name="edialog-cancel" onclick="ejax.closedlg();" /></div>',g={title:b,content:a+f,width:c,height:d};
ejax._showPopup(g)},_showPopup:function(a){var b={width:"500",height:"auto",type:"dialog",beforeDisplay:function(){},afterDisplay:function(){},afterClose:function(){}},a=$.extend({},b,a),c=$("#eblog-overlay");c.length<1&&(c='<div id="eblog-overlay"></div>',c=$(c).appendTo("body"),c.click(function(){ejax.closedlg()}));var d=$("#eblog-dialog");d.length<1&&(dialogTemplate='<div id="eblog-dialog">',dialogTemplate+='	<div class="dialog">',dialogTemplate+='		<div class="dialog-wrap">',dialogTemplate+='			<div class="dialog-top">',dialogTemplate+="				<h3></h3>",dialogTemplate+='				<a href="javascript:void(0);" onclick="ejax.closedlg();" class="closeme">Close</a>',dialogTemplate+="			</div>",dialogTemplate+='			<div class="dialog-middle clearfix">',dialogTemplate+='				<div class="dialog-middle-content"></div>',dialogTemplate+="			</div>",dialogTemplate+="		</div>",dialogTemplate+="	</div>",dialogTemplate+="</div>",d=$(dialogTemplate).appendTo("body")),d.data("options",a);
var e=d.find(".dialog-top h3");a.title=null!=a.title?a.title:"&nbsp;",e.html(unescape(a.title));var f=$("#eblog-dialog .dialog-middle-content");f.css({width:"auto"==a.width?"auto":parseInt(a.width),height:"auto"==a.height?"auto":parseInt(a.height)}).html(a.content),a.beforeDisplay.apply(d);var g=function(){d.css({top:0,left:0}).position({my:"center",at:"center",of:window}),c.css({width:$(document).width(),height:$(document).height()}).show()};d.show(0,function(){g();var a;$(window).bind("resize.dialog scroll.dialog",function(){clearTimeout(a),a=setTimeout(g,50)
})}),d.fadeOut(0,function(){d.fadeIn(function(){a.afterDisplay.apply(d)})}),$(document).on("click.eb.dialog","#edialog-cancel, #edialog-submit",function(){ejax.closedlg()}),$(document).bind("keyup",ejax._attachPopupShortcuts)}};module.resolve()}),EasyBlog.module("featured",function(a){var b=this;EasyBlog.require().done(function(){EasyBlog.Controller("Featured.Scroller",{defaultOptions:{elements:null,itemWidth:null,autorotate:{enabled:!1,interval:50},"{placeHolder}":".slider-holder","{slider}":".featured-entries","{sliderItems}":".slider-holder ul li","{sliderNavigation}":".featured-navi .featured-a a"}},function(b){return{init:function(){b.options.itemWidth=b.placeHolder().width()+1;
var a=b.sliderItems().length*parseInt(b.options.itemWidth);b.slider().css("width",a),b.sliderItems().css("width",b.options.itemWidth),b.options.autorotate.enabled&&setTimeout(function(){b.initAutoRotate()},1e3*parseInt(b.options.autorotate.interval))},nextItem:function(c){var d=a(c).data("slider"),e=0;1!=d&&(e=b.options.itemWidth*parseInt(d-1)),b.slider().children(":nth-child("+d+")").show(),b.slider().animate({left:"-"+e+"px"},"slow"),b.sliderNavigation(".active").removeClass("active"),a(c).addClass("active")
},"{sliderNavigation} click":function(a){b.nextItem(a)},initAutoRotate:function(){var c=!1;b.sliderNavigation().each(function(){a(this).hasClass("active")&&1!=c&&(0==a(this).next().length?b.nextItem(b.sliderNavigation(":first")):b.nextItem(a(this).next()),c=!0)}),setTimeout(function(){b.initAutoRotate()},1e3*parseInt(b.options.autorotate.interval))}}}),b.resolve()})}),EasyBlog.module("location",function(a){var b=this;EasyBlog.require().library("ui/autocomplete").done(function(){EasyBlog.Controller("Location.Form",{defaultOptions:{language:"en",initialLocation:null,mapType:"ROADMAP","{locationInput}":".locationInput","{locationLatitude}":".locationLatitude","{locationLongitude}":".locationLongitude","{locationMap}":".locationMap","{autoDetectButton}":".autoDetectButton"}},function(b){return{init:function(){var c=a.uid("ext");
window[c]=function(){a.___GoogleMaps.resolve()},a.___GoogleMaps||(a.___GoogleMaps=a.Deferred(),EasyBlog.require().script({prefetch:!1},"https://maps.googleapis.com/maps/api/js?sensor=true&language="+b.options.language+"&callback="+c)),a.___GoogleMaps.done(function(){b._init()})},_init:function(){b.geocoder=new google.maps.Geocoder,b.hasGeolocation=void 0!==navigator.geolocation,b.hasGeolocation?b.autoDetectButton().show():b.autoDetectButton().remove(),b.locationInput().autocomplete({delay:300,minLength:0,source:b.retrieveSuggestions,select:function(a,c){b.locationInput().autocomplete("close"),b.setLocation(c.item.location)
}}).prop("disabled",!1),b.autocomplete=b.locationInput().autocomplete("widget"),b.autocomplete.addClass("location-suggestion");var e=a.trim(b.options.initialLocation);e&&b.getLocationByAddress(e,function(a){b.setLocation(a[0])}),b.busy(!1)},busy:function(a){b.locationInput().toggleClass("loading",a)},getUserLocations:function(a){b.getLocationAutomatically(function(c){b.userLocations=b.buildDataset(c),a&&a(c)})},getLocationByAddress:function(a,c){b.geocoder.geocode({address:a},c)},getLocationByCoords:function(a,c,d){b.geocoder.geocode({location:new google.maps.LatLng(a,c)},d)
},getLocationAutomatically:function(a,c){return navigator.geolocation?(navigator.geolocation.getCurrentPosition(function(c){b.getLocationByCoords(c.coords.latitude,c.coords.longitude,a)},c),void 0):c("ERRCODE","Browser does not support geolocation or do not have permission to retrieve location data.")},renderMap:function(a,c){b.busy(!0),b.locationMap().show();var d=new google.maps.Map(b.locationMap()[0],{zoom:15,center:a.geometry.location,mapTypeId:google.maps.MapTypeId[b.options.mapType],disableDefaultUI:!0}),e=new google.maps.Marker({position:a.geometry.location,center:a.geometry.location,title:a.formatted_address,map:d}),f=new google.maps.InfoWindow({content:c});
google.maps.event.addListener(d,"tilesloaded",function(){f.open(d,e),b.busy(!1)})},setLocation:function(a){a&&(b.locationResolved=!0,b.lastResolvedLocation=a,b.locationInput().val(a.formatted_address),b.locationLatitude().val(a.geometry.location.lat()),b.locationLongitude().val(a.geometry.location.lng()),b.renderMap(a,a.formatted_address))},removeLocation:function(){b.locationResolved=!1,b.locationInput().val(""),b.locationLatitude().val(""),b.locationLongitude().val(""),b.locationMap().hide()},buildDataset:function(b){var c=a.map(b,function(a){return{label:a.formatted_address,value:a.formatted_address,location:a}
});return c},retrieveSuggestions:function(a,c){b.busy(!0);var d=a.term,e=function(a){c(a),b.busy(!1)};""==d?e(b.userLocations||[]):b.getLocationByAddress(d,function(a){e(b.buildDataset(a))})},suggestUserLocations:function(){b.hasGeolocation&&b.userLocations&&(b.removeLocation(),b.locationInput().autocomplete("search","")),b.busy(!1)},"{locationInput} blur":function(){setTimeout(function(){var c=a.trim(b.locationInput().val());""==c?b.removeLocation():b.locationResolved?c!=b.lastResolvedLocation.formatted_address&&b.setLocation(b.lastResolvedLocation):b.removeLocation()
},250)},"{autoDetectButton} click":function(){b.busy(!0),b.hasGeolocation&&!b.userLocations?b.getUserLocations(b.suggestUserLocations):b.suggestUserLocations()}}}),EasyBlog.Controller("Location.Map",{defaultOptions:{animation:"drop",language:"en",useStaticMap:!1,disableMapsUI:!0,zoom:5,fitBounds:null,minZoom:null,maxZoom:null,center:null,locations:[],mapType:"ROADMAP",width:500,height:400,"{locationMap}":".locationMap"}},function(b){return{init:function(){b.mapLoaded=!1;var c=a.uid("ext");if(window[c]=function(){a.___GoogleMaps.resolve()
},1==b.options.useStaticMap){var d="&language="+String(b.options.language),e="&size="+String(b.options.width)+"x"+String(b.options.height),f="&zoom="+String(b.options.zoom),g="&center="+String(parseFloat(b.options.locations[0].latitude).toFixed(6))+","+String(parseFloat(b.options.locations[0].longitude).toFixed(6)),h="&maptype="+google.maps.MapTypeId[b.options.mapType],i="&markers=",j="https://maps.googleapis.com/maps/api/staticmap?sensor=false"+d+e;if(1==b.options.locations.length)i+=String(parseFloat(b.options.locations[0].latitude).toFixed(6))+","+String(parseFloat(b.options.locations[0].longitude).toFixed(6)),j+=f+g+h+i;
else{var k=new Array;a.each(b.options.locations,function(a,b){k.push(String(parseFloat(b.latitude).toFixed(6))+","+String(parseFloat(b.longitude).toFixed(6)))}),i+=k.join("|"),j+=i+h}b.locationMap().show().html('<img src="'+j+'" />'),b.busy(!1)}else{var c=a.uid("ext");window[c]=function(){a.___GoogleMaps.resolve()},a.___GoogleMaps||(a.___GoogleMaps=a.Deferred(),EasyBlog.require().script({prefetch:!1},"https://maps.googleapis.com/maps/api/js?sensor=true&language="+b.options.language+"&callback="+c)),a.___GoogleMaps.done(function(){b._init()
})}},_init:function(){null===b.options.fitBounds&&(b.options.fitBounds=1==b.options.locations.length?!1:!0),b.options.disableMapsUI=Boolean(b.options.disableMapsUI),b.locations=new Array,a.each(b.options.locations,function(a,c){"null"!=c.latitude&&"null"!=c.longitude&&b.locations.push(new google.maps.LatLng(c.latitude,c.longitude))}),b.locations.length>0&&b.renderMap(),b.busy(!1)},busy:function(a){b.locationMap().toggleClass("loading",a)},renderMap:function(){b.busy(!0),b.locationMap().show();var a;a=b.options.center?new google.maps.LatLng(center.latitude,center.longitude):b.locations[0],b.map=new google.maps.Map(b.locationMap()[0],{zoom:parseInt(b.options.zoom),minZoom:parseInt(b.options.minZoom),maxZoom:parseInt(b.options.maxZoom),center:a,mapTypeId:google.maps.MapTypeId[b.options.mapType],disableDefaultUI:b.options.disableMapsUI}),google.maps.event.addListener(b.map,"tilesloaded",function(){0==b.mapLoaded&&(b.mapLoaded=!0,b.loadLocations())
})},loadLocations:function(){b.bounds=new google.maps.LatLngBounds,b.infoWindow=new Array;var c=function(){a.each(b.locations,function(a,c){b.bounds.extend(c);var d=function(){b.addMarker(c,b.options.locations[a])};setTimeout(d,100*(a+1))}),b.options.fitBounds&&b.map.fitBounds(b.bounds)};setTimeout(c,500)},addMarker:function(a,c){if(a){var d=new google.maps.Marker({position:a,map:b.map});d.setAnimation(google.maps.Animation.DROP),b.addInfoWindow(d,c)}},addInfoWindow:function(c,d){var e=d.content;e||(e=d.address);
var f=new google.maps.InfoWindow;f.setContent(e),b.infoWindow.push(f),b.options.locations.length>1?google.maps.event.addListener(c,"click",function(){a.each(b.infoWindow,function(a,b){b.close()}),f.open(b.map,c)}):(google.maps.event.addListener(c,"click",function(){f.open(b.map,c)}),f.open(b.map,c)),d.ratingid&&google.maps.event.addListener(f,"domready",function(){a.each(d.ratingid,function(b,c){eblog.ratings.setup("ebpostmap_"+c+"-ratings",!0,"entry"),a("#ebpostmap_"+c+"-ratings").removeClass("ui-state-disabled"),a("#ebpostmap_"+c+"-ratings-form").find(".blog-rating-text").hide(),a("#ebpostmap_"+c+"-ratings .ratings-value").hide()
})})}}}),b.resolve()})}),EasyBlog.module("media",function(a){var d,f,g,h,b=this,c=function(b){return a("<div>").text(b).html().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};EasyBlog.Controller("Media",{defaultOptions:{debug:{logging:EasyBlog.debug,itemVisibility:!1,delayConfiguration:0,delayCommon:0,delayBrowser:0,delayUploader:0,delayEditor:0},ui:"#EasyBlogMediaManagerUI",overlay:{background:"black",opacity:0},modal:{size:.9},recentActivities:{hideAfter:3e3},"{modalGroup}":".mediaModalGroup","{modal}":".mediaModal","{loaderModal}":".loaderModal","{uploaderModal}":".uploaderModal","{browserModal}":".browserModal","{editorModal}":".editorModal","{modalContent}":".modalContent","{overlay}":".media-overlay","{modalDashboardButton}":".dashboardButton","{assetItem}":".assetItem"}},function(c){return{console:function(a,b){if(c.options.debug.logging){var d=window.console;
if(d){var a=d[a];a&&(a.apply?a.apply(d,b):a(b.join(" ")))}}},assets:{},getAsset:function(b){if(void 0===c.assets[b]){var d=c.assets[b]=a.Deferred();d.done(function(){c.assetItem(".asset-type-"+b).removeClass("loading done failed").addClass("done")}).fail(function(){c.assetItem(".asset-type-"+b).removeClass("loading done failed").addClass("fail")})}return c.assets[b]},createAsset:function(a,b,d){var e=c.getAsset(a);return e.factory=b,setTimeout(function(){e.factory&&e.factory(e)},d),e},init:function(){if(d=c,c.IE=function(){for(var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0];);return b>4?b:a
}(),"undefined"!=typeof tinyMCE&&tinyMCE&&tinyMCE.isIE&&9==c.IE)var b=setInterval(function(){var d=tinyMCE.editors.write_content;if(d){var e="keydown.mediaManager mousedown.mediaManager focus.mediaManager";a(d.contentWindow).off(e).on(e,function(){c.bookmark={element:d.selection.getEnd(),range:d.selection.getBookmark(1).rng}}),clearInterval(b)}},500);c.originalBodyOverflow=a("body").css("overflow"),c.createAsset("configuration",function(a){EasyBlog.module("media/configuration").done(function(){c.initialize(this),a.resolve()
}).fail(function(){a.reject()})},c.options.debug.delayConfiguration),c.createAsset("common",function(a){EasyBlog.require().script("media/navigation").view("media/recent.item","media/browser","media/browser.item-group","media/browser.item","media/browser.tree-item-group","media/browser.tree-item","media/browser.pagination-page","media/browser.uploader","media/browser.uploader.item","media/editor","media/editor.viewport","media/navigation.item","media/navigation.itemgroup").language("COM_EASYBLOG_MM_UNABLE_TO_FIND_EXPORTER","COM_EASYBLOG_MM_GETTING_IMAGE_SIZES","COM_EASYBLOG_MM_UNABLE_TO_RETRIEVE_VARIATIONS","COM_EASYBLOG_MM_ITEM_INSERTED","COM_EASYBLOG_MM_UPLOADING","COM_EASYBLOG_MM_UPLOADING_STATE","COM_EASYBLOG_MM_UPLOADING_PENDING","COM_EASYBLOG_MM_UPLOAD_COMPLETE","COM_EASYBLOG_MM_UPLOAD_PREPARING","COM_EASYBLOG_MM_UPLOAD_UNABLE_PARSE_RESPONSE","COM_EASYBLOG_MM_UPLOADING_LEFT","COM_EASYBLOG_MM_CONFIRM_DELETE_ITEM","COM_EASYBLOG_MM_CANCEL_BUTTON","COM_EASYBLOG_MM_YES_BUTTON","COM_EASYBLOG_MM_ITEM_DELETE_CONFIRMATION").done(function(){a.resolve()
}).fail(function(){a.reject()})},c.options.debug.delayCommon),c.createAsset("uploader",function(b){a.when(c.getAsset("configuration"),c.getAsset("common"),EasyBlog.require().script("media/uploader").done()).done(function(){var a=c.createModal("uploader");g=a.controller=new EasyBlog.Controller.Media.Uploader(a.element,c.options.uploader),b.resolve()}).fail(function(){b.reject()})},c.options.debug.delayUploader),c.createAsset("browser",function(b){a.when(c.getAsset("configuration"),c.getAsset("common"),EasyBlog.require().script("media/browser").done()).done(function(){var a=c.createModal("browser");
f=a.controller=new EasyBlog.Controller.Media.Browser(a.element,c.options.browser),b.resolve()}).fail(function(){b.reject()})},c.options.debug.delayBrowser),c.createAsset("editor",function(b){a.when(c.getAsset("browser"),EasyBlog.require().script("media/editor").done()).done(function(){var a=c.createModal("editor");a.controller=new EasyBlog.Controller.Media.Editor(a.element,c.options.editor),b.resolve()}).fail(function(){b.reject()})},c.options.debug.delayEditor),c.setLayout=a.debounce(c._setLayout,200)},initialize:function(d){var e={controller:{media:c}},d=a.extend(!0,d,{browser:e,uploader:e,library:e,editor:e,exporter:e});
c.update(d),h=d.directorySeparator;var f=a(c.options.ui);c.element.append(f.html()),f.remove(),c.overlay().css(c.options.overlay),c.loader=new EasyBlog.Controller.Media.Loader(c.createModal("loader"),{controller:{media:c}}),c.element.implement(EasyBlog.Controller.Media.Library,c.options.library,function(){}),c.element.implement(EasyBlog.Controller.Media.Exporter,c.options.exporter),b.resolve()},setLayout:function(){c._setLayout()},_setLayout:function(){return c.layout=c.element.hasClass("active")?a.uid():null,c.layout&&c.setModalLayout(),c.layout
},modals:{},createModal:function(b){var d=c.modal("."+b+"Modal");return d.length<1&&(d=a('<div class="mediaModal"></div>').addClass(b+"Modal").appendTo(c.modalGroup())),c.modals[b]={name:b,element:d}},activateModal:function(a,b){if(void 0===c.modals[a])return c.loader.when(c.assets[a]).done(function(){setTimeout(function(){c.activateModal(a,b)},1e3)}),void 0;if(c.currentModal===a)return!0;var d=c.modals[a];if(!d)return!1;c.deactivateModal(c.currentModal),c.currentModal=a,c.show();var e=d.controller;return e&&e.trigger("modalActivate",b),!0
},deactivateModal:function(a,b){var d=c.modals[a];if(!d)return!1;var e=d.controller;if(e)try{e.trigger("modalDeactivate",b)}catch(f){console.error(f)}return d.element.removeClass("active"),c.currentModal=void 0,!0},setModalLayout:function(){clearTimeout(c.setModalLayout.task);var b=c.modals[c.currentModal];if(b){if(!c.layout)return c._setLayout();b.element.addClass("active");var d=b.controller;if(d&&a.isFunction(d.setLayout)){var e=function(){var a=d.element.offset();0===a.top||0===a.left?c.setModalLayout.task=setTimeout(e,50):d.setLayout()
};e()}}},show:function(){c.element.addClass("active"),c._setLayout(),c.trigger("showModal")},hide:function(){c.element.removeClass("active"),c.deactivateModal(c.currentModal),c.trigger("hideModal")},"{overlay} click":function(){c.hide()},"{window} resize":function(){c.setLayout()},"{modalDashboardButton} click":function(a,b){return b.shiftKey?c.console("dir",[c]):(c.hide(),void 0)},upload:function(){c.activateModal("uploader",arguments)},browse:function(){c.activateModal("browser",arguments)},edit:function(){c.activateModal("editor",arguments)
}}}),EasyBlog.Controller("Media.Loader",{defaultOptions:{}},function(b){return{init:function(){},when:function(){b.media.activateModal("loader");var c=a.when.apply(null,arguments),d=c.done;return c.id=a.uid(),c.done=function(a){d(function(){b.currentQueueId==c.id&&a&&a()})},b.currentQueueId=c.id,c},"{self} hide":function(){b.currentQueueId=null}}}),EasyBlog.Controller("Media.Prompt",{defaultOptions:{"{dialog}":".modalPromptDialog","{cancelButton}":".promptCancelButton"}},function(a){return{init:function(){},get:function(b){var c=a.dialog("."+b);
return a.instantiate(c)},instantiate:function(b){var c={element:b,show:function(){return b.addClass("active"),a.element.addClass("active"),c},hide:function(){return b.removeClass("active"),a.element.removeClass("active"),c},state:function(a){var d=b.data("lastPromptState");if(void 0===a)return d;var e=function(a){return b.find(".promptState.state-"+a)},f=e(a),d=e(d);if(!(f.length<1))return d.removeClass("active"),f.addClass("active"),b.data("lastPromptState",a),c}};return c},hideAll:function(){a.dialog().removeClass("active"),a.element.removeClass("active")
},"{cancelButton} click":function(){a.hideAll()}}}),EasyBlog.Controller("Media.Library",{defaultOptions:{places:[],place:{files:{},acl:{canCreateFolder:!1,canUploadItem:!1,canRenameItem:!1,canRemoveItem:!1,canCreateVariation:!1,canDeleteVariation:!1},populateImmediately:!1}}},function(b){return{init:function(){b.media.library=b,a.each(b.options.places,function(a,c){b.addPlace(c)})},places:{},getPlace:function(a){return a?a.acl?a:"string"==typeof a?b.places[a.split("|")[0]]:void 0:void 0},addPlace:function(c){var c=b.places[c.id]=a.extend({tasks:a.Threads({threadLimit:1}),ready:a.Deferred(),baseFolder:function(){return b.getMeta(c.id+"|"+b.media.options.directorySeparator)
}},b.options.place,c);c.done=c.ready.done,c.fail=c.ready.fail,c.always=c.ready.always;var d=function(b){if(!a.isEmptyObject(b)){if("string"==typeof b)try{b=a.parseJSON(b)}catch(c){}return"object"==typeof b?b:void 0}};return c.files=d(c.files),c.files&&c.tasks.add(function(){b.importMeta(c.files),c.ready.resolve(c)}),c.populate=function(){return void 0!==c.populate.task?c.populate.task:(c.populate.task=a.Deferred(),c.populate[/easysocial|jomsocial|flickr/.test(c.id)||c.files?"getFileTree":"getFolderTree"](),c.populate.task)
},c.populate.getFolderTree=function(){return b.getRemoteMeta({place:c.id,foldersOnly:1}).done(function(a){c.tasks.add(function(){b.importMeta(a),c.ready.resolve(c)}),c.populate.getFileTree()}).fail(function(){c.populate.task.reject(c),delete c.populate.task,c.ready.reject(c)})},c.populate.getFileTree=function(){return b.getRemoteMeta({place:c.id}).done(function(a){c.tasks.add(function(){b.importMeta(a),c.ready.resolve(c),c.populate.task.resolve(c)})}).fail(function(){c.populate.task.reject(c),delete c.populate.task
})},c.populateImmediately&&c.populate(),c},meta:{},metadata:{},isMeta:function(b){return!(void 0===b||!a.isPlainObject(b)||a.isEmptyObject(b))},get:function(c){if(b.meta.hasOwnProperty(c)){var d=a.extend({},b.meta[c]);return d.data=b.metadata[c],d}},getKey:function(a){return a?a.place+"|"+a.path:null},getParentKey:function(a){if(a){var c="string"==typeof a?a:a.key||b.getKey(a),d=c.indexOf(h),e=c.lastIndexOf(h);return e===c.length-1?void 0:c.substring(0,e+(d===e?1:0))}},getMeta:function(a){return a?b.isMeta(a)?b.get(b.getKey(a))||a:"string"==typeof a?b.get(a):void 0:void 0
},getRemoteMeta:function(c){var d=a.Deferred();d.retry=0;var e={path:b.media.options.directorySeparator,retry:3,retryAfter:1e3,variation:0,foldersOnly:0},c=a.extend(e,c);if(void 0===c.place)return d.rejectWith(d,"Error: Place not given!");var f=function(){return d.loader=EasyBlog.ajax("site.views.media.getMeta",c,{success:function(){d.resolveWith(d,arguments)},fail:function(){d.rejectWith(d,arguments)},error:function(){d.retry++,d.retry<c.retry?f():d.rejectWith(d,arguments)}}),arguments.callee}();return d},getMetaVariations:function(a){var a=b.getMeta(a);
if(void 0!==a)return b.getRemoteMeta({place:a.place,path:a.path,variation:1}).done(function(a){b.addMeta(a)})},removeMetaVariation:function(a,c){var a=b.getMeta(a);if(void 0!==a&&void 0!==a.variations){for(var d,e=0;e<a.variations.length;e++)if(a.variations[e].name===c){d=a.variations[e],a.variations.splice(e,1);break}return d}},addMeta:function(c){var d=b.getKey(c),e=b.getMeta(d);if(e&&c.hash===e.hash)return e;c.key=d,c.hash=a.uid(),c.group="folder"==c.type?"folders":"files",c.parentKey=b.getParentKey(c);var f=b.getPlace(c.place);
c.friendlyPath=c.path===h?f.title:f.title+c.path.substring(c.path.indexOf(h),c.path.length),b.meta[d]=c;var g=c.data=b.metadata[d]||(b.metadata[d]=a.eventable({}));if("folder"==c.type&&(g.files=g.files||{},g.folders=g.folders||{},g.views=g.views||b.createMetaView(c)),e)setTimeout(function(){c.data.fire("updated",c)},0);else{var i=b.getMeta(c.parentKey);i&&i.data.views.addMeta(c)}return c},removeMeta:function(a){var a=b.getMeta(a);if(void 0!==a){if("folder"===a.type){var c=a.data.folders,d=a.data.files;for(key in c)b.removeMeta(key);
for(key in d)b.removeMeta(key)}if(a.parentKey){var e=b.getMeta(a.parentKey);e&&e.data.views.removeMeta(a),delete b.meta[a.key],setTimeout(function(){a.data.fire("removed",a)},0)}return a}},removeRemoteMeta:function(c){var d=a.Deferred(),c=b.getMeta(c);return void 0===c?d.rejectWith(d,"The file does not exist in the media library."):(d.loader=EasyBlog.ajax("site.views.media.delete",{place:c.place,path:c.path},{success:function(){b.removeMeta(c),d.resolveWith(d,[c])},fail:function(){d.rejectWith(d,arguments)},error:function(a,b){d.rejectWith(d,[b])
}}),d)},createFolder:function(c,d){var e=a.Deferred(),c=b.getMeta(c),f=c.place;return void 0===c||"folder"!==c.type?e.rejectWith(e,"Parent folder was not found."):(e.loader=EasyBlog.ajax("site.views.media.createFolder",{place:f,path:c.path+h+d},{success:function(a){a.place=f;var a=b.addMeta(a);e.resolveWith(e,[a])},fail:function(){e.rejectWith(e,arguments)},error:function(a,b){e.rejectWith(e,[b])}}),e)},importMeta:function(a,c){if(void 0!==a&&"folder"===a.type){void 0===c&&(c=!0);var d=a.contents,e=d.length;
delete a.contents,d.reverse();for(var f=b.addMeta(a),g=f.data,h={files:{},folders:{}},i=0;e>i;){var a=b.addMeta(d[i]),j=a.key,k=a.group;h[k][j]=delete g[k][j],i++}for(j in g.files)b.removeMeta(j);for(j in g.folders)b.removeMeta(j);if(g.folders=h.folders,g.files=h.files,c)for(j in g.folders)b.importMeta(b.getMeta(j),c);return f}},createMetaView:function(c){var d={meta:c,addMeta:function(a){for(mode in d.modes){var b=d.modes[mode][a.group];b&&b.add(a)}},removeMeta:function(a){for(mode in d.modes){var b=d.modes[mode][a.group];
b&&b.remove(a)}},create:function(b){var c={from:0,to:1024,mode:"dateModified",group:"files"},e=a.Callbacks("unique memory");return a.extend(e,c,b,{uid:a.uid(),select:function(b){return a.extend(e,b),e.map&&delete e.map.monitors[e.uid],e.map=d.modes[e.mode][e.group],e.map.monitors[e.uid]=e,e.refresh()},updated:e.add,refresh:function(){return e.fire(e.map.slice(e.from,e.to))},destroy:function(){return e.disable(),e.map&&delete e.map.monitors[e.uid],e}}),e.select()}};return b.createViewModes(d),d},createViewModes:function(a){return a.modes={dateModified:{folders:b.createViewMap(a,!0),files:b.createViewMap(a)}},a
},createViewMap:function(b,c){var d=a.extend([],{task:a.Threads({threadLimit:1}),affectedIndex:[],add:function(a){d.task.add(function(){d.unshift(a.key),d.affectedIndex.push(0),c&&d.sort().reverse(),d.refreshMonitor()})},remove:function(a){d.task.add(function(){for(var e,b=a.key,c=d.length;c--;)if(d[c]===b){e=c;break}void 0!==e&&(d.splice(c,1),d.affectedIndex.push(c),d.refreshMonitor())})},monitors:{},refreshMonitor:function(){clearTimeout(d.refreshMonitor.timer),d.refreshMonitor.timer=setTimeout(function(){var a=d.affectedIndex;
d.affectedIndex=[],d.task.add(function(){var b=a.length,c=0;for(id in d.monitors){var c,e=d.monitors[id],f=e.from,g=e.to;for(c=0;b>c;c++){var h=a[c];if(h>=f||g>=h){e.refresh();break}}}})},250)}});return d},search:function(c){if(""===a.trim(c))return[];var c=c.toLowerCase(),d=b.createMetaView({type:"search"});for(key in b.meta){var e=key.split("|"),f=e[0],g=e[1],h=b.meta[key];/easysocial|jomsocial|flickr/.test(f)&&(g=h.title||""),g.toLowerCase().match(c)&&d.addMeta(h)}return d}}}),EasyBlog.Controller("Media.Exporter",{defaultOptions:{view:{recentItem:"media/recent.item"},"{recentActivities}":".recentActivities","{recentActivitiesDialog}":".recentActivities .modalPromptDialog","{hideRecentActivitiesButton}":".recentActivities .promptHideButton","{dashboardButton}":".recentActivities .dashboardButton","{recentItemGroup}":".recentItemGroup","{recentItem}":".recentItem"}},function(b){return{init:function(){d.exporter=b,d.insert=b.insert
},handler:{},showDialog:function(){b.recentActivitiesDialog().addClass("active"),b.recentActivities().css({top:0,opacity:1}).addClass("active")},hideDialog:function(){b.recentActivities().animate({top:"-=50px",opacity:0},{duration:250,complete:function(){b.recentActivities().removeClass("active"),b.recentActivitiesDialog().removeClass("active")}})},"{dashboardButton} click":function(){b.hideDialog()},"{hideRecentActivitiesButton} click":function(){b.hideDialog()},insert:function(c,e){var f=d.library.getMeta(c);
if(void 0!==f){var g=b.create(f.type,f.key,e);return b.showDialog(),g.recentItem=b.view.recentItem({meta:f}).addClass("loading").css({opacity:0}).prependTo(b.recentItemGroup()).animate({opacity:1},{duration:500,complete:function(){g.done(function(c){if(""===c&&g.recentItem.removeClass("loading done").addClass("error").find(".itemProgress").html(a.language("COM_EASYBLOG_MM_UNABLE_TO_EXPORT_ITEM")),"undefined"!=typeof tinyMCE)if(tinyMCE&&tinyMCE.isIE&&9==d.IE){var e=d.bookmark;if(e){var f=tinyMCE.editors.write_content;
f.selection.moveToBookmark({rng:e.range}),f.execCommand("mceInsertContent",!1,c)}else EasyBlog.dashboard.editor.insert(c)}else EasyBlog.dashboard.editor.insert(c);else EasyBlog.dashboard.editor.insert(c);g.recentItem.removeClass("loading failed").addClass("done").find(".itemProgress").html(a.language("COM_EASYBLOG_MM_ITEM_INSERTED")),d.options.recentActivities.hideAfter>0&&setTimeout(function(){b.hideDialog()},d.options.recentActivities.hideAfter)}).progress(function(a){g.recentItem.hasClass("done")||g.recentItem.find(".itemProgress").html(a)
}).fail(function(a){g.recentItem.removeClass("loading done").addClass("error").find(".itemProgress").html(a)})}}),g}},create:function(c,d,e){var f=b.handler[c],g=a.Deferred();if(void 0===f){var h=EasyBlog.Controller.Media.Exporter[a.String.capitalize(c)];if(void 0===h)return g.reject(a.language("COM_EASYBLOG_MM_UNABLE_TO_FIND_EXPORTER")),g;f=b.handler[c]=new h(b.element,a.extend({},{settings:b.options[c],controller:{media:b.media}}))}return f.create(g,d,e),g}}}),EasyBlog.Controller("Media.Exporter.File",{defaultOptions:{settings:{title:"",target:"_self",content:""}}},function(b){return{init:function(){},create:function(c,d,e){var f=a.extend({},b.options.settings,e),g=b.media.library.getMeta(d),h=a(document.createElement("A")).attr({title:f.title,target:f.target,href:g.url}).html(f.content?f.content:g.title);
return c.resolve(h.toHTML()),c}}}),EasyBlog.Controller("Media.Exporter.Folder",{defaultOptions:{settings:{}}},function(b){return{init:function(){},create:function(c,d,e){var f=a.extend({},b.options.settings,e),g=b.media.library.getMeta(d),h="jomsocial"==g.place||"easysocial"==g.place?"album":"gallery";f.file=g.path,f.place=g.place;var i="[embed="+h+"]"+JSON.stringify(f)+"[/embed]";return c.resolve(i),c}}}),EasyBlog.Controller("Media.Exporter.Image",{defaultOptions:{settings:{zoom:null,caption:null,lightbox:!1,enforceDimension:!1,enforceWidth:null,enforceHeight:null,variation:null,defaultVariation:"thumbnail",defaultZoom:"original"}}},function(b){return{init:function(){},create:function(d,e,f){var g=a.extend({},b.options.settings,f),h=b.media.library.getMeta(e),i=a(new Image),j=c(h.title);
i.attr({src:h.thumbnail.url,alt:j,title:j});var k=function(){d.resolve(i.toHTML())},l=function(){var b={};a.each(h.variations,function(a,c){b[c.name]=c});var d=b[g.variation]||b[g.defaultVariation]||h.variations[0],e=c(d.title);if(i.attr({src:d.url,alt:e,title:e}),g.enforceDimension&&null!==g.enforceWidth&&null!==g.enforceHeight){var f=a.Image.resizeWithin(d.width,d.height,g.enforceWidth,g.enforceHeight);f.width=Math.floor(f.width),f.height=Math.floor(f.height),i.attr(f)}if(null!==g.caption){var j=c(g.caption);
i.addClass("easyblog-image-caption").attr("title",j).attr("alt",j)}if(null!==g.zoom){var l=b[g.zoom]||b[g.defaultZoom]||{url:h.thumbnail.url,title:h.title},e=c(g.caption||l.title||"");i=a("<a>").addClass("easyblog-thumb-preview").attr({href:l.url,title:e}).html(i)}k()};return g.variation||g.zoom||g.enforceWidth||g.enforceHeight?void 0===h.variations?(d.notify(a.language("COM_EASYBLOG_MM_GETTING_IMAGE_SIZES")),b.media.library.getMetaVariations(e).done(function(a){h=a,l()}).fail(function(){d.reject(a.language("COM_EASYBLOG_MM_UNABLE_TO_RETRIEVE_VARIATIONS"))
})):l():k(),d}}}),EasyBlog.Controller("Media.Exporter.Audio",{defaultOptions:{width:400,height:24,autostart:!1,controlbar:"bottom",backcolor:"#333333",frontcolor:"#ffffff"}},function(b){return{init:function(){},create:function(c,d,e){var f=a.extend({},b.options.settings,e),g=b.media.library.getMeta(d);f.file=g.path,f.place=g.place;var h="[embed=audio]"+JSON.stringify(f)+"[/embed]";return c.resolve(h),c}}}),EasyBlog.Controller("Media.Exporter.Video",{defaultOptions:{settings:{width:400,height:225,autostart:!1,controlbar:"bottom",backcolor:"#333333",frontcolor:"#ffffff"}}},function(b){return{init:function(){},create:function(c,d,e){var f=a.extend({},b.options.settings,e),g=b.media.library.getMeta(d);
f.file=g.path,f.place=g.place;var h="[embed=video]"+JSON.stringify(f)+"[/embed]";return c.resolve(h),c}}}),EasyBlog.Controller("MediaLauncher",{defaultOptions:{"{uploadImageButton}":".uploadImageButton","{chooseImageButton}":".chooseImageButton"}},function(){return{init:function(){a("#media_manager_button").click(function(){EasyBlog.mediaManager.browse()})},"{uploadImageButton} click":function(){EasyBlog.mediaManager.upload()},"{chooseImageButton} click":function(){EasyBlog.mediaManager.browse()}}});var i=a(document.createElement("div")).attr("id","EasyBlogMediaManager").appendTo("body");
EasyBlog.mediaManager=new EasyBlog.Controller.Media(i)}),EasyBlog.module("media/navigation",function(a){var b=this;EasyBlog.require().done(function(){var c,d,e;EasyBlog.Controller("Media.Navigation",{defaultOptions:{view:{item:"media/navigation.item",itemGroup:"media/navigation.itemgroup"},nestLevel:8,groupCollapseDelay:1e3,canActivate:!0,"{itemGroup}":".navigationItemGroup","{item}":".navigationItem"}},function(b){return{init:function(){c=b.media,d=c.library,e=c.options.directorySeparator,b.element.toggleClass("canActivate",b.options.canActivate)
},setPathway:function(c){var c=d.getMeta(c);if(c){b.currentKey=c.key;var l,f=d.getPlace(c.place),g=c.path,h="folder"===c.type,i=g.split(e).splice(1),j=b.options.nestLevel,k=i.length-(i.length%j||j);b.element.empty().toggleClass("type-folder",h),b.view.item({title:f.title||e}).addClass("base").data("key",f.id+"|"+e).appendTo(b.element);var m="jomsocial"===f.id;g!==e&&a.each(i,function(a,g){var n=!h&&a==i.length-1,o=e+i.slice(0,a+1).join(e),p=f.id+"|"+o,g=m?d.getMeta(p).title:g,q=b.view.item({title:n?c.title:g}).data("key",p).toggleClass("filename",n);
a>=k?q.appendTo(b.element):(a%j==0&&(l=b.view.itemGroup().appendTo(b.element)),q.appendTo(l))})}},"{itemGroup} mouseover":function(a){clearTimeout(a.data("delayCollapse")),a.addClass("expand")},"{itemGroup} mouseout":function(a){a.data("delayCollapse",setTimeout(function(){a.removeClass("expand")},b.options.groupCollapseDelay))},"{item} click":function(a){if(b.options.canActivate){var c=a.data("key");b.trigger("activate",c)}}}}),b.resolve()})}),EasyBlog.module("media/uploader",function(a){var b=this;EasyBlog.require().library("plupload").done(function(){var c,d,e,f;
EasyBlog.Controller("Media.Uploader",{defaultOptions:{view:{uploader:"media/browser.uploader",uploadItem:"media/browser.uploader.item"},"{modalHeader}":".modalHeader","{modalToolbar}":".modalToolbar","{modalContent}":".modalContent","{modalFooter}":".modalFooter","{modalPrompt}":".modalPrompt","{modalBrowserButton}":".modalButton.browserButton","{modalDashboardButton}":".modalButton.dashboardButton","{uploadButton}":".uploadButton","{uploadNavigation}":".uploadNavigation","{uploadForm}":".uploadForm","{uploadPath}":".uploadPath","{uploadSize}":".uploadSize","{uploadExtensionList}":".uploadExtensionList","{uploadItemGroup}":".uploadItemGroup","{uploadItem}":".uploadItem","{uploadDropHint}":".uploadDropHint","{uploadInstructions}":".uploadInstructions","{clearListButton}":".clearListButton"}},function(b){return{init:function(){c=b.media,d=c.library,e=c.uploader=b,f=c.options.directorySeparator,b.element.addClass("uploader").html(b.view.uploader({uploadSize:b.options.settings.max_file_size,uploadExtensionList:b.options.settings.filters[0].extensions.split(",").join(", ")})),b.uploadNavigation().implement(EasyBlog.Controller.Media.Navigation,{controller:b.controllerProps()},function(){b.navigation=this
}),b.modalPrompt().implement(EasyBlog.Controller.Media.Prompt,{controller:b.controllerProps()},function(){b.promptDialog=this}),b.element.implement(EasyBlog.Controller.Media.Uploader.FolderSwitcher,{controller:b.controllerProps()},function(){b.folderSwitcher=this}),b.element.implement("plupload",{settings:b.options.settings,"{uploadButton}":b.options["{uploadButton}"],"{uploadDropsite}":b.options["{uploadItemGroup}"]},function(){if(b.plupload=this.plupload,"html4"==b.plupload.runtime||a.browser.msie){b.uploadDropHint().remove(),b.uploadItemGroup().addClass("indefinite-progress");
var d=b.uploadInstructions().appendTo(c.element);b.element.find("> form").mouseover(function(){var e=b.uploadButton(),f=e.offset();d.addClass("show").css({top:f.top+e.outerHeight()-c.element.offset().top+3,right:a(window).width()-(f.left+e.outerWidth())-1})}).mouseout(function(){d.removeClass("show")})}else b.uploadButton().mouseover(function(){b.uploadInstructions().addClass("show")}).mouseout(function(){b.uploadInstructions().removeClass("show")})}),b.setLayout()},setLayout:function(){if("uploader"===c.currentModal){var d;
b.modalContent().hide().height(d=b.element.height()-b.modalHeader().outerHeight()-b.modalToolbar().outerHeight()-b.modalFooter().outerHeight()).show(),a.browser.msie&&(b.uploadDropHint().height(d),b.uploadItemGroup().height(d)),b.plupload&&b.plupload.refresh()}},controllerProps:function(c){return a.extend({media:b.media,uploader:b},c||{})},setUploadFolder:function(a){a&&(b.navigation.setPathway(a),b.currentUploadFolder=a)},items:{},createItem:function(c){var d=new EasyBlog.Controller.Media.Uploader.Item(b.view.uploadItem(),{controller:b.controllerProps({id:c.id,originalFile:c,uploadFolder:b.currentUploadFolder})});
d.element.appendTo(b.uploadItemGroup());var e=d.file().filesize,e=e?"":" ("+e+").";return d.setMessage(a.language("COM_EASYBLOG_MM_UPLOADING_PENDING")+e),b.items[c.id]=d,d},"{self} BeforeUpload":function(c,e,f,g){var h=b.items[g.id];if(void 0!==h){h.setMessage(a.language("COM_EASYBLOG_MM_UPLOAD_PREPARING"));var i=b.options.settings.url,j=d.getMeta(h.uploadFolder),k=j?j.place:h.uploadFolder.split("|")[0],l=encodeURIComponent(j?j.path:h.uploadFolder.split("|")[1]);f.settings.url=i+"&place="+k+"&path="+l}},"{self} FilesAdded":function(c,d,e,f){try{a.each(f,function(a,c){void 0===b.items[c.id]&&b.createItem(c)
}),b.uploadItem().length>0&&b.uploadItemGroup().removeClass("empty"),b.plupload.start()}catch(g){console.error(g)}},"{self} UploadFile":function(c,d,e,f){var g=b.items[f.id];void 0!==g&&(g.setState("uploading"),g.setMessage(a.language("COM_EASYBLOG_MM_UPLOADING_STATE")))},"{self} UploadProgress":function(c,d,e,f){var g=b.items[f.id];void 0!==g&&(g.setProgress(f.percent),g.setMessage(a.language("COM_EASYBLOG_MM_UPLOADING")+(void 0!==f.percent?" "+f.percent+"%":"")+(void 0!==f.loaded&&void 0!==!f.size?f.size-f.loaded?" ("+a.plupload.formatSize(f.size-f.loaded)+" "+a.language("COM_EASYBLOG_MM_UPLOADING_LEFT")+")":"":"")))
},"{self} FileUploaded":function(d,e,f,g,h){var i=b.items[g.id];if(void 0!==i){if(i.response=h,!a.isPlainObject(h))return i.setState("failed"),i.setMessage(a.language("COM_EASYBLOG_MM_SERVER_RETURNED_INVALID_RESPONSE")),void 0;if(!a.isPlainObject(h.item))return i.setState("failed"),i.setMessage(h.message||a.language("COM_EASYBLOG_MM_UPLOAD_UNABLE_PARSE_RESPONSE")),void 0;i.setState("done"),i.setMessage(a.language("COM_EASYBLOG_MM_UPLOAD_COMPLETE")),i.meta=h.item,i.meta.place=c.library.get(i.uploadFolder).place,"image"!==i.meta.type&&i.insertBlogImageButton().remove(),c.library.addMeta(i.meta)
}},"{self} FileError":function(a,c,d,e,f){var g=b.items[e.id];void 0===g&&(g=b.createItem(e)),g.response=f,g.setState("failed"),g.setMessage(f.message),b.uploadItem().length>0&&b.uploadItemGroup().removeClass("empty")},"{self} Error":function(a,c,d,e){if(e.file){var f=e.file,g=b.items[f.id];void 0===g&&(g=b.createItem(f)),g.setState("failed"),g.setMessage(e.message)}b.uploadItem().length>0&&b.uploadItemGroup().removeClass("empty")},"{modalBrowserButton} click":function(){c.browse()},"{modalDashboardButton} click":function(){c.hide()
},"{uploadNavigation} activate":function(a,c,d){b.setUploadFolder(d)},"{self} modalActivate":function(a,d,e){b.setUploadFolder(e),c.browser&&b.uploadItemGroup().toggleClass("blogimage","blogimage"==c.browser.mode())},removeItem:function(a){var c=b.items[a];void 0!==c&&(b.plupload.removeFile(c.file()),c.element.remove(),delete b.items[a]),b.uploadItem().length<1&&b.uploadItemGroup().addClass("empty")},"{clearListButton} click":function(){for(id in b.items)b.removeItem(id)}}}),EasyBlog.Controller("Media.Uploader.Item",{defaultOptions:{"{filename}":".uploadFilename","{progressBar}":".uploadProgressBar progress","{percentage}":".uploadPercentage","{status}":".uploadStatus","{removeButton}":".uploadRemoveButton","{insertItemButton}":".insertItemButton","{locateItemButton}":".locateItemButton","{insertBlogImageButton}":".insertBlogImageButton"}},function(b){return{init:function(){var a=b.file();
b.filename().html(a.name),b.setState("queued")},file:function(){var c=e.plupload.getFile(b.id)||b.originalFile;return c&&(c.filesize=void 0===c.size||"N/A"==c.size?"":a.plupload.formatSize(b.file.size)),c},dblclick:function(a,d){d.shiftKey&&c.console("log",b)},setProgress:function(a){b.progressBar().attr("value",a),b.percentage().html(a)},setState:function(a){b.element.removeClass("upload-state-"+b.state).addClass("upload-state-"+a),b.state=a},setMessage:function(a){b.status().html(a)},"{removeButton} click":function(a,c){c.stopPropagation(),e.removeItem(b.id)
},"{insertItemButton} click":function(){c.insert(b.meta)},"{locateItemButton} click":function(){c.browse(b.meta)},"{insertBlogImageButton} click":function(){var a=d.meta[d.getMeta(b.meta).key];EasyBlog.dashboard.blogImage.setImage(a),c.hide()}}}),EasyBlog.Controller("Media.Uploader.FolderSwitcher",{defaultOptions:{view:{treeItemGroup:"media/browser.tree-item-group",treeItem:"media/browser.tree-item"},"{changeUploadFolderButton}":".changeUploadFolderButton","{selectFolderButton}":".selectFolderButton","{treeItemField}":".browserTreeItemField","{treeItemGroup}":".browserTreeItemGroup","{treeItem}":".browserTreeItem"}},function(b){return{init:function(){var d;
b.promptDialog=e.promptDialog.get("changeUploadFolderPrompt"),a.each(c.library.places,function(a,c){c.acl.canUploadItem&&(c.uploaderTreeItemGroup=b.view.treeItemGroup().addClass("expanded").appendTo(b.treeItemField()),c.uploaderTreeItem=b.view.treeItem({title:c.title}).addClass("loading").addClass("type-place").data("place",c).appendTo(c.uploaderTreeItemGroup),d||(d=c.id+"|"+f,e.setUploadFolder(d)),c.done(function(){b.createTreeItem(c.baseFolder()),c.uploaderTreeItem.removeClass("loading")}))})},treeItems:{},createTreeItem:function(c){var c=d.getMeta(c),e=b.treeItems[c.key]||function(){var e=d.getPlace(c.place),f=d.getMeta(c.parentKey),g=b.treeItems[c.key]=(f?b.view.treeItem({title:c.title}).addClass("type-folder").insertAfter(b.treeItems[f.key]):e.uploaderTreeItem).data("key",c.key);
return c.data.on("removed",function(){b.removeTreeItem(c)}),c.data.views.create({group:"folders"}).updated(function(c){a.each(c,function(a,c){b.createTreeItem(c)})}),g}();return e},removeTreeItem:function(a){var a=d.getMeta(a),c=b.treeItems[a.key];if(c){c.remove();{b.treeItems[a.parentKey]}e.setUploadFolder(a.parentKey)}},"{treeItem} click":function(a){b.treeItem().removeClass("active"),a.addClass("active")},"{changeUploadFolderButton} click":function(){var a=b.currentUploadFolder,c=b.treeItems[a]||b.treeItem(":first");
c.click(),b.promptDialog.show()},"{selectFolderButton} click":function(){var a=b.treeItem(".active").data("key");e.setUploadFolder(a),b.promptDialog.hide()}}}),b.resolve()})}),EasyBlog.module("media/browser",function(a){var b=this;EasyBlog.require().library("image","easing","scrollTo").script("media/browser.item").done(function(){var c,d,e,g,h;EasyBlog.Controller("Media.Browser",{defaultOptions:{view:{browser:"media/browser",itemGroup:"media/browser.item-group",item:"media/browser.item",treeItemGroup:"media/browser.tree-item-group",treeItem:"media/browser.tree-item",paginationPage:"media/browser.pagination-page"},path:"",items:void 0,mode:"browse",layout:{viewMode:"tile",tileSize:.125,scrollToItemDuration:500,scrollToItemEasing:"swing",iconMaxLoadThread:8},search:{chunkSize:128,chunkDelay:500},"{modalHeader}":".modalHeader","{modalToolbar}":".modalToolbar","{modalContent}":".modalContent","{modalFooter}":".modalFooter","{modalPrompt}":".modalPrompt","{modalUploaderButton}":".uploaderButton","{header}":".browserHeader","{content}":".browserContent","{footer}":".browserFooter","{treeToggleButton}":".browserTreeToggleButton","{tileViewButton}":".browserTileViewButton","{listViewButton}":".browserListViewButton","{itemField}":".browserItemField","{itemGroup}":".browserItemGroup","{item}":".browserItem","{treeItemField}":".browserTreeItemField","{treeItemGroup}":".browserTreeItemGroup","{treeItem}":".browserTreeItem","{headerTitle}":".browserTitle","{headerSearch}":".browserSearch","{headerNavigation}":".browserNavigation","{headerUpload}":".browserUploadButton","{footerStatus}":".browserStatus","{footerMessage}":".browserMessage","{itemActionSet}":".browserItemActionSet","{itemFieldHints}":".browserItemField .hints","{browserPagination}":".browserPagination","{currentPage}":".currentPage","{totalPage}":".totalPage","{prevPageButton}":".prevPageButton","{nextPageButton}":".nextPageButton","{pageSelection}":".pageSelection","{paginationPage}":".paginationPage","{searchInput}":".searchInput"}},function(b){return{init:function(){c=b.media,d=c.library,e=c.browser=b,h=c.options.directorySeparator,b.iconThread=a.Threads({threadLimit:b.options.layout.iconMaxLoadThread}),b.enqueue=a.Enqueue();
var f=d.getPlace("flickr");b.element.addClass("browser").html(b.view.browser({canUpload:b.options.acl.canUpload,flickrCallback:f?f.options.callback:"",flickrLogin:f?f.options.login:""})),b.headerNavigation().implement(EasyBlog.Controller.Media.Navigation,{controller:b.controllerProps()},function(){b.navigation=this}),b.modalPrompt().implement(EasyBlog.Controller.Media.Prompt,{controller:b.controllerProps()},function(){g=b.promptDialog=this}),b.element.implement(EasyBlog.Controller.Media.Browser.Actions,{controller:b.controllerProps()},function(){b.actions=this
}),b.search=a.debounce(b._search,500),b.mode("browse"),c.element.bind("hideModal",function(){b.mode("browse")}),b.viewMode(b.options.layout.viewMode),b.setLayout(),b.on("scroll",b.itemField(),a.debounce(b["{itemField} scroll"],250)),a.each(d.places,function(a,c){b.createPlace(c)}),b.activatePlace(b.options.initialPlace||d.places[0].id).done(b.enqueue(function(a){b.activateItem(a.baseFolder())}))},controllerProps:function(b){return a.extend({media:c},b||{})},items:{},createPlace:function(a){var a=d.getPlace(a);
return a.treeItemGroup=b.view.treeItemGroup().appendTo(b.treeItemField()),a.treeItem=b.view.treeItem({title:a.title}).addClass("type-place").data("place",a).appendTo(a.treeItemGroup),a.itemGroup=b.view.itemGroup().appendTo(b.itemField()),a},activatePlace:function(c){var c=d.getPlace(c);if(void 0!==c){if(b.itemGroup().removeClass("active"),c.itemGroup.addClass("active"),b.treeItem().removeClass("active"),c.treeItem.addClass("active"),c.activator||(c.activator=a.Deferred()),"flickr"===c.id&&!c.options.associated)return e.currentFolderStatus("flickr"),c.activator;
if(!c.populated){c.populated=!0,b.currentFolderStatus("loading");var f=/easysocial|jomsocial|flickr/.test(c.id)?c.populate():c.ready;f.done(function(){var a=b.createFolder(c.baseFolder());c.activator.resolveWith(c,[c,a])}).fail(function(){b.currentFolderStatus("error"),c.activator.rejectWith(c,arguments)})}return c.activator}},getItem:function(a){return void 0!==a?a instanceof EasyBlog.Controller.Media.Browser.Item?a:"string"==typeof a?b.items[a]:d.isMeta(a)?b.items[d.getKey(a)]:void 0:void 0},createItem:function(a){var a=d.getMeta(a);
if(a)return b.items[a.key]=new EasyBlog.Controller.Media.Browser.Item(b.view.item({meta:a}),{controller:{key:a.key,media:c}})},createFolder:function(c){var c=d.getMeta(c);return b.getItem(c)||function(){var d=b.createItem(c),e=d.place(),f=d.parentFolder();return f?d.element.insertAfter(f.element):d.element.appendTo(e.itemGroup),d.treeItem=(f?b.view.treeItem({title:c.title}).addClass("type-folder").css("marginLeft",18*(c.path.split(h).length-1)).insertAfter(f.treeItem):e.treeItem).data("item",d),c.data.views.create({group:"folders"}).updated(function(c){a.each(c,function(a,c){b.createFolder(c)
})}),d}()},createFile:function(a){var a=d.getMeta(a);return b.getItem(a)||b.createItem(a)},removeItem:function(a){clearTimeout(b.removeItem.revert);var a=b.getItem(a),c=a.parentFolder();a.remove(),a.treeItem&&a.treeItem.remove(),delete b.items[a.key],b.itemField().hasClass("searching")||(b.removeItem.revert=setTimeout(function(){c&&b.activateItem(c)},500))},focusItem:function(a,c){var a=b.getItem(a);a&&(c?b.activateItem(a):(b.currentItem(a),a.element.removeClass("active")),b.scrollTo(a),b.trigger("itemFocus",[a]))
},locateItem:function(a){b.itemField().hasClass("searching")&&b.clearSearch(!0);var a=d.getMeta(a);a&&b.activatePlace(a.place).done(b.enqueue(function(){var c="folder"===a.type,d=b.activateItem(c?a:a.parentKey);if(void 0!==d){c||d.handler.locateItem(a);var e=d.handler.folderView;e&&e.refresh()}}))},activateItem:function(a){var a=b.getItem(a);if(a)return b.currentItem(a),a.activate(),b.trigger("itemActivate",[a]),a},scrollTo:function(a){var a=b.getItem(a);a&&b.itemField().scrollTo(a.element,{duration:b.options.layout.scrollToItemDuration,easing:b.options.layout.scrollToItemEasing,offset:{top:b.itemField().height()*-.1}})
},currentItem:function(a){var c=b.currentItem.item;!c||!c._destroyed&&b.items[c.key]||(c=b.currentItem.item=void 0);var a=b.getItem(a);if(!a)return c;if(a._destroyed)return c;c&&(c.element.removeClass("active focus"),"folder"!==c.meta().type&&c.parentFolder().element.removeClass("active focus"),c.place().itemGroup.removeClass("active")),a.element.addClass("active focus");var d="folder"==a.meta().type;return d||a.parentFolder().element.addClass("focus"),a.place().itemGroup.addClass("active"),b.currentFolder(d?a:a.parentFolder()),b.navigation.setPathway(a.key),b.currentItem.item=a
},currentFolder:function(a){var c=b.currentFolder.folder;c&&c._destroyed&&(c=b.currentFolder.folder=void 0);var a=b.getItem(a);return a?(b.treeItem().removeClass("active"),a.treeItem.addClass("active"),a.meta().path!==h&&a.place().treeItemGroup.addClass("expanded"),a.handler.folderView&&a.handler.refreshSeed!==b.folderRefreshSeed&&(a.handler.folderView.refresh(),a.handler.refreshSeed=b.folderRefreshSeed),b.currentFolder.folder=a):c},currentFolderStatus:function(a){if(!b.itemField().hasClass("searching")||/emptySearch|ready/.test(a)){var c=b.currentFolderStatus.lastStatus;
if(void 0===a)return c;if("string"==typeof a)return c&&b.itemField().removeClass(c),b.itemField().addClass(a),b.currentFolderStatus.lastStatus=a}},setLayout:function(){if(c.layout&&"browser"===c.currentModal){var d;b.modalContent().hide().height(d=b.element.height()-b.modalHeader().outerHeight()-b.modalToolbar().outerHeight()-b.modalFooter().outerHeight()).show(),a.browser.msie&&(b.treeItemField().height(d),b.itemField().height(d),b.itemFieldHints().height(d)),b.setItemLayout(),b.trigger("setLayout")}},setItemStyle:function(d){if(!d){var e=c.layout;
if(b.setItemStyle.seed===e)return;b.setItemStyle.seed=e}var f=b.viewMode(),g={};if("tile"==f){var h="#EasyBlogMediaManager .browser .browserItemField.view-tile .browserItem",i=function(){var c=a(document.createElement("DIV")).prependTo(b.itemField()),d=c.width();return c.remove(),d}(),j=Math.floor(i*b.options.layout.tileSize),k=j-24;g[h]={width:j+"px",height:k+"px"}}var l=document.getElementsByTagName("head")[0];if(b.itemStyle)try{l.removeChild(b.itemStyle)}catch(m){}b.itemStyle=document.createElement("style"),b.itemStyle.type="text/css";
var n="";a.each(g,function(b,c){n+=b+"{"+a.map(c,function(a,b){return b+":"+a}).join(";")+"}\n"}),b.itemStyle.styleSheet?b.itemStyle.styleSheet.cssText=n:b.itemStyle.appendChild(document.createTextNode(n)),l.appendChild(b.itemStyle)},setItemLayout:function(){c.layout&&"browser"===c.currentModal&&(b.setItemStyle(),setTimeout(function(){var a=[];if(b.itemField().hasClass("searching"))b.searchItemGroup&&(a=b.searchItemGroup.find(".browserItem"));else{var c=b.currentFolder();if(void 0===c)return;a=c.childItem()}if(!(a.length<1)){var e,f,d=b.itemField().offset(),g=a.length,h=1;
if(!(a.length<1)){for(;Math.abs(g-h)>1;){e=a.eq(h-1),f=e.offset();var i=f.top-d.top+e.outerHeight();0>i?h=Math.ceil((g+h)/2):(g=h,h=Math.ceil(g/2))}1===h&&(h=0);var j=h,k=h,l=0,m=a.length-1;for(setLayout=function(b){if(l>b||b>m)return!1;var c=a.eq(b).data("item");return c.isVisible()?(c.setLayout(),void 0):!1};;){if(setLayout(j)===!1)break;j--}for(;;){if(setLayout(k)===!1)break;k++}}}},0))},viewMode:function(a){var c=b.viewMode.mode;if(c||(c=b.viewMode.mode=b.options.layout.viewMode),void 0!==a){b.setItemStyle.seed=null,b.itemField().removeClass("view-"+c).addClass("view-"+a),b.viewMode.mode=c=a,b.setLayout();
var d=b.currentItem();void 0!==d&&b.scrollTo(d)}return c},mode:function(c){if(void 0===c)return b.mode.currentMode||"browse";switch(c){case"browse":b.element.removeClass("mode-blogimage").addClass("mode-browse"),a.each(d.places,function(a,b){/easysocial|jomsocial|flickr/.test(b.id)&&(b.treeItemGroup&&b.treeItemGroup.show(),b.itemGroup&&b.itemGroup.show())});break;case"blogimage":b.element.addClass("mode-blogimage").removeClass("mode-browse");var e=b.currentItem(),f=!1;e&&/easysocial|jomsocial|flickr/.test(e.place().id)&&(f=!0),a.each(d.places,function(a,b){/easysocial|jomsocial|flickr/.test(b.id)?(b.treeItemGroup&&b.treeItemGroup.hide(),b.itemGroup&&b.itemGroup.hide()):f&&(f=!1,b.treeItem&&b.treeItem.click())
})}b.mode.currentMode=c},"{self} itemActivate":function(a,c,d){b.itemActionSet().removeClass("active"),"folder"==d.meta().type?b.itemActionSet(".type-folder").addClass("active"):b.itemActionSet(".type-item").addClass("active")},"{headerNavigation} activate":function(a,c,d){b.activateItem(d)},"{tileViewButton} click":function(a){a.addClass("active").siblings().removeClass("active"),b.viewMode("tile")},"{listViewButton} click":function(a){a.addClass("active").siblings().removeClass("active"),b.viewMode("list")
},"{treeItem} click":a.debounce(function(c,d){b.clearSearch(!0);var e=c.data("item");if(c.hasClass("type-place")){var f=c.data("place");return a(d.target).hasClass("treeItemToggle")&&f.treeItemGroup.toggleClass("expanded"),b.activatePlace(f).done(b.enqueue(function(a,c){"jomsocial"===a.id&&a.treeItemGroup.addClass("expanded"),"easysocial"===a.id&&a.treeItemGroup.addClass("expanded"),b.activateItem(c)})),void 0}b.activateItem(e)},50),"{itemField} scroll":function(){b.setItemLayout()},"{item} click":function(a,c){c.stopPropagation();
var d=a.data("item");if(void 0!==d){var e=d.place();b.activatePlace(e).done(b.enqueue(function(){b.activateItem(d)}))}},"{item} dblclick":function(a,e){e.stopPropagation();var f=a.data("item");if(e.shiftKey)return c.console("log",[f]),void 0;if(void 0!==f&&"folder"!=f.meta().type)if("blogimage"===b.mode.currentMode){if("image"==f.meta().type){var g=d.meta[f.key];EasyBlog.dashboard.blogImage.setImage(g),c.hide()}}else c.edit(f.key)},"{modalUploaderButton} click":function(){var a=b.currentFolder();c.upload(a.place().acl.canUploadItem?a.key:"")
},"{self} modalActivate":function(a,c,e,f){void 0!==f&&b.mode(f);var e=d.getMeta(e)||b.currentItem().meta();e&&b.locateItem(e)},"{prevPageButton} click":function(){var a=e.currentFolder();a.handler.changePage("prev")},"{nextPageButton} click":function(){var a=e.currentFolder();a.handler.changePage("next")},"{pageSelection} click":function(a){b.paginationPage().length>1&&a.toggleClass("expanded")},"{paginationPage} click":function(a){if(b.pageSelection().hasClass("expanded")&&!a.hasClass("selected")){var c=a.data("page"),d=e.currentFolder();
d.handler.isChangingPage=!0,d.handler.currentPage(c)}},"{window} click":function(c,d){var e=a(d.target).attr("class");/pageSelection|paginationPage/.test(e)||b.pageSelection().hasClass("expanded")&&b.pageSelection().removeClass("expanded")},_search:function(a){b.itemBeforeSearch||(b.itemBeforeSearch=b.currentItem().meta()),b.element.addClass("searching"),b.itemField().addClass("searching"),b.searchItemGroup||(b.searchItemGroup=b.view.itemGroup().appendTo(b.itemField())),b.searchItemGroup.addClass("active search-mode");
var c;b.searchView=d.search(a).create({from:0,to:300}).updated(function(a){var d=a.length;if(1>d)return c=setTimeout(function(){e.currentFolderStatus("emptySearch")},500),void 0;for(clearTimeout(c),e.currentFolderStatus("ready"),i=0;d>i;i++){var f=a[i],g=e.createFile(f);g.element.appendTo(b.searchItemGroup)}b.setItemLayout()})},clearSearch:function(c){b.folderRefreshSeed=a.uid(),c&&b.searchInput().val("").blur(),b.element.removeClass("searching"),b.itemField().removeClass("searching"),b.searchItems&&a.each(b.searchItems,function(b,c){a(c).detach()
}),b.searchItemGroup&&(b.searchItemGroup.find(".browserItem").detach(),b.searchItemGroup.removeClass("active")),b.searchView&&b.searchView.destroy(),delete b.searchView,b.itemBeforeSearch&&b.locateItem(b.itemBeforeSearch)},"{searchInput} focusin":function(b){b.parent().addClass("active"),""!==a.trim(b.val())&&b.parent().addClass("showCancelButton")},"{searchInput} focusout":function(b){setTimeout(function(){""===a.trim(b.val())&&b.parent().removeClass("active showCancelButton")},50)},"{searchInput} keyup":function(c){var d=a.trim(c.val());
return""===d?(c.parent().removeClass("showCancelButton"),b.clearSearch(),delete b.itemBeforeSearch,void 0):(c.parent().addClass("showCancelButton"),b.search(d),void 0)}}}),EasyBlog.Controller("Media.Browser.Actions",{defaultOptions:{"{customizeItemButton}":".customizeItemButton","{insertAsGalleryButton}":".insertAsGalleryButton","{insertItemButton}":".insertItemButton","{insertBlogImageButton}":".insertBlogImageButton","{createFolderButton}":".createFolderButton","{confirmCreateFolderButton}":".createFolderPrompt .confirmCreateFolderButton","{folderPath}":".createFolderPrompt .folderPath","{folderCreationPath}":".createFolderPrompt .folderCreationPath","{folderInput}":".createFolderPrompt .folderInput","{folderCreationFailedReason}":".createFolderPrompt .folderCreationFailedReason","{removeItemButton}":".removeItemButton","{removeItemFilename}":".removeItemPrompt .removeItemFilename","{confirmRemoveItemButton}":".confirmRemoveItemButton","{removeItemFailedReason}":".removeItemPrompt .removeItemFailedReason","{flickrLoginButton}":".flickrLoginButton","{cancelSearchButton}":".cancelSearchButton","{retryPopulateButton}":".retryPopulateButton"}},function(b){return{init:function(){},"{self} itemActivate":function(a,c,d){b.item=d;
var f=d.place().acl;b.removeItemButton().toggle(f.canRemoveItem),b.createFolderButton().toggle(f.canCreateFolder),b.insertBlogImageButton().toggle("blogimage"===e.mode()&&"image"===d.meta().type)},"{customizeItemButton} click":function(){c.edit(b.item.key)},"{insertAsGalleryButton} click":function(){c.insert(b.item.key)},"{insertItemButton} click":function(){c.insert(b.item.key)},"{insertBlogImageButton} click":function(){var a=d.meta[b.item.key];EasyBlog.dashboard.blogImage.setImage(a),c.hide()},"{createFolderButton} click":function(){g.get("createFolderPrompt").show().state("default");
var a=e.currentFolder();b.folderPath().html(a.meta().friendlyPath),b.folderInput().focus()[0].select()},"{folderInput} keyup":function(a,c){13==c.keyCode&&b.confirmCreateFolderButton().click()},"{confirmCreateFolderButton} click":function(){var c=a.trim(b.folderInput().val());if(""!==c){var f=e.currentFolder().meta(),i=f.friendlyPath+h+c;b.folderCreationPath().html(i);var j=g.get("createFolderPrompt");j.state("progress"),d.createFolder(f,c).done(function(a){var b=e.createFolder(a);j.hide(),e.activateItem(b)}).fail(function(a){b.folderCreationFailedReason().html(a),j.state("fail")
})}},"{removeItemButton} click":function(){b.removeItemFilename().html(b.item.meta().title),g.get("removeItemPrompt").show().state("default")},"{confirmRemoveItemButton} click":function(){var c=g.get("removeItemPrompt");c.state("progress"),d.removeRemoteMeta(b.item.key).done(function(){c.hide()}).fail(function(a){b.removeItemFailedReason().html(a),c.state("fail")})},"{flickrLoginButton} click":function(a){var b=a.data("login"),c=a.data("callback"),f=e.enqueue(function(){e.activatePlace("flickr").done(e.enqueue(function(a,b){e.activateItem(b)
}))});window[c]=function(){var a=d.getPlace("flickr");a.options.associated=!0,f()},window.open(b,"Flickr Login","scrollbars=no, resizable=no, width=650, height=700")},"{cancelSearchButton} click":function(){e.clearSearch(!0)},"{retryPopulateButton} click":function(){var a=b.item.place();delete a.activator,a.populated=!1,a.treeItem.click()}}}),b.resolve()})}),EasyBlog.module("media/browser.item",function(a){var b=this;EasyBlog.Controller("Media.Browser.Item",{defaultOptions:{"{itemTitle}":".itemTitle","{itemIcon}":".itemIcon","{childItem}":".browserItem",hasCustomHandler:["folder"]}},function(b){var c,d,e;
return{init:function(){c=b.media,d=c.library,e=c.browser,b.element.data("item",b).addClass("item-type-"+b.meta().type),b.meta().data.on("removed",function(){e.removeItem(b)}),b.createHandler()},meta:function(){return d.getMeta(b.key)},place:function(){return d.getPlace(b.key)},parentFolder:function(){return e.getItem(d.getParentKey(b.key))},createHandler:function(){if(!(a.inArray(b.meta().type,b.options.hasCustomHandler)<0)){var c=EasyBlog.Controller.Media.Browser.Item[a.String.capitalize(b.meta().type)];return void 0===c?(EasyBlog.require().script("media/browser.item."+b.meta().type).done(function(){b.createHandler()
}),void 0):(b.handler=new c(b.element,{controller:{media:b.media,item:b}}),void 0)}},activate:function(){b.setLayout(),b.handler&&b.handler.activate()},remove:function(){try{b.element&&b.element.detach().remove(),b.handler&&(b.handler._destroyed||b.handler.destroy())}catch(a){}},isVisible:function(){var a=b.element,c=a.outerHeight(),d=a.offset().top,e=d+c,f=b.media.browser.itemField(),g=f.offset().top,h=g+f.height();return isVisible=!(g>d&&g>e||d>h&&e>h),b.media.options.debug.itemVisiblity&&b.media.console("info",["Item visibility",{title:b.meta().title,isVisible:isVisible,item:b,itemHeight:c,itemTop:d,itemBottom:e,itemFieldTop:g,itemFieldBottom:h}]),isVisible
},setLayout:function(){return"folder"!=b.meta().type?b.handler&&a.isFunction(b.handler.setLayout)?b.handler.setLayout():(b.setIcon(),void 0):void 0},setIcon:function(){b.setIcon.loading||b.setIcon.loaded||void 0===b.meta().icon||b._destroyed||(b.setIcon.loading=!0,e.iconThread.addDeferred(function(a){var c=b.itemIcon();if(b.isVisible()){var d=b.meta(),e=b.place(),f=d.icon.url;b.setIcon.useNaturalUrl||/easysocial|jomsocial|flickr/.test(e.id)||"image"!==d.type||(f=EasyBlog.baseUrl+"&view=media&layout=getIconImage&place="+encodeURIComponent(e.id)+"&path="+encodeURIComponent(b.meta().path)+"&format=image&tmpl=component"),b.element.addClass("loading-icon"),c.image("get",f).done(function(){b.element.removeClass("loading-icon"),b.setIcon.loaded=!0,b.setIcon.loading=!1,a.resolve()
}).fail(function(){b.element.removeClass("loading-icon"),b.setIcon.loaded=!1,b.setIcon.loading=!1,a.reject(),b.setIcon.triedNaturalUrl||(b.setIcon.useNaturalUrl=!0,b.setIcon.triedNaturalUrl=!0)})}else b.setIcon.loading=!1,a.reject()}))}}}),EasyBlog.Controller("Media.Browser.Item.Folder",{defaultOptions:{"{childItem}":".browserItem"}},function(b){var c,d,e;return{init:function(){c=b.media,d=c.library,e=c.browser,b.element.empty()},items:{},setLayout:function(){var d,a=b.item.place();switch(a.ready.state()){case"pending":d="loading";
break;case"rejected":d="error";break;case"resolved":if(b.folderView&&b.folderView.map.length>0)d="ready",e.browserPagination().show();else switch(a.populate.task.state()){case"pending":d="loading";break;case"rejected":d="error";break;case"resolved":b.folderView&&b.folderView.map.length<1?(d=a.acl.canUploadItem?"empty canUpload":"empty","jomsocial"===b.item.meta().place&&b.item.meta().path===c.options.directorySeparator&&(d="selectAlbum"),"easysocial"===b.item.meta().place&&b.item.meta().path===c.options.directorySeparator&&(d="selectAlbum")):d="ready",e.browserPagination().toggle(!/empty|selectAlbum/.test(d))
}}e.currentFolderStatus(d),e.setItemLayout(),b.isChangingPage?b.isChangingPage=!1:b.populatePages()},populate:function(a){if(!e.itemField().hasClass("searching")){var c,d=a.length,f=b.items;if(b.items={},1>d)try{b.childItem().detach()}catch(g){}else{for(c=0;d>c;c++){var h=a[c],i=e.createFile(h);i.element.appendTo(b.element),b.items[h]=i,delete f[h]}for(h in f)try{f[h].element.detach()}catch(g){}}b.item.place().itemGroup.hasClass("active")&&b.element.hasClass("focus")&&b.setLayout()}},activate:function(){b.folderView||(b.folderView=b.item.meta().data.views.create({from:0,to:e.options.layout.maxIconPerPage}),b.folderView.updated(b.populate)),b.setLayout()
},populatePages:function(){var a=b.totalPage();if(2>a)e.browserPagination().hide();else{e.browserPagination().show(),e.pageSelection().html("");for(var c=1;a>=c;c++)e.view.paginationPage({page:c}).appendTo(e.pageSelection());b.folderView.currentPage=b.folderView.currentPage||1,e.paginationPage().removeClass("selected"),e.paginationPage(".page"+b.folderView.currentPage).addClass("selected")}},totalPage:function(){var a=b.folderView.map.length,c=a%e.options.layout.maxIconPerPage,d=Math.floor(c>0?a/e.options.layout.maxIconPerPage+1:a/e.options.layout.maxIconPerPage);
return e.totalPage().text()!=d&&e.totalPage().text(d),d},currentPage:function(c,d){var f=parseInt(b.folderView.currentPage);if(isNaN(f)&&(f=1,b.folderView.currentPage=1,e.paginationPage().removeClass("selected"),e.paginationPage(":first").addClass("selected")),void 0===c&&(c={from:b.folderView.from}),a.isPlainObject(c)&&void 0!==c.from)var h=(b.folderView.map.length,Math.floor(c.from/e.options.layout.maxIconPerPage)+1);if(c=h||c,c!=f){var i=(c-1)*e.options.layout.maxIconPerPage,j=i+e.options.layout.maxIconPerPage;
i!=c.from&&b.folderView.select({from:i,to:j}),b.folderView.currentPage=c,e.paginationPage().removeClass("selected"),e.paginationPage(".page"+c).addClass("selected"),e.trigger("pageChanged",[f,c])}return d&&d(),c},next:function(){b.changePage("next")},prev:function(){b.changePage("prev")},changePage:function(a){b.isChangingPage=!0;var c=b.totalPage(),d=b.currentPage();"next"==a&&c>d&&(d+=1),"prev"==a&&d>1&&(d-=1),b.currentPage(d)},locateItem:function(a){var a=d.getMeta(a),c=b.getItemPage(a);c&&b.currentPage(c,function(){e.focusItem(a.key,!0)
})},getItemPage:function(c){{var h,c=d.getMeta(c),f=c.key;b.folderView.map.length}return a.each(b.folderView.map,function(a,b){return b==f?(h=a,!1):void 0}),void 0!==h?Math.floor(h/e.options.layout.maxIconPerPage)+1:!1}}}),b.resolve()}),EasyBlog.module("media/editor",function(a){var b=this;EasyBlog.require().done(function(){EasyBlog.Controller("Media.Editor",{defaultOptions:{view:{editor:"media/editor",viewport:"media/editor.viewport"},"{modalHeader}":".modalHeader","{modalToolbar}":".modalToolbar","{modalContent}":".modalContent","{navigationPathway}":".navigationPathway","{insertItemButton}":".insertItemButton","{cancelEditingButton}":".cancelEditingButton"}},function(b){return{init:function(){b.element.addClass("editor").html(b.view.editor()),b.navigationPathway().implement(EasyBlog.Controller.Media.Navigation,{controller:{media:b.media},canActivate:!1},function(){b.navigation=this
}),b.setLayout()},setLayout:function(){if("editor"===b.media.currentModal){b.modalContent().hide().height(b.element.height()-b.modalHeader().outerHeight()-b.modalToolbar().outerHeight()).show();var a=b.getEditor(b.currentEditor);a&&a.setLayout&&a.setLayout()}},editors:[],handlers:[],loadHandler:function(c){var d=b.handlers[c];return void 0!==d?d:(d=a.Deferred(),d.require=EasyBlog.require().script("media/editor."+c).done(function(){var e=EasyBlog.Controller.Media.Editor[a.String.capitalize(c)];void 0!==e?d.resolve(e):(delete b.handlers[c],d.reject())
}).fail(function(){d.reject()}),d)},createEditor:function(a,c){b.removeEditor(a);var d=b.media.library.getMeta(a);void 0!==d&&b.loadHandler(d.type).done(function(e){var f=new e(b.view.viewport().addClass("editor-type-"+d.type).prependTo(b.modalContent()),{controller:{media:b.media,editor:b,key:b.media.library.getKey(d)}});b.editors[a]=f,c&&c(f)})},removeEditor:function(a){var c=b.editors[a];void 0!==c&&(c.destroy(),delete b.editors[a])},getEditor:function(a){return b.editors[a]},activateEditor:function(a){b.deactivateEditor(b.currentEditor),b.navigation.setPathway(a);
var c=b.getEditor(a),d=function(c){b.currentEditor=a,c.element.addClass("active"),c.activate&&c.activate()};void 0===c?b.createEditor(a,d):d(c)},deactivateEditor:function(){var a=b.getEditor(b.currentEditor);void 0!==a&&(a.deactivate&&a.deactivate(),a.element.removeClass("active"))},"{self} modalActivate":function(a,c,d){b.activateEditor(d)},"{self} modalDeactivate":function(){b.deactivateEditor()},"{insertItemButton} click":function(){var a=b.getEditor(b.currentEditor);void 0!==a&&a.trigger("insertItem")},"{cancelEditingButton} click":function(){var a=b.getEditor(b.currentEditor);
a&&a.trigger("cancelItem"),b.media.browse()}}}),EasyBlog.Controller("Media.Editor.Panel",{defaultOptions:{"{sectionHeader}":".panelSectionHeader","{sectionContent}":".panelSectionContent"}},function(){return{init:function(){},"{sectionHeader} click":function(a){var b=a.parent();b.toggleClass("active")}}}),EasyBlog.Controller("Media.Editor.Preview",{defaultOptions:{"{container}":".previewContainer","{dialogGroup}":".previewDialogGroup"}},function(a){return{init:function(){},resetLayout:function(){clearTimeout(a.resetLayoutTimer),a.resetLayoutTimer=setTimeout(function(){var b=a.container(),c=a.element.width(),d=a.element.height(),e=b.width(),f=b.height(),g=0,h=0,i="none";
c>e?h=(c-e)/2:i="auto",d>f?g=(d-f)/2:i="auto",a.element.css("overflow",i),b.css({top:g,left:h})},100)},showDialog:function(b){a.dialogGroup().addClass("show-dialog-"+b)},hideDialog:function(b){a.dialogGroup().removeClass("show-dialog-"+b)}}}),b.resolve()})}),EasyBlog.module("media/constrain",function(a){var b=this;EasyBlog.require().library("image").done(function(){a.fn.constrain=function(){var b=this.data("constrain");if(b instanceof a.Constrain){if(!(arguments.length>0))return b;b.update(arguments[0])}else b=new a.Constrain(this,arguments[0]),this.data("constrain",b)
},a.Constrain=function(b,c){var d=this,e={selector:{width:".inputWidth",height:".inputHeight",constrain:".inputConstrain"},forceConstrain:!1},f=c?c:{};d.options=a.extend(!0,{},e,f),d.options.element={width:b.find(d.options.selector.width).data("type","width"),height:b.find(d.options.selector.height).data("type","height"),constrain:b.find(d.options.selector.constrain)},d.options.initial=d.options.initial||d.options.source,void 0!==d.options.allowedMax&&(d.options.max=a.Image.resizeWithin(d.options.source.width,d.options.source.height,d.options.allowedMax.width,d.options.allowedMax.height),d.options.initial.width=Math.min(d.options.max.width,d.options.initial.width),d.options.initial.height=Math.min(d.options.max.height,d.options.initial.height)),d.options.element.width.data("initial",d.options.initial.width),d.options.element.height.data("initial",d.options.initial.height),d.fieldValues(d.calculate("width",d.options.initial)),a.each([d.options.element.width,d.options.element.height],function(b,c){var e=c.data("type"),f=d.getOppositeType(e),c=a(c),g=d.options.element[f];
c.bind("keyup",function(a){return 9==a.keyCode||16==a.keyCode?!1:(d.fieldValues(d.calculate(e)),void 0)}),c.bind("blur",function(){d.options.element.constrain.is(":checked")||""!=a.trim(c.val())||c.val(d.options.initial[e]),""==a.trim(c.val())&&""==a.trim(g.val())&&(c.val(d.options.initial[e]),g.val(d.options.initial[f]))})}),a(d.options.element.constrain).bind("change",function(){if(a(this).is(":checked")){var b=d.fieldValues(),c=""===b.width?"height":"width";d.fieldValues(d.calculate(c))}})},a.extend(a.Constrain.prototype,{calculate:function(a,b){var c=this,b=void 0!==b?b:c.fieldValues(),d=c.getOppositeType(a),e=c.options.max?c.options.max[a]:void 0,f=c.options.max?c.options.max[d]:void 0,g=c.options.source[a],h=c.options.source[d],i=b[a],j=b[d];
if(i=""!=i&&e&&i>e?e:i,this.enforceConstrain())if(""==i)j="";else{var k=g/i;j=Math.round(h/k),f&&j>f&&(j=f)}var l={};return l[a]=i,l[d]=j,l},getOppositeType:function(a){return"width"==a?"height":"width"},getInput:function(b){var c=this,d=c.options.element[b].val();return d=a.trim(d),d=d.replace(new RegExp("[^0-9.]","g"),""),d=parseInt(d,10),isNaN(d)?"":d},fieldValues:function(a){var b=this,c={};return void 0===a?(c.width=b.getInput("width"),c.height=b.getInput("height")):(b.options.element.width.val(Math.floor(a.width)),b.options.element.height.val(Math.floor(a.height)),c=a),c
},enforceConstrain:function(){var a=this;return a.options.forceConstrain?!0:a.options.element.constrain.length<1?!0:a.options.element.constrain.is(":checked")},update:function(b){var c=this;c.options.initial=b.initial||b.source||c.options.initial,void 0!==b.allowedMax&&void 0!==b.source&&(b.max=a.Image.resizeWithin(b.source.width,b.source.height,b.allowedMax.width,b.allowedMax.height),c.options.initial.width=Math.min(b.max.width,c.options.initial.width),c.options.initial.height=Math.min(b.max.height,c.options.initial.height)),c.options=a.extend(!0,{},c.options,b),values=this.calculate("width",{width:c.options.initial.width||c.options.source.width,height:c.options.initial.height||c.options.source.height}),this.fieldValues(values)
}}),b.resolve()})}),EasyBlog.module("media/editor.audio",function(a){var b=this;EasyBlog.require().view("media/editor.audio","media/editor.audio.player").done(function(){EasyBlog.Controller("Media.Editor.Audio",{defaultOptions:{view:{panel:"media/editor.audio",player:"media/editor.audio.player"},player:{width:400,height:24,autostart:!1,controlbar:"bottom",backcolor:"#333333",frontcolor:"#ffffff",modes:[{type:"html5"},{type:"flash",src:a.rootPath+"/components/com_easyblog/assets/vendors/jwplayer/player.swf"},{type:"download"}]},"{editorPreview}":".editorPreview","{editorPanel}":".editorPanel","{playerContainer}":".playerContainer","{autoplay}":".autoplay"}},function(b){var c,d,e;
return{init:function(){c=b.media,d=c.library,e=c.browser;{var a=b.meta();b.place()}b.editorPanel().html(b.view.panel({meta:a})).implement(EasyBlog.Controller.Media.Editor.Panel,{},function(){b.panel=this}),b.editorPreview().implement(EasyBlog.Controller.Media.Editor.Preview,{},function(){b.preview=this,b.initPlayer()})},initPlayer:function(){EasyBlog.require().script(a.rootPath+"/components/com_easyblog/assets/vendors/jwplayer/jwplayer.js").done(function(a){var c=b.meta(),e=(b.place(),"player-"+a.uid()),f=a.extend(b.options.player,{id:e,file:b.meta().url}),g=b.view.player({id:e,meta:c,options:f});
b.preview.container().append(g),b.player=jwplayer(e).setup(f),b.preview.resetLayout()})},meta:function(){return d.getMeta(b.key)},place:function(){return d.getPlace(b.meta().place)},setLayout:function(){},stop:function(){b.player&&"PLAYING"==b.player.getState()&&b.player.pause()},deactivate:function(){b.stop()},"{self} cancelItem":function(){b.stop()},"{self} insertItem":function(){var a={autostart:"1"==b.autoplay().val()?!0:!1};c.insert(b.meta(),a)}}}),b.resolve()})}),EasyBlog.module("media/editor.file",function(){var b=this;
EasyBlog.require().view("media/editor.file","media/editor.file.preview").done(function(){EasyBlog.Controller("Media.Editor.File",{defaultOptions:{view:{panel:"media/editor.file",preview:"media/editor.file.preview"},"{editorPreview}":".editorPreview","{editorPanel}":".editorPanel","{filePreviewCaption}":".filePreviewCaption","{insertItemButton}":".insertItemButton","{insertItemDetail}":".insertItemDetail","{insertCaption}":".insertCaption","{insertAs}":".insertAs"}},function(a){var b,c,d;return{init:function(){b=a.media,c=b.library,d=b.browser;
var e=a.meta();a.editorPanel().html(a.view.panel({meta:e})).implement(EasyBlog.Controller.Media.Editor.Panel,{},function(){a.panel=this}),a.editorPreview().implement(EasyBlog.Controller.Media.Editor.Preview,{},function(){a.preview=this,a.generatePreview()})},generatePreview:function(){var b=a.preview.container().find("a"),c=a.insertAs().val(),d=a.insertCaption().val();if(b.length<1){var e=a.meta();a.preview.container().html(a.view.preview({meta:e,target:c,content:d}))}else b.attr("target",c).text(d);a.preview.resetLayout()
},setLayout:function(){},meta:function(){return c.getMeta(a.key)},place:function(){return c.getPlace(a.meta().place)},"{self} insertItem":function(){var c=a.meta(),d={title:c.title,target:a.insertAs().val(),content:a.insertCaption().val()};b.insert(a.meta(),d)},"{insertCaption} keyup":function(){a.generatePreview()},"{insertCaption} blur":function(b){if(""==b.val()){var c=a.meta();b.val(c.title),a.generatePreview()}},"{insertAs} change":function(){a.generatePreview()}}}),b.resolve()})}),EasyBlog.module("media/editor.image",function(a){var b=this;
EasyBlog.require().library("ui/position").script("media/constrain").view("media/editor.image","media/editor.image.variation","media/editor.image.caption").done(function(){EasyBlog.Controller("Media.Editor.Image",{defaultOptions:{view:{panel:"media/editor.image",variation:"media/editor.image.variation",caption:"media/editor.image.caption"},defaultVariation:"thumbnail","{editorPreview}":".editorPreview","{editorPanel}":".editorPanel","{imageVariationPanel}":".imageVariationPanel","{imageVariationList}":".imageVariationList","{imageVariations}":".imageVariations","{imageVariation}":".imageVariation","{imageEnforceDimensionOption}":".imageEnforceDimensionOption","{imageEnforceWidth}":".imageEnforceWidth","{imageEnforceHeight}":".imageEnforceHeight","{imageCaptionOption}":".imageCaptionOption","{imageCaption}":".imageCaption","{imageZoomOption}":".imageZoomOption","{imageZoomLargeImageSelection}":".imageZoomLargeImageSelection","{itemFilesize}":".itemFilesize","{itemFilename}":".itemFilename","{itemUrl}":".itemUrl","{itemCreationDate}":".itemCreationDate","{modalPrompt}":".modalPrompt"}},function(b){var c,d,e,f;
return{init:function(){c=b.media,d=c.library,e=c.browser;var a=b.meta(),g=b.place(),h={controller:{editor:b,media:b.media}};b.editorPanel().html(b.view.panel({meta:a,acl:g.acl,enableLightbox:c.options.exporter.image.lightbox,enforceImageDimension:c.options.exporter.image.enforceDimension,enforceImageWidth:c.options.exporter.image.enforceWidth,enforceImageHeight:c.options.exporter.image.enforceHeight})).implement(EasyBlog.Controller.Media.Editor.Panel,{},function(){b.panel=this,("jomsocial"===a.place||"easysocial"==a.place)&&(b.itemFilesize().remove(),b.itemFilename().css("padding-right",0))
}),b.modalPrompt().implement(EasyBlog.Controller.Media.Prompt,h,function(){f=b.promptDialog=this});var i=EasyBlog.Controller.Media.Editor.Image.Filter;b.element.implement(i.Dimension,h).implement(i.Caption,h).implement(i.Lightbox,h),b.editorPreview().implement(EasyBlog.Controller.Media.Editor.Preview,{draggable:!0},function(){b.preview=this,b.previewImage(b.meta().thumbnail.url)}),g.acl.canCreateVariation&&g.acl.canDeleteVariation&&b.element.implement(EasyBlog.Controller.Media.Editor.Image.VariationForm,h),b.populateImageVariations(),b.setLayout()
},meta:function(){return d.getMeta(b.key)},place:function(){return d.getPlace(b.meta().place)},setLayout:function(){b.preview.resetLayout()},"{self} insertItem":function(){var a=b.currentImageVariation().data("variation"),d={variation:a.name};b.imageEnforceDimensionOption().is(":checked")&&(d.enforceDimension=!0,d.enforceWidth=b.imageEnforceWidth().val(),d.enforceHeight=b.imageEnforceHeight().val()),b.imageCaptionOption().is(":checked")&&(d.caption=b.imageCaption().val()),b.imageZoomOption().is(":checked")&&(d.zoom=b.imageZoomLargeImageSelection().val()),c.insert(b.meta(),d)
},populateImageVariations:function(){var c=b.meta(),e=c.variations;return b.imageVariationsData=b.imageVariationsData||{},void 0===e?(b.imageVariations().empty().addClass("busy"),d.getMetaVariations(c.key).done(function(){b.populateImageVariations(),b.imageVariations().removeClass("busy")}).fail(function(){}).always(function(){b.imageVariations().removeClass("busy")}),void 0):(a.each(e,function(a,c){"icon"!=c.name&&b.createImageVariation(c)}),b.trigger("variationPopulated",[b.imageVariationsData]),void 0)},createImageVariation:function(a){var c=b.view.variation({variation:a});
return c.data("variation",a).appendTo(b.imageVariations()),(a["default"]===!0||"true"==a["default"])&&c.addClass("default"),a.canDelete||c.addClass("locked"),b.imageVariationsData[a.name]=c,b.trigger("variationCreated",[c,a]),c},"{self} variationPopulated":function(){var c,d=b.imageVariation(".default");if(b.imageVariation().length>0){if(d.length<1){var e=b.meta(),f=b.previewImage();void 0!==f&&a.each(e.variations,function(a,b){return b.width==f.width()&&b.height==f.height()?(c=b.name,!1):void 0}),c=c||b.imageVariation(":first").data("variation").name
}else c=d.eq(0).data("variation").name;b.currentImageVariation(c)}},"{imageVariation} click":function(a){var c=a.data("variation");b.currentImageVariation(c.name)},currentImageVariation:function(c){var d=b.currentImageVariation.imageVariation,e=b.imageVariationsData[c];if(void 0!==e){var f=e.data("variation"),g=b.meta();if("jomsocial"==g.place||"easysocial"==g.place){var h=b.previewImage();f.width=h?h.data("width"):0,f.height=h?h.data("height"):0,a('<span class="variationDimension"></span>').text(f.width+"x"+f.height).appendTo(e)
}d&&d.removeClass("active"),e.addClass("active"),b.currentImageVariation.imageVariation=e,b.trigger("variationSelected",[e,f])}return b.currentImageVariation.imageVariation},"{self} variationSelected":function(a,c,d,e){b.itemFilesize().html(e.filesize),b.itemUrl().html(e.url),b.itemCreationDate().html(e.dateCreated),b.previewImage(e.url)},"{self} variationRemoved":function(a,c,d,e){delete b.imageVariationsData[e.name],d.remove()},previewImage:function(c){if(void 0===c)return b.previewImage.currentImage;void 0===b.previewImage.images&&(b.previewImage.images={});
var d=b.previewImage.images[c],e=b.previewImage.currentUrl,f=b.previewImage.images[e];return b.preview.showDialog("loading"),void 0===f||a.isDeferred(f)||(f.detach(),b.preview.container().empty()),b.previewImage.currentUrl=c,void 0===d?(b.previewImage.images[c]=a.Image.get(c).done(function(a){b.previewImage.images[c]=a,b.previewImage.currentUrl==c&&b.previewImage(c)}).fail(function(){b.preview.hideDialog("loading"),b.previewImage.currentUrl==c}),void 0):(a.isDeferred(d)||(b.preview.container().append(d),b.previewImage.currentImage=d,b.trigger("previewImage",[b.preview.container(),d]),b.preview.hideDialog("loading"),b.preview.resetLayout()),void 0)
}}}),EasyBlog.Controller("Media.Editor.Image.VariationForm",{defaultOptions:{"{imageVariationForm}":".imageVariationForm","{addVariationButton}":".addVariationButton","{createVariationButton}":".createVariationButton","{removeVariationButton}":".removeVariationButton","{cancelVariationButton}":".cancelVariationButton","{tryCreateVariationButton}":".tryCreateVariationButton","{newVariationName}":".newVariationName","{newVariationWidth}":".newVariationWidth","{newVariationHeight}":".newVariationHeight","{newVariationRatio}":".newVariationRatio","{newVariationLockRatio}":".newVariationLockRatio","{imageVariationMessage}":".imageVariationMessage",variationNameFilter:new RegExp("[^a-zA-Z0-9]","g"),"{createNewImageVariationPrompt}":".createNewImageVariationPrompt","{promptVariationName}":".createNewImageVariationPrompt .variationName","{promptVariationWidth}":".createNewImageVariationPrompt .variationWidth","{promptVariationHeight}":".createNewImageVariationPrompt .variationHeight"}},function(b){return{init:function(){},"{self} variationSelected":function(){var a=b.editor.currentImageVariation().data("variation");
b.removeVariationButton().toggle(a.canDelete)},nextVariationName:function(c){var d=!1,c=a.trim(c.toLowerCase());return a.each(b.editor.imageVariationsData,function(b,e){if(c==e.data("variation").name.toLowerCase()){d=!0;var f=c.substr(-1,1);return c=a.isNumeric(f)?c.substr(0,c.length-1)+(parseInt(f,10)+1):c+1,!1}}),d?b.nextVariationName(c):c},"{addVariationButton} click":function(){b.editor.promptDialog.get("createNewImageVariationPrompt").state("default").show();var c=b.editor.currentImageVariation().data("variation");
variationName=a.String.capitalize(b.nextVariationName(c.name)),b.newVariationName().data("default",variationName).val(variationName).select(),b.newVariationWidth().data("default",c.width).val(c.width),b.newVariationHeight().data("default",c.height).val(c.height),b.imageVariationForm().constrain({selector:{width:b.options["{newVariationWidth}"],height:b.options["{newVariationHeight}"],constrain:b.options["{newVariationLockRatio}"]},source:{width:c.width,height:c.height},allowedMax:{width:b.editor.media.options.exporter.image.maxVariationWidth,height:b.editor.media.options.exporter.image.maxVariationHeight}})
},"{newVariationRatio} click":function(a){a.toggleClass("locked"),a.hasClass("locked")?b.newVariationLockRatio().attr("checked","checked"):b.newVariationLockRatio().removeAttr("checked"),b.newVariationLockRatio().trigger("change")},"{createVariationButton} click":function(){b.createVariation()},"{tryCreateVariationButton} click":function(){b.createVariation()},"{newVariationName} keyup":function(c,d){var e=a.trim(a(c).val());e=e.replace(new RegExp("[^0-9a-zA-Z]","g"),""),a(c).val(e),13==d.keyCode&&b.createVariationButton().trigger("click")
},"[{newVariationWidth}, {newVariationHeight}] keyup":function(a,c){13==c.keyCode&&b.createVariationButton().trigger("click")},createVariation:function(){var c=b.editor.meta(),d=b.editor.place(),e=b.newVariationName().val(),f=b.newVariationWidth().val(),g=b.newVariationHeight().val();return a.trim(e)&&a.trim(f)&&a.trim(g)?(b.promptVariationName().text(e),b.promptVariationWidth().text(f),b.promptVariationHeight().text(g),b.editor.promptDialog.get("createNewImageVariationPrompt").state("progress").show(),EasyBlog.ajax("site.views.media.createVariation",{path:c.path,place:d.id,name:e,width:f,height:g},{success:function(a){b.media.library.meta[c.key].variations.push(a),b.editor.createImageVariation(a),b.editor.currentImageVariation(a.name),b.cancelVariationButton().click()
},fail:function(){b.editor.promptDialog.get("createNewImageVariationPrompt").state("fail").show()}}),void 0):!1},"{removeVariationButton} click":function(){var a=b.editor.imageVariation(".active"),c=a.data("variation"),d=b.editor.meta(),e=b.editor.place();c.canDelete&&EasyBlog.ajax("site.views.media.deleteVariation",{fromPath:d.path,place:e.id,name:c.name},{beforeSend:function(){a.addClass("busy")},success:function(){a.slideUp(function(){b.trigger("variationRemoved",[a,c])}),b.editor.imageVariation(".default").click(),b.media.library.removeMetaVariation(d,c.name)
},fail:function(a){try{console.log(a)}catch(b){}},complete:function(){a.removeClass("busy")}})}}}),EasyBlog.Controller("Media.Editor.Image.Filter.Caption",{defaultOptions:{view:{caption:"media/editor.image.caption"},"{imageVariation}":".imageVariation","{imageCaptionOption}":".imageCaptionOption","{imageCaption}":".imageCaption"}},function(b){return{init:function(){b.item={meta:b.editor.meta()}},"{imageVariation} click":function(){b.transform()},"{self} dimensionEnforced":function(){b.transform()},"{imageCaptionOption} change":function(a,c){c.stopPropagation(),a.parent(".field").toggleClass("hide-field-content",!a.is(":checked")),b.transform()
},"{imageCaptionOption} mouseup":function(){setTimeout(function(){b.imageCaption().focus()[0].select()},1)},"{imageCaption} blur":function(c){""==a.trim(c.val())&&c.val(b.item.meta.title),b.transform()},"{imageCaption} keyup":function(){b.transform()},transform:function(){var a=b.editor.preview.container(),c=a.find("img"),d=a.find("div.imageCaptionText");if(b.imageCaptionOption().is(":checked")){var e=b.imageCaption().val();d.remove(),a.width(c.width()),a.addClass("imageCaptionBorder"),a.width(a.width()),a.append(b.view.caption({caption:e}))
}else a.removeClass("imageCaptionBorder"),d.remove(),a.width("auto");b.editor.preview.resetLayout()}}}),EasyBlog.Controller("Media.Editor.Image.Filter.Lightbox",{defaultOptions:{defaultImageZoomVariation:"original","{imageZoomOption}":".imageZoomOption","{imageZoomLargeImageSelection}":".imageZoomLargeImageSelection","{imageZoomLargeImageOption}":".imageZoomLargeImageSelection option"}},function(b){return{init:function(){},"{self} variationCreated":function(c,d,e,f){var g=a.String.capitalize(f.name),h=a("<option>").val(g).html(g).data("variation",f),i=b.media.options.exporter.image.zoom||b.options.defaultImageZoomVariation;
f.name==i&&h.attr("selected",!0),b.imageZoomLargeImageSelection().append(h)},"{self} variationRemoved":function(a,c,d,e){b.imageZoomLargeImageOption('[value="'+e.name+'"]').remove()},"{imageZoomOption} change":function(a,b){b.stopPropagation(),a.parent(".field").toggleClass("hide-field-content",!a.is(":checked"))},transform:function(){if(b.imageZoomOption().is(":checked")){var c=b.imageZoomLargeImageOption(":selected").data("variation");image=a("<a>").addClass("easyblog-thumb-preview").attr({href:c.url,title:imageCaption||b.item.meta.title}).html(image)
}}}}),EasyBlog.Controller("Media.Editor.Image.Filter.Dimension",{defaultOptions:{"{imageEnforceDimension}":".imageEnforceDimension","{imageEnforceDimensionOption}":".imageEnforceDimensionOption","{imageEnforceWidth}":".imageEnforceWidth","{imageEnforceHeight}":".imageEnforceHeight","{imageEnforceRatio}":".imageEnforceRatio","{imageEnforceLockRatio}":".imageEnforceLockRatio","{imageVariation}":".imageVariation"}},function(b){return{init:function(){var a={selector:{width:b.options["{imageEnforceWidth}"],height:b.options["{imageEnforceHeight}"],constrain:b.options["{imageEnforceLockRatio}"]}};
b.editor.element.bind("variationPopulated",function(){b.editor.media.options.exporter.image.enforceDimension&&b.imageEnforceDimensionOption().attr({checked:"checked",disabled:"disabled"}).parent(".field").removeClass("hide-field-content"),b.applyConstrain(a)})},"{imageVariation} click":function(){b.applyConstrain()},"{imageEnforceDimensionOption} change":function(a,c){c.stopPropagation(),a.parent(".field").toggleClass("hide-field-content",!a.is(":checked")),b.transform()},"{imageEnforceRatio} click":function(a){a.toggleClass("locked"),a.hasClass("locked")?b.imageEnforceLockRatio().attr("checked","checked"):b.imageEnforceLockRatio().removeAttr("checked"),b.imageEnforceLockRatio().trigger("change"),a.hasClass("locked")&&b.transform()
},"{self} previewImage":function(){b.transform()},"{imageEnforceWidth} keyup":function(){b.transform()},"{imageEnforceHeight} keyup":function(){b.transform()},"{imageEnforceWidth} blur":function(c){""!=a.trim(c.val())||b.imageEnforceLockRatio().is(":checked")||c.val(c.data("initial")),b.transform()},"{imageEnforceHeight} blur":function(c){""!=a.trim(c.val())||b.imageEnforceLockRatio().is(":checked")||c.val(c.data("initial")),b.transform()},transform:function(){var a=b.editor.previewImage();if(void 0!==a){var c={};
if(b.imageEnforceDimensionOption().is(":checked"))c={width:b.imageEnforceWidth().val(),height:b.imageEnforceHeight().val()};else{var d=b.editor.currentImageVariation();d=void 0===d?b.editor.meta():d.data("variation"),c={width:d.width,height:d.height}}(a.width()!==c.width||a.height()!==c.height)&&(a.css(c),b.editor.trigger("dimensionEnforced")),b.editor.preview.resetLayout()}},applyConstrain:function(c){var d=void 0===b.editor.currentImageVariation()?b.editor.meta():b.editor.currentImageVariation().data("variation"),e={source:{width:d.width,height:d.height}};
b.editor.media.options.exporter.image.enforceDimension&&(e.allowedMax={width:b.editor.media.options.exporter.image.enforceWidth,height:b.editor.media.options.exporter.image.enforceHeight}),c=a.extend(!0,{},e,c),b.imageEnforceDimension().constrain(c),b.transform()}}}),b.resolve()})}),EasyBlog.module("media/editor.video",function(a){var b=this;EasyBlog.require().view("media/editor.video","media/editor.video.player").done(function(){EasyBlog.Controller("Media.Editor.Video",{defaultOptions:{view:{panel:"media/editor.video",player:"media/editor.video.player"},player:{width:400,height:225,autostart:!1,controlbar:"bottom",backcolor:"#333333",frontcolor:"#ffffff",modes:[{type:"html5"},{type:"flash",src:a.rootPath+"/components/com_easyblog/assets/vendors/jwplayer/player.swf"},{type:"download"}]},"{editorPreview}":".editorPreview","{editorPanel}":".editorPanel","{playerContainer}":".playerContainer","{insertWidth}":".insertWidth","{insertHeight}":".insertHeight","{autoplay}":".autoplay"}},function(b){var c,d,e;
return{init:function(){c=b.media,d=c.library,e=c.browser;var a=b.meta(),f=c.options.exporter.video.width,g=c.options.exporter.video.height;void 0!==f&&(b.options.player.width=f),void 0!==g&&(b.options.player.height=g),b.editorPanel().html(b.view.panel({meta:a,insertWidth:b.options.player.width,insertHeight:b.options.player.height})).implement(EasyBlog.Controller.Media.Editor.Panel,{},function(){b.panel=this}),b.editorPreview().implement(EasyBlog.Controller.Media.Editor.Preview,{},function(){b.preview=this,b.initPlayer()
})},initPlayer:function(){b.preview.showDialog("loading"),EasyBlog.require().script(a.rootPath+"/components/com_easyblog/assets/vendors/jwplayer/jwplayer.js").done(function(a){var c=b.meta(),e=(b.place(),"player-"+a.uid()),f=a.extend(b.options.player,{id:e,file:b.meta().url}),g=b.view.player({id:e,meta:c,options:f});b.preview.container().append(g),b.player=jwplayer(e).setup(f),b.preview.resetLayout(),b.preview.hideDialog("loading")}).fail(function(){})},meta:function(){return d.getMeta(b.key)},place:function(){return d.getPlace(b.meta().place)
},setLayout:function(){},"{self} cancelItem":function(){b.player&&"PLAYING"==b.player.getState()&&b.player.pause()},"{self} insertItem":function(){var a={autostart:"1"==b.autoplay().val()?!0:!1,width:parseInt(b.insertWidth().val(),10),height:parseInt(b.insertHeight().val(),10)};c.insert(b.meta(),a)},resize:function(){if(b.player){var a=parseInt(b.insertWidth().val(),10),c=parseInt(b.insertHeight().val(),10);b.player.resize(a,c),b.preview.resetLayout()}},"{insertWidth} keyup":function(){b.resize()},"{insertHeight} keyup":function(){b.resize()
}}}),b.resolve()})}),EasyBlog.module("media/uploader.item",function(a){var b=this;EasyBlog.Controller("Media.Browser.Uploader.Item",{defaultOptions:{"{filename}":".uploadFilename","{progressBar}":".uploadProgressBar progress","{percentage}":".uploadPercentage","{status}":".uploadStatus","{removeButton}":".uploadRemoveButton"}},function(b){return{init:function(){b.element.data("item",b),b.filename().html(b.file.name),b.setState("queued")},getFilesize:function(c,d){return void 0===b.file.size||"N/A"==b.file.size?"":(c?c:"")+a.plupload.formatSize(b.file.size)+(d?d:"")
},setProgress:function(a){b.progressBar().attr("value",a),b.percentage().html(a)},setState:function(a){b.element.removeClass("upload-state-"+b.state).addClass("upload-state-"+a),b.state=a},setMessage:function(a){b.status().html(a)},"{removeButton} click":function(a,c){c.stopPropagation(),b.element.slideUp(function(){b.element.remove()})}}}),b.resolve()}),EasyBlog.module("ratings",function(a){var b=this;EasyBlog.require().library("ui/stars").script("legacy").done(function(){eblog.ratings={setup:function(b,c,d){a("#"+b).stars({split:2,disabled:c,oneVoteOnly:!0,cancelShow:!1,callback:function(c){eblog.loader.loading(b+"-command .rating-text"),ejax.load("ratings","vote",c.value(),a("#"+b).children("input:hidden").val(),d,b)
}})},showVoters:function(a,b){ejax.load("ratings","showvoters",a,b)},update:function(b,c,d){a("#"+b).children(".ui-stars-star").removeClass("ui-stars-star-on"),d=parseInt(d),a("#"+b+"-command").hide(),a("#"+b).addClass("voted"),a("#"+b).children(".ui-stars-star").each(function(b){d>b?a(this).addClass("ui-stars-star-on"):a(this).removeClass("ui-stars-star-on")})}},b.resolve()})}),EasyBlog.module("tag",function(a){var b=this;EasyBlog.require().view("dashboard/dashboard.tags.item").done(function(){EasyBlog.Controller("Tag.Form",{defaultOptions:{tags:[],tagLimit:0,tagSelections:[],tagSelectionLimit:25,"{tagList}":".tag-list.creation","{tagItems}":".tag-list.creation .tag-item","{tagItemRemoveButton}":".remove-tag","{tagCreationForm}":".new-tag-item","{tagInput}":".tagInput","{tagCreateButton}":".tag-create","{totalTags}":".total-tags","{tagSelectionFilter}":".tag-selection-filter","{tagSelectionList}":".tag-list.selection","{tagSelectionItems}":".tag-list.selection .tag-item","{tagSelection}":".tag-selection","{showAllTagsButton}":".show-all-tags",view:{tagItem:"dashboard/dashboard.tags.item"}}},function(b){return{init:function(){EasyBlog.dashboard&&EasyBlog.dashboard.registerPlugin("tags",b),setTimeout(function(){var c,a=b.options.tagSelections,d=a.length;
for(c=0;d>c;c++)b.tags[a[c].title.toLowerCase()]=a[c];var a=b.options.tags,d=a.length;for(c=0;d>c;c++){var e=b.getKey(a[c].title);b.selectTag(e)}b.showTagSelections("")},0)},tags:{},items:{},selected:{},sanitizeTitle:function(b){return a.trim(b).replace(/[,\'\"\#\<\>]/gi,"")},getKey:function(a){return b.sanitizeTitle(a).toLowerCase()},getTag:function(a){return Object.prototype.hasOwnProperty.call(b.tags,a)?b.tags[a]:void 0},createTag:function(a){var a=b.sanitizeTitle(a),c=a.toLowerCase();return b.getTag(c)||(b.tags[c]={title:a})
},getTagItem:function(a){var c=b.getTag(a);if(c)return c.item||(c.item=b.view.tagItem({title:c.title}).data("key",a))},getTagData:function(c){var d=b.getTag(c);if(d)return d.data||(d.data=a('<input class="tagdata" type="hidden" name="tags[]" value="'+d.title+'" />'))},search:function(c){var c=a.trim(c).toLowerCase(),d=[];for(key in b.tags)key.indexOf(c)<0||d.push(key);return d},selectTag:function(a){clearTimeout(b.selectTag.refreshTagSelection);var c=b.getTagItem(a);if(c){var d=b.tagItems();if(!(b.options.tagLimit>0&&d.length>=b.options.tagLimit)){if(c.css({opacity:0}),d.length<1)b.tagList().prepend(c);
else{var e=d.filter(":last");e[0]!=c[0]&&c.insertAfter(e)}c.animate({opacity:1});var f=b.getTagData(a);f.appendTo(b.element),b.selected[a]=!0,b.checkTagLimit(),b.selectTag.refreshTagSelection=setTimeout(function(){b.showTagSelections()},500)}}},unselectTag:function(a){var c=b.getTagItem(a);if(c){c.detach();var d=b.getTagData(a);d.detach(),delete b.selected[a],b.checkTagLimit();var e=b.getTag(a);void 0!==e.alias&&b.showTagSelections()}},addToTagSelectionList:function(a){var c=b.getTagItem(a);return c&&c.appendTo(b.tagSelectionList())
},showTagSelections:function(a){b.tagSelectionItems().detach(),a=b.currentFilter=void 0===a?b.currentFilter||"":a;var c=0,d=b.options.tagSelectionLimit;if(""===a)for(h in b.tags){if(c>=d)break;b.selected[h]||void 0===b.getTag(h).alias||(b.addToTagSelectionList(h),c++)}else{var f,e=b.search(a),g=e.length;for(f=0;g>f&&!(c>=d);f++){var h=e[f];b.selected[h]||void 0===b.getTag(h).alias||(b.addToTagSelectionList(h),c++)}}b.tagSelection().toggleClass("no-selection",1>c)},"{tagInput} keydown":function(a,c){c.stopPropagation(),b.realEnterKey=13==c.keyCode
},"{tagInput} keypress":function(a,c){c.stopPropagation(),b.realEnterKey=b.realEnterKey&&13==c.keyCode},"{tagInput} keyup":function(a,c){switch(clearTimeout(b.filterTask),c.stopPropagation(),c.keyCode){case 27:a.val("");break;case 13:b.realEnterKey&&a.hasClass("canCreate")&&b.createTagFromInput()}b.filterTask=setTimeout(function(){b.showTagSelections(a.val())},250)},createTagFromInput:function(){var c=a.trim(b.tagInput().val());if(""!==c){{var d=b.getKey(c);b.createTag(c)}b.selectTag(d),b.tagInput().val("")}b.showTagSelections("")
},checkTagLimit:function(){var a=b.options.tagLimit;if(!(1>a)){var c=b.tagItems().length;b.totalTags().text(c),b.tagCreationForm()[c>=a?"hide":"show"]()}},"{tagCreateButton} click":function(){b.createTagFromInput()},"{tagSelectionItems} click":function(a){var c=a.data("key");b.selectTag(c)},"{tagItemRemoveButton} click":function(a){var c=a.parents(".tag-item").data("key");b.unselectTag(c)},"{showAllTagsButton} click":function(a){a.hasClass("active")?(a.removeClass("active"),b.options.tagSelectionLimit=b.originalLimit):(a.addClass("active"),b.originalLimit=b.options.tagSelectionLimit,b.options.tagSelectionLimit=9999),b.showTagSelections("")
}}}),b.resolve()})})});