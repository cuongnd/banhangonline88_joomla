var jGetEditorSelectedMedia=!1;(function(){function t(n){return encodeURIComponent(n).replace(/~/g,"%7E").replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+").replace(/%7C/g,"|")}function n(n){var t=n.widgets.selected[0]||null;return t?t.element.getFirst():!1}function i(n,i){var u=[],r;if(i)for(r in i)u.push(r+"="+t(i[r]));else return n;return n+(n.indexOf("?")!=-1?"&":"?")+u.join("&")}jGetEditorSelectedMedia=function(t){var i=CKEDITOR.instances[t];return i?(element=n(i))?element.$:!1:!1};CKEDITOR.plugins.add("arkmediabutton",{lang:"en",icons:"arkmediabutton",hidpi:!1,init:function(t){if(t.config.arkMediaEnabled&&t.config.arkMediaProEnabled){var u={url:t.config.base+"index.php?option=com_arkmedia",exec:function(t){var v=t.config.filebrowserWindowWidth||"80%",y=t.config.filebrowserWindowHeight||(CKEDITOR.env.gecko?"77%":"85%"),r={},h=0,f=n(t),c,o,e,s,u,l,a;if(f){c=f.is("video")?"video":"audio";o="";r.stacklock=1;switch(c){case"video":if(r.stack="videos",f.hasAttribute("src"))o=f.getAttribute("src").replace(t.config.baseHref,"");else{for(e=f.find("source").$,s=[],u=0;u<e.length;u++)s[u]=e[u].src&&e[u].src.replace(t.config.baseHref,"")||"";o=s.join("|")}break;case"audio":if(r.stack="audios",f.hasAttribute("src"))o=f.getAttribute("src").replace(t.config.baseHref,"");else{for(e=f.getFirst().$,s=[],u=0;u<e.length;u++)s[u]=e[u].src&&e[u].src.replace(t.config.baseHref,"")||"";o=s.join("|")}}h=o}else r.stacks="audios|videos",r.stack="videos",r.stacklock=0;r.tmpl="component";r.editor="CKEDITOR";r.editorname=t.name;h&&(r.edit=h);r.langCode||(r.language=t.langCode);l=i(this.url,r);a=function(n){n.cancel()};t.editable().once("blur",a,null,null,-100);t.popup(l,v,y)}},r="arkmediabutton",f=t.addCommand(r,u);f.modes={wysiwyg:1};t.ui.addButton&&t.ui.addButton("Arkmediabutton",{label:t.lang.arkmediabutton.toolbar,command:r});t.on("doubleclick",function(n){var i=n.data.element;return!i||i.is("video")||i.is("audio")||(i=i.findOne("video")||i.findOne("audio")),i?(setTimeout(function(){t.execCommand(r)},0),!1):void 0},null,null,4);t.addMenuItems&&t.addMenuItems({arkmediabutton:{label:t.lang.arkmediabutton.menu,command:r,group:"link",order:1}});t.contextMenu&&t.contextMenu.addListener(function(n){return n?(n.is("video")||n.is("audio")||(n=n.findOne("video")||n.findOne("audio")),!n)?null:{arkmediabutton:CKEDITOR.TRISTATE_OFF}:null})}}})})()