"use strict";
/**
 * @license Copyright (c) 2003-2016, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
function Notification(n,t){CKEDITOR.tools.extend(this,t,{editor:n,id:"cke-"+CKEDITOR.tools.getUniqueId(),area:n._.notificationArea});t.type||(this.type="info");this.element=this._createElement();n.plugins.clipboard&&CKEDITOR.plugins.clipboard.preventDefaultDropOnElement(this.element)}function Area(n){var t=this;this.editor=n;this.notifications=[];this.element=this._createElement();this._uiBuffer=CKEDITOR.tools.eventsBuffer(10,this._layout,this);this._changeBuffer=CKEDITOR.tools.eventsBuffer(500,this._layout,this);n.on("destroy",function(){t._removeListeners();t.element.remove()})}CKEDITOR.plugins.add("notification",{lang:"cs,da,de,de-ch,en,eo,eu,fr,gl,id,it,km,ko,ku,nb,nl,pl,pt,pt-br,ru,sv,tr,ug,uk,zh,zh-cn",requires:"toolbar",init:function(n){function t(n){var t=new CKEDITOR.dom.element("div");t.setStyles({position:"fixed","margin-left":"-9999px"});t.setAttributes({"aria-live":"assertive","aria-atomic":"true"});t.setText(n);CKEDITOR.document.getBody().append(t);setTimeout(function(){t.remove()},100)}n._.notificationArea=new Area(n);n.showNotification=function(t,i,r){var f,e,u;return i=="progress"?f=r:e=r,u=new CKEDITOR.plugins.notification(n,{message:t,type:i,progress:f,duration:e}),u.show(),u};n.on("key",function(i){if(i.data.keyCode==27){var r=n._.notificationArea.notifications;if(!r.length)return;t(n.lang.notification.closed);r[r.length-1].hide();i.cancel()}})}});Notification.prototype={show:function(){this.editor.fire("notificationShow",{notification:this})!==!1&&(this.area.add(this),this._hideAfterTimeout())},update:function(n){var u=!0;this.editor.fire("notificationUpdate",{notification:this,options:n})===!1&&(u=!1);var t=this.element,f=t.findOne(".cke_notification_message"),i=t.findOne(".cke_notification_progress"),r=n.type;t.removeAttribute("role");n.progress&&this.type!="progress"&&(r="progress");r&&(t.removeClass(this._getClass()),t.removeAttribute("aria-label"),this.type=r,t.addClass(this._getClass()),t.setAttribute("aria-label",this.type),this.type!="progress"||i?this.type!="progress"&&i&&i.remove():(i=this._createProgressElement(),i.insertBefore(f)));n.message!==undefined&&(this.message=n.message,f.setHtml(this.message));n.progress!==undefined&&(this.progress=n.progress,i&&i.setStyle("width",this._getPercentageProgress()));u&&n.important&&(t.setAttribute("role","alert"),this.isVisible()||this.area.add(this));this.duration=n.duration;this._hideAfterTimeout()},hide:function(){this.editor.fire("notificationHide",{notification:this})!==!1&&this.area.remove(this)},isVisible:function(){return CKEDITOR.tools.indexOf(this.area.notifications,this)>=0},_createElement:function(){var r=this,n,t,i,u=this.editor.lang.common.close;n=new CKEDITOR.dom.element("div");n.addClass("cke_notification");n.addClass(this._getClass());n.setAttributes({id:this.id,role:"alert","aria-label":this.type});this.type=="progress"&&n.append(this._createProgressElement());t=new CKEDITOR.dom.element("p");t.addClass("cke_notification_message");t.setHtml(this.message);n.append(t);i=CKEDITOR.dom.element.createFromHtml('<a class="cke_notification_close" href="javascript:void(0)" title="'+u+'" role="button" tabindex="-1"><span class="cke_label">X<\/span><\/a>');n.append(i);i.on("click",function(){r.editor.focus();r.hide()});return n},_getClass:function(){return this.type=="progress"?"cke_notification_info":"cke_notification_"+this.type},_createProgressElement:function(){var n=new CKEDITOR.dom.element("span");return n.addClass("cke_notification_progress"),n.setStyle("width",this._getPercentageProgress()),n},_getPercentageProgress:function(){return Math.round((this.progress||0)*100)+"%"},_hideAfterTimeout:function(){var t=this,n;this._hideTimeoutId&&clearTimeout(this._hideTimeoutId);typeof this.duration=="number"?n=this.duration:(this.type=="info"||this.type=="success")&&(n=typeof this.editor.config.notification_duration=="number"?this.editor.config.notification_duration:5e3);n&&(t._hideTimeoutId=setTimeout(function(){t.hide()},n))}};Area.prototype={add:function(n){this.notifications.push(n);this.element.append(n.element);this.element.getChildCount()==1&&(CKEDITOR.document.getBody().append(this.element),this._attachListeners());this._layout()},remove:function(n){var t=CKEDITOR.tools.indexOf(this.notifications,n);t<0||(this.notifications.splice(t,1),n.element.remove(),this.element.getChildCount()||(this._removeListeners(),this.element.remove()))},_createElement:function(){var t=this.editor,i=t.config,n=new CKEDITOR.dom.element("div");return n.addClass("cke_notifications_area"),n.setAttribute("id","cke_notifications_area_"+t.name),n.setStyle("z-index",i.baseFloatZIndex-2),n},_attachListeners:function(){var t=CKEDITOR.document.getWindow(),n=this.editor;t.on("scroll",this._uiBuffer.input);t.on("resize",this._uiBuffer.input);n.on("change",this._changeBuffer.input);n.on("floatingSpaceLayout",this._layout,this,null,20);n.on("blur",this._layout,this,null,20)},_removeListeners:function(){var t=CKEDITOR.document.getWindow(),n=this.editor;t.removeListener("scroll",this._uiBuffer.input);t.removeListener("resize",this._uiBuffer.input);n.removeListener("change",this._changeBuffer.input);n.removeListener("floatingSpaceLayout",this._layout);n.removeListener("blur",this._layout)},_layout:function(){function d(){t.setStyles({position:"absolute",top:f(r.y)})}function g(){t.setStyles({position:"fixed",top:f(l.bottom)})}function nt(){t.setStyles({position:"fixed",top:0})}function tt(){t.setStyles({position:"absolute",top:f(r.y+n.height-a.height)})}function w(){t.setStyle("left",f(o))}function it(){t.setStyle("left",f(o-r.x+e.x))}function rt(){t.setStyle("left",f(o+n.width/2-i/2-u/2))}function b(){t.setStyle("left",f(o+n.width-i-u))}function ut(){t.setStyle("left",f(o-r.x+e.x+h.width-i-u))}var t=this.element,c=this.editor,n=c.ui.contentsElement.getClientRect(),r=c.ui.contentsElement.getDocumentPosition(),v=c.ui.space("top"),l=v.getClientRect(),a=t.getClientRect(),s,i=this._notificationWidth,u=this._notificationMargin,y=CKEDITOR.document.getWindow(),e=y.getScrollPosition(),h=y.getViewPaneSize(),p=CKEDITOR.document.getBody(),k=p.getDocumentPosition(),f=CKEDITOR.tools.cssLength,o;i&&u||(s=this.element.getChild(0),i=this._notificationWidth=s.getClientRect().width,u=this._notificationMargin=parseInt(s.getComputedStyle("margin-left"),10)+parseInt(s.getComputedStyle("margin-right"),10));v.isVisible()&&l.bottom>n.top&&l.bottom<n.bottom-a.height?g():n.top>0?d():r.y+n.height-a.height>e.y?nt():tt();o=t.getStyle("position")=="fixed"?n.left:p.getComputedStyle("position")!="static"?r.x-k.x:r.x;n.width<i+u?r.x+i+u>e.x+h.width?b():w():r.x+i+u>e.x+h.width?w():r.x+n.width/2+i/2+u>e.x+h.width?ut():n.left+n.width-i-u<0?b():n.left+n.width/2-i/2<0?it():rt()}};CKEDITOR.plugins.notification=Notification