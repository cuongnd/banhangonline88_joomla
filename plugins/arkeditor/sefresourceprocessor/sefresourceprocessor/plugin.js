/**
 * @license Copyright (c) 2003-2013, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
CKEDITOR.plugins.add("sefresourceprocessor",{init:function(){},afterInit:function(n){if(n.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&n.config.sefEnabled){var i=n.dataProcessor,r=i&&i.dataFilter,u=i&&i.htmlFilter,t=n.config;r&&r.addRules({elements:{$:function(n){var u=n.attributes,r,i;if(u)for(r=["href","src","poster"],i=0;i<r.length;i++)u[r[i]]&&(u[r[i]]=u[r[i]].replace(/^(?!\/|[a-zA-Z0-9\-]+:|#|')(.*)$/i,t.base+"$1"));return n}}});u&&u.addRules({elements:{$:function(n){var u=n.attributes,r,i;if(u)for(r=["poster","data-cke-saved-href","data-cke-saved-src"],i=0;i<r.length;i++)u[r[i]]&&(u[r[i]]=u[r[i]].replace(t.base,""));return n}}});n.on("insertHtml",function(n){var i=n.data&&n.data.dataValue||"";i&&(n.data.dataValue=n.data.dataValue.replace(/\s+(src|href|poster)="(?!\/|[a-zA-Z0-9\-]+:|#|')([^"]*)"/i,' $1="'+t.base+'$2"'))},null,null,9);n.on("insertElement",function(n){var i=n.data,u,r,o,f,e;if(i&&i.type==CKEDITOR.NODE_ELEMENT){for(u=["href","src","poster"],r=0;r<u.length;r++)i.$[u[r]]&&(o=u[r],f=i.getAttribute(o),f=f.replace(/^(?!\/|[a-zA-Z0-9\-]+:|#|')(.*)$/i,t.base+"$1"),i.setAttribute(o,f),savedAttributeName="cke-saved-"+u[r],i.data(savedAttributeName,f.replace(t.base,"")));e=i.getHtml();e=e.replace(/\s+(src|href|poster)="(?!\/|[a-zA-Z0-9\-]+:|#|')([^"]*)"/i,' $1="'+t.base+'$2"');i.setHtml(e)}})}}})