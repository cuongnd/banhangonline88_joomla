/**
 * @license Copyright (c) 2003-2013, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
(function(){function t(n){function f(){for(var t,r,s,h,l,c=e(),f=CKEDITOR.tools.clone(n.config.toolbarGroups)||i(n),o=0;o<f.length;o++){if(t=f[o],t=="/")continue;else typeof t=="string"&&(t=f[o]={name:t});if(s=t.groups,s)for(h=0;h<s.length;h++)l=s[h],r=c[l],r&&u(t,r);r=c[t.name];r&&u(t,r)}return f}function e(){var t={},u,f,r,i,e;for(u in n.ui.items)f=n.ui.items[u],r=f.toolbar||"others",r&&(r=r.split(","),i=r[0],e=parseInt(r[1]||-1,10),t[i]||(t[i]=[]),t[i].push({name:u,order:e}));for(i in t)t[i]=t[i].sort(function(n,t){return n.order==t.order?0:t.order<0?-1:n.order<0?1:n.order<t.order?-1:1});return t}function u(t,i){if(i.length){t.items?t.items.push(n.ui.create("-")):t.items=[];for(var u,f;u=i.shift();)if(f=typeof u=="string"?u:u.name,!r||CKEDITOR.tools.indexOf(r,f)==-1){if(u=n.ui.create(f),!u)continue;if(!n.addFeature(u))continue;t.items.push(u)}}}function o(n){for(var r=[],t,i,f=0;f<n.length;++f)t=n[f],i={},t=="/"?r.push(t):CKEDITOR.tools.isArray(t)?(u(i,CKEDITOR.tools.clone(t)),r.push(i)):t.items&&(u(i,CKEDITOR.tools.clone(t.items)),i.name=t.name,r.push(i));return r}var r=n.config.removeButtons,t;return r=r&&r.split(","),t=n.config.toolbar,typeof t=="string"&&(t=n.config["toolbar_"+t]),n.toolbar=t?o(t):f()}function i(n){return n._.toolbarGroups||(n._.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}])}var n=function(){this.toolbars=[];this.focusCommandExecuted=!1};n.prototype.focus=function(){for(var i,r,n,t=0;i=this.toolbars[t++];)for(r=0;n=i.items[r++];)if(n.focus){n.focus();return}};CKEDITOR.ui.richCombo.prototype.setState=function(n){if(this._.state!=n){var t=this.document.getById("cke_"+this.id);t&&(t.setState(n,"cke_combo"),n==CKEDITOR.TRISTATE_DISABLED?t.setAttribute("aria-disabled",!0):t.removeAttribute("aria-disabled"),this._.state=n)}};CKEDITOR.plugins.add("toolbarswitcher",{requires:"toolbar",init:function(i){function f(n){var r,t;i.config.toolbar=i.config[n];r=i.fire("uiSpace",{space:"image",html:""}).html;i.ui.space("top").setHtml(r);t=i.ui.space("toolbox");t&&i.focusManager.add(t,1)}if(i.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&i.config.enableToolbarSwitcher){var r,u=function(n,t){var f,e,s=i.lang.dir=="rtl",o=i.config.toolbarGroupCycling,h=s?37:39,c=s?39:37;o=o===undefined||o;switch(t){case 9:case CKEDITOR.SHIFT+9:while(!e||!e.items.length)if(e=t==9?(e?e.next:n.toolbar.next)||i.toolbox.toolbars[0]:(e?e.previous:n.toolbar.previous)||i.toolbox.toolbars[i.toolbox.toolbars.length-1],e.items.length)for(n=e.items[r?e.items.length-1:0];n&&!n.focus;)n=r?n.previous:n.next,n||(e=0);return n&&n.focus(),!1;case h:f=n;do f=f.next,!f&&o&&(f=n.toolbar.items[0]);while(f&&!f.focus);return f?f.focus():u(n,9),!1;case 40:if(n.button&&n.button.hasArrow){i.once("panelShow",function(n){n.data._.panel._.currentBlock.onKeyDown(40)});n.execute()}else u(n,t==40?h:c);return!1;case c:case 38:f=n;do f=f.previous,!f&&o&&(f=n.toolbar.items[n.toolbar.items.length-1]);while(f&&!f.focus);return f?f.focus():(r=1,u(n,CKEDITOR.SHIFT+9),r=0),!1;case 27:return i.focus(),!1;case 13:case 32:return n.execute(),!1}return!0};i.on("uiSpace",function(r){var b,k,v,a,e,y,s,d,p,c,tt,l,g;if(r.data.space=="image"){i.toolbox=new n;var nt=CKEDITOR.tools.getNextId(),f=['<span id="',nt,'" class="cke_voice_label">',i.lang.toolbar.toolbars,"<\/span>",'<span id="'+i.ui.spaceId("toolbox")+'" class="cke_toolbox" role="group" aria-labelledby="',nt,'" onmousedown="return false;">'],w=i.config.toolbarStartupExpanded!==!1,o,h;for(i.config.toolbarCanCollapse&&i.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&f.push('<span class="cke_toolbox_main"'+(w?">":' style="display:none">')),b=i.toolbox.toolbars,k=t(i),v=0;v<k.length;v++)if(e=0,s=k[v],s){if(o&&(f.push("<\/span>"),o=0,h=0),s==="/"){f.push('<span class="cke_toolbar_break"><\/span>');continue}for(d=s.items||s,p=0;p<d.length;p++)if(c=d[p],c){if(c.type==CKEDITOR.UI_SEPARATOR){h=o&&c;continue}tt=c.canGroup!==!1;e||(a=CKEDITOR.tools.getNextId(),e={id:a,items:[]},y=s.name&&(i.lang.toolbar.toolbarGroups[s.name]||s.name),f.push('<span id="',a,'" class="cke_toolbar"',y?' aria-labelledby="'+a+'_label"':"",' role="toolbar">'),y&&f.push('<span id="',a,'_label" class="cke_voice_label">',y,"<\/span>"),f.push('<span class="cke_toolbar_start"><\/span>'),l=b.push(e)-1,l>0&&(e.previous=b[l-1],e.previous.next=e));tt?o||(f.push('<span class="cke_toolgroup" role="presentation">'),o=1):o&&(f.push("<\/span>"),o=0);function it(n){var t=n.render(i,f);l=e.items.push(t)-1;l>0&&(t.previous=e.items[l-1],t.previous.next=t);t.toolbar=e;t.onkey=u;t.onfocus=function(){i.toolbox.focusCommandExecuted||i.focus()}}h&&(it(h),h=0);it(c)}o&&(f.push("<\/span>"),o=0,h=0);e&&f.push('<span class="cke_toolbar_end"><\/span><\/span>')}if(i.config.toolbarCanCollapse&&f.push("<\/span>"),i.config.toolbarCanCollapse&&i.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){g=CKEDITOR.tools.addFunction(function(){i.execCommand("toolbarCollapse")});i.on("destroy",function(){CKEDITOR.tools.removeFunction(g)});i.addCommand("toolbarCollapse",{readOnly:1,exec:function(n){var t=n.ui.space("toolbar_collapser"),i=t.getPrevious(),u=n.ui.space("contents"),f=i.getParent(),s=parseInt(u.$.style.height,10),h=f.$.offsetHeight,r="cke_toolbox_collapser_min",e=t.hasClass(r),o;e?(i.show(),t.removeClass(r),t.setAttribute("title",n.lang.toolbar.toolbarCollapse)):(i.hide(),t.addClass(r),t.setAttribute("title",n.lang.toolbar.toolbarExpand));t.getFirst().setText(e?"▲":"◀");o=f.$.offsetHeight-h;u.setStyle("height",s-o+"px");n.fire("resize")},modes:{wysiwyg:1,source:1}});i.setKeystroke(CKEDITOR.ALT+(CKEDITOR.env.ie||CKEDITOR.env.webkit?189:109),"toolbarCollapse");f.push('<a title="'+(w?i.lang.toolbar.toolbarCollapse:i.lang.toolbar.toolbarExpand)+'" id="'+i.ui.spaceId("toolbar_collapser")+'" tabIndex="-1" class="cke_toolbox_collapser');w||f.push(" cke_toolbox_collapser_min");f.push('" onclick="CKEDITOR.tools.callFunction('+g+')">','<span class="cke_arrow">&#9650;<\/span>',"<\/a>")}f.push("<\/span>");r.data.html+=f.join("")}});i.on("contentDom",function(){i.on("selectionChange",function(){var n,t;this.editable().getCustomData("type")!="title"&&(n=this.getSelection(),n&&(t=n.getSelectedElement(),t&&t.is("img")?this.config.toolbarName!="image"&&(f("toolbar_image"),this.config.toolbarName="image"):CKEDITOR.env.iOS?this.config.toolbarName!="mobile"&&(f("toolbar_mobile"),this.config.toolbarName="mobile"):this.config.toolbarName!="inline"&&(f("toolbar_inline"),this.config.toolbarName="inline")))})})}}})})()