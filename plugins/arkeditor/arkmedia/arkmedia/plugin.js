var jGetEditorSelectedElement=!1,jGetEditorSelectedText=!1,jGetEditorSelectedImage=!1,jGetEditorSelectedLink=!1;(function(){function t(n){return encodeURIComponent(n).replace(/~/g,"%7E").replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}function i(n,t){var i=n.getSelection();return element=i&&i.getSelectedElement()||null,element&&element.is(t)&&!element.isReadOnly()?element:element&&element.is("img")&&element.data("cke-realelement")&&element.data("cke-real-element-type")==t&&!element.isReadOnly()?n.restoreRealElement(element)||null:!1}function u(n){return i(n,"audio")}function f(n){return i(n,"video")}function n(n){var t=n.getSelection();return(element=t&&t.getSelectedElement()||null,element&&element.is("img")&&!element.data("cke-realelement")&&!element.isReadOnly())?element:!1}function r(n,t){var r=[],i;if(t)for(i in t)r.push(i+"="+encodeURIComponent(t[i]));else return n;return n+(n.indexOf("?")!=-1?"&":"?")+r.join("&")}jGetEditorSelectedAudio=function(n){var t=CKEDITOR.instances[n];return t?(element=u(t))?element.$:!1:!1};jGetEditorSelectedVideo=function(n){var t=CKEDITOR.instances[n];return t?(element=f(t))?element.$:!1:!1};jGetEditorSelectedImage=function(t){var i=CKEDITOR.instances[t];return i?(element=n(i))?element.$:!1:!1};jGetEditorSelectedLink=function(n){var t=CKEDITOR.instances[n];return t?(element=CKEDITOR.plugins.link.getSelectedLink(t))?element.$:!1:!1};jGetEditorSelectedElement=function(t){var i=CKEDITOR.instances[t];return i?(element=CKEDITOR.plugins.link.getSelectedLink(i))?element.$:(element=n(i))?element.$:!1:!1};jGetEditorSelectedText=function(n){var t=CKEDITOR.instances[n];return t?t.getSelection().getSelectedText():!1};CKEDITOR.plugins.add("arkmedia",{requires:"image,document",icons:"image",hidpi:!0,init:function(){},afterInit:function(i){var u,c,o;if(i.config.arkMediaEnabled){var s={url:i.config.base+"index.php?option=com_arkmedia",exec:function(i){var s=i.config.filebrowserImageWindowWidth||i.config.filebrowserWindowWidth||"100%",h=i.config.filebrowserImageWindowHeight||i.config.filebrowserWindowHeight||(CKEDITOR.env.gecko?"92%":"100%"),u={stack:"images",stacklock:1},f,e,o;u.stacks="images";u.tmpl="component";u.editor="CKEDITOR";u.editorname=i.name;u.langCode||(u.language=i.langCode);u.edit=0;f=n(i);f&&(edit=f.getAttribute("src").replace(i.config.base,""),u.edit=t(edit));e=r(this.url,u);o=function(n){n.cancel()};i.editable().once("blur",o,null,null,-100);i.popup(e,s,h)}},h={url:i.config.base+"index.php?option=com_arkmedia",exec:function(n){var s=n.config.filebrowserWindowWidth||"80%",h=n.config.filebrowserWindowHeight||(CKEDITOR.env.gecko?"77%":"85%"),i={},u=0,f=CKEDITOR.plugins.link.getSelectedLink(n),i={stacklock:1,stack:"documents",stacks:"documents"},e,o;f&&(u=t(f.getAttribute("href").replace(n.config.base,"")));i.tmpl="component";i.editor="CKEDITOR";i.editorname=n.name;i.edit=u;i.langCode||(i.language=n.langCode);e=r(this.url,i);o=function(n){n.cancel()};n.editable().once("blur",o,null,null,-100);n.popup(e,s,h)}},f="arkimage2",e=i.addCommand(f,s);e.modes={wysiwyg:1};i.ui.addButton&&i.ui.addButton("Image",{label:i.lang.common.image,command:f});i.on("doubleclick",function(n){var t=n.data.element;if(t.is("img")&&!t.data("cke-realelement")&&!t.isReadOnly())return setTimeout(function(){i.execCommand(f)},0),!1},null,null,4);i.removeMenuItem&&i.removeMenuItem("image");i.addMenuItems&&i.addMenuItems({image:{label:i.lang.image.menu,command:f,group:"image"}});u="arkmedia2";c=i.addCommand(u,h);e.modes={wysiwyg:1};i.ui.addButton&&i.ui.addButton("Document",{label:i.lang.document.toolbar,command:u});o=/(?:[^\/])\/(([^\u0000-\u007F]|[\w-])+\.(?!(?:htm|php|asp|jsp|cfm|pl|cgi))\w+)$/;i.on("doubleclick",function(n){var t=CKEDITOR.plugins.link.getSelectedLink(i)||n.data.element;if(!t.isReadOnly())if(t.is("a")){if(t.getAttribute("name")||!t.getAttribute("href")&&t.getChildCount())t.getAttribute("name")&&(!t.getAttribute("href")||t.getChildCount())&&(n.data.dialog="anchor");else if(o.test(t.getAttribute("href")))return setTimeout(function(){i.execCommand(u)},0),!1}else CKEDITOR.plugins.link.tryRestoreFakeAnchor(i,t)&&(n.data.dialog="anchor")},null,null,4);i.removeMenuItem&&i.removeMenuItem("document");i.addMenuItems&&i.addMenuItems({document:{label:i.lang.document.menu,command:u,group:"link",order:1}})}}})})()