CKEDITOR.plugins.add("quicktable",{requires:"table,panelbutton,floatpanel",lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,ug,uk,vi,zh,zh-cn",afterInit:function(n){function i(t){return new CKEDITOR.dom.element(t,n.document)}function o(t,r){for(var o,f,y,u=i("table"),p=u.append(i("tbody")),e=0;e<t;e++)for(o=p.append(i("tr")),f=0;f<r;f++)y=o.append(i("td")),y.appendBogus();u.setAttribute("cellpadding",l);u.setAttribute("cellspacing",a);u.setAttribute("border",s);u.setAttribute("class",c);u.setStyles(h);u.setStyle("width",v);n.insertElement(u)}function y(n){var t=[],u=CKEDITOR.tools.addFunction(function(t,i){o(parseInt(t,10)+1,parseInt(i,10)+1);n.hide()}),i,r;for(t.push('<a style="display:block" _cke_focus=1 hidefocus=true href="javascript:void(1)"><table role="presentation" cellspacing=0 cellpadding=0 style="width: 154px; margin: 0 auto 3px;table-layout:fixed;border-collapse:collapse;border: 1px solid #aaa">'),i=0;i<f;i++){for(t.push("<tr>"),r=0;r<e;r++)t.push('<td style="border: 1px solid #aaa;width:14px;height:14px;" data-i="'+i+'" data-j="'+r+'" onclick="CKEDITOR.tools.callFunction(',u,",'",i,"','",r,"'); return false;\"><\/td>");t.push("<\/tr>")}return t.push("<\/table><\/a>"),t.join("")}function u(t,i,u,f){for(var s,e,c,h=i.$.tBodies[0].rows,o=0;o<h.length;o++)for(s=h[o].cells,e=0;e<s.length;e++)c=s[e],c.style.background=o<u&&e<f?"#E5E5E5":"";r.row=u-1;r.column=f-1;t.setText(u+" Ã— "+f+" "+n.lang.table.toolbar)}var t=n.config,f=t.qtRows||8,e=t.qtColumns||10,s=t.qtBorder||"1",h=t.qtStyle||null,c=t.qtClass||"",l=t.qtCellPadding||"1",a=t.qtCellSpacing||"1",v=t.qtWidth||"500px",r={row:-1,column:-1};n.ui.add("Table",CKEDITOR.UI_PANELBUTTON,{label:n.lang.table.toolbar,command:"table",modes:{wysiwyg:1},editorFocus:0,toolbar:"insert,30",caption:null,table:null,panel:{css:CKEDITOR.skin.getPath("editor"),attributes:{role:"listbox","aria-label":n.lang.table.toolbar}},onBlock:function(n,t){var i,r,u;t.autoSize=!0;t.element.addClass("cke_colorblock");i=new CKEDITOR.dom.element("div");i.setStyles({"text-align":"center",margin:"3px 0"});t.element.append(i);this.caption=i;r=CKEDITOR.dom.element.createFromHtml(y(n));this.table=this.addEvents(r);t.element.append(r);u=this.createMoreButton();t.element.append(u);CKEDITOR.ui.fire("ready",this);t.keys=this.assignKeys(t.keys)},assignKeys:function(t){var i=n.lang.dir=="rtl";return t[i?37:39]="next",t[40]="next",t[9]="next",t[i?39:37]="prev",t[38]="prev",t[CKEDITOR.SHIFT+9]="prev",t[32]="click",t},addEvents:function(t){var i=this.table=t.getFirst(),s=this.caption;i.on("mouseleave",function(){u(s,i,1,1)});i.on("mousemove",function(n){var t=n.data.getTarget(),r,f;t.getName()=="td"&&(r=parseInt(t.getAttribute("data-i"),10),f=parseInt(t.getAttribute("data-j"),10),u(s,i,r+1,f+1))});t.on("keydown",function(t){var l=t.data.getKeystroke(),h=r.row,c=r.column;switch(l){case 37:c--;break;case 39:c++;break;case 40:h++;break;case 38:h--;break;case 13:case 32:o(h+1,c+1);return;default:return}if(h<0||c<0){this.panel.hide();return}(h>f-1||c>e-1)&&n.execCommand("table");u(s,i,h+1,c+1);t.data.preventDefault();t.data.stopPropagation()});return i},createMoreButton:function(){var t=new CKEDITOR.dom.element("a");t.setAttributes({_cke_focus:1,hidefocus:!0,title:n.lang.quicktable.more,href:'javascript:void("'+n.lang.quicktable.more+'")',role:"option"});t.addClass("cke_colormore");t.setText(n.lang.quicktable.more);t.setStyle("text-align","center");t.on("click",function(t){n.execCommand("table");t.data.preventDefault()});return t},onOpen:function(){u(this.caption,this.table,1,1)}})}})