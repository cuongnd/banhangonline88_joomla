function jchatAlias($){function injectFloatingMsg(t,a){a&&(t=sprintf(t,a)),$("div#jchat_msg").remove(),$("<div/>").attr("id","jchat_msg").prependTo("body").append('<div id="jchat_msgtext">'+t+"</div>").css("margin-top",0).hide().fadeIn(500).delay(2500).fadeOut(500,function(){$(this).remove()})}function triggerGenericPopover(t,a,e){var s="",o=$(a).parents(".jchat_tabpopup.jchat_tabopen");$(o).hasClass("maximized")&&!t.match(/jchat_contact/i)&&(s=" maximized");var i=jchatHasTouch();if(!i&&!s||!t.match(/jchat_trigger_send_tooltip/i)){var n=0,c=0,r="",l=$(a).parents("div[id^=jchat_user_]");if(l.length&&!$(a).hasClass("jchat_webrtc_disabled")&&(popupTooltipDependency=l),e||(e=$(a).data("text")),e){if(t.match(/jchat_room/i)&&(n=25,e=e.replace(/\r?\n/gi,"<br/>")),t.match(/webrtc/i)&&webrtcDirector.callee&&!$(a).prev(".jchat_webrtctooltip").length){if($(a).hasClass("jchat_webrtc_disabled"))return;e=jchat_trigger_webrtc_ringing,r=" jchat_tooltip_webrtc"}$(t).remove(),$("body").append('<div id="'+t.replace("#","")+'" class="jchat_generic_tooltip'+s+r+'"><div class="jchat_tooltip_content">'+e+"</div></div>");var h=$(a).offset(),p=$(a).width(),_=$(t).width();s&&(_=24,t.match(/jchat_skype/i)&&(n=175,c=-75)),$(t).css("left",h.left+p-$(window).scrollLeft()-_-n+8),$(t).css("top",h.top-parseInt($(t).height())-c-6-$(window).scrollTop()+"px"),$(t).fadeIn(200),i&&setTimeout(function(){$(t).fadeOut(200)},1e3)}}}function bindTooltipEvents(t,a,e){$(t,"#jchat_user_"+a+"_popup").toggle(function(t){switch($('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+a+"_popup").length&&$('.jchat_tabcontent div[class$="tooltip"]',"#jchat_user_"+a+"_popup").filter(function(t){return"none"!==$(this).css("display")}).next().trigger("click"),$(this).attr("class").split(" ").shift()){case"jchat_trigger_history":historyTooltip(this,"#jchat_user_"+a+"_popup",a,e.loggedid);break;case"jchat_trigger_geolocation":geolocationTooltip(this,"#jchat_user_"+a+"_popup",a,e)}$(this).addClass("toggle_on")},function(t){switch($(this).attr("class").split(" ").shift()){case"jchat_trigger_history":$(".jchat_historytooltip","#jchat_user_"+a+"_popup").remove();break;case"jchat_trigger_geolocation":$(".jchat_geolocationtooltip","#jchat_user_"+a+"_popup").hide()}$(this).removeClass("toggle_on")})}function wallTooltipUsers(t){var a=null;switch(currentScopedUsers={},groupChatMode){case"global":a=jchat_groupchat_allusers,currentScopedUsers[0]=jchat_groupchat_allusers;break;case"chatroom":if(a=jchat_groupchat_nousers,currentScopedUsers[0]=jchat_groupchat_nousers,myChatRoomUsers.length||currentJoinedChatRoom){a=my_username+", ",currentScopedUsers[0]=my_username;for(o=0;o<myChatRoomUsers.length;o++)a+=myChatRoomUsers[o].name+", ",currentScopedUsers[myChatRoomUsers[o].sessionid]=myChatRoomUsers[o].name,(o+1)%3==0&&o+1<myChatRoomUsers.length&&(a+="<br/>");a=a.slice(0,-2)}else{if(a=my_username+", ",currentScopedUsers[0]=my_username,!$.isEmptyObject(buddyList)){var e=0;$.each(buddyList,function(t,s){s.hasroomid||(a+=s.name+", ",currentScopedUsers[t]=s.name,(e+1)%3==0&&(a+="<br/>"),e++)})}a=a.replace(/<br\/>$/gi,""),a=a.slice(0,-2)}break;case"invite":var s=$("div[id^=jchat_userlist] span.jchat_contact[data-contact=1]");if(s.length){a=my_username+"<br/>",currentScopedUsers[0]=my_username;for(var o=0;o<s.length;o++){var i=$(s[o]).attr("data-name"),n=$(s[o]).attr("data-userid");a+=i+"<br/>",currentScopedUsers[n]=i}}else a=jchat_groupchat_nousers,currentScopedUsers[0]=jchat_groupchat_nousers}var c="",r=$(t).parents(".jchat_tabpopup.jchat_tabopen");$(r).hasClass("maximized")&&(c=" maximized"),$("#jchat_users_informations_tooltip").remove(),$("body").append('<div id="jchat_users_informations_tooltip" class="jchat_generic_tooltip'+c+'"><div class="jchat_tooltip_content">'+a+"</div></div>");var l=$(t).offset(),h=$(t).width(),p=$("#jchat_users_informations_tooltip").width();c&&(p=24),$("#jchat_users_informations_tooltip").css({left:l.left+h-$(window).scrollLeft()-p+12,top:l.top-parseInt($("#jchat_users_informations_tooltip").height())-5-$(window).scrollTop()+"px"}),$("#jchat_users_informations_tooltip").fadeIn(200)}function hoverSidebarTooltips(t,a){$("#jchat_tooltip").length>0?$("#jchat_tooltip .jchat_tooltip_content").html(a):$(jchatTargetElement).append('<div id="jchat_tooltip"><div class="jchat_tooltip_content">'+a+"</div></div>");var e=$(t).offset(),s=$(t).width(),o=$("#jchat_tooltip").width();$("#jchat_tooltip").css({top:e.top-28-$(window).scrollTop(),left:e.left+s-$(window).scrollLeft()-o+12}),$("#jchat_tooltip").fadeIn(200),(!0!==avatarUploadEnabled||isGuest&&!allowGuestAvatarupload)&&$("#jchat_avatar").remove(),(!skypeEnabled||isGuest&&!allowGuestSkypeBridge)&&$("div.jchat_skype").nextAll().remove().end().remove(),isGuest&&allowGuestOverrideName||$("div.jchat_override_name").next().remove().end().remove()}function avatarTooltip(t,a,e){var s="";$(t).parents("div.jchat_chatboxmessage").hasClass("selfmessage")||(s="selfmessage"),void 0===a&&(a=""),$(t).parent().append('<div id="jchat_avatartooltip" class="'+s+'"><div class="jchat_tooltip_content"></div></div>');var o="";void 0!==e&&(o='<br/><span class="jchat_time_details">'+e+"</span>"),$("#jchat_avatartooltip .jchat_tooltip_content").html(a+o);var i=$(t).offset(),n=$(t).width(),c=jchatGetPageScroll(),r=$("#jchat_avatartooltip").width();s&&(r=-35),$("#jchat_avatartooltip").css({top:i.top-parseInt(c[1]),left:i.left+n-$(window).scrollLeft()-r-35,"z-index":10002}),$("#jchat_avatartooltip").fadeIn(200)}function avatarUploadTooltip(t){$(t).before('<div class="jchat_avatar_upload_tooltip"></div>').before('<div class="jchat_overlay"></div>'),$("div.jchat_overlay").fadeIn(300),$(".jchat_avatar_upload_tooltip").append('<div class="jchat_tooltip_header jchat_tooltip_avatar_upload_header">'+jchat_manage_avatars+"</div>"),$(".jchat_avatar_upload_tooltip").click(function(){$(t).trigger("click"),$("div.jchat_overlay").remove()}),$(".jchat_avatar_upload_tooltip").append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",margin:"25% 38%",width:"64px"}),$(".jchat_avatar_upload_tooltip").append('<iframe id="avatarUpload_iframe" scrolling="no" src="'+htmlLiveSite+'&task=avatar.display"></iframe>'),$("#avatarUpload_iframe").on("load",function(){setTimeout(function(){$(".jchat_avatar_upload_tooltip img").remove()},1)}),$(".jchat_avatar_upload_tooltip").show().css("z-index",10002)}function chatroomAdderTooltip(t){$(t).parents("#jchat_roomstooltip").append('<div class="jchat_chatroom_adder_tooltip"></div><div class="jchat_overlay"></div>'),$("div.jchat_overlay").fadeIn(300),$(".jchat_chatroom_adder_tooltip").append('<div class="jchat_tooltip_header jchat_tooltip_chatroom_adder_header">'+jchat_addnew_chatroom+"</div>"),$(".jchat_tooltip_chatroom_adder_header").click(function(){$("div.jchat_overlay, div.jchat_chatroom_adder_tooltip").remove()}),$(".jchat_chatroom_adder_tooltip").append('<div id="chatroom_adder"></div>');var a=$("<form/>").attr("name","chatroomform").attr("id","chatroomform").attr("class","ajaxform");$("#chatroom_adder").append(a);var e=$("<label/>").text(jchat_lamform_required).attr("class","jchat_label_validate"),s=$("<label/>").text(jchat_chatroomform_name).attr("class","jchat_label_title"),o=$("<input/>").attr("name","chatroom_name").attr("data-validation","required");$(a).append(s).append($(e.clone(!0))).append(o);var i=$("<label/>").text(jchat_chatroomform_description).attr("class","jchat_label_title"),n=$("<textarea/>").attr("name","chatroom_description");$(a).append(i).append(n);var c=$("<label/>").text(jchat_chatroomform_accesslevel).attr("class","jchat_label_title"),r=$("<select/>").attr({id:"chatroom_access",name:"chatroom_access"});$.each(joomlaAccessLevels,function(t,a){if(-1==$.inArray(parseInt(a.value),userAccessLevels))return!0;var e=1==parseInt(a.value)?'selected="selected"':"";$(r).append("<option "+e+' value="'+a.value+'">'+a.text+"</option>")}),$(a).append(c).append($(e.clone(!0))).append(r);var l=$("<div/>").text(jchat_chatroomform_submit).attr("class","jchat_submit_chatroom_form");$(a).append(l),$(l).on("click",function(t){var e=$("input[name=chatroom_name]",a).val(),s=$("textarea[name=chatroom_description]",a).val(),o=$("#chatroom_access",a).val();if(jchatValidateForm("#chatroomform *[data-validation^=required]")){$("#chatroom_adder").append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",top:"10%",left:"38%",width:"64px"}).addClass("waiter");var i={newroom_name:e,newroom_description:s,newroom_access:o,task:"stream.saveEntity"};$.ajax({type:"post",url:jsonLiveSite,dataType:"json",context:this,data:i}).done(function(t){if(t.storing.status){injectFloatingMsg(jchat_success_storing_chatroom);var o=$(a).get(0);$.each(o,function(t,a){$(a).val("")}),$("div.jchat_noroom").remove();var i=$("<div/>").attr("class","jchat_room"),n=deleteChatrooms&&allowChatroomsDeletion?'<span data-roomid="'+t.storing.chatroomid+'" class="jchat_roomdelete"></span>':"";e=e.length<chatRoomLength?e:e.substr(0,chatRoomLength)+"...",i.html('<div class="jchat_roomleft"><div class="jchat_roomname" data-text="'+s+'">'+e+n+'</div><div class="jchat_roomcount" data-roomcountid="'+t.storing.chatroomid+'">'+jchat_chatroom_users+'0</div></div><div class="jchat_roomright"><div class="jchat_roomjoin" data-roomid="'+t.storing.chatroomid+'" data-name="'+e+'">'+jchat_chatroom_join+"</div></div>"),$("div.jchat_roomslist").append(i).scrollTop($("div.jchat_roomslist")[0].scrollHeight),$("div.jchat_roomjoin").on("click",chatRoomsJoiner),$("span.jchat_roomdelete[data-roomid="+t.storing.chatroomid+"]").on("click",chatRoomsDeleter),$(".jchat_tooltip_chatroom_adder_header").trigger("click")}else injectFloatingMsg(t.storing.details)}).always(function(){$("#chatroom_adder img.waiter").remove()})}})}function emoticonsTooltip(t,a,e,s){var o="",i="";s?o=' data-wall="1" ':i=' data-userid="'+e+'" ';var n=!1,c=$(t).parents(".jchat_tabpopup.jchat_tabopen");($(c).hasClass("maximized")||$(window).width()<=360)&&(n=!0),$(t).before("<div"+i+o+' class="jchat_emoticonstooltip"></div>');var r=new Array,l=0;$.each(window.jchat_emoticons,function(t,a){t>0&&t%10==0&&l++,void 0===r[l]&&(r[l]=""),r[l]+='<img class="jchat_emoticons" title="'+a.keycode+'" src="'+jchat_livesite+a.path+'"/>'}),$(".jchat_tooltip_header",a).click(function(){$(t).trigger("click")}),$.each(r,function(t,e){$(".jchat_emoticonstooltip",a).append('<div class="jchat_tooltip_content">'+e+"</div>")});var h=$(t).offset(),p=$(t).innerWidth(),_=jchatGetPageScroll(),d=216;n&&(d=p),$(".jchat_emoticonstooltip",a).css("top",h.top-parseInt(_[1])-134).css("left",h.left-$(window).scrollLeft()-d+p).css("display","block").css("z-index",10002),$(".jchat_emoticonstooltip img",a).click(function(a){var e,s,o=$(this).parent().parent().prevAll(".jchat_tabcontentinput").children("div"),i=$(o).get(0);if($.support.leadingWhitespace&&isContentEditable){var n=$(this).clone();$("br:last-child",o).remove(),$(o).append(n)}else if(isContentEditable){c=" "+$(this).attr("title");$(o).append(c)}else{var c=" "+$(this).attr("title");o=$(this).parent().parent().prev().children("textarea"),$(o).val($(o).val()+c)}document.createRange?((e=document.createRange()).selectNodeContents(i),e.collapse(!1),(s=window.getSelection()).removeAllRanges(),jchatHasTouch()||s.addRange(e)):document.selection&&((e=document.body.createTextRange()).moveToElementText(i),e.collapse(!1),jchatHasTouch()||e.select()),jchatHasTouch()||o.focus(),(jchatHasTouch()||autoClosePopups)&&$(t).trigger("click")}),jchatHasTouch()||$("div.jchat_textarea").focus()}function chatroomUsersInformationsTooltip(t,a,e,s){var o=$(t).offset(),i=$(t).width(),n=jchatGetPageScroll(),c=!1,r=$(t).parents(".jchat_tabpopup.jchat_tabopen");($(r).hasClass("maximized")||$(window).width()<=360)&&(c=!0),$(t).before('<div class="jchat_chatroom_usersinfo_tooltip"><span class="jchat_tab">'+jchat_users_inchatroom+'</span><div id="jchat_chatroom_userslist"><ul></ul></div></div>');var l="",h="",p=$("#jchat_chatroom_userslist ul"),_=!(!usersBanning||!(!isGuest||isGuest&&allowGuestBanning)||"private_public"!=usersBanningMode);$.each(currentScopedUsers,function(t,a){if(0!=parseInt(t)&&_){var e=!!parseInt($("div.jchat_userlist span.jchat_banning[data-userid="+t+"]").data("banned"));l='<span class="jchat_banning'+(e?" banned":"")+'" data-userid="'+t+'"></span>'}0!=parseInt(t)&&enableModeration&&userPermissions.moderation_groups&&(h='<span class="jchat_ban_moderator" data-userid="'+t+'"></span>');var s=a.length<chatLength?a:a.substr(0,chatLength)+"...";p.append('<li data-userid="'+t+'">'+s+h+l+"</li>"),t&&$("#jchat_chatroom_userslist li").on("click",function(t){var a=$(this).data("userid");$("#jchat_userlist_"+a).trigger("click")})}),$("#jchat_chatroom_userslist span.jchat_banning").on("click",function(t){$(this).toggleClass("banned");var a=$(this).data("userid");return $("span.jchat_banning[data-userid="+a+"]").trigger("dblclick",[this]),!1}),$("#jchat_chatroom_userslist span.jchat_ban_moderator").on("click",function(t){$(this).toggleClass("banned");var a=$(this).data("userid");return $("span.jchat_ban_moderator[data-userid="+a+"]").trigger("dblclick"),setTimeout(function(t){$(t).parent("li").slideUp(250)},500,this),!1});var d=$(".jchat_chatroom_usersinfo_tooltip",a).outerWidth();c&&(d=i),$(".jchat_chatroom_usersinfo_tooltip",a).css("top",o.top-parseInt(n[1])-152).css("left",o.left-$(window).scrollLeft()-d+i).css("display","block").css("z-index",10002)}function addChatRoomsUsersDetails(t,a){var e=3;if("module"==renderingMode&&(e=2),showChatroomsUsersDetails){var s=$("div [data-roomcountid="+t.id+"]"),o="";a&&(o+=my_username+", "),t.users&&$.each(t.users,function(a,s){o+=s+", ",(a+1)%e==0&&a+1<t.users.length&&(o+="<br/>")}),s.data("text",o.slice(0,-2))}}function roomsTooltip(t,a,e){if($(t).before('<div id="jchat_roomstooltip" class="jchat_roomstooltip"><span id="jchat_roomsdragger" class="jchat_tab"><span class="jchat_rooms_title">'+jchat_available_rooms+'</span></span><div class="jchat_roomslist"></div></div>'),addChatrooms&&allowChatroomsCreation&&$("#jchat_roomstooltip span.jchat_tab").append('<div class="jchat_chatrooms_adder"></div>'),$("#jchat_roomstooltip span.jchat_tab").append('<div class="jchat_closebox_bottom"></div>'),$("#jchat_roomstooltip span.jchat_tab .jchat_closebox_bottom").on("click",function(){$(".jchat_trigger_room","#jchat_wall_popup").trigger("click")}),$("#jchat_roomstooltip div.jchat_chatrooms_adder").on("click",function(){chatroomAdderTooltip(this)}),jchatHasTouch()&&$("#jchat_roomstooltip span.jchat_tab").css("background-position","97% -851px"),$.isArray(roomsAvailable)){var s=$("<div/>").attr("class","jchat_room jchat_noroom");s.html('<div class="jchat_roomname">'+jchat_noavailable_rooms+"</div>"),$(".jchat_roomslist",a).append(s)}else $.each(roomsAvailable,function(t,e){var s=!(e.id!=currentJoinedChatRoom),o="";deleteChatrooms&&allowChatroomsDeletion&&(o=0==e.numusers?'<span data-roomid="'+e.id+'" class="jchat_roomdelete"></span>':"");var i=$("<div/>").attr("class","jchat_room");e.name=e.name.length<chatRoomLength?e.name:e.name.substr(0,chatRoomLength)+"...",i.html('<div class="jchat_roomleft"><div class="jchat_roomname" data-text="'+e.description+'">'+e.name+o+'</div><div class="jchat_roomcount" data-roomcountid="'+e.id+'">'+jchat_chatroom_users+e.numusers+'</div></div><div class="jchat_roomright"><div class="jchat_roomjoin" data-roomid="'+e.id+'" data-name="'+e.name+'">'+jchat_chatroom_join+"</div></div>"),$(".jchat_roomslist",a).append(i),s&&$("div[data-roomid="+currentJoinedChatRoom+"]").addClass("jchat_joined").data("joined",!0).text(jchat_chatroom_joined),addChatRoomsUsersDetails(e,s)}),$("div.jchat_roomjoin").on("click",chatRoomsJoiner),$("span.jchat_roomdelete").on("click",chatRoomsDeleter);var o=!1,i=$(t).parents(".jchat_tabpopup.jchat_tabopen");($(i).hasClass("maximized")||$(window).width()<=360)&&(o=!0);var n=$(t).offset(),c=$(t).innerWidth(),r=jchatGetPageScroll(),l=$(".jchat_roomstooltip",a).width()+2;o&&(l=c),$(".jchat_roomstooltip",a).css("top",n.top-parseInt(r[1])-232).css("left",n.left-$(window).scrollLeft()-l+c).css("display","block").css("z-index",10002),$("#jchat_roomstooltip").draggable({handle:"#jchat_roomsdragger",start:function(t,a){$(this).addClass("dragging")},stop:function(t,a){$(this).removeClass("dragging")}}),jchatInitTouchEvents($("#jchat_roomsdragger").get(0))}function chatRoomsJoiner(t){var a=$(this).data("roomid");if($(this).data("joined"))$(this).removeClass("jchat_joined").data("joined",!1),$(this).text(jchat_chatroom_join),$(".jchat_userstabtitle","#jchat_wall_popup").next(".jchat_userstabsubtitle").remove(),currentJoinedChatRoom=null,a=null;else{$(".jchat_roomjoin").removeClass("jchat_joined").data("joined",!1).text(jchat_chatroom_join),$(".jchat_userstabtitle","#jchat_wall_popup").next(".jchat_userstabsubtitle").remove(),$(this).addClass("jchat_joined").data("joined",!0),$(this).text(jchat_chatroom_joined);var e=$(this).data("name");currentJoinedChatRoom=a;var s=$("<div/>").addClass("jchat_userstabsubtitle").html('<span class="jchat_roomtitle">'+jchat_chatroom+"</span> "+e);$(".jchat_userstabtitle","#jchat_wall_popup").after(s),$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7),$("span.jchat_roomdelete[data-roomid="+a+"]").remove()}autoClearConversation&&$("div.jchat_chatboxmessage","#jchat_wall_popup").remove(),(jchatHasTouch()||autoClosePopups)&&setTimeout(function(){$(".jchat_trigger_room","#jchat_wall_popup").trigger("click")},500),$.post(jsonLiveSite,{roomid:a,task:"stream.saveEntity"},function(t){a&&chatRoomLatestMessages&&restartUpdateSession("buddylist","1"),wallHistoryDelayAutoload&&($("#jchat_wall_popup div.jchat_trigger_history_wall").trigger("click",[!0]),window.sessionStorage.removeItem("wall_autoload_history"),a||window.sessionStorage.setItem("wall_autoload_history",1)),t.storing.status||showDebugMsgs(t.storing.details)})}function chatRoomAutoJoiner(t){var a=null;if($.each(roomsAvailable,function(e,s){if(t==s.id)return a=s.name,!1}),a){var e=$("<div/>").addClass("jchat_userstabsubtitle").html('<span class="jchat_roomtitle">'+jchat_chatroom+"</span> "+a);$(".jchat_userstabtitle","#jchat_wall_popup").after(e),$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7),autoClearConversation&&$("div.jchat_chatboxmessage","#jchat_wall_popup").remove(),currentJoinedChatRoom=t,setTimeout(function(){$.post(jsonLiveSite,{roomid:t,silentJoin:!0,task:"stream.saveEntity"},function(t){chatRoomLatestMessages&&restartUpdateSession("buddylist","1"),wallHistoryDelayAutoload&&($("#jchat_wall_popup div.jchat_trigger_history_wall").trigger("click",[!0]),window.sessionStorage.removeItem("wall_autoload_history")),t.storing.status||showDebugMsgs(t.storing.details)})},500)}}function chatRoomsDeleter(){var t=parseInt($(this).data("roomid"));$.post(jsonLiveSite,{todeleteroomid:t,task:"stream.saveEntity"},function(a){a.storing.status?($("div[data-roomid="+t+"]").parents("div.jchat_room").slideUp().promise().done(function(){if($(this).remove(),!$("div.jchat_roomslist div.jchat_room").length){var t=$("<div/>").attr("class","jchat_room jchat_noroom");t.html('<div class="jchat_roomname">'+jchat_noavailable_rooms+"</div>"),$("div.jchat_roomslist").append(t)}}),injectFloatingMsg(jchat_success_deleting_chatroom)):showDebugMsgs(a.storing.details)})}function uploadFileTooltip(t,a,e,s){var o=!1,i=$(t).parents(".jchat_tabpopup.jchat_tabopen");($(i).hasClass("maximized")||$(window).width()<=360)&&(o=!0),$(t).before('<div data-userid="'+e+'" class="jchat_fileuploadtooltip"></div>'),$(".jchat_fileuploadtooltip",a).append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",margin:"10px 46%",width:"32px"}),$(".jchat_fileuploadtooltip",a).append('<iframe id="fileupload_iframe"  scrolling="no" src="'+htmlLiveSite+"&task=attachments.display&to="+e+"&tologged="+s+'"></iframe>'),$("#fileupload_iframe",a).on("load",function(){setTimeout(function(){$(".jchat_fileuploadtooltip img",a).remove()},1)});var n=$(t).offset(),c=$(t).innerWidth(),r=jchatGetPageScroll(),l=$(".jchat_fileuploadtooltip",a).width()+2;o&&(l=c),$(".jchat_fileuploadtooltip",a).css("top",n.top-parseInt(r[1])-59).css("left",n.left-$(window).scrollLeft()-l+c).css("display","block").css("z-index",10002),jchatHasTouch()||$("div.jchat_textarea").focus()}function webrtcTooltip(t,a,e,s,o,i){if(!$(t).hasClass("jchat_webrtc_disabled")){$(".jchat_trigger_webrtc",a).trigger("mouseout");var n=300,c=!1,r=$(t).parents(".jchat_tabpopup.jchat_tabopen");$(r).hasClass("maximized")&&(c=!0);l="";if(recordingEnabled&&userPermissions.allow_media_recorder){var l=" jchat_large_recording";n+=50}$(t).before('<div dir="ltr" data-peerid="'+e+'" class="jchat_webrtctooltip'+l+'"><span id="jchat_webrtcdragger" class="jchat_tab">'+jchat_webrtc_videochat+'<div class="jchat_closebox_bottom"></div><span id="jchat_maximize_webrtc" class="jchat_maximize_webrtc"></span></span></div>'),$(".jchat_webrtctooltip span.jchat_tab .jchat_closebox_bottom").on("click",function(){$(".jchat_trigger_webrtc","#jchat_user_"+e+"_popup").trigger("click")}),jchatHasTouch()&&$(".jchat_webrtctooltip  span.jchat_tab").css("background-position","90% -851px");var h=webrtcDirector.initializeVideo($(".jchat_webrtctooltip",a),e,s,o);h&&webrtcDirector.callee&&webrtcDirector.setCalleeRingingButton(),h&&recorderDirector&&recordingEnabled&&userPermissions.allow_media_recorder&&recorderDirector.initializeVideo($(".jchat_webrtctooltip",a),i,my_username);var p=$(t).offset(),_=$(t).innerWidth(),d=jchatGetPageScroll(),u=$(".jchat_webrtctooltip",a).width()+12;c&&(u=_),$(".jchat_webrtctooltip",a).css("top",p.top-parseInt(d[1])-n).css("left",p.left-$(window).scrollLeft()-u+_).css("display","block").css("z-index",10002),refreshStream(),$("div[data-peerid="+e+"] .jchat_maximize_webrtc").on("hover",function(){$(this).toggleClass("jchat_maximizebox_bottomhover")}),$("div[data-peerid="+e+"] .jchat_maximize_webrtc").toggle(function(t){var a=$(this).parents("div[data-peerid="+e+"]"),s=(window.innerHeight?window.innerHeight:$(window).height())-25;$(a).animate({width:"100%",height:s,top:"26px",left:0},{duration:300,easing:"swing",start:function(){$(this).addClass("fullscreen")},progress:function(t){$("#jchat_localvideo_placeholder, #jchat_remotevideo_placeholder").height($("#jchat_localvideo").height())},complete:function(){$("#jchat_webrtcdragger").css({width:"100%"})}}),$(this).addClass("maximized");var o=function(){var t=(window.innerHeight?window.innerHeight:$(window).height())-42;$(".jchat_webrtctooltip","#jchat_user_"+e+"_popup").height(t)};return $(window).on("resize.jchat",function(t){o()}),t.stopPropagation(),!1},function(t){var a=$(this).parents("div[data-peerid="+e+"]");return $(a).animate({width:"520px",height:n+"px",top:"50%",left:"50%","margin-left":"-260px","margin-top":"-150px"},{duration:300,easing:"swing",start:function(){$("#jchat_webrtcdragger").hide(),a.removeClass("fullscreen")},progress:function(t){$("#jchat_localvideo_placeholder, #jchat_remotevideo_placeholder").height($("#jchat_localvideo").height())},complete:function(){$("#jchat_webrtcdragger").css({width:"520px"}),$("#jchat_webrtcdragger").show(),$(this).css("margin",0),popupsReposition(!0)}}),$(this).removeClass("maximized"),$("#jchat_localvideo_placeholder, #jchat_remotevideo_placeholder").height($("#jchat_localvideo").height()),$(window).off("resize.jchat"),t.stopPropagation(),!1}),$(".jchat_webrtctooltip","#jchat_user_"+e+"_popup").draggable({handle:"#jchat_webrtcdragger",start:function(t,a){$(this).addClass("dragging")},stop:function(t,a){$(this).removeClass("dragging")}}),jchatDetectMobileDevice(videochatAutoMaximize)&&$(".jchat_webrtctooltip #jchat_maximize_webrtc","#jchat_user_"+e+"_popup").trigger("click"),resizableChatboxes&&!jchatHasTouch()&&$(".jchat_webrtctooltip","#jchat_user_"+e+"_popup").resizable({handles:"se",minHeight:300,minWidth:520,aspectRatio:!0,start:function(t,a){},stop:function(t,a){var e=parseInt($(this).innerWidth()+2),s=parseInt($(this).innerHeight()+2);520==e&&300==s&&$(this).removeClass("fullscreen")},resize:function(t,a){var s=parseInt($(this).innerWidth()+2),o=parseInt($(this).innerHeight()+2);s>520&&o>300&&$(this).addClass("fullscreen"),$("#jchat_localvideo_placeholder, #jchat_remotevideo_placeholder").height($("#jchat_localvideo").height()),$("#jchat_webrtcdragger","#jchat_user_"+e+"_popup").innerWidth(s-2)}}),jchatInitTouchEvents($("#jchat_webrtcdragger").get(0))}}function infoGuestTooltip(t,a,e){$(t).before('<div data-userid="'+e+'" class="jchat_infoguesttooltip"></div>');new Array;$.ajax({url:jsonLiveSite,data:{guestsession:e,task:"stream.showEntity"},type:"get",cache:!1,dataType:"json",success:function(t){if(!t.status)return showDebugMsgs(t.details),!1;$.each(t.details,function(t,a){t=t.charAt(0).toUpperCase()+t.slice(1)+":",a=a||"-",$(".jchat_infoguesttooltip").append('<div class="jchat_infoguest_title">'+t+"</div>"),$(".jchat_infoguesttooltip").append('<div class="jchat_infoguest_value">'+a+"</div>")})}});var s=!1,o=$(t).parents(".jchat_tabpopup.jchat_tabopen");$(o).hasClass("maximized")&&(s=!0);var i=$(t).offset(),n=$(t).innerWidth(),c=jchatGetPageScroll(),r=$(".jchat_infoguesttooltip",a).width()+2;s&&(r=n),$(".jchat_infoguesttooltip",a).css("top",i.top-parseInt(c[1])-201).css("left",i.left-$(window).scrollLeft()-r+n).css("display","block").css("z-index",10002)}function historyTooltip(element,context,identifier,logged_identifier){$(element).before('<div data-userid="'+identifier+'" data-loggedid="'+logged_identifier+'" class="jchat_historytooltip"></div>');var periodsAvailable=new Array("1d","1w","1m","3m","6m","1y");$(".jchat_historytooltip","#jchat_user_"+identifier+"_popup").append('<div id="jchat_select_period">'+jchat_select_period+"</div>"),$.each(periodsAvailable,function(index,period){$(".jchat_historytooltip","#jchat_user_"+identifier+"_popup").append('<div data-value="'+period+'" class="jchat_single_period">'+eval("jchat_period_"+period)+"</div>")}),$("div.jchat_single_period").on("click",function(t){var a=$(this).parent().data("loggedid"),e=$(this).data("value"),s=null,o=$(this).parents("div.jchat_tabcontent.messagelist").find("div.jchat_tabcontenttext.private div.jchat_chatboxmessage:first-child").attr("id");o&&(s=o.split("_")[2]),fetchHistoryMessages(a,$(this).parent().data("userid"),e,s),(jchatHasTouch()||autoClosePopups)&&$(element).trigger("click")});var ab=$(element).offset(),Y=$(element).width(),windowScroll=jchatGetPageScroll(),mixed=$(".jchat_historytooltip",context).width();$(".jchat_historytooltip",context).css("top",ab.top-parseInt(windowScroll[1])-161).css("left",ab.left-$(window).scrollLeft()-mixed+18).css("display","block").css("z-index",10002)}function geolocationTooltip(t,a,e,s){var o=$(t).offset(),i=$(t).width(),n=jchatGetPageScroll(),c={geoip:"https://geoip.nekudo.com/api/",ipinfo:"http://ipinfo.io/",freegeoip:"https://freegeoip.net/json/"}[geolocationService],r=!1,l=$(t).parents(".jchat_tabpopup.jchat_tabopen");$(l).hasClass("maximized")&&(r=!0),gMapReference[e]||($(t).before('<div data-userid="'+e+'" class="jchat_geolocationtooltip"><div class="jchat_gmap" id="jchat_gmap_'+e+'"></div></div>'),$.get(c+s.geoip,function(t){if(void 0!==t.location)var a=t.location.latitude,s=t.location.longitude;else if(void 0!==t.loc)var a=t.loc.split(",")[0],s=t.loc.split(",")[1];else if(void 0!==t.latitude&&void 0!==t.longitude)var a=t.latitude,s=t.longitude;else var a=40.73061,s=-73.935242;gMapReference[e]=new GMaps({div:"#jchat_gmap_"+e,lat:a,lng:s,zoom:5,zoomControl:!0,zoomControlOpt:{style:"SMALL",position:"TOP_LEFT"},panControl:!0,streetViewControl:!0,mapTypeControl:!0,overviewMapControl:!0}),gMapReference[e].setCenter(a,s),gMapReference[e].addMarker({lat:a,lng:s})},"jsonp"));var h=$(".jchat_geolocationtooltip",a).outerWidth();r&&(h=i),$(".jchat_geolocationtooltip",a).css("top",o.top-parseInt(n[1])-302).css("left",o.left-$(window).scrollLeft()-h+i).css("display","block").css("z-index",10002)}function suggestionTooltip(t){$("#jchat_default_suggestion_tooltip").length>0?$("#jchat_default_suggestion_tooltip .jchat_tooltip_content").html(defaultSuggestionText):($("body").append('<div id="jchat_default_suggestion_tooltip" dir="ltr"><div id="jchat_tooltip_close"></div><div class="jchat_tooltip_content">'+defaultSuggestionText+'</div><div class="jchat_tooltip_pointer"></div></div>'),"arm"==chatTemplateTooltip&&$("#jchat_default_suggestion_tooltip").addClass("jchat_arm"),"skrilled"==chatTemplateTooltipVariant&&$("#jchat_default_suggestion_tooltip, #jchat_default_suggestion_tooltip .jchat_tooltip_content, #jchat_tooltip_close").addClass("jchat_skrilled"));var a=$("#jchat_userstab");"module"!=renderingMode||"bottom"!=baloonPosition||separateWidgets||(a=$("#jchat_target"));var e=a.offset(),s=a.width()+30,o=jchatGetPageScroll();setTimeout(function(){e=a.offset(),s=a.width()+30,o=jchatGetPageScroll()},0),setTimeout(function(){$("#jchat_base").length&&($("#jchat_base:visible").length&&$("#jchat_default_suggestion_tooltip").css("top",e.top-parseInt(o[1])-parseInt($("#jchat_default_suggestion_tooltip").height())-30).css("left",e.left-$(window).scrollLeft()+18),(!$.jStorage.get("default_suggestion")&&!$("#jchat_userstab").hasClass("jchat_tabclick")||t)&&$("#jchat_default_suggestion_tooltip").show())},500),t&&($("#jchat_default_suggestion_tooltip").css({left:"auto",top:"auto",bottom:"20px",right:"10px"}).attr("data-link",chatFormLink),$(document).off("click","#jchat_default_suggestion_tooltip"),$(document).on("click","#jchat_default_suggestion_tooltip",function(t){window.location.href=$(this).data("link")}))}function sendMessage(Z,textareaElement,userid,loggedid,notOpen){if(13==Z.keyCode&&0==Z.shiftKey){var message=eval("$(textareaElement)."+valFunction+"()");message=message.replace(/^\s+|\s+$/g,""),message=html_entity_decode(message,"ENT_QUOTE"),message=message.replace(/<a\b[^>]*>|<\/a>/gi,"");var linksArray=message.match(/([^">=]http|[^">]https|^http|^https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi);if(null!==linksArray&&linksArray.length>0&&$.each(linksArray,function(t,a){message=message.replace(a,'<a target="_blank" href="'+a.trim()+'">'+a+"</a>")}),"videomessage"!=Z.which&&(message=jchatStripTags(message,allowMediaObjects,!0),message=jchatDetectImages(message),message=jchatDetectVideos(message),message=$.jchatEmoticons(message)),wordsBanning&&wordsBanned&&"videomessage"!=Z.which){var words=wordsBanned.split(","),cleanedWords=new Array;$.each(words,function(t,a){$.inArray(a,["ass","src","title"])>=0&&(a+=" "),cleanedWords.push(a)}),message=message.replace(new RegExp(cleanedWords.join("|"),"g"),"*"+wordsBannedReplacement+"*")}eval("$(textareaElement)."+valFunction+'("")'),$(textareaElement).hasClass("jchat_noresize")||($(textareaElement).css("height","22px"),$(textareaElement).css("overflow-y","hidden"));var thisPopupHeight=popupDimensions[userid]?popupDimensions[userid].height+11:defaultPopupHeight;if(resizableChatboxes&&!jchatHasTouch()&&$("#jchat_user_"+userid+"_popup").resizable("enable"),$("#jchat_user_"+userid+"_popup .jchat_tabcontenttext").css("height",parseInt(thisPopupHeight-11)+"px"),jchatHasTouch()?($(textareaElement).blur(),$("body").focus()):$(textareaElement).focus(),""!=message&&"<br>"!=message){$("span.jchat_messaging.msg_seen, div.jchat_agent_dummy_message").remove(),$("span.msg_seen","#jchat_user_"+userid+"_popup").remove();var postObject={to:userid,tologged:loggedid,message:message,task:"stream.saveEntity"},languageTranslationObject={};languageTranslationEnabled&&void 0!==popupLanguages[userid]&&(languageTranslationObject.sourcelang=popupLanguages[userid].sourcelang||defaultLanguage,languageTranslationObject.targetlang=popupLanguages[userid].targetlang||defaultTranslateToLanguage,languageTranslationObject.lang_switch_enabled=popupLanguages[userid].lang_switch_enabled||0,postObject=$.extend(postObject,languageTranslationObject),translateSelfMessages&&postObject.lang_switch_enabled&&postObject.sourcelang!=postObject.targetlang&&(message='<img class="clessidra" src="'+jchat_livesite+'components/com_jchat/images/default/loading.gif"/>'+message)),"before"!=asyncSendMessage||notOpen||($(".jchat_chatboxmessage.dummy_typing","#jchat_user_"+userid+"_popup").remove(),$("#jchat_userlist_"+userid).trigger("addmessage",[message,"1","1","temp",{time:""}]),userid&&$("#jchat_user_"+userid+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+userid+"_popup .jchat_tabcontenttext")[0].scrollHeight)),$.post(jsonLiveSite,postObject,function(t){if(!t.storing.status)return showDebugMsgs(t.storing.details),!1;void 0!==t.storing.translatedmessage&&(message=t.storing.translatedmessage),$(".jchat_chatboxmessage.dummy_typing","#jchat_user_"+userid+"_popup").remove(),$("#jchat_message_temp","#jchat_user_"+userid+"_popup").remove();var a=t.storing.details.id,e=t.storing.details.time;a&&!notOpen&&($("#jchat_userlist_"+userid).trigger("addmessage",[message,"1","1",a,{time:e}]),userid&&$("#jchat_user_"+userid+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+userid+"_popup .jchat_tabcontenttext")[0].scrollHeight)),sendAppendPrivateMessage(loggedid,a,message,!0),refreshStream()},"json"),typingEnabled&&timeoutID&&(clearTimeout(timeoutID),timeoutID=null,s.typing=0,s.typing_to=null,b("updatesession","1"))}return!1}typingEnabled&&(s.typing=1,s.typing_to=userid,b("updatesession","1"),timeoutID&&clearTimeout(timeoutID),timeoutID=setTimeout(function(){clearTimeout(timeoutID),timeoutID=null,s.typing=0,s.typing_to=null,b("updatesession","1")},K/2))}function sendWallMessage(Z,Y){if(13==Z.keyCode&&0==Z.shiftKey){var message=eval("$(Y)."+valFunction+"()");message=message.replace(/^\s+|\s+$/g,""),message=html_entity_decode(message,"ENT_QUOTE"),message=message.replace(/<a\b[^>]*>|<\/a>/gi,"");var linksArray=message.match(/([^">=]http|[^">]https|^http|^https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi);if(null!==linksArray&&linksArray.length>0&&$.each(linksArray,function(t,a){message=message.replace(a,'<a target="_blank" href="'+a.trim()+'">'+a+"</a>")}),message=jchatStripTags(message,allowMediaObjects,!0),message=jchatDetectImages(message),message=jchatDetectVideos(message),message=$.jchatEmoticons(message),wordsBanning&&wordsBanned){var words=wordsBanned.split(","),cleanedWords=new Array;$.each(words,function(t,a){$.inArray(a,["ass","src","title"])>=0&&(a+=" "),cleanedWords.push(a)}),message=message.replace(new RegExp(cleanedWords.join("|"),"g"),"*"+wordsBannedReplacement+"*")}var testomessaggio=message.replace(/&/gi,"&amp;");if(eval("$(Y)."+valFunction+'("")'),$(Y).css("height","22px"),$(Y).css("overflow-y","hidden"),jchatHasTouch()?($(Y).blur(),$("body").focus()):$(Y).focus(),popupsReposition(),""!=message&&"<br>"!=message){if("before"==asyncSendMessage){if(void 0!==my_avatar&&null!==my_avatar&&""!==my_avatar)var tempPlaceholder='<img width="32px" height="32px" src="'+my_avatar+'" />';else var tempPlaceholder="<strong>"+my_username+"</strong>";$("#jchat_wall_popup div.jchat_tabcontenttext").append('<div class="jchat_chatboxmessage selfmessage" id="jchat_message_publictemp"><span class="jchat_chatboxmessagefrom">'+tempPlaceholder+'</span><span class="jchat_chatboxmessagecontent selfmessage">'+testomessaggio+"</span></div>")}$.post(jsonLiveSite,{to:"wall",message:message,task:"stream.saveEntity"},function(t){if(!t.storing.status)return showDebugMsgs(t.storing.details),!1;$("#jchat_message_publictemp","#jchat_wall_popup").remove();var a=t.storing.details.id,e=t.storing.details.time;a&&(fromPlaceholder=void 0!==my_avatar&&null!==my_avatar&&""!==my_avatar?'<img alt="'+jchat_you+my_username+'" data-time="'+e+'" width="32px" height="32px" src="'+my_avatar+'" />':'<strong data-time="'+e+'">'+my_username+"</strong>",$("#jchat_message_"+a).length>0||($("#jchat_wall_popup div.jchat_tabcontenttext").append('<div class="jchat_chatboxmessage selfmessage" id="jchat_message_'+a+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent selfmessage">'+testomessaggio+"</span></div>"),$("span.jchat_chatboxmessagefrom img, span.jchat_chatboxmessagefrom strong","#jchat_wall_popup").mouseover(function(t){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(t){$("#jchat_avatartooltip").remove()})),$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight)),refreshStream()},"json")}return!1}}function sendAppendPrivateMessage(t,a,e,s,o){var i=jchatStripTags(e,!1,!0,!0);if(i.length>25&&(i=i.substr(0,22)+"..."),i&&$("li.jchat_userbox[data-userid="+t+"] div.jchat_lastmessage").html('<span class="jchat_lastmessage_icon"></span>'+i),$(".jchat_chatboxmessage.dummy_typing","#jchat_usersmessages").remove(),$("li.jchat_userbox[data-userid="+t+"]").hasClass("jchat_active")){var n="";if(s){var c=jchat_my_username,r=jchat_my_avatar;n=" selfmessage"}else var c=o.fromuser,r=o.avatar;var l='<div class="jchat_chatboxmessage'+n+'" data-messageid="'+a+'"><span class="jchat_chatboxmessagefrom"><img alt="'+c+'" width="32px" height="32px" src="'+r+'"></span><div class="jchat_chatboxmessageinfo"><div class="jchat_chatboxmessagefromname">'+c+'</div><span class="jchat_chatboxmessagecontent'+n+'">'+e+'</span></div><div class="jchat_chatboxmessagedate'+n+'"><div>'+(new Date).toLocaleString()+"</div></div></div>";$("#jchat_usersmessages").append(l),$("#jchat_usersmessages").scrollTop($("#jchat_usersmessages")[0].scrollHeight),$("#jchat_loadolder_messages").show(),$("div.jchat_messaging_info").remove();var h=$("div.jchat_userlist[data-loggedid="+t+"]").length;if("jomsocial"==thirdPartyIntegration&&PMIntegration&&!h&&((_={option:"community",no_html:1,task:"azrul_ajax",func:"inbox,ajaxSend",arg2:'[["subject","'+((p=jchatStripTags(e,!1,!0,!0)).length<chatTitleLength?p:p.substr(0,chatTitleLength)+"...")+'"],["body","'+p+'"],["to",'+t+"]]"})[jchat_form_token]=1,$.ajax({url:jchat_livesite,data:_,type:"post"})),"easysocial"==thirdPartyIntegration&&PMIntegration&&!h){var p=jchatStripTags(e,!1,!0,!0),_={tmpl:"component",format:"ajax",no_html:1,"uid[]":t,message:p,option:"com_easysocial",namespace:"site/controllers/conversations/store"};_[jchat_form_token]=1,$.ajax({url:jchat_livesite,data:_,type:"post"})}}}function sendTicketMessage(t){var a=$("input[name=lam_name]",t).val(),e=$("input[name=lam_email]",t).val(),s=$("textarea[name=lam_message]",t).val();if(jchatValidateForm("#lamform *[data-validation^=required]","#lamform input[data-validation*=email]")){$("#jchat_userstab_popup").append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",top:"10%",left:"38%",width:"64px"}).addClass("waiter");var o={name:a,email:e,message:s};$.ajax({type:"post",url:"index.php?option=com_jchat&task=ticket.saveEntity&format=raw",dataType:"json",context:this,data:o,success:function(a){if(a.storing.status){injectFloatingMsg(jchat_success_send_lamessage);var e=$(t).get(0);$.each(e,function(t,a){$(a).val("")})}else injectFloatingMsg(jchat_error_send_lamessage+a.storing.details)}}).always(function(){$("#jchat_userstab_popup img.waiter").remove()})}}function deleteConversation(t,a){$.post(jsonLiveSite,{from:t,task:"stream.saveEntity"},function(e){a?$("div.jchat_chatboxmessage","#jchat_wall_popup").remove():$("div.jchat_chatboxmessage, span.msg_seen","#jchat_user_"+t+"_popup").remove(),e.storing.status||showDebugMsgs(e.storing.details)})}function getLanguageToolbar(t,a){var e=jchatBuildLanguagesList(),s=e.list,o=e.arrayLanguagesPath,i="#jchat_user_"+t+"_popup";if(a)return $(document).off(".language",i+" span.jchat_source_language,"+i+" span.jchat_target_language"),$(document).off(".language",i+" ul.jchat_languages_list li"),$(document).off(".language",i+" input[id^=jchat_lang_switch]"),$(document).off(".language",i+" span.jchat_translate_arrow"),null;$(document).on("click.language",i+" span.jchat_source_language,"+i+" span.jchat_target_language",function(a){var e=$(this).data("role"),s="jchat_"+$(this).data("role"),o=$("ul.jchat_languages_list","#jchat_user_"+t+"_popup").hasClass(s),i=$("ul.jchat_languages_list","#jchat_user_"+t+"_popup").hasClass("jchat_tabopen");if($("ul.jchat_languages_list, span.jchat_languages_list_pointer","#jchat_user_"+t+"_popup").toggleClass("jchat_tabopen").removeClass("jchat_sourcelang jchat_targetlang").addClass(s).data("role",e),i&&!o&&$(this).trigger("click"),!i){var n=languageFallbacks[e];if(void 0!==popupLanguages[t]&&(n=popupLanguages[t][e]||languageFallbacks[e]),n){var c=$("ul.jchat_languages_list li[data-isocode="+n+"]","#jchat_user_"+t+"_popup");$("ul.jchat_languages_list li","#jchat_user_"+t+"_popup").removeClass("jchat_lang_selected"),c.addClass("jchat_lang_selected");var r=$("ul.jchat_languages_list","#jchat_user_"+t+"_popup"),l=parseInt(c.position().top)+r.scrollTop();r.animate({scrollTop:l},50)}}}),$(document).on("click.language",i+" ul.jchat_languages_list li",function(a){var e=$(this).data("isocode"),s="background-image: url("+jchat_livesite+o[e].path+e+".gif)",i=$(this).parent("ul.jchat_languages_list").data("role");$("div.jchat_toolbarlanguage > span[data-role="+i+"]","#jchat_user_"+t+"_popup").attr("style",s),$("div.jchat_toolbarlanguage > span[data-role="+i+"]","#jchat_user_"+t+"_popup").attr("data-isocode",e),$("ul.jchat_languages_list li","#jchat_user_"+t+"_popup").removeClass("jchat_lang_selected"),$(this).addClass("jchat_lang_selected"),void 0===popupLanguages[t]&&(popupLanguages[t]={}),popupLanguages[t][i]=e,sessionStorage.setItem("popupLanguages",JSON.stringify(popupLanguages))}),$(document).on("change.language",i+" input[id^=jchat_lang_switch]",function(a){void 0===popupLanguages[t]&&(popupLanguages[t]={}),popupLanguages[t].lang_switch_enabled=~~!popupLanguages[t].lang_switch_enabled,sessionStorage.setItem("popupLanguages",JSON.stringify(popupLanguages))}),$(document).on("click.language",i+" span.jchat_translate_arrow",function(a){if(void 0!==popupLanguages[t]){var e=popupLanguages[t].sourcelang||defaultLanguage,s=popupLanguages[t].targetlang||defaultTranslateToLanguage;if(e!=s){popupLanguages[t].sourcelang=s,popupLanguages[t].targetlang=e;var i="background-image: url("+jchat_livesite+o[e].path+e+".gif)";$("div.jchat_toolbarlanguage span[data-role=targetlang]","#jchat_user_"+t+"_popup").attr("style",i),$("div.jchat_toolbarlanguage span[data-role=targetlang]","#jchat_user_"+t+"_popup").attr("data-isocode",e);var n="background-image: url("+jchat_livesite+o[s].path+s+".gif)";$("div.jchat_toolbarlanguage span[data-role=sourcelang]","#jchat_user_"+t+"_popup").attr("style",n),$("div.jchat_toolbarlanguage span[data-role=sourcelang]","#jchat_user_"+t+"_popup").attr("data-isocode",s),sessionStorage.setItem("popupLanguages",JSON.stringify(popupLanguages))}}}),$(document).on("click.language","body > *:not(ul.jchat_languages_list)",function(a){$(a.target).hasClass("jchat_languages_list")||$(a.target).parents("div.jchat_toolbarlanguage").length||$("ul.jchat_languages_list, span.jchat_languages_list_pointer","#jchat_user_"+t+"_popup").removeClass("jchat_tabopen")});var n=' style="background-image: url('+jchat_livesite+o[defaultLanguage].path+defaultLanguage+'.gif)"',c=' style="background-image: url('+jchat_livesite+o[defaultTranslateToLanguage].path+defaultTranslateToLanguage+'.gif)"',r=' data-isocode="'+defaultLanguage+'"',l=' data-isocode="'+defaultTranslateToLanguage+'"',h="";if(void 0!==popupLanguages[t]&&(popupLanguages[t].sourcelang&&(n=' style="background-image: url('+jchat_livesite+o[popupLanguages[t].sourcelang].path+popupLanguages[t].sourcelang+'.gif)"',r=' data-isocode="'+popupLanguages[t].sourcelang+'"'),popupLanguages[t].targetlang&&(c=' style="background-image: url('+jchat_livesite+o[popupLanguages[t].targetlang].path+popupLanguages[t].targetlang+'.gif)"',l=' data-isocode="'+popupLanguages[t].targetlang+'"'),popupLanguages[t].lang_switch_enabled))h=popupLanguages[t].lang_switch_enabled?' checked="checked"':"";return'<div class="jchat_toolbarlanguage"><span class="jchat_langlabel">From</span><span data-role="sourcelang"'+r+' class="jchat_source_language"'+n+'></span><span class="jchat_translate_arrow"></span><span class="jchat_langlabel">To</span><span data-role="targetlang"'+l+' class="jchat_target_language"'+c+'></span><div class="jchat_onoffswitchlang jchat_lang_switcher"><input type="checkbox" name="jchat_onoffswitch" class="jchat_onoffswitch-checkbox" id="jchat_lang_switch_'+t+'"'+h+'><label class="jchat_onoffswitch-label" for="jchat_lang_switch_'+t+'"><span class="jchat_onoffswitch-inner"></span><span class="jchat_onoffswitch-switch"></span></label></div>'+s+"</div>"}function setLanguageSessionvars(){var t={},a=new Array;$.each(openedChatboxes,function(e,s){var o=$("span[data-role=sourcelang]","#jchat_user_"+e+"_popup").attr("data-isocode")||defaultLanguage,i=$("span[data-role=targetlang]","#jchat_user_"+e+"_popup").attr("data-isocode")||defaultTranslateToLanguage,n=!!$("input[name=jchat_onoffswitch]","#jchat_user_"+e+"_popup").prop("checked")||0;t[e]={sourcelanguage:o,targetlanguage:i,translatorstatus:n},a[e]=!0}),$.each(popupLanguages,function(e,s){if(!a[e]&&void 0!==popupLanguages[e]){var o=popupLanguages[e].sourcelang||defaultLanguage,i=popupLanguages[e].targetlang||defaultTranslateToLanguage,n=parseInt(popupLanguages[e].lang_switch_enabled)||0;t[e]={sourcelanguage:o,targetlanguage:i,translatorstatus:n}}}),s.langvars=JSON.stringify(t)}function popup(t,a,e){var s=a.clientHeight;if(94>s){if(s=Math.max(a.scrollHeight,s),(s=Math.min(94,s))>a.clientHeight){$(a).css("height",s+4+"px");var o=popupDimensions[e]?popupDimensions[e].height+11:defaultPopupHeight;$("#jchat_user_"+e+"_popup .jchat_tabcontenttext").css("height",parseInt(o-s+6)+"px"),resizableChatboxes&&!jchatHasTouch()&&$("#jchat_user_"+e+"_popup").resizable("disable")}}else $(a).css("overflow-y","auto");$("#jchat_user_"+e+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+e+"_popup .jchat_tabcontenttext")[0].scrollHeight)}function popupWall(t,a,e){var s=a.clientHeight;94>s?(s=Math.max(a.scrollHeight,s),(s=Math.min(94,s))>a.clientHeight&&($(a).css("height",s+4+"px"),$("#jchat_wall_popup div.jchat_tabcontenttext").height(e-($(".jchat_textarea_wall").height()-22)))):$(a).css("overflow-y","auto"),$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight)}function statusClassOp(){$("#jchat_optionsbutton_popup .offline").css("text-decoration","none"),$("#jchat_optionsbutton_popup .available").css("text-decoration","none"),$("#jchat_userstab_icon").removeClass("jchat_user_available2"),$("#jchat_userstab_icon").removeClass("jchat_user_offline")}function postStatus(t){$.post(jsonLiveSite,{status:t,task:"stream.saveEntity"},function(t){t.storing.status||showDebugMsgs(t.storing.details)})}function postGenericStatus(t,a){var e={};e[t]=a,e.task="stream.saveEntity",$.post(jsonLiveSite,e,function(t){t.storing.status||showDebugMsgs(t.storing.details)})}function turnChatOffline(t){o=1,statusClassOp(),$("#jchat_userstab_icon").addClass("jchat_user_offline"),$("#jchat_userstab_text").html(chatTitle),1!=t&&postGenericStatus("user_status","offline"),$("#jchat_wall_popup").removeClass("jchat_tabopen"),$("#jchat_userstab_popup").removeClass("jchat_tabopen"),$("#jchat_userstab").removeClass("jchat_tabclick").removeClass("jchat_userstabclick"),restartUpdateSession("buddylist","0")}function refreshActiveChatBoxes(){var t="";openedChatboxes={},$("span[id^=jchat_user_]").each(function(a,e){var s=$(this).data("id"),o=0;$("#jchat_user_"+s+" .jchat_tabalert").length>0&&(o=parseInt($("#jchat_user_"+s+" .jchat_tabalert").html())),t+=s+"|"+o+",",openedChatboxes[s]=a}),restartUpdateSession("activeChatboxes",t=t.slice(0,-1))}function createPrivateMessagesPopup(t,a,s,o,i,n){if($("#jchat_user_"+t).length>0){if(!$("#jchat_user_"+t).hasClass("jchat_tabclick")){$(".jchat_tabalert").css("display","none");1!=e("initialize")&&1!=e("updatesession")||0,$("#jchat_user_"+t).trigger("fetchMessages")}}else{shortname=a.length>tabLength?a.substr(0,tabLength)+"...":a,longname=a.length>headLength?a.substr(0,headLength)+"...":a;var c={width:230,height:200};"object"==typeof popupDimensions[t]&&(c.width=popupDimensions[t].width+"px",c.height=popupDimensions[t].height+"px");var r={},l={},h=!1,p=!1;if("bottom"==positionmentChatboxes){var _=0;$.each(nofluxChatBoxes,function(a,e){openedChatboxes[t]>e&&_++});var d=(openedChatboxes[t]-_)*parseInt(c.width),u=0;("module"!=renderingMode||"module"==renderingMode&&separateWidgets)&&(u=$("#jchat_userstab_popup").width());var g=$(window).width();if(p=!(parseInt(u+d)+parseInt(c.width)>g)){if(!firstCall||p&&nofluxChatBoxes[t]&&!popupPositions[t])try{delete nofluxChatBoxes[t],delete minimizedIndexes[t],$.jStorage.set("nofluxchatboxes",nofluxChatBoxes),$.jStorage.set("minimizedIndexes",minimizedIndexes)}catch(t){}}else nofluxChatBoxes[t]=openedChatboxes[t],$.jStorage.set("nofluxchatboxes",nofluxChatBoxes)}if("middle"!=positionmentChatboxes&&p)r={right:parseInt(u+d)+"px",bottom:0};else{var m=Object.keys(openedChatboxes).length-$(".jchat_bottomed").length,j=parseInt(m)/microSplacementKonstant;r={left:50+j+"%",top:50+j+"%"},l={left:"-115px",top:"-167px"}}"object"==typeof popupPositions[t]&&(r.left=popupPositions[t].x+"px",r.top=popupPositions[t].y+"px",l.left=0,l.top=0,h=!0,"bottom"==positionmentChatboxes&&(nofluxChatBoxes[t]=openedChatboxes[t],$.jStorage.set("nofluxchatboxes",nofluxChatBoxes)));var v="";n.isguest&&2==guestEnabledMode&&(v='<div class="jchat_trigger_infoguest"></div>');var b="";n.isguest||isGuest||!messagesHistory||(b='<div class="jchat_trigger_history"></div>');var f="";n.geoip&&geolocationEnabled&&(f='<div class="jchat_trigger_geolocation"></div>');var w="";if("undefined"!=typeof JChatWebrtc&&webrtcEnabled&&hasWebRTCSupport()&&userPermissions.allow_videochat&&"undefined"==typeof JChatConference){var x="";$(".jchat_webrtctooltip").length&&(x=" jchat_webrtc_disabled"),w='<div class="jchat_trigger_webrtc'+x+'"></div>'}var C="";(1==showSendButton||2==showSendButton&&jchatHasTouch())&&(C='<div data-id="'+t+'" class="jchat_trigger_send"></div>',$(document).on("click","div.jchat_trigger_send[data-id="+t+"]",function(t){var a=$.Event("keydown");a.keyCode=13,a.shiftKey=!1;var e=$(this).data("id");$("#jchat_user_"+e+"_popup .jchat_textarea").trigger(a)}));var y="";languageTranslationEnabled&&(y=getLanguageToolbar(t,!1)),$("<div/>").attr("id","jchat_user_"+t+"_popup").addClass("jchat_tabpopup jchat_tabopen").attr("dir","ltr").html(y+'<div class="jchat_tabcontent messagelist"><div class="jchat_tabcontenttext private"></div><div class="jchat_tabcontentinput">'+writeElement+"</div>"+w+'<div class="jchat_trigger_emoticon"></div><div class="jchat_trigger_fileupload"></div><div class="jchat_trigger_export"></div><div class="jchat_trigger_delete"></div><div class="jchat_trigger_refresh"></div>'+v+b+f+C+"</div>").appendTo($("body")),(v||b)&&f&&C&&$("div[class^=jchat_trigger]").addClass("jchat_trigger_smallspaced"),(!attachmentsEnabled||isGuest&&!allowGuestFileupload)&&$(".jchat_trigger_fileupload").remove(),n.imbanned&&($("#jchat_user_"+t+"_popup .jchat_tabcontentinput").addClass("jchat_textarea_banned").html('<span class="banned_msg">'+jchat_banneduser+"</span>"),$(".jchat_trigger_webrtc, .jchat_trigger_fileupload, .jchat_trigger_emoticon","#jchat_user_"+t+"_popup").hide(),$("#jchat_privatemessaging_textarea[data-loggedid="+n.loggedid+"]").length&&($("#jchat_privatemessaging_textarea, div.jchat_userslist_ctrls").hide(),$("div.jchat_fullcolumn_input span.banned_msg").remove(),$("div.jchat_fullcolumn_input").append('<span class="banned_msg">'+jchat_banneduser+"</span>"))),"middle"==positionmentChatboxes||h||!p?$("#jchat_user_"+t+"_popup").css({left:r.left,top:r.top,"margin-left":l.left,"margin-top":l.top}):$("#jchat_user_"+t+"_popup").css({right:r.right,bottom:r.bottom}).addClass("jchat_bottomed"),$("#jchat_user_"+t+"_popup").css({width:c.width}),$("#jchat_user_"+t+"_popup .jchat_tabcontenttext").css({height:c.height}),$("<div/>").attr("id","jchat_user_"+t+"_popup"),$("#jchat_user_"+t+"_popup .jchat_textarea").focusin(function(){T=t}),$("div.jchat_trigger_send[data-id="+t+"]").hover(function(){T=t}),$(document).on("keydown","#jchat_user_"+t+"_popup .jchat_textarea",function(a){return sendMessage(a,this,t,n.loggedid)}),$(document).on("keyup","#jchat_user_"+t+"_popup .jchat_textarea",function(a){return popup(a,this,t)}),$(".jchat_trigger_emoticon","#jchat_user_"+t+"_popup").toggle(function(a){var e=$('.jchat_tabcontent div[class*="tooltip"]',"#jchat_user_"+t+"_popup").filter(function(t){return"none"!==$(this).css("display")});e.length&&e.next().trigger("click"),emoticonsTooltip(this,"#jchat_user_"+t+"_popup",t),$(this).addClass("toggle_on")},function(a){$(".jchat_emoticonstooltip","#jchat_user_"+t+"_popup").remove(),$(this).removeClass("toggle_on")}),$(".jchat_trigger_fileupload","#jchat_user_"+t+"_popup").toggle(function(a){var e=$('.jchat_tabcontent div[class*="tooltip"]',"#jchat_user_"+t+"_popup").filter(function(t){return"none"!==$(this).css("display")});e.length&&e.next().trigger("click"),uploadFileTooltip(this,"#jchat_user_"+t+"_popup",t,n.loggedid),$(this).addClass("toggle_on")},function(a){$(".jchat_fileuploadtooltip","#jchat_user_"+t+"_popup").remove(),$(this).removeClass("toggle_on")}),$(".jchat_trigger_webrtc","#jchat_user_"+t+"_popup").toggle(function(e){var s=!1;if($("#jchat_end_call","#jchat_user_"+t+"_popup").length&&(s=!$("#jchat_end_call","#jchat_user_"+t+"_popup").hasClass("jchat_disabled")),$(this).hasClass("jchat_webrtc_disabled")||s||$(".jchat_webrtctooltip","#jchat_user_"+t+"_popup").length)return $(this).trigger("click"),void webrtcDirector.showInnerMessage(jchat_endcall_totoggle_popups);var o=$('.jchat_tabcontent div[class*="tooltip"]',"#jchat_user_"+t+"_popup").filter(function(t){return"none"!==$(this).css("display")});o.length&&o.next().trigger("click");var i=a.length>videoLength?a.substr(0,videoLength)+"...":a,n=my_username.length>videoLength?my_username.substr(0,videoLength)+"...":my_username;webrtcTooltip(this,"#jchat_user_"+t+"_popup",t,i,n,a),$(this).addClass("toggle_on"),$("div[id!=jchat_user_"+t+"_popup].jchat_tabpopup.jchat_tabopen .jchat_trigger_webrtc").addClass("jchat_webrtc_disabled")},function(a){var e=!1;$("#jchat_end_call","#jchat_user_"+t+"_popup").length&&(e=!$("#jchat_end_call","#jchat_user_"+t+"_popup").hasClass("jchat_disabled")),$(this).hasClass("jchat_webrtc_disabled")||e?webrtcDirector.showInnerMessage(jchat_endcall_totoggle_popups):($(".jchat_webrtctooltip","#jchat_user_"+t+"_popup").remove(),$(this).removeClass("toggle_on"),webrtcDirector.flushMedias(),$("div[id!=jchat_user_"+t+"_popup].jchat_tabpopup.jchat_tabopen .jchat_trigger_webrtc").removeClass("jchat_webrtc_disabled"))}),$(".jchat_trigger_infoguest","#jchat_user_"+t+"_popup").toggle(function(a){var e=$('.jchat_tabcontent div[class*="tooltip"]',"#jchat_user_"+t+"_popup").filter(function(t){return"none"!==$(this).css("display")});e.length&&e.next().trigger("click"),infoGuestTooltip(this,"#jchat_user_"+t+"_popup",t),$(this).addClass("toggle_on")},function(a){$(".jchat_infoguesttooltip","#jchat_user_"+t+"_popup").remove(),$(this).removeClass("toggle_on")}),bindTooltipEvents(".jchat_trigger_history, .jchat_trigger_geolocation",t,n),$(".jchat_trigger_export","#jchat_user_"+t+"_popup").append("<a/>"),$(".jchat_trigger_export a","#jchat_user_"+t+"_popup").attr("href",htmlLiveSite+"&task=export.display&chatid="+t),$(".jchat_trigger_delete","#jchat_user_"+t+"_popup").on("click",function(){deleteConversation(t)}),$("div.jchat_trigger_refresh","#jchat_user_"+t+"_popup").click(function(e){var s=a.length>tabLength?a.substr(0,tabLength)+"...":a;return $("div.jchat_tab_shortname","#jchat_user_"+t+"_popup").text(s),fetchMessages(t)}),$("div.jchat_trigger_refresh","#jchat_user_"+t+"_popup").mousedown(function(){$(this).addClass("jchat_refresh_mousedown")}).mouseup(function(){$(this).removeClass("jchat_refresh_mousedown")}),$("#jchat_user_"+t+"_popup .jchat_tabtitle").append('<div class="jchat_closebox"></div><br clear="all"/>'),$("#jchat_user_"+t+"_popup .jchat_tabtitle .jchat_closebox").mouseenter(function(){$(this).addClass("jchat_chatboxmouseoverclose"),$("#jchat_user_"+t+"_popup .jchat_tabtitle").removeClass("jchat_chatboxtabtitlemouseover")}),$("#jchat_user_"+t+"_popup .jchat_tabtitle .jchat_closebox").mouseleave(function(){$(this).removeClass("jchat_chatboxmouseoverclose"),$("#jchat_user_"+t+"_popup .jchat_tabtitle").addClass("jchat_chatboxtabtitlemouseover")}),$("#jchat_user_"+t+"_popup .jchat_tabtitle .jchat_closebox").click(function(){$("#jchat_user_"+t+"_popup").remove(),$("#jchat_user_"+t).remove(),T==t&&(T="",restartUpdateSession("openChatboxId","")),popupsReposition(),refreshActiveChatBoxes()}),$("#jchat_user_"+t+"_popup .jchat_tabtitle").click(function(){$("#jchat_user_"+t).trigger("fetchMessages")}),$("#jchat_user_"+t+"_popup .jchat_tabtitle").mouseenter(function(){$(this).addClass("jchat_chatboxtabtitlemouseover")}),$("#jchat_user_"+t+"_popup .jchat_tabtitle").mouseleave(function(){$(this).removeClass("jchat_chatboxtabtitlemouseover")}),shortname=null!==n.profilelink?'<a href="'+n.profilelink+'">'+shortname+"</a>":shortname,$("<span/>").attr("id","jchat_user_"+t).attr("data-id",t).addClass("jchat_tab jchat_tabclick jchat_usertabclick").html('<div class="jchat_closebox_bottom_status jchat_'+s+'">'+i+'</div><div class="jchat_tab_shortname">'+shortname+"</div>").prependTo($("#jchat_user_"+t+"_popup")),$("#jchat_user_"+t).attr("data-loggedid",n.loggedid);var k='<div class="jchat_maximizebox_bottom"></div>';(!maximizeButton||maximizeButton>1&&!jchatDetectMobileDevice(maximizeButton))&&(k=""),$("#jchat_user_"+t).append('<div class="jchat_closebox_bottom"></div>'+k+'<div class="jchat_minimizebox_bottom"></div>'),$("#jchat_user_"+t+" .jchat_closebox_bottom").mouseenter(function(){$(this).addClass("jchat_closebox_bottomhover")}),$("#jchat_user_"+t+" .jchat_closebox_bottom").mouseleave(function(){$(this).removeClass("jchat_closebox_bottomhover")}),$("#jchat_user_"+t+" .jchat_closebox_bottom").click(function(){if(!!$(this).parent().next().children(".jchat_webrtctooltip").length){if(!$("#jchat_end_call","#jchat_user_"+t+"_popup").hasClass("jchat_disabled"))return webrtcDirector.showInnerMessage(jchat_endcall_before_close),!1;$("div[id!=jchat_user_"+t+"_popup].jchat_tabpopup.jchat_tabopen .jchat_trigger_webrtc").removeClass("jchat_webrtc_disabled")}if($("#jchat_user_"+t+"_popup").hasClass("maximized")&&(popupDimensions[t]={width:230,height:200}),"bottom"==positionmentChatboxes&&!(t in nofluxChatBoxes)){var a=$("#jchat_user_"+t+"_popup").nextAll("div[id^=jchat_user_].jchat_bottomed");a.length&&$.each(a,function(t,a){var e=$(a),s=parseInt(e.css("right"));e.animate({right:s-parseInt(c.width)+"px"},300)})}try{if(delete openedChatboxes[t],nofluxChatBoxes[t]&&(delete nofluxChatBoxes[t],$.jStorage.set("nofluxchatboxes",nofluxChatBoxes)),minimizedAllChatboxes&&minimizedIndexes[t]){var e=minimizedIndexes[t];$.each(minimizedIndexes,function(t,a){if(a>e&&(minimizedIndexes[t]--,popupPositions[t])){var s=popupPositions[t].y+26;$("#jchat_user_"+t+"_popup").animate({top:s+"px"},300),popupPositions[t].y=s}}),delete minimizedIndexes[t],delete popupPositions[t],delete popupDimensions[t],delete popupState[t],delete popupMaximizedState[t],$.jStorage.set("minimizedIndexes",minimizedIndexes),$.jStorage.set("popupPositions",popupPositions),$.jStorage.set("popupState",popupState),$.jStorage.set("popupMaximizedState",popupMaximizedState),$.jStorage.set("popupDimensions",popupDimensions)}}catch(t){}delete gMapReference[t],languageTranslationEnabled&&getLanguageToolbar(t,!0),$("#jchat_user_"+t+"_popup").remove(),$("#jchat_user_"+t).remove(),T==t&&(T="",restartUpdateSession("openChatboxId","")),popupsReposition(),refreshActiveChatBoxes()}),$("#jchat_user_"+t+" .jchat_minimizebox_bottom").on("hover",function(){$(this).toggleClass("jchat_minimizebox_bottomhover")}),$("#jchat_user_"+t+" .jchat_maximizebox_bottom").on("hover",function(){$(this).toggleClass("jchat_maximizebox_bottomhover")}),$("#jchat_user_"+t+" .jchat_minimizebox_bottom").click(function(a,e){var s=$(window).width(),o=$(window).height(),i=($(".jchat_bottomed").length,$("div[id^=jchat_user_]:not(.jchat_bottomed)").length,0);("auto"==renderingMode||"module"==renderingMode&&separateWidgets)&&(i=$("#jchat_userstab_popup").width()),$("#jchat_userstab_popup").hasClass("maximized")&&(i=$.jStorage.get("sidebarWidth",!1)||("auto"==renderingMode?260:originalSidebarWidth)),$(this).toggleClass("minimized");var n=$("#jchat_user_"+t+"_popup"),c=!$(this).data("minimized");$(this).data("minimized",c),popupState[t]=c,$.jStorage.set("popupState",popupState),c&&(n.toggleClass("minimized"),$("#jchat_user_"+t+"_popup .ui-resizable-handle").toggle()),$("#jchat_user_"+t+"_popup .jchat_tabcontent.messagelist").slideToggle(300,"swing",function(){if($("#jchat_user_"+t+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+t+"_popup .jchat_tabcontenttext")[0].scrollHeight),c){if(minimizedAllChatboxes){var a=$($("div.jchat_bottomed").get(0)).height()||0;if(!minimizedIndexes[t]&&!e&&!n.hasClass("jchat_bottomed")){var r=jchatDetectMaxValue(minimizedIndexes);minimizedIndexes[t]=r+1,$.jStorage.set("minimizedIndexes",minimizedIndexes)}if(n.hasClass("jchat_bottomed")||e){var l=$($("div.jchat_bottomed").get(0));if(l.attr("id")==n.attr("id")&&!e){_=293;$("div[id^=jchat_user_]:not(.jchat_bottomed).minimized").each(function(t,a){var e=$("span[id^=jchat_user_]",a).data("id"),s=popupPositions[e].y,o=popupPositions[e].y=s+_-26;$(a).animate({top:o},300)}),$.jStorage.set("popupPositions",popupPositions)}}else{var h=s-i-230,p=o-a-26*minimizedIndexes[t];n.animate({left:h+"px",top:p+"px","margin-left":0,"margin-top":0,bottom:"auto",right:"auto",width:"230px",height:"293px"},500),popupPositions[t]={x:h,y:p},$.jStorage.set("popupPositions",popupPositions);try{delete popupDimensions[t],$.jStorage.set("popupDimensions",popupDimensions),$("#jchat_user_"+t+"_popup .jchat_tabcontenttext").removeAttr("style")}catch(t){}}}}else if(n.toggleClass("minimized"),$("#jchat_user_"+t+"_popup .ui-resizable-handle").toggle(),minimizedAllChatboxes)if(n.hasClass("jchat_bottomed")||e){if((l=$($("div.jchat_bottomed").get(0))).attr("id")==n.attr("id")&&!e){var _=l.height();$("div[id^=jchat_user_]:not(.jchat_bottomed).minimized").each(function(t,a){var e=$("span[id^=jchat_user_]",a).data("id"),s=popupPositions[e].y,o=popupPositions[e].y=s-_+26;$(a).animate({top:o},300)})}$.jStorage.set("popupPositions",popupPositions)}else{var d=minimizedIndexes[t],u=parseInt(d)/microSplacementKonstant,g={left:50+u+"%",top:50+u+"%"},m={left:"-115px",top:"-167px"};n.animate({left:g.left,top:g.top,height:"auto","margin-left":m.left,"margin-top":m.top},500);try{delete popupPositions[t],$.jStorage.set("popupPositions",popupPositions)}catch(t){}}})}),$("#jchat_user_"+t+" .jchat_maximizebox_bottom").click(function(){$(this).toggleClass("maximized");var a=!$(this).data("maximized");$(this).data("maximized",a);var e=$("div.jchat_toolbarlanguage","#jchat_user_"+t+"_popup").height()||0;if(a){$("#jchat_user_"+t+"_popup").toggleClass("maximized"),$("#jchat_user_"+t+"_popup .ui-resizable-handle").toggle(),$("#jchat_user_"+t+"_popup").css({top:0,left:0,"margin-left":0,"margin-top":0,width:"100%",height:"auto"});var s=function(){var a=(window.innerWidth?window.innerWidth:$(window).width())-28,s=(window.innerHeight?window.innerHeight:$(window).height())-92-e;$(".jchat_tabcontenttext.private","#jchat_user_"+t+"_popup").width(a),$(".jchat_tabcontenttext.private","#jchat_user_"+t+"_popup").height(s),popupDimensions[t]={width:a,height:s}};s(),$(window).on("resize.jchat",function(t){s()}),popupsReposition(!0),$("#jchat_user_"+t+"_popup").draggable("disable"),$("div[id^=jchat_user_]").removeClass("maximized_hover"),$("div[id^=jchat_user_]").each(function(a,e){var s=$(e).attr("id");$(e).hasClass("maximized")&&s!="jchat_user_"+t+"_popup"&&$(".jchat_maximizebox_bottom",e).trigger("click")}),popupMaximizedState[t]=a,$.jStorage.set("popupMaximizedState",popupMaximizedState)}else{$("#jchat_user_"+t+"_popup").toggleClass("maximized"),$("#jchat_user_"+t+"_popup .ui-resizable-handle").toggle();var o="50%",i="50%",n=200-e,c=l.left,r=l.top;popupDimensions[t]={width:230,height:n},"object"==typeof popupPositions[t]&&(o=popupPositions[t].y,i=popupPositions[t].x,c=0,r=0),$("#jchat_user_"+t+"_popup").hasClass("jchat_bottomed")?$("#jchat_user_"+t+"_popup").css({top:"auto",left:"auto","margin-left":"auto","margin-top":"auto",width:230,height:"auto"}):$("#jchat_user_"+t+"_popup").css({top:o,left:i,"margin-left":c,"margin-top":r,width:230,height:"293px"}),$(".jchat_tabcontenttext.private","#jchat_user_"+t+"_popup").innerWidth(226),$(".jchat_tabcontenttext.private","#jchat_user_"+t+"_popup").height(n),$(window).off("resize.jchat"),popupsReposition(),$("#jchat_user_"+t+"_popup").draggable("enable"),$("div[id^=jchat_user_]").removeClass("maximized_hover"),delete popupMaximizedState[t],$.jStorage.set("popupMaximizedState",popupMaximizedState)}$("#jchat_user_"+t+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+t+"_popup .jchat_tabcontenttext")[0].scrollHeight)}),!0===popupState[t]&&($("#jchat_user_"+t+" .jchat_minimizebox_bottom").addClass("minimized").data("minimized",popupState[t]),$("#jchat_user_"+t+"_popup .jchat_tabcontent.messagelist").toggle()),$("#jchat_user_"+t).mouseenter(function(){$(this).addClass("jchat_tabmouseover"),$("#jchat_user_"+t+" div").addClass("jchat_tabmouseovertext")}),$("#jchat_user_"+t).mouseleave(function(){$(this).removeClass("jchat_tabmouseover"),$("#jchat_user_"+t+" div").removeClass("jchat_tabmouseovertext")}),$("#jchat_user_"+t).on("fetchMessages",function(){$("#jchat_user_"+t+" .jchat_tabalert").length>0&&($("#jchat_user_"+t+" .jchat_tabalert").remove(),refreshActiveChatBoxes()),$("div.jchat_avatar_upload_tooltip").length>0&&$("#jchat_avatar").trigger("click"),$("div.jchat_emoticonstooltip","#jchat_wall_popup").length>0&&$("div.jchat_trigger_emoticon","#jchat_wall_popup").trigger("click"),$(this).addClass("jchat_tabclick").addClass("jchat_usertabclick"),restartUpdateSession("openChatboxId",t),T=t,fetchMessages(t),$("#jchat_user_"+t+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+t+"_popup .jchat_tabcontenttext")[0].scrollHeight),firstCall||jchatHasTouch()||$("#jchat_user_"+t+"_popup .jchat_textarea").focus()}),$("#jchat_user_"+t).trigger("fetchMessages"),isTabFocused||$("title").text(a+jchat_newmessage_tab),refreshActiveChatBoxes(),$("#jchat_user_"+t+"_popup").draggable({handle:"#jchat_user_"+t,drag:function(t,a){popupsReposition($("#jchat_wall_popup").hasClass("maximized")||$(this).hasClass("maximized"),this)},start:function(a,e){if($(this).addClass("dragging"),$(this).css({bottom:"auto",right:"auto"}),"bottom"==positionmentChatboxes&&$("#jchat_user_"+t+"_popup").hasClass("jchat_bottomed")){var s=$("#jchat_user_"+t+"_popup.jchat_bottomed").removeClass("jchat_bottomed").nextAll("div[id^=jchat_user_].jchat_bottomed");s.length&&$.each(s,function(t,a){var e=$(a),s=parseInt(e.css("right"));e.animate({right:s-parseInt(c.width)+"px"},300)}),nofluxChatBoxes[t]=openedChatboxes[t],$.jStorage.set("nofluxchatboxes",nofluxChatBoxes)}},stop:function(a,e){popupPositions[t]={x:e.helper.offset().left-$(window).scrollLeft(),y:e.helper.offset().top-$(window).scrollTop()},$.jStorage.set("popupPositions",popupPositions),$(this).removeClass("dragging")}}),resizableChatboxes&&!jchatHasTouch()&&$("#jchat_user_"+t+"_popup").resizable({handles:"se",alsoResize:"#jchat_user_"+t+"_popup .jchat_tabcontenttext.private",minHeight:293,minWidth:230,start:function(t,a){},stop:function(a,e){var s=$(e.element).get(0),o=($(".jchat_tabcontenttext",s).get(0),$(".jchat_tabcontenttext",s).get(0).clientHeight-10);popupDimensions[t]={width:e.size.width,height:o},$.jStorage.set("popupDimensions",popupDimensions)},resize:function(t,a){popupsReposition();var e=$(a.element).get(0);a.originalSize.height>a.size.height&&$(".jchat_tabcontenttext",e).scrollTop($(".jchat_tabcontenttext",e)[0].scrollHeight),$(".jchat_tabcontenttext iframe",e).height()<150&&$(".jchat_tabcontenttext iframe",e).height(150)}}),!0===popupMaximizedState[t]&&$("#jchat_user_"+t+" .jchat_maximizebox_bottom").trigger("click"),makeSidebarResizable(),!0===popupState[t]&&($("#jchat_user_"+t+"_popup .ui-resizable-handle").toggle(),$("#jchat_user_"+t+"_popup").toggleClass("minimized")),$.browser.msie&&$.browser.version<=8||(jchatInitTouchEvents($("#jchat_user_"+t).get(0)),resizableChatboxes&&!jchatHasTouch()&&jchatInitTouchEvents($("#jchat_user_"+t+"_popup div.ui-resizable-handle").get(0))),jchatHasTouch()&&($("#jchat_user_"+t).css("background-position","80% -850px"),$("div.ui-resizable-handle").css({width:"36px",height:"36px","background-position":"22px -1402px"}),$("div.jchat_tabcontent").css("border-bottom","none"))}}function fetchMessages(t){$.ajax({async:!0,url:jsonLiveSite,data:{chatbox:t,task:"stream.display"},type:"post",cache:!1,dataType:"json",success:function(a){if(a){$("#jchat_user_"+t+"_popup .jchat_tabcontenttext").html("");var e="";$.each(a,function(a,s){"messages"==a&&$.each(s,function(a,s){s.id>n&&(n=s.id);var o="";if(1==s.self)fromPlaceholder=void 0!==my_avatar&&null!==my_avatar&&""!==my_avatar&&!0===avatarEnabled?'<img alt="'+jchat_you+my_username+'" data-time="'+s.time+'" width="32px" height="32px" src="'+my_avatar+'" />':'<strong data-time="'+s.time+'">'+my_username+"</strong>",o=" selfmessage";else{var i=$("#jchat_userlist_"+t).triggerHandler("getname"),c=$("#jchat_userlist_"+t).triggerHandler("getavatar");void 0!==c&&null!==c&&""!==c||(c=s.avatar),void 0!==i&&null!==i&&""!==i||(i=s.fromuser.length>chatLength?s.fromuser.substr(0,chatLength)+"...":s.fromuser),fromPlaceholder=void 0!==c&&null!==c&&""!==c&&!0===avatarEnabled?'<img alt="'+i+'" data-time="'+s.time+'" width="32px" height="32px" src="'+c+'" />':'<strong data-time="'+s.time+'">'+i+"</strong>"}if(void 0!==s.profilelink&&""!==s.profilelink&&null!==s.profilelink&&(fromPlaceholder='<a href="'+s.profilelink+'">'+fromPlaceholder+"</a>"),"file"==s.type)s.message=jchatTrasformMsgFile(s.message,s.id,s.self,s.from,s.status,!1,s);else{s.message=jchatStripTags(s.message,allowMediaObjects);try{s.message=s.message.replace(/&/gi,"&amp;")}catch(t){}}s.message&&(e+='<div class="jchat_chatboxmessage'+o+'" id="jchat_message_'+s.id+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+o+'">'+s.message+"</span></div>")})}),$("#jchat_user_"+t+"_popup .jchat_tabcontenttext").append(e),$("#jchat_user_"+t+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+t+"_popup .jchat_tabcontenttext")[0].scrollHeight)}$("span.jchat_chatboxmessagefrom img, span.jchat_chatboxmessagefrom strong").mouseover(function(t){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(t){$("#jchat_avatartooltip").remove()})}})}function fetchWallMessages(t,a){$("#jchat_wall_popup").append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",top:"10%",left:"38%",width:"64px"}).addClass("waiter"),$.ajax({async:!0,url:jsonLiveSite,data:{wall:!0,task:"stream.display",download_history:t},type:"post",cache:!1,dataType:"json",success:function(e){if(e&&void 0!==e.wallmessages){$("#jchat_wall_popup div.jchat_tabcontenttext").html("");var s="";$.each(e.wallmessages,function(t,a){var e="",o="",i="";if(1==a.self)fromPlaceholder=void 0!==my_avatar&&null!==my_avatar&&""!==my_avatar?'<img alt="'+jchat_you+my_username+'" data-time="'+a.time+'" width="32px" height="32px" src="'+my_avatar+'" />':'<strong data-time="'+a.time+'">'+my_username+"</strong>",e=" selfmessage";else{var n=$("#jchat_userlist_"+a.fromuserid).triggerHandler("getname"),c=$("#jchat_userlist_"+a.fromuserid).triggerHandler("getavatar");void 0!==c&&null!==c&&""!==c||(c=a.avatar),void 0!==n&&null!==n&&""!==n||(n=a.fromuser.length>chatLength?a.fromuser.substr(0,chatLength)+"...":a.fromuser),!!(void 0===c||null===c||""===c||c.match(/default_other.png/)||!0!==avatarEnabled)&&n.length>=chatLength-13&&(o=" jchat_username_large",i=" jchat_message_small"),fromPlaceholder=void 0===c||null===c||""===c||c.match(/default_other.png/)||!0!==avatarEnabled?'<strong data-time="'+a.time+'">'+n+"</strong>":'<img alt="'+n+'" data-time="'+a.time+'" width="32px" height="32px" src="'+c+'" />'}void 0!==a.profilelink&&""!==a.profilelink&&null!==a.profilelink&&(fromPlaceholder='<a href="'+a.profilelink+'">'+fromPlaceholder+"</a>"),a.message=jchatStripTags(a.message,allowMediaObjects),a.message=a.message.replace(/&/gi,"&amp;"),s+='<div class="jchat_chatboxmessage'+e+'" id="jchat_message_'+a.id+'"><span class="jchat_chatboxmessagefrom'+o+'">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+e+i+'">'+a.message+"</span></div>"}),$("#jchat_wall_popup div.jchat_tabcontenttext").append(s),t&&!a?$("#jchat_wall_popup div.jchat_tabcontenttext").animate({scrollTop:0},300,"swing"):$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight)}$("span.jchat_chatboxmessagefrom img, span.jchat_chatboxmessagefrom strong","#jchat_wall_popup").mouseover(function(t){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(t){$("#jchat_avatartooltip").remove()}),$("#jchat_wall_popup img.waiter").remove()}})}function fetchHistoryMessages(t,a,e,s){$("#jchat_user_"+a+"_popup").append("<img/>").children("img").attr("src",jchat_livesite+"components/com_jchat/images/loading.gif").css({position:"absolute",top:"10%",left:"38%",width:"64px"}).addClass("waiter"),$.Deferred(function(o){$.ajax({type:"post",url:jsonLiveSite,dataType:"json",cache:!1,context:this,data:{task:"stream.showHistory",from_loggedid:t,from_userid:a,msgs_period:e,min_message_id:s}}).done(function(t,a,e){return t.status?t.messages.length?void(t.status&&t.messages.length&&o.resolve(t.messages)):(o.reject(jchat_nomessages_available,a),!1):(o.reject(t.details,a),!1)}).fail(function(t,a,e){var s=a[0].toUpperCase()+a.slice(1);o.reject("-"+s+"- "+e)}).always(function(){$("#jchat_user_"+a+"_popup img.waiter").remove()})}).promise().then(function(t){var e="";$.each(t,function(t,s){var o="";if(1==s.self)fromPlaceholder=void 0!==my_avatar&&null!==my_avatar&&""!==my_avatar&&!0===avatarEnabled?'<img alt="'+jchat_you+my_username+'" data-time="'+s.time+'" width="32px" height="32px" src="'+my_avatar+'" />':'<strong data-time="'+s.time+'">'+my_username+"</strong>",o=" selfmessage";else{var i=$("#jchat_userlist_"+a).triggerHandler("getname"),n=$("#jchat_userlist_"+a).triggerHandler("getavatar");void 0!==i&&null!==i&&""!==i||(i=s.fromusername.length>chatLength?s.fromusername.substr(0,chatLength)+"...":s.fromusername),fromPlaceholder=void 0!==n&&null!==n&&""!==n&&!0===avatarEnabled?'<img alt="'+i+'" data-time="'+s.time+'" width="32px" height="32px" src="'+n+'" />':'<strong data-time="'+s.time+'">'+i+"</strong>"}void 0!==s.profilelink&&""!==s.profilelink&&null!==s.profilelink&&(fromPlaceholder='<a href="'+s.profilelink+'">'+fromPlaceholder+"</a>"),"file"==s.type?s.message=jchatTrasformMsgFile(s.message,s.id,s.self,s.from,s.status,!1,s):(s.message=jchatStripTags(s.message,allowMediaObjects),s.message=s.message.replace(/&/gi,"&amp;")),e+='<div class="jchat_chatboxmessage'+o+'" id="jchat_message_'+s.id+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+o+'">'+s.message+"</span></div>"}),$("#jchat_user_"+a+"_popup .jchat_tabcontenttext").prepend(e),$("#jchat_user_"+a+"_popup .jchat_tabcontenttext").animate({scrollTop:0},300,"swing"),$("span.jchat_chatboxmessagefrom img, span.jchat_chatboxmessagefrom strong").mouseover(function(t){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(t){$("#jchat_avatartooltip").remove()})},function(t,a){injectFloatingMsg(t)})}function listaUtenti(t,a,s,o,i,n){""==o&&(o=jchat_defaultstatus);var c="";if(s.indexOf("|")>0){var r=s.split("|");s=r[0];var l=r[1];c='<span class="jchat_timeinfo">'+l+"</span>"}else"available"!==s||i.lastmessagetime||(s="neveractive");var h=!!$("#jchat_userlist_"+t).length,p=$("#jchat_userlist_"+t+" span.jchat_contact").attr("data-owned"),_=$("#jchat_userlist_"+t+" span.jchat_contact").attr("data-contact"),d="0"!=e("initialize"),u=null,g=null;$("#jchat_userlist_"+t).length>0&&($("#jchat_user_"+t+" .jchat_closebox_bottom_status").removeClass("jchat_available"),$("#jchat_user_"+t+" .jchat_closebox_bottom_status").removeClass("jchat_busy"),$("#jchat_user_"+t+" .jchat_closebox_bottom_status").removeClass("jchat_away"),$("#jchat_user_"+t+" .jchat_closebox_bottom_status").removeClass("jchat_offline"),$("#jchat_user_"+t+" .jchat_closebox_bottom_status").removeClass("jchat_disconnected"),$("#jchat_user_"+t+" .jchat_closebox_bottom_status").addClass("jchat_"+s),$("#jchat_user_"+t+" .jchat_closebox_bottom_status").html(c),i.imbanned?($("#jchat_user_"+t+"_popup .jchat_tabcontentinput").addClass("jchat_textarea_banned").html('<span class="banned_msg">'+jchat_banneduser+"</span>"),$(".jchat_trigger_webrtc, .jchat_trigger_fileupload, .jchat_trigger_emoticon","#jchat_user_"+t+"_popup").hide(),$("#jchat_privatemessaging_textarea[data-loggedid="+i.loggedid+"]").length&&($("#jchat_privatemessaging_textarea, div.jchat_userslist_ctrls").hide(),$("div.jchat_fullcolumn_input span.banned_msg").remove(),$("div.jchat_fullcolumn_input").append('<span class="banned_msg">'+jchat_banneduser+"</span>"))):($("#jchat_user_"+t+"_popup .jchat_tabcontentinput").hasClass("jchat_textarea_banned")&&($("#jchat_user_"+t+"_popup .jchat_tabcontentinput").removeClass("jchat_textarea_banned").html(writeElement),$(".jchat_trigger_webrtc, .jchat_trigger_fileupload, .jchat_trigger_emoticon","#jchat_user_"+t+"_popup").show()),$("#jchat_privatemessaging_textarea[data-loggedid="+i.loggedid+"]").length&&($("#jchat_privatemessaging_textarea, div.jchat_userslist_ctrls").show(),$("div.jchat_fullcolumn_input span.banned_msg").remove())),i.isguest||isGuest||$("#jchat_user_"+t+"_popup .jchat_trigger_history").length||!messagesHistory||($('<div class="jchat_trigger_history"></div>').appendTo("#jchat_user_"+t+"_popup div.messagelist").on("mouseover",function(t){triggerGenericPopover("#jchat_trigger_history_tooltip",this,jchat_trigger_history)}).on("mouseout",function(t){$("#jchat_trigger_history_tooltip").css("display","none")}),bindTooltipEvents(".jchat_trigger_history",t,i)),$("#jchat_userlist_"+t).remove(),"undefined"!=typeof JChatConference&&(u=$("div.jchat_conference_btns","#jchat_conference_userslist li[data-sessionid="+t+"]").html(),g=$("div.jchat_peer_bandwidth","#jchat_conference_userslist li[data-sessionid="+t+"]").html(),$("#jchat_conference_userslist li[data-sessionid="+t+"]").remove())),$("#jchat_private_messaging").length&&(c?$("span.jchat_usersbox_status[data-userid="+i.loggedid+"]").append(c):$("span.jchat_usersbox_status[data-userid="+i.loggedid+"]").addClass("jchat_online")),shortname=a.length>tabLength?a.substr(0,tabLength)+"...":a,$("div.jchat_tab_shortname a","#jchat_user_"+t+"_popup").length?$("div.jchat_tab_shortname a","#jchat_user_"+t+"_popup").text(shortname):$("div.jchat_tab_shortname","#jchat_user_"+t+"_popup").text(shortname),longname=a.length>buddyLength?a.substr(0,buddyLength)+"...":a;var m="";void 0!==i.avatar&&""!==i.avatar&&null!==i.avatar&&!0===avatarEnabled&&(m='<img width="32px" height="32px"  src="'+i.avatar+'" />');var j=$("<div/>").attr("id","jchat_userlist_"+t).attr("data-loggedid",i.loggedid).attr("data-sessionid",t).addClass("jchat_userlist").html('<span class="jchat_userscontentname">'+m+'<span class="jchat_banning"></span><span class="jchat_ban_moderator"></span>'+longname+'</span><span class="jchat_contact"></span>'+c+'<span class="jchat_userscontentdot jchat_'+s+'"></span>').data("id",t);if(0===longname.indexOf(guestPrefix)?j.appendTo($("#jchat_userstab_popup .jchat_tabcontent .jchat_userscontent .jchat_userslist_"+s)):j.prependTo($("#jchat_userstab_popup .jchat_tabcontent .jchat_userscontent .jchat_userslist_"+s)),"undefined"!=typeof JChatConference&&(i.loggedid||jchat_conference_access_guest)&&userPermissions.allow_videochat){var v=u?'<div class="jchat_conference_btns">'+u+"</div>":'<div class="jchat_conference_btns"><div class="jchat_end_decline_call jchat_disabled"></div><div class="jchat_start_accept_call"></div></div>',b='<li class="jchat_userbox" data-sessionid="'+t+'" data-username="'+longname+'"><div class="jchat_usertab_container"><span class="jchat_usersbox_name">'+m+'<span class="jchat_usersbox_textname">'+longname+"</span>"+c+'<span class="jchat_userscontentdot jchat_'+s+'"></span></span>'+(g?'<div class="jchat_peer_bandwidth">'+g+"</div>":'<div class="jchat_peer_bandwidth"><span>0.0 mbits/s</span></div>')+v+"</div></li>",f=$.trim($("#jchat_leftusers_search").val());if(f){var w=new RegExp(f,"gi");longname.match(w)&&$(b).prependTo("#jchat_conference_userslist")}else $(b).prependTo("#jchat_conference_userslist")}privateChatEnabled?($("#jchat_userlist_"+t).mouseover(function(){$(this).addClass("jchat_userlist_hover")}),$("#jchat_userlist_"+t).mouseout(function(){$(this).removeClass("jchat_userlist_hover")}),$("#jchat_userlist_"+t).on("click dblclick",function(e,n){if(console.log($(this)),!n){var r=Object.keys(openedChatboxes).length;openedChatboxes[t]=r}createPrivateMessagesPopup(t,a,s,o,c,i)})):$("#jchat_userlist_"+t).css({cursor:"auto"}),$("span.jchat_contact","#jchat_userlist_"+t).attr("data-userid",t),$("span.jchat_banning","#jchat_userlist_"+t).attr("data-userid",t),console.log("hello123456"),$("span.jchat_ban_moderator","#jchat_userlist_"+t).attr("data-userid",t).attr("data-loggedid",i.loggedid),i.iscontact&&i.isowner?($("span.jchat_contact","#jchat_userlist_"+t).attr("data-contact",1).attr("data-name",i.name),$("span.jchat_contact","#jchat_userlist_"+t).addClass("active").attr("data-text",jchat_remove),_||d||!h||(injectFloatingMsg(jchat_groupchat_request_accepted_owner,i.name),JChatNotifications.playSentFile())):i.iscontact||i.isowner?($("span.jchat_contact","#jchat_userlist_"+t).attr("data-owned",1),$("span.jchat_contact","#jchat_userlist_"+t).addClass("owned").attr("data-text",jchat_pending),p||d||!h||(injectFloatingMsg(jchat_groupchat_request_received,i.name),JChatNotifications.playSentFile())):($("span.jchat_contact","#jchat_userlist_"+t).attr("data-contact",0),$("span.jchat_contact","#jchat_userlist_"+t).addClass("noactive").attr("data-text",jchat_invite)),$("#jchat_userlist_"+t).on("click dblclick","span.jchat_contact",function(t){t.stopPropagation();var a=$(this).attr("data-userid"),e=$(this).attr("data-contact"),s=$(this).attr("data-owned"),o=!(!i.iscontact||i.isowner),n=!(!i.isowner||i.iscontact);o?($(this).removeClass("owned").addClass("noactive").attr("data-contact",0).attr("data-owned",0),updateGroupChatUsers("groupchat.deleteEntity",a),injectFloatingMsg(jchat_groupchat_request_removed,i.name)):n?e?($(this).removeClass("owned").addClass("noactive").attr("data-contact",0).attr("data-owned",0),updateGroupChatUsers("groupchat.deleteEntity",a),injectFloatingMsg(jchat_groupchat_request_removed,i.name)):s&&($(this).removeClass("noactive").addClass("active").attr("data-owned",0).attr("data-contact",1).attr("data-name",i.name),updateGroupChatUsers("groupchat.saveEntity",a),injectFloatingMsg(jchat_groupchat_request_accepted)):1!=e&&1!=s?($(this).removeClass("noactive").addClass("owned").attr("data-owned",1),updateGroupChatUsers("groupchat.saveEntity",a),injectFloatingMsg(jchat_groupchat_request_sent,i.name)):($(this).removeClass("active").addClass("noactive").attr("data-contact",0).attr("data-owned",0),updateGroupChatUsers("groupchat.deleteEntity",a),injectFloatingMsg(jchat_groupchat_request_removed,i.name))}),i.isbanned&&($("span.jchat_banning","#jchat_userlist_"+t).data("banned",1).addClass("banned"),$("#jchat_chatroom_userslist span.jchat_banning[data-userid="+t+"]").data("banned",1).addClass("banned")),$("#jchat_userlist_"+t).on("click dblclick","span.jchat_banning",function(t,a){t.stopPropagation();var e=$(this).data("userid"),s=!$(this).data("banned"),o={};o.userSessionId=e,o.currentState=s,postGenericStatus("bannedinfo",JSON.stringify(o));var i=s?1:0;$(this).toggleClass("banned").data("banned",i),a||$("#jchat_chatroom_userslist span.jchat_banning[data-userid="+e+"]").toggleClass("banned")}),$("#jchat_userlist_"+t).on("click dblclick","span.jchat_ban_moderator",function(t){t.stopPropagation(),$(this).toggleClass("banned");var a={};a.userSessionId=$(this).data("userid"),a.userId=$(this).data("loggedid"),postGenericStatus("bannedmoderatorinfo",JSON.stringify(a)),setTimeout(function(t){$(t).parents("div.jchat_userlist").slideUp(250)},500,this)}),$("#jchat_userlist_"+t).on("addmessage",function(e,n,r,l,h,p,_,d){console.log("helllo124444444444444444");var u=Object.keys(openedChatboxes).length;if(openedChatboxes[t]=u,!d&&!$("#jchat_user_"+t+"_popup").length)if("undefined"!=typeof jchat_auto_open_msgspopup)if(0==jchat_auto_open_msgspopup){var g=$("#jchat_userslist li.jchat_userbox[data-userid="+i.loggedid+"]","#jchat_private_messaging"),m=privateMessagingCounters[i.loggedid]||0,j='<span class="jchat_newmessages_notifier">'+ ++m+"</span>";$("span.jchat_usersbox_name",g).next(".jchat_newmessages_notifier").remove().end().after(j),privateMessagingCounters[i.loggedid]=m,$.jStorage.set("privateMessagingCounters",privateMessagingCounters,{TTL:36e5})}else createPrivateMessagesPopup(t,a,s,o,c,i);else createPrivateMessagesPopup(t,a,s,o,c,i);if(!p.id&&T==t&&1==r){var v="";1==r&&(fromPlaceholder=void 0!==my_avatar&&null!==my_avatar&&""!==my_avatar&&!0===avatarEnabled?'<img alt="'+jchat_you+my_username+'" data-time="'+p.time+'" width="32px" height="32px" src="'+my_avatar+'" />':'<strong data-time="'+p.time+'">'+my_username+"</strong>",v=" selfmessage"),n=(n=jchatStripTags(n,allowMediaObjects)).replace(/&/gi,"&amp;"),$("#jchat_message_"+h).length>0||($("#jchat_user_"+t+"_popup .jchat_tabcontenttext").append('<div class="jchat_chatboxmessage'+v+'" id="jchat_message_'+h+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+v+'">'+n+"</span></div>"),$("span.jchat_chatboxmessagefrom img, span.jchat_chatboxmessagefrom strong").mouseover(function(t){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(t){$("#jchat_avatartooltip").remove()}))}if(T!=t&&0==l?tabAlert(t,1,1,p,_):1==audio&&0==r&&0==l&&"file"!=p.type?JChatNotifications.playMessageAlert(p):1==audio&&0==r&&0==l&&"file"==p.type&&JChatNotifications.playSentFile(p),0==l){var b=$("#jchat_user_"+p.from+"_popup .jchat_textarea");!b.length||$(b).is(":focus")||$(b).data("isblinking")||($(b).blink(),$(b).data("isblinking",!0))}}),$("#jchat_userlist_"+t).on("getname",function(t){return a.length>chatLength?a.substr(0,chatLength)+"...":a}),$("#jchat_userlist_"+t).on("getavatar",function(t){return i.avatar}),i.skypeid&&injectSkypeControls(i)}function tabAlert(t,a,e,s,o){1==audio&&"file"!=s.type?JChatNotifications.playMessageAlert(s):1==audio&&"file"==s.type&&JChatNotifications.playSentFile(s)}function initializeDom(){$("<span/>").attr("id","jchat_userstab").addClass("jchat_tab").css("display","none").html('<span id="jchat_userstab_icon"></span><span id="jchat_userstab_text" style="float:left">'+chatTitle+"</span>").appendTo($("#jchat_base")),$("<span/>").attr("id","jchat_closesidebarbutton").addClass("jchat_tab").addClass("jchat_exitimages").appendTo($("#jchat_userstab")),$("<span/>").attr("id","jchat_optionsbutton").addClass("jchat_tab").addClass("jchat_optionsimages").appendTo($("#jchat_userstab")),$("<span/>").attr("id","jchat_maximizebutton").attr("data-translation","jchat_maximizebutton").addClass("jchat_tab").addClass("jchat_maximizeimages").appendTo($("#jchat_userstab")),$("<div/>").attr("id","jchat_userstab_popup").attr("dir","ltr").addClass("jchat_tabpopup").css("display","none").html('<div class="jchat_userstabtitle"><span class="jchat_privatechattitle">'+jchat_privatechat+'</span><input id="jchat_users_search" type="text" value="'+jchat_search+'"/><div id="jchat_myusername"></div></div><div class="jchat_tabcontent userslist"><div class="jchat_userscontent"><div class="jchat_userslist_available"></div><div class="jchat_userslist_away"></div><div class="jchat_userslist_neveractive"></div><div class="jchat_userslist_busy"></div></div>').appendTo($(jchatTargetElement)),$("#jchat_userstab").mouseover(function(){$(this).addClass("jchat_tabmouseover")}),$("#jchat_userstab").mouseout(function(){$(this).removeClass("jchat_tabmouseover")}),$(document).on("click","#jchat_userstab",function(t){1==o&&(o=0,$("#jchat_userstab_text").html(chatTitle),ajaxReceive(),$("#jchat_optionsbutton_popup .available").click()),s.options=0,"module"==renderingMode&&separateWidgets||$("#jchat_wall_popup").toggleClass("jchat_tabopen"),$(this).hasClass("jchat_tabclick")?(restartUpdateSession("buddylist","0"),$.jStorage.get("default_suggestion")||$("#jchat_default_suggestion_tooltip").show()):(restartUpdateSession("buddylist","1"),$("#jchat_default_suggestion_tooltip").hide(),makeSidebarResizable(),$("#jchat_wall_popup div.jchat_tabcontenttext").length&&$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight)),$("#jchat_userstab_popup").css("right","0").css("bottom","0"),$(this).toggleClass("jchat_tabclick").toggleClass("jchat_userstabclick"),buddyListVisible&&(!allowGuestBuddylist&&isGuest||$("#jchat_userstab_popup").toggleClass("jchat_tabopen")),$("#jchat_newpublic_msg").remove(),clearInterval(wallMessagesAlertInterval)}),$(document).on("click","#jchat_default_suggestion_tooltip",function(){$("#jchat_userstab").click()});var defaultGenericTooltips=["jchat_trigger_emoticon","jchat_trigger_fileupload","jchat_trigger_export","jchat_trigger_delete","jchat_trigger_refresh","jchat_trigger_skypesave","jchat_trigger_skypedelete","jchat_trigger_override_name","jchat_trigger_infoguest","jchat_trigger_room","jchat_trigger_webrtc","jchat_roomname","jchat_roomcount","jchat_banning","jchat_ban_moderator","jchat_trigger_history","jchat_trigger_history_wall","jchat_skype","jchat_quality_cam","jchat_onoffswitch","jchat_trigger_messaging_emoticon","jchat_trigger_messaging_fileupload","jchat_trigger_messaging_export","jchat_trigger_messaging_delete","jchat_trigger_messaging_openbox","jchat_trigger_send","jchat_trigger_geolocation","jchat_source_language","jchat_target_language","jchat_lang_switcher","jchat_translate_arrow","jchat_busy","jchat_start_accept_call","jchat_end_decline_call","jchat_start_recording","jchat_pause_recording","jchat_stop_recording","jchat_view_recording","jchat_download_recording","jchat_send_recording","jchat_upload_recording"];$.each(defaultGenericTooltips,function(k,elem){$(document).on("mouseover","."+elem,function(event){triggerGenericPopover("#"+elem+"_tooltip",this,eval(elem))}).on("mouseout","."+elem,function(t){$("#"+elem+"_tooltip").css("display","none")})}),$(document).on("mouseover",".jchat_contact",function(t){triggerGenericPopover("#jchat_contact_tooltip",this)}).on("mouseout",".jchat_contact",function(t){$("#jchat_contact_tooltip").css("display","none")}),$("#jchat_users_search").focusin(function(){$(this).val("")}).focusout(function(){$(this).val(jchat_search),forceBuddylistRefresh=0}).keyup(function(){restartUpdateSession("buddylist","1"),forceBuddylistRefresh=1}),$("head").append('<style>.jchat_tab_shortname a:hover::before{ content:"'+jchat_userprofile_link+'" }</style>'),$(window).focus(function(){isTabFocused=!0,$("title").text(originalPageTitle)}),$(window).blur(function(){isTabFocused=!1}),$(document).on("click","#jchat_tooltip_close",function(t){$("#jchat_default_suggestion_tooltip").remove(),t.stopPropagation(),$.jStorage.set("default_suggestion",1,{TTL:36e5})}),$.jStorage.get("buddylistMaximized",!1)&&$("#jchat_maximizebutton").trigger("click",[!0])}function initializeOptionsDiv(){$("<div/>").attr("id","jchat_optionsbutton_popup").attr("dir","ltr").addClass("jchat_tabpopup").css("display","none").html('<div class="jchat_tabcontent"><span style="float:left" class="jchat_user_available"></span><span class="jchat_optionsstatus available">'+jchat_available+'</span><br clear="all"/><span class="jchat_optionsstatus2 jchat_user_offline"></span><span class="jchat_optionsstatus offline">'+jchat_statooffline+'</span><br clear="all"/><span class="jchat_optionsstatus2 jchat_user_donotdisturb"></span><span class="jchat_optionsstatus jchat_donotdisturb">'+jchat_statodonotdisturb+'</span><br clear="all"/><span class="jchat_optionsstatus2 jchat_reset_chatboxes"></span><span class="jchat_optionsstatus jchat_resetposition">'+jchat_reset_chatboxes+'</span><br clear="all"/><span class="jchat_optionsstatus2 jchat_minimize_chatboxes"></span><span class="jchat_optionsstatus jchat_minimizeall">'+jchat_minimize_chatboxes+'</span><br clear="all"/><span class="jchat_optionsstatus2 jchat_open_privatemess"></span><span class="jchat_optionsstatus jchat_privatemess" data-uri="'+jchat_privatemess_uri+'">'+jchat_open_privatemess+'</span><br clear="all"/><div class="jchat_override_name"><span class="jchat_options_override_name">'+jchat_insert_override_name+'</span></div><div><input type="text" id="override_name" value=""/><div id="jchat_trigger_override_name" class="jchat_trigger_override_name"></div></div><br clear="all"/><div id="jchat_avatar" class="jchat_avatar">Avatar</div><div class="jchat_sounds">'+jchat_audio_onoff+'</div><div class="jchat_wall_sounds">'+jchat_public_audio_onoff+'</div><br clear="all"/><div class="jchat_skype"><span class="jchat_options_skype">'+jchat_insert_skypeid+'</span></div><input type="text" id="skype_id" value=""/><div id="jchat_trigger_skypesave" class="jchat_trigger_skypesave"></div><div id="jchat_trigger_skypedelete" class="jchat_trigger_skypedelete"></div></div>').appendTo($(jchatTargetElement)),JChatNotifications.supportVibration&&jchatHasTouch()&&($("#jchat_optionsbutton_popup .jchat_sounds").before('<div class="jchat_vibrate">'+jchat_vibrate_onoff+"</div>"),$("div.jchat_vibrate").on("click",function(t){restartUpdateSession("vibrate",vibrate=1==vibrate?0:1),$(this).toggleClass("novibrate"),JChatNotifications.setVibrateStatus(vibrate)})),JChatNotifications.supportNotification&&($("#jchat_optionsbutton_popup .jchat_sounds").before('<div class="jchat_notification">'+jchat_notification_onoff+"</div>"),$("div.jchat_notification").on("click",function(t){restartUpdateSession("notification",notification=0==notification?1:0),$(this).toggleClass("yesnotification"),JChatNotifications.setNotificationStatus(notification).requestNotificationPermission()})),$("#jchat_optionsbutton_popup .jchat_minimizeall").on("click",function(t){restartUpdateSession("minimizedallchatboxes",minimizedAllChatboxes=0==minimizedAllChatboxes?1:0),$(this).prev().toggleClass("yesminimized");var a=$(window).width(),e=$(window).height(),s=1,o=0;("auto"==renderingMode||"module"==renderingMode&&separateWidgets)&&(o=$("#jchat_userstab_popup").width()),minimizedAllChatboxes?$("div[id^=jchat_user_].jchat_bottomed").draggable("disable").addClass("jchat_nodraggable"):$("div[id^=jchat_user_].jchat_bottomed").draggable("enable").removeClass("jchat_nodraggable");var i=function(t,a,e){t.animate({left:a+"px",top:e+"px","margin-left":0,"margin-top":0,bottom:"auto",right:"auto"},500)},n=function(t,a,e){$("#jchat_user_"+t+"_popup").animate({left:a.left,top:a.top,height:"auto","margin-left":e.left,"margin-top":e.top},500)};$.each(openedChatboxes,function(t,c){minimizedAllChatboxes&&!$("#jchat_user_"+t+"_popup").hasClass("minimized")?$("div.jchat_minimizebox_bottom","#jchat_user_"+t).trigger("click",[!0]):!minimizedAllChatboxes&&$("#jchat_user_"+t+"_popup").hasClass("minimized")&&$("div.jchat_minimizebox_bottom","#jchat_user_"+t).trigger("click",[!0]),$("#jchat_user_"+t+"_popup .jchat_tabcontenttext").height(200);var r=$("#jchat_user_"+t+"_popup").width(230);if($.jStorage.deleteKey("popupDimensions"),minimizedAllChatboxes)if("bottom"==positionmentChatboxes)r.hasClass("jchat_bottomed")||(i(r,l=a-o-230,h=e-26-26*s),popupPositions[t]={x:l,y:h},minimizedIndexes[t]=s,s++);else{var l=a-o-230,h=e-26*s;i(r,l,h),popupPositions[t]={x:l,y:h},minimizedIndexes[t]=s,s++}else if("bottom"==positionmentChatboxes){if(!r.hasClass("jchat_bottomed")){var p=s,_=parseInt(p)/microSplacementKonstant;n(t,d={left:50+_+"%",top:50+_+"%"},u={left:"-115px",top:"-167px"});try{delete popupPositions[t]}catch(t){}s++}}else{var p=s,d={left:50+(_=parseInt(p)/microSplacementKonstant)+"%",top:50+_+"%"},u={left:"-115px",top:"-167px"};n(t,d,u);try{delete popupPositions[t]}catch(t){}s++}}),$.jStorage.set("popupPositions",popupPositions),$.jStorage.set("minimizedIndexes",minimizedIndexes)}),$("#jchat_optionsbutton_popup .available").click(function(t){statusClassOp(),$("#jchat_userstab_icon").addClass("jchat_user_available2"),$(this).css("text-decoration","underline"),postGenericStatus("user_status","available")}),$("#jchat_optionsbutton_popup .offline").click(function(t){turnChatOffline(),$(this).css("text-decoration","underline"),$("#jchat_optionsbutton_popup").removeClass("jchat_tabopen")}),$("#jchat_optionsbutton_popup .jchat_donotdisturb").on("click",function(t){postGenericStatus("user_status",(donotdisturb=0==donotdisturb?1:0)?"busy":"available"),$(this).prev().toggleClass("jchat_enabled"),$("#jchat_userstab_popup .jchat_userstabtitle").toggleClass("jchat_donotdisturb")}),$("#jchat_optionsbutton_popup .jchat_resetposition").click(function(t){$.jStorage.deleteKey("popupPositions"),$.jStorage.deleteKey("popupState"),$.jStorage.deleteKey("popupMaximizedState"),$.jStorage.deleteKey("popupDimensions"),$.jStorage.deleteKey("nofluxchatboxes"),$.jStorage.deleteKey("minimizedIndexes"),popupPositions={},popupDimensions={},popupState={},popupMaximizedState={},nofluxChatBoxes={},minimizedIndexes={},restartUpdateSession("minimizedallchatboxes",minimizedAllChatboxes=0),$(".jchat_minimize_chatboxes").removeClass("yesminimized");var a=$.extend({},openedChatboxes);$.each(openedChatboxes,function(t,a){$("#jchat_user_"+t+"_popup div.jchat_closebox_bottom").trigger("click"),$("#jchat_user_"+t+" .jchat_minimizebox_bottom").data("minimized",!1)}),$.each(a,function(t,a){$("#jchat_userlist_"+t).trigger("click")})}),$("#jchat_optionsbutton_popup .jchat_privatemess").click(function(){var t=$(this).data("uri");window.location.href=t}),$("#jchat_trigger_override_name").click(function(){var t=$(this).prev().val();postGenericStatus("override_name",t),t?injectFloatingMsg(jchat_override_name_saved,t):injectFloatingMsg(jchat_override_name_deleted,null)}),$("#jchat_trigger_skypesave").click(function(){var t=$(this).prev().val();postGenericStatus("skypeid",t),t?injectFloatingMsg(jchat_skypeidsaved,t):injectFloatingMsg(jchat_skypeid_deleted,null)}),$("#jchat_trigger_skypedelete").click(function(){$(this).prevAll("input").val(null),postGenericStatus("skypeid",null),injectFloatingMsg(jchat_skypeid_deleted,null)}),$(document).on("mouseover","#jchat_optionsbutton, #jchat_closesidebarbutton, #jchat_loginbutton",function(){$("#jchat_optionsbutton_popup, #jchat_loginbutton_popup").hasClass("jchat_tabopen")||hoverSidebarTooltips(this,eval($(this).attr("id")))}),$(document).on("mouseover","#jchat_maximizebutton",function(){if(!$("#jchat_optionsbutton_popup, #jchat_loginbutton_popup").hasClass("jchat_tabopen")){var appendedStateClass=$(this).hasClass("maximized")?"_maximized":"_minimized";hoverSidebarTooltips(this,eval($(this).data("translation")+appendedStateClass))}}),$(document).on("mouseout","#jchat_optionsbutton, #jchat_closesidebarbutton, #jchat_loginbutton, #jchat_maximizebutton",function(){$(this).removeClass("jchat_tabmouseover"),$("#jchat_tooltip").css("display","none")}),$(document).on("click","#jchat_optionsbutton",function(t){return 0==r&&(1==o&&(o=0,$("#jchat_userstab_text").html(chatTitle),ajaxReceive(),$("#jchat_optionsbutton_popup .available").click()),$("#jchat_optionsbutton_popup").toggleClass("jchat_tabopen")),$("#jchat_optionsbutton").trigger("mouseout"),$("#jchat_loginbutton_popup").remove(),popupsReposition(),t.stopPropagation(),!1}),$(document).on("click","#jchat_loginbutton",function(t){return $("#jchat_loginbutton").trigger("mouseout"),$("#jchat_loginbutton_popup").length?$("#jchat_loginbutton_popup").remove():($('<div id="jchat_loginbutton_popup" class="jchat_tabpopup jchat_tabopen"></div>').appendTo("body"),isGuest?($('<div id="jchat_loginpopup_desc">'+jchat_logindesc+"</div>").appendTo("#jchat_loginbutton_popup"),facebookLoginActive&&($("<span/>").attr("id","jchat_loginbutton_facebook").appendTo("#jchat_loginbutton_popup"),$("#jchat_loginbutton_facebook").on("click",jchatfblogin)),googleLoginActive&&($("<span/>").attr("id","jchat_loginbutton_google").appendTo("#jchat_loginbutton_popup"),$("#jchat_loginbutton_google").on("click",function(t){"undefined"!=typeof jchatGPlusLoginURL&&(window.location.href=jchatGPlusLoginURL)})),twitterLoginActive&&($("<span/>").attr("id","jchat_loginbutton_twitter").appendTo("#jchat_loginbutton_popup"),$("#jchat_loginbutton_twitter").on("click",function(t){"undefined"!=typeof jchatTwitterLoginURL&&(window.location.href=jchatTwitterLoginURL)}))):$('<span class="jchat_loginbutton_logged">'+jchat_already_logged+my_username+"</span>").appendTo("#jchat_loginbutton_popup"),popupsReposition()),t.stopPropagation(),!1}),$(document).on("click","body > *:not(#jchat_optionsbutton_popup)",function(t){"jchat_optionsbutton"==$(t.target).attr("id")||$(t.target).parents("#jchat_optionsbutton_popup").length||$("#jchat_optionsbutton_popup").removeClass("jchat_tabopen")}),$(document).on("click","#jchat_maximizebutton",function(t,a){if(0==r&&(1==o&&(o=0,$("#jchat_userstab_text").html(chatTitle),ajaxReceive(),$("#jchat_optionsbutton_popup .available").click()),$(this).toggleClass("maximized"),$("#jchat_userstab_popup").toggleClass("maximized"),$("#jchat_userstab_popup div.jchat_tabcontent.userslist").toggleClass("maximized"),$("#jchat_userstab").toggleClass("maximized"),$("#jchat_wall_popup").toggleClass("hidden")),popupsReposition(),!a){var e=!$.jStorage.get("buddylistMaximized",!1);$.jStorage.set("buddylistMaximized",e),buddylistMaximized=e}return t.stopPropagation(),!1}),$("#jchat_optionsbutton_popup .jchat_userstabtitle").click(function(){$("#jchat_optionsbutton_popup").toggleClass("jchat_tabopen")}),$("#jchat_optionsbutton_popup .jchat_userstabtitle").mouseenter(function(){$(this).addClass("jchat_chatboxtabtitlemouseover2")}),$("#jchat_optionsbutton_popup .jchat_userstabtitle").mouseleave(function(){$(this).removeClass("jchat_chatboxtabtitlemouseover2")}),$("#jchat_avatar").toggle(function(t){avatarUploadTooltip(this)},function(t){$("#jchat_avatar").prevAll(".jchat_avatar_upload_tooltip, .jchat_overlay").remove()}),$("div.jchat_sounds").on("click",function(t){restartUpdateSession("audio",audio=1==audio?0:1),$(this).toggleClass("noaudio"),JChatNotifications.setAudioStatus(audio)}),$("div.jchat_wall_sounds").on("click",function(t){restartUpdateSession("wallaudio",wallaudio=1==wallaudio?0:1),$(this).toggleClass("noaudio"),JChatNotifications.setWallAudioStatus(wallaudio)})}function initializeWall(){var t="";(1==jchat_wall_sendbutton||2==jchat_wall_sendbutton&&jchatHasTouch())&&(t='<div data-id="wall" class="jchat_trigger_send jchat_trigger_send_wall"></div>',$(document).on("click","div.jchat_trigger_send[data-id=wall]",function(t){var a=$.Event("keydown");a.keyCode=13,a.shiftKey=!1,$("#jchat_wall_popup .jchat_textarea").trigger(a)})),$("<div/>").attr("id","jchat_wall_popup").addClass("jchat_tabpopup jchat_walltab_popup").attr("dir","ltr").css("display","none").html('<div class="jchat_userstabtitle"><span class="jchat_publicchattitle">'+jchat_wall_msgs+'</span></div><div class="jchat_tabcontent messagelist"><div class="jchat_tabcontenttext jchat_tabcontenttext_wall"></div><div class="jchat_tabcontentinput">'+writeElementWall+'</div><div class="jchat_trigger_emoticon"></div><div class="jchat_trigger_room"></div><div class="jchat_trigger_users_informations"></div><div class="jchat_trigger_export"></div><div class="jchat_trigger_refresh"></div><div class="jchat_trigger_delete"></div><div class="jchat_trigger_history_wall"></div>'+t+"</div>").appendTo($(jchatTargetElement)),$("#jchat_wall_popup div.jchat_userstabtitle").append('<span id="jchat_maximize_wall" data-translation="jchat_maximizebutton" class="jchat_maximizeimages"></span>'),$("#jchat_maximize_wall").toggle(function(t){$("#jchat_wall_popup").addClass("maximized");var a=window.innerHeight?window.innerHeight:$(window).height();return $("div.jchat_tabcontenttext_wall").height(a-103),$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7),$("#jchat_wall_popup").addClass("maximized"),$(this).addClass("maximized"),popupsReposition(!0),$("#jchat_wall_popup .jchat_userstabtitle").off("click"),t.stopPropagation(),!1},function(t){$("#jchat_wall_popup").removeClass("maximized");var e=$("div.jchat_tabcontenttext_wall").parents("#jchat_wall_popup").height();return $("div.jchat_tabcontenttext_wall").height(e-103),$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7),$("#jchat_wall_popup").removeClass("maximized"),$(this).removeClass("maximized"),popupsReposition(),$("#jchat_wall_popup .jchat_userstabtitle").on("click",a),t.stopPropagation(),!1}),$(".jchat_trigger_emoticon","#jchat_wall_popup").toggle(function(t){var a=$('.jchat_tabcontent div[class*="tooltip"]',"#jchat_wall_popup").filter(function(t){return"none"!==$(this).css("display")});a.length&&a.next().trigger("click"),emoticonsTooltip(this,"#jchat_wall_popup",null,!0),$(this).addClass("toggle_on")},function(t){$(".jchat_emoticonstooltip","#jchat_wall_popup").remove(),$(this).removeClass("toggle_on")}),$(".jchat_trigger_room","#jchat_wall_popup").toggle(function(t){var a=$('.jchat_tabcontent div[class*="tooltip"]',"#jchat_wall_popup").filter(function(t){return"none"!==$(this).css("display")});a.length&&a.next().trigger("click"),roomsTooltip(this,"#jchat_wall_popup",!0),$(this).addClass("toggle_on")},function(t){$(".jchat_roomstooltip","#jchat_wall_popup").remove(),$(this).removeClass("toggle_on")}),$(".jchat_trigger_users_informations","#jchat_wall_popup").toggle(function(t){var a=$('.jchat_tabcontent div[class*="tooltip"]',"#jchat_wall_popup").filter(function(t){return"none"!==$(this).css("display")});a.length&&a.next().trigger("click"),chatroomUsersInformationsTooltip(this,"#jchat_wall_popup",!0),$(this).addClass("toggle_on")},function(t){$(".jchat_chatroom_usersinfo_tooltip","#jchat_wall_popup").remove(),$(this).removeClass("toggle_on")}),$("#jchat_wall_popup div.jchat_trigger_refresh").click(function(t){return fetchWallMessages(0)}),$("#jchat_wall_popup div.jchat_trigger_history_wall").click(function(t,a){return fetchWallMessages(1,a)}),$("#jchat_wall_popup div.jchat_trigger_users_informations").mouseover(function(){wallTooltipUsers("div.jchat_trigger_users_informations"),$(this).addClass("jchat_tabmouseover")}),$("#jchat_wall_popup div.jchat_trigger_users_informations").mouseout(function(){$(this).removeClass("jchat_tabmouseover"),$("#jchat_users_informations_tooltip").css("display","none")}),$("#jchat_wall_popup div.jchat_trigger_refresh").mousedown(function(){$(this).addClass("jchat_refresh_mousedown")}).mouseup(function(){$(this).removeClass("jchat_refresh_mousedown")}),$("#jchat_wall_popup div.jchat_trigger_export").append("<a/>"),$("#jchat_wall_popup div.jchat_trigger_export a").attr("href",htmlLiveSite+"&task=export.display&chatid=wall"),$("#jchat_wall_popup div.jchat_trigger_delete").on("click",function(){deleteConversation("wall",!0)}),$("#jchat_wall_popup .jchat_textarea").keydown(function(t){return sendWallMessage(t,this)}),$("#jchat_wall_popup .jchat_textarea").keyup(function(t){return popupWall(t,this,wallStartHeight)}),$("#jchat_wall_popup .jchat_userstabtitle").mouseenter(function(){$(this).addClass("jchat_chatboxtabtitlemouseover2")}),$("#jchat_wall_popup .jchat_userstabtitle").mouseleave(function(){$(this).removeClass("jchat_chatboxtabtitlemouseover2")}),publicChatStateClosed=$.jStorage.get("publicChatStateClosed",!1),buddylistMaximized=$.jStorage.get("buddylistMaximized",!1);var a=function(t){$("#jchat_maximize_wall").toggle(),$(this).nextAll().toggle();var a=!$.jStorage.get("publicChatStateClosed",!1);$.jStorage.set("publicChatStateClosed",a),publicChatStateClosed=a,$(this).parent().toggleClass("jchat_wall_minimized"),popupsReposition()};$("#jchat_wall_popup .jchat_userstabtitle").on("click",a),!0===publicChatStateClosed&&($("#jchat_wall_popup .jchat_userstabtitle").nextAll().toggle().parent().toggleClass("jchat_wall_minimized"),$("#jchat_maximize_wall").hide()),$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7)}function popupsReposition(t,a){("auto"==renderingMode||"module"==renderingMode&&separateWidgets)&&$("#jchat_base").css("width","100%"),$("#jchat_userstab_popup").css("right",0).css("bottom","0");var e=$("div.jchat_tabcontenttext_wall").parents("#jchat_wall_popup").show().height();$("div.jchat_tabcontenttext_wall").parents("#jchat_wall_popup").hide(),$("div.jchat_tabcontenttext_wall").height(e-103);$(window).width();wallStartHeight=parseInt($("#jchat_wall_popup div.jchat_tabcontenttext").height()),$(".jchat_fileuploadtooltip",a).each(function(a,e){var s=$(e).next(".jchat_trigger_fileupload"),o=282;!0===t&&(o=0);$(e,s).css("left",$(s).offset().left-$(window).scrollLeft()-o).css("top",$(s).offset().top-$(window).scrollTop()-60)}),$(".jchat_webrtctooltip").each(function(a,e){if($(e).hasClass("fullscreen"))$("#jchat_localvideo_placeholder, #jchat_remotevideo_placeholder").height($("#jchat_localvideo").height());else{var s=$(e).next(".jchat_trigger_webrtc"),o=500,i=300;recordingEnabled&&userPermissions.allow_media_recorder&&(i+=50);var n=!!$(e).parents("div.jchat_tabpopup").hasClass("maximized");!0===t||n?(n&&(o=0),!0===t?$(e,s).animate({left:$(s).offset().left-$(window).scrollLeft()-o,top:$(s).offset().top-$(window).scrollTop()-i},300):$(e,s).css("left",$(s).offset().left-$(window).scrollLeft()-o).css("top",$(s).offset().top-$(window).scrollTop()-i)):$(e,s).css("left",$(s).offset().left-$(window).scrollLeft()-o).css("top",$(s).offset().top-$(window).scrollTop()-i)}}),$(".jchat_emoticonstooltip",a).each(function(a,e){var s=$(e).next(".jchat_trigger_emoticon"),o=196;!0===t&&(o=0);$(e,s).css("left",$(s).offset().left-$(window).scrollLeft()-o).css("top",$(s).offset().top-$(window).scrollTop()-133)}),$(".jchat_roomstooltip").each(function(a,e){var s=$(".jchat_trigger_room").offset(),o=$(e).width()-18;!0===t&&(o=0);var i=jchatGetPageScroll();$(e).css("left",s.left-$(window).scrollLeft()-o).css("top",s.top-parseInt(i[1])-232)}),$(".jchat_chatroom_usersinfo_tooltip").each(function(a,e){var s=$(".jchat_trigger_users_informations").offset(),o=$(e).width()-18;!0===t&&(o=0);var i=jchatGetPageScroll();$(e).css("left",s.left-$(window).scrollLeft()-o).css("top",s.top-parseInt(i[1])-152)}),$(".jchat_infoguesttooltip").each(function(a,e){var s=$(e).next(".jchat_trigger_infoguest"),o=232;!0===t&&(o=0),$(e,s).css("left",$(s).offset().left-$(window).scrollLeft()-o).css("top",$(s).offset().top-$(window).scrollTop()-201)}),$(".jchat_historytooltip").each(function(t,a){var e=$(a).next(".jchat_trigger_history");$(a,e).css("left",$(e).offset().left-$(window).scrollLeft()-102).css("top",$(e).offset().top-$(window).scrollTop()-161)}),$(".jchat_geolocationtooltip").each(function(a,e){var s=$(e).next(".jchat_trigger_geolocation"),o=232;!0===t&&(o=0),$(e,s).css("left",$(s).offset().left-$(window).scrollLeft()-o).css("top",$(s).offset().top-$(window).scrollTop()-302)});var s=$("#jchat_optionsbutton_popup"),o=$("#jchat_userstab #jchat_optionsbutton");if(s.length&&o.length){c=o.offset().top-$(window).scrollTop()-s.height()-10;s.removeClass("jchat_optionspopup_reverse"),c<0&&(c+=s.height()+40,s.addClass("jchat_optionspopup_reverse")),s.css("left",o.offset().left+$(window).scrollLeft()-s.width()+42).css("top",c)}var i=$("#jchat_loginbutton_popup"),n=$("#jchat_userstab #jchat_loginbutton");if(i.length&&n.length){var c=n.offset().top-$(window).scrollTop()-i.height()-18;i.css("left",n.offset().left+$(window).scrollLeft()-105).css("top",c)}var r=$("#jchat_trigger_webrtc_tooltip");if(popupTooltipDependency&&r.length){var l=$(".jchat_trigger_webrtc",popupTooltipDependency);if(!l.length)return;d=244;t?(d=0,$(r).css("background-position","left bottom")):$(r).css("background-position","right bottom");u=40;$(r).css("left",$(l).offset().left-$(window).scrollLeft()-d).css("top",$(l).offset().top-$(window).scrollTop()-u)}var h=$("#jchat_default_suggestion_tooltip");if(h.length&&$("#jchat_base:visible").length){var p=$("#jchat_userstab");"module"!=renderingMode||"bottom"!=baloonPosition||separateWidgets||(p=$("#jchat_target"));var _=p.offset(),d=(p.width(),16),u=30;"alternative.css"==chatTemplate&&(u+=20),h.css("top",_.top-$(window).scrollTop()-parseInt(h.height())-u).css("left",_.left-$(window).scrollLeft()+d)}}function b(a,e){t[a]=e}function e(a){return t[a]?t[a]:""}function restartUpdateSession(t,a){s[t]=a,1!=e("initialize")&&1!=e("updatesession")&&(R=1,clearTimeout(U),U=setTimeout(function(){ajaxReceive()},restartInterval))}function getSessionProperty(t,a){return s[t]?s[t]:""}function showDebugMsgs(t){debugEnabled&&alert(t)}function ajaxReceive(){for(vars in s)t["sessionvars["+vars+"]"]=s[vars];t.task="stream.display",t.searchfilter=$("#jchat_users_search").val(),t.force_refresh=forceBuddylistRefresh,t.conferenceview=$("#jchat_conference_container").length||0,languageTranslationEnabled&&setLanguageSessionvars(),1==R&&(b("updatesession","1"),R=0),t.last_received_msg_id=n;var a="",e="";$.ajax({url:jsonLiveSite,data:t,type:"post",cache:!1,dataType:"json",success:function(t){if($(".jchat_chatboxmessage.dummy_typing").remove(),t){var s=0;if($.each(t,function(o,i){if("paramslist"==o){X=1e3*i.chatrefresh,K=1e3*i.chatrefresh,avatarUploadEnabled=!!parseInt(i.avatarupload),avatarEnabled=!!parseInt(i.avatarenable),attachmentsEnabled=!!parseInt(i.attachmentsenable),chatboxesOpenMode=!!parseInt(i.chatboxes_open_mode),showSendButton=parseInt(i.show_send_button),skypeEnabled=!!parseInt(i.skypebridge),groupChat=parseInt(i.groupchat),privateChatEnabled=!!parseInt(i.privatechat_enabled),typingEnabled=!!parseInt(i.typing_enabled),buddyListVisible=!!parseInt(i.buddylist_visible),groupChatMode=i.groupchatmode,debugEnabled=!!parseInt(i.enable_debug),resizableChatboxes=!!parseInt(i.resizable_chatboxes),chatTemplate=i.chat_template,chatTemplateTooltip=i.chat_template_tooltip,chatTemplateTooltipVariant=i.chat_template_tooltip_variant,positionmentChatboxes=i.positionment_chatboxes,autoClosePopups=!!parseInt(i.auto_close_popups),resizableSidebar=!!parseInt(i.resizable_sidebar),searchFieldEnabled=!!parseInt(i.searchfield),showMyUsername=!!parseInt(i.show_myusername),showChatroomsUsersDetails=!!parseInt(i.chatrooms_users_details),chatRoomLatestMessages=!!parseInt(i.chatrooms_latest),autoClearConversation=!!parseInt(i.autoclear_conversation),usersBanning=!!parseInt(i.usersbanning),usersBanningMode=i.usersbanning_mode,wordsBanning=!!parseInt(i.wordsbanning),wordsBanned=i.wordsbanned,wordsBannedReplacement=i.wordsbanned_replacement,messagesHistory=!!parseInt(i.history),maximizeButton=parseInt(i.maximize_box),renderingMode=i.rendering_mode,baloonPosition=i.baloon_position,separateWidgets=!!parseInt(i.separate_widgets),guestEnabledMode=i.guestenabled,chatTitle=i.chat_title,privateChatTitle=i.private_chat_title,publicChatTitle=i.public_chat_title.trim(),microSplacementKonstant=parseInt(i.micro_splacement_konstant),doubleChatboxesDirection=!!parseInt(i.double_chatboxes_direction),showSuggestionTooltip=!!parseInt(i.show_suggestion_tooltip),defaultSuggestionText=i.suggestion_tooltip_text?i.suggestion_tooltip_text:defaultSuggestionText,chatFormLink=i.chatform_link,excludeOnMobile=parseInt(i.exclude_onmobile),guestPrefix=i.guestprefix,asyncSendMessage=i.async_send_message,notificationsAutoEnable=!!parseInt(i.notifications_auto_enable),geolocationEnabled=!!parseInt(i.geolocation_enabled),geolocationService=i.geolocation_service,wallStartState=!!parseInt(i.groupchat_start_open_mode),addChatrooms=!!parseInt(i.addchatroom),deleteChatrooms=!!parseInt(i.deletechatroom),userAccessLevels=i.user_access_viewlevels,joomlaAccessLevels=i.total_access_viewlevels,wallHistoryDelayAutoload=!!parseInt(i.wall_history_delay_autoload),defaultChatroom=parseInt(i.default_chatroom),webrtcEnabled=!!parseInt(i.webrtc_enabled),webrtcRingingTone=i.webrtc_call_sound,iceServers=i.ice_servers,timeoutStartCall=parseInt(i.timeout_start_call),timeoutEndCall=parseInt(i.timeout_end_call),webrtcFallbackEnabled=!!parseInt(i.no_webrtc_fallback),hideWebcamWhenDisabled=parseInt(i.hide_webcam_when_disabled),showWebRTCStats=!!parseInt(i.show_webrtc_stats),showWebRTCVUMeter=!!parseInt(i.show_webrtc_vumeter),serverLoadReduction=!!parseInt(i.serverload_reduction),defaultMicVolume=parseFloat(i.micvolume_default),defaultAudioVolume=parseFloat(i.audiovolume_default),videochatAutoMaximize=parseInt(i.videochat_auto_maximize_box),autoQualityBandwidthMgmt=!!parseInt(i.auto_quality_bandwidth_management),recordingEnabled=!!parseInt(i.enable_recording),ticketsForm=!!parseInt(i.tickets_form),ticketsFormAlwaysVisible=!!parseInt(i.tickets_form_always_visible),autoOpenRandomAgentBox=!!parseInt(i.auto_open_agentbox),autoOpenAgentboxDefaultMessage=i.auto_open_agentbox_defaultmessage||jchat_agentbox_defaultmessage,affectPublicChat=!!parseInt(i.affect_public_chat),parseInt(i.offline_message_switcher)&&(jchat_nousers='<div class="jchat_nousers_placeholder">'+jchatOfflineMessage+"</div>"),"auto"!=renderingMode&&(targetElement="jchat_target"),thirdPartyIntegration=i["3pdintegration"],PMIntegration=!!parseInt(i.pm_integration),facebookLoginActive=!!parseInt(i.fblogin_active),googleLoginActive=!!parseInt(i.gpluslogin_active),twitterLoginActive=!!parseInt(i.twitterlogin_active),languageTranslationEnabled=!!parseInt(i.language_translation_enabled),translateSelfMessages=!!parseInt(i.language_translation_selfmessages),languageTranslationEnabled&&(defaultLanguage=i.default_language||i.default_fallback_language,defaultTranslateToLanguage=i.default_to_language,languageFallbacks={sourcelang:defaultLanguage,targetlang:defaultTranslateToLanguage}),isGuest=!!parseInt(i.isguest),hasSuperUser=!!i.superuser,allowGuestAvatarupload=!!parseInt(i.allow_guest_avatarupload),allowGuestFileupload=!!parseInt(i.allow_guest_fileupload),allowGuestSkypeBridge=!!parseInt(i.allow_guest_skypebridge),allowGuestOverrideName=!!parseInt(i.allow_guest_overridename),allowGuestBanning=!!parseInt(i.allow_guest_banning),allowGuestBuddylist=!!parseInt(i.allow_guest_buddylist),allowMediaObjects=!!parseInt(i.allow_media_objects),allowChatroomsCreation=!!parseInt(i.addchatroom_permission),allowChatroomsDeletion=!!parseInt(i.deletechatroom_permission),enableModeration=!!parseInt(i.enablemoderation),buildUserPermissions(i,i.usergroups);var c=originalSidebarWidth=parseInt(i.sidebar_width),l=Math.abs(parseInt((260-c)/10));c<260&&(buddyLength+=l=-(l+=2)),"module"==renderingMode&&"bottom"==i.baloon_position&&$("#jchat_base").detach().appendTo(jchatTargetElement),(facebookLoginActive||googleLoginActive||twitterLoginActive)&&$("<span/>").attr("id","jchat_loginbutton").addClass("jchat_tab").addClass("jchat_loginimages").appendTo($("#jchat_userstab"))}if("buddylist"==o){var p=function(){$(".jchat_nousers, .jchat_userlist").remove(),$("#jchat_users_search:focus").length?$(".jchat_userscontent").append('<div class="jchat_nousers">'+jchat_nousers_filter+"</div>"):$(".jchat_userscontent").append('<div class="jchat_nousers">'+jchat_nousers+"</div>"),ticketsForm&&!$("#jchat_users_search:focus").length&&renderTicketForm("div.jchat_nousers")};if(i){if(buddyList=i,$("#jchat_userstab_popup").css("min-height","inherit"),$("#jchat_wall_popup").removeClass("jchat_lamform_hidden"),wallStartHeight=jchatGetWallHeight(),$("#jchat_wall_popup div.jchat_tabcontenttext").height(wallStartHeight-($(".jchat_textarea_wall").height()-22)),ticketsForm&&($("span.jchat_lamform_title").remove(),$("#jchat_userstab_popup *.jchat_lamform, #jchat_userstab *.jchat_lamform").removeClass("jchat_lamform")),!$("#lamform input[name=lam_name]").val()){$(".jchat_nousers").remove();var _=0;$("#jchat_private_messaging").length&&$("span.jchat_usersbox_status").removeClass("jchat_online").empty(),$.each(i,function(t,a){listaUtenti(a.id,a.name,a.status,a.message,a,!1),"offline"!==a.status&&_++}),$("#jchat_userstab_text").html(chatTitle+'<span class="jchat_userscount">('+_+")</span>"),0==_?(p(),$("div.jchat_ticketform_collapse, div.jchat_always_ticket_form").remove()):ticketsFormAlwaysVisible&&($("div.jchat_ticketform_collapse").length||($(".jchat_userscontent").prepend('<div class="jchat_ticketform_collapse">'+jchat_sendus_aticket+"</div>"),$(".jchat_ticketform_collapse").after('<div class="jchat_always_ticket_form"></div>'),renderTicketForm("div.jchat_always_ticket_form"),$(".jchat_ticketform_collapse").on("click",function(){$(this).toggleClass("opened"),$("div.jchat_always_ticket_form").slideToggle()})))}var d=$("div.jchat_userlist");$.each(d,function(a,e){var s=$(e).data("id");if(-1==$.inArray(s,t.buddylist_ids)&&($(e).remove(),$("#jchat_user_"+s+" div.jchat_closebox_bottom_status").removeClass("jchat_available jchat_busy").addClass("jchat_disconnected").html(""),"undefined"!=typeof JChatConference)){var o=$(e).data("sessionid");$("#jchat_conference_userslist li.jchat_userbox[data-sessionid="+o+"]").remove()}})}else $("#lamform input[name=lam_name]").val()||(p(),$("div.jchat_ticketform_collapse, div.jchat_always_ticket_form").remove()),$("#jchat_userstab_text").html(chatTitle+'<span class="jchat_userscount">(0)</span>'),buddyList={},$("span[id^=jchat_user_] div.jchat_closebox_bottom_status").removeClass("jchat_available jchat_busy").addClass("jchat_disconnected").html(""),"undefined"!=typeof JChatConference&&$("#jchat_conference_userslist li.jchat_userbox").remove()}if("my_username"==o&&""!=o&&"undefined"!=o&&(my_username=i.length>chatLength-2?i.substr(0,chatLength-2)+"...":i,$("#jchat_myusername").html(jchat_me+"<span>"+my_username+"</span>"),$("div.jchat_userslist_myusername").html(jchat_me+"<span>"+my_username+"</span>"),!$("input[name=lam_name]")||firstCall||isGuest||isChatAdmin||$("input[name=lam_name]").val(my_username)),"my_avatar"==o&&""!=o&&void 0!==o&&null!==o&&(my_avatar=i),"my_email"==o&&""!=o&&void 0!==o&&null!==o&&(my_email=i,!$("input[name=lam_email]")||firstCall||isGuest||isChatAdmin||$("input[name=lam_email]").val(my_email)),"loggedout"==o&&($("#jchat_optionsbutton").addClass("jchat_optionsimages_exclamation"),$("#jchat_userstab").hide(),$("#jchat_optionsbutton_popup").hide(),$("#jchat_wall_popup").hide(),$("#jchat_userstab_popup").hide(),$(".jchat_tabopen").css("cssText","display: none !important;"),""!=T&&($("#jchat_user_"+T+"_popup").hide(),T=""),r=1),"userstatus"==o&&$.each(i,function(t,a){"message"==t&&$("#jchat_optionsbutton_popup .jchat_statustextarea").val(a),"status"==t&&(chatStatus=a,"offline"==a?turnChatOffline(1):"busy"==a?($("span.jchat_user_donotdisturb").addClass("jchat_enabled"),$("#jchat_userstab_popup .jchat_userstabtitle").addClass("jchat_donotdisturb"),donotdisturb=1):(statusClassOp(),$("#jchat_userstab_icon").addClass("jchat_user_"+a+"2"),$("#jchat_optionsbutton_popup ."+a).css("text-decoration","underline"))),"override_name"==t&&$("#override_name").val(a),"skype_id"==t&&$("#skype_id").val(a),"room_id"==t&&null==(currentJoinedChatRoom=a)&&defaultChatroom&&chatRoomAutoJoiner(defaultChatroom)}),"typing_status"==o){var u=i;u&&$.each(u,function(t,a){var e=$("#jchat_user_"+t+"_popup"),s=$("div.jchat_tabcontenttext",e);if(e.length){var o=null,i=$("span.jchat_userscontentname img","#jchat_userlist_"+t),n='<div class="jchat_chatboxmessage dummy_typing"><span class="jchat_chatboxmessagefrom">'+(o=i.length?i.get(0).outerHTML:"<strong>"+$("span.jchat_userscontentname","#jchat_userlist_"+t).text()+"</strong>")+'</span><span class="jchat_chatboxmessagecontent"><span class="dummy_typing_dots">...</span></span></div>';s.append(n).scrollTop(s.get(0).scrollHeight),$("#jchat_usersmessages").length&&$("#jchat_usersmessages").append(n).scrollTop($("#jchat_usersmessages").get(0).scrollHeight)}})}if("lastreadmessages"==o){var g=i;$.each(g,function(t,a){var e=$("#jchat_usersmessages div.jchat_chatboxmessage[data-messageid="+a+"] div.jchat_chatboxmessagedate");if(e.length&&!$("span.jchat_messaging.msg_seen",e).length&&($("span.jchat_messaging.msg_seen").remove(),$("#jchat_usersmessages div.jchat_chatboxmessage:last-child").data("messageid")==a&&e.append('<span class="jchat_messaging msg_seen">'+jchat_seen+"</span>")),$("#jchat_user_"+t+"_popup").length){var s=$("div.jchat_tabcontenttext.private div.jchat_chatboxmessage.selfmessage:last-child","#jchat_user_"+t+"_popup").attr("id"),o=$("#jchat_message_"+a).next("span.msg_seen");if(s==="jchat_message_"+a&&!o.length){$("#jchat_message_"+a).after('<span class="msg_seen">'+jchat_seen+"</span>");var i=$("#jchat_user_"+t+"_popup .jchat_tabcontenttext"),n=$(i)[0].scrollHeight;$(i).animate({scrollTop:n},800,"swing")}}})}if("webrtc_signaling_channel"==o&&webrtcDirector&&userPermissions.allow_videochat&&"undefined"==typeof JChatConference&&webrtcDirector.setListeningData(i,{tabFocused:isTabFocused,tabTitle:originalPageTitle}),"webrtc_conference_signaling_channel"==o&&conferenceDirector&&userPermissions.allow_videochat&&"undefined"!=typeof JChatConference&&$.each(i,function(t,a){conferenceDirector.setListeningData(a)}),"chatrooms"==o&&(roomsAvailable=i,!currentJoinedChatRoom&&firstCall&&(currentJoinedChatRoom=t.userstatus.room_id),$.each(roomsAvailable,function(t,a){var e=!(a.id!=currentJoinedChatRoom);if(currentJoinedChatRoom&&e&&!publicChatStateClosed){a.name=a.name.length<chatRoomLength?a.name:a.name.substr(0,chatRoomLength)+"...";var s=$("<div/>").addClass("jchat_userstabsubtitle").html('<span class="jchat_roomtitle">'+jchat_chatroom+"</span> "+a.name);$(".jchat_userstabtitle","#jchat_wall_popup").next(".jchat_userstabsubtitle").remove().end().after(s),$("#jchat_wall_popup .jchat_userstabsubtitle").width($("#jchat_wall_popup").width()-7),a.numusers++}addChatRoomsUsersDetails(a,e),$(".jchat_roomcount[data-roomcountid="+a.id+"]").text(jchat_chatroom_users+a.numusers)})),"users_inmyroom"==o&&(myChatRoomUsers=i),"initialize"==o){if(firstCall=!0,$("#jchat_userstab").addClass("jchat_tabopen"),$.each(i,function(t,a){if("buddylist"==t&&(1==a&&$("#jchat_userstab").click(),chatTitle.length>chatTitleLength&&$("#jchat_userstab_text").addClass("jchat_userstab_text_long")),"options"==t&&1==a&&$("#jchat_optionsbutton").click(),"activeChatboxes"==t&&(parseInt(i.buddylist)||chatboxesOpenMode))for(var e=a.split(/,/),s=0,o=0;o<e.length;o++){var n=e[o].split(/\|/);$("#jchat_userlist_"+n[0]).length&&(n[0]&&(openedChatboxes[n[0]]=s),$("#jchat_userlist_"+n[0]).trigger("dblclick",[!0]),parseInt(n[1])>0&&tabAlert(n[0],n[1],0,{}),s++)}"audio"==t&&0==(audio=parseInt(a))&&$("div.jchat_sounds").addClass("noaudio"),"wallaudio"==t&&0==(wallaudio=parseInt(a))&&$("div.jchat_wall_sounds").addClass("noaudio"),"vibrate"==t&&(0==(vibrate=parseInt(a))&&$("div.jchat_vibrate").addClass("novibrate"),JChatNotifications.setVibrateStatus(vibrate)),"notification"==t&&(1==(notification=parseInt(a))&&$("div.jchat_notification").addClass("yesnotification"),JChatNotifications.setNotificationStatus(notification)),"minimizedallchatboxes"==t&&1==(minimizedAllChatboxes=parseInt(a))&&($("span.jchat_minimize_chatboxes").addClass("yesminimized"),$("div[id^=jchat_user_].jchat_bottomed").draggable("disable").addClass("jchat_nodraggable"))}),b("initialize","0"),notificationsAutoEnable&&!i.notification&&$("div.jchat_notification").trigger("click"),"undefined"!=typeof JChatConference&&userPermissions.allow_videochat){var m={debugEnabled:debugEnabled,jsonLiveSite:jsonLiveSite,ringingTone:webrtcRingingTone,audiostatus:audio,startCallTimeout:1e3*timeoutStartCall,endCallTimeout:1e3*timeoutEndCall,defaultMicVolume:defaultMicVolume,defaultAudioVolume:defaultAudioVolume,iceServers:iceServers,hideWebcamWhenDisabled:hideWebcamWhenDisabled,showWebRTCStats:showWebRTCStats,showWebRTCVUMeter:showWebRTCVUMeter,autoQualityBandwidthMgmt:autoQualityBandwidthMgmt},j=my_username.length>videoLength?my_username.substr(0,videoLength)+"...":my_username;if((conferenceDirector=new JChatConference(m)).initializeVideo($("#jchat_right_videocolumn"),j),"undefined"!=typeof JChatRecorder&&recordingEnabled&&userPermissions.allow_media_recorder){recorderDirector=new JChatRecorder(conferenceDirector,{debugEnabled:debugEnabled,permissions:userPermissions});$("#jchat_wrapper_localvideo").append('<div id="jchat_wrapper_localvideo_recorder"></div>');recorderDirector.initializeVideo($("#jchat_wrapper_localvideo_recorder"),"conference",my_username)}}else{if("undefined"!=typeof JChatWebrtc&&webrtcEnabled&&userPermissions.allow_videochat){m={debugEnabled:debugEnabled,jsonLiveSite:jsonLiveSite,ringingTone:webrtcRingingTone,audiostatus:audio,startCallTimeout:1e3*timeoutStartCall,endCallTimeout:1e3*timeoutEndCall,defaultMicVolume:defaultMicVolume,defaultAudioVolume:defaultAudioVolume,iceServers:iceServers,hideWebcamWhenDisabled:hideWebcamWhenDisabled,showWebRTCStats:showWebRTCStats,showWebRTCVUMeter:showWebRTCVUMeter,autoQualityBandwidthMgmt:autoQualityBandwidthMgmt};webrtcDirector=new JChatWebrtc(m),"undefined"!=typeof JChatRecorder&&recordingEnabled&&userPermissions.allow_media_recorder&&(recorderDirector=new JChatRecorder(webrtcDirector,{debugEnabled:debugEnabled,permissions:userPermissions}));var v=$.jStorage.get("jchat_remotepeer_webrtc_tooltip",!1);v&&($(".jchat_trigger_webrtc","#jchat_user_"+v+"_popup").trigger("click"),$.jStorage.deleteKey("jchat_remotepeer_webrtc_tooltip"))}"undefined"==typeof JChatWebrtc&&$("div.jchat_trigger_webrtc").remove()}"undefined"==typeof JChatConference||userPermissions.allow_videochat||($("#jchat_conference_container").empty(),$("#jchat_conference_container").append('<span class="jchat_view_message">'+COM_JCHAT_NOACCESS_VIDEOCONFERENCE+"</span>")),window.sessionStorage&&(parseInt(jchat_userid)||2!=jchat_guestenabled||sessionStorage.getItem("jchat_joined")||$("#jchat_userstab").removeClass("jchat_tabclick jchat_userstabclick")),!(isChatAdmin=!!parseInt(t.ischatadmin))&&autoOpenRandomAgentBox&&autoOpenAgentChatbox()}if("wallmessages"==o&&$.each(i,function(t,a){++s;var o="",i="",n="";if(1==a.self)fromPlaceholder=void 0!==my_avatar&&null!==my_avatar&&""!==my_avatar?'<img alt="'+jchat_you+my_username+'" data-time="'+a.time+'" width="32px" height="32px" src="'+my_avatar+'" />':'<strong data-time="'+a.time+'">'+my_username+"</strong>",o=" selfmessage";else{var c=$("#jchat_userlist_"+a.fromuserid).triggerHandler("getname"),r=$("#jchat_userlist_"+a.fromuserid).triggerHandler("getavatar");void 0!==r&&null!==r&&""!==r||(r=a.avatar),void 0!==c&&null!==c&&""!==c||(c=a.fromuser.length>chatLength?a.fromuser.substr(0,chatLength)+"...":a.fromuser),!!(void 0===r||null===r||""===r||r.match(/default_other.png/)||!0!==avatarEnabled)&&c.length>=chatLength-13&&(i=" jchat_username_large",n=" jchat_message_small"),fromPlaceholder=void 0===r||null===r||""===r||r.match(/default_other.png/)||!0!==avatarEnabled?'<strong data-time="'+a.time+'">'+c+"</strong>":'<img alt="'+c+'" data-time="'+a.time+'" width="32px" height="32px" src="'+r+'" />',void 0!==a.profilelink&&""!==a.profilelink&&null!==a.profilelink&&(fromPlaceholder='<a href="'+a.profilelink+'">'+fromPlaceholder+"</a>")}a.message=jchatStripTags(a.message,allowMediaObjects),a.message=a.message.replace(/&/gi,"&amp;"),$("#jchat_message_"+a.id).length>0||(e+='<div class="jchat_chatboxmessage'+o+'" id="jchat_message_'+a.id+'"><span class="jchat_chatboxmessagefrom'+i+'">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+o+n+'">'+a.message+"</span></div>",1==wallaudio&&!1===firstCall&&JChatNotifications.playWallMessageAlert(a))}),"messages"==o){var f=function(t){var a=!1;$("div[id^=jchat_user_]").each(function(e,s){var o=$(s).attr("id");$(s).hasClass("maximized")&&o!="jchat_user_"+t+"_popup"&&(a=!0),$(s).removeClass("maximized_hover")}),a&&$("#jchat_user_"+t+"_popup").addClass("maximized_hover")};$("span.jchat_messaging.msg_seen").remove(),$.each(i,function(t,e){n=e.id;var s="";if($("span.msg_seen","#jchat_user_"+e.from+"_popup").remove(),$("#jchat_user_"+e.from+"_popup").length>0){if(1==e.self)fromPlaceholder=void 0!==my_avatar&&null!==my_avatar&&""!==my_avatar&&!0===avatarEnabled?'<img alt="'+jchat_you+my_username+'" data-time="'+e.time+'" width="32px" height="32px" src="'+my_avatar+'" />':'<strong data-time="'+e.time+'">'+my_username+"</strong>",s=" selfmessage";else{var o=$("#jchat_userlist_"+e.from).triggerHandler("getname"),c=$("#jchat_userlist_"+e.from).triggerHandler("getavatar");void 0!==c&&null!==c&&""!==c||(c=e.avatar),void 0!==o&&null!==o&&""!==o||(o=e.fromuser),fromPlaceholder=void 0!==c&&null!==c&&""!==c&&!0===avatarEnabled?'<img alt="'+o+'" data-time="'+e.time+'" width="32px" height="32px" src="'+c+'" />':'<strong data-time="'+e.time+'">'+o+"</strong>",void 0!==e.profilelink&&""!==e.profilelink&&null!==e.profilelink&&(fromPlaceholder='<a href="'+e.profilelink+'">'+fromPlaceholder+"</a>")}if("file"==e.type){if(firstCall)p=!1;e.message=jchatTrasformMsgFile(e.message,e.id,e.self,e.from,e.status,p,e)}else e.message=jchatStripTags(e.message,allowMediaObjects),e.message=e.message.replace(/&/gi,"&amp;");if($("#jchat_message_"+e.id).length>0);else if(a='<div class="jchat_chatboxmessage'+s+'" id="jchat_message_'+e.id+'"><span class="jchat_chatboxmessagefrom">'+fromPlaceholder+'</span><span class="jchat_chatboxmessagecontent'+s+'">'+e.message+"</span></div>",1==audio&&!1===firstCall&&"file"!=e.type&&JChatNotifications.playMessageAlert(e),!e.old){var r=$("#jchat_user_"+e.from+"_popup .jchat_textarea");!r.length||$(r).is(":focus")||$(r).data("isblinking")||($(r).blink(),$(r).data("isblinking",!0))}$("#jchat_user_"+e.from+"_popup .jchat_tabcontenttext").append(a),$("#jchat_user_"+e.from+"_popup .jchat_tabcontenttext").scrollTop($("#jchat_user_"+e.from+"_popup .jchat_tabcontenttext")[0].scrollHeight),$("span.jchat_chatboxmessagefrom img, span.jchat_chatboxmessagefrom strong").mouseover(function(t){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(t){$("#jchat_avatartooltip").remove()}),$("div.jchat_agent_dummy_message").remove(),isTabFocused||1==e.self||$("title").text(o+jchat_newmessage_tab),f(e.from),"file"==e.type&&e.self&&(e.idregistered=$("#jchat_user_"+e.from).data("loggedid")),sendAppendPrivateMessage(e.idregistered,e.id,e.message,e.self,e)}else{var l=!(t!=i.length-1),h=!(!$("#jchat_private_messaging").length||$("#jchat_privatemessaging_textarea").data("loggedid")!=e.idregistered);if($("#jchat_userlist_"+e.from).trigger("addmessage",[e.message,e.self,e.old,e.id,e,l,h]),!$("#jchat_userlist_"+e.from).length&&$("#jchat_private_messaging").length&&1==audio&&("file"==e.type?JChatNotifications.playSentFile(e):JChatNotifications.playMessageAlert(e)),$("div.jchat_agent_dummy_message").remove(),f(e.from),"file"==e.type){if(firstCall)var p=!1;e.message=jchatTrasformMsgFile(e.message,e.id,e.self,e.from,e.status,p,e)}else e.message=jchatStripTags(e.message,allowMediaObjects),e.message=e.message.replace(/&/gi,"&amp;");sendAppendPrivateMessage(e.idregistered,e.id,e.message,!1,e)}}),h=1,K=X}"downloads"==o&&$.each(i,function(t,a){refreshMsgFileStatus(a[0],a[1])})}),e&&($("#jchat_wall_popup div.jchat_tabcontenttext").append(e),$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext")[0].scrollHeight),$("span.jchat_chatboxmessagefrom img, span.jchat_chatboxmessagefrom strong","#jchat_wall_popup").mouseover(function(t){avatarTooltip(this,$(this).attr("alt"),$(this).data("time"))}).mouseout(function(t){$("#jchat_avatartooltip").remove()}),!$("#jchat_userstab").hasClass("jchat_tabclick")&&!$("#jchat_newpublic_msg").length&&!firstCall)){$("<span/>").attr("id","jchat_newpublic_msg").addClass("jchat_tab").appendTo($("#jchat_userstab"));var i=$("#jchat_newpublic_msg");wallMessagesAlertInterval=setInterval(function(){i.data("blink")?$(i).toggleClass("hidden").data("blink",!1):$(i).toggleClass("hidden").data("blink",!0)},600)}}b("initialize","0"),b("updatesession","0");var c=!(!$("div.jchat_webrtctooltip").length&&!$("#jchat_conference_container").length||serverLoadReduction);1!=r&&1!=o&&(c||++h>emptyResponse&&(K*=2,h=1),K>F&&(K=F),clearTimeout(U),U=setTimeout(function(){ajaxReceive()},K)),firstCall&&groupChat&&(popupsReposition(),$("#jchat_wall_popup div.jchat_tabcontenttext").length&&$("#jchat_wall_popup div.jchat_tabcontenttext").scrollTop($("#jchat_wall_popup div.jchat_tabcontenttext").get(0).scrollHeight)),firstCall&&showSuggestionTooltip&&suggestionTooltip(),"undefined"!=typeof jchat_hide_sidebar&&firstCall&&jchat_hide_sidebar&&$("#jchat_base, #jchat_optionsbutton_popup, #jchat_wall_popup, #jchat_userstab_popup, #jchat_default_suggestion_tooltip, #jchat_tooltip").removeClass("jchat_tabopen").addClass("jchat_sidebar_hidden"),firstCall&&isGuest&&$("span.jchat_open_privatemess, span.jchat_privatemess").remove(),firstCall&&!wallStartState&&null===$.jStorage.get("publicChatStateClosed")&&$("div.jchat_userstabtitle").trigger("click"),firstCall&&wallHistoryDelayAutoload&&!currentJoinedChatRoom&&!window.sessionStorage.getItem("wall_autoload_history")&&($("#jchat_wall_popup div.jchat_trigger_history_wall").trigger("click",[!0]),window.sessionStorage.setItem("wall_autoload_history",1)),firstCall&&"module"==renderingMode&&separateWidgets&&($("#jchat_userstab_popup, #jchat_base").css({position:"fixed"}),$("#jchat_wall_popup").addClass("jchat_tabopen")),firstCall&&privateChatTitle&&$("span.jchat_privatechattitle").text(privateChatTitle),firstCall&&publicChatTitle&&$("span.jchat_publicchattitle").text(publicChatTitle),firstCall=!1,sound=!0,(!groupChat||groupChat>1&&jchatDetectMobileDevice(groupChat))&&($("#jchat_wall_popup").remove(),$("span.jchat_contact").hide()),(!buddyListVisible||!allowGuestBuddylist&&isGuest)&&($("#jchat_userstab_popup").removeClass("jchat_tabopen").hide(),("auto"==renderingMode||"module"==renderingMode&&separateWidgets)&&$("#jchat_wall_popup").css({bottom:"27px",top:"inherit"})),"invite"!=groupChatMode&&$("span.jchat_contact").hide(),(!usersBanning||isGuest&&!allowGuestBanning)&&$("span.jchat_banning").hide(),enableModeration&&userPermissions.moderation_groups||$("span.jchat_ban_moderator").hide(),"chatroom"!=groupChatMode&&$("div.jchat_trigger_room").hide(),searchFieldEnabled||$("#jchat_users_search").hide(),showMyUsername||$("#jchat_myusername").hide(),messagesHistory||$("div.jchat_trigger_history_wall").hide(),(!maximizeButton||maximizeButton>1&&!jchatDetectMobileDevice(maximizeButton))&&($("#jchat_maximizebutton").remove(),$("#jchat_maximize_wall").remove()),window.sessionStorage&&isGuest&&2==guestEnabledMode&&!sessionStorage.getItem("jchat_joined")&&(clearTimeout(U),$("#jchat_base").hide(),$("#jchat_wall_popup, #jchat_userstab_popup").removeClass("jchat_tabopen"),showSuggestionTooltip&&suggestionTooltip(!0))}})}function makeSidebarResizable(){if(!resizableSidebar||"module"==renderingMode)return!1;$("#jchat_userstab_popup").resizable({handles:"w",minWidth:260,maxWidth:500,alsoResize:"#jchat_userstab, #jchat_wall_popup",resize:function(t,a){$(a.element).css("left","auto"),$("#jchat_wall_popup .jchat_userstabsubtitle").width($(a.element).width()-7);$("#jchat_wall_popup").attr("style").removeAttr},stop:function(t,a){$.jStorage.set("sidebarWidth",a.size.width);var e=$("#jchat_wall_popup").attr("style");$("#jchat_wall_popup").removeAttr("style"),$("#jchat_wall_popup").attr("style",e.replace(/\sheight:\s\d+px;/gi,""))}}),$("#jchat_wall_popup").resizable({handles:"w",minWidth:260,maxWidth:500,alsoResize:"#jchat_userstab, #jchat_userstab_popup",resize:function(t,a){$(a.element).css("left","auto"),$("#jchat_wall_popup .jchat_userstabsubtitle").width($(a.element).width()-7),popupsReposition()},stop:function(t,a){$.jStorage.set("sidebarWidth",a.size.width)}})}function refreshMsgFileStatus(t,a){$("#jchat_message_"+a+" span.jchat_chatboxmessagecontent span.filestatus","#jchat_user_"+t+"_popup").prev().remove(),$("#jchat_message_"+a+" span.jchat_chatboxmessagecontent span.filestatus","#jchat_user_"+t+"_popup").html(jchat_sent_file_downloaded_realtime),$("#jchat_right_messagescolumn").length&&($("span.jchat_chatboxmessagecontent span.filestatus","div.jchat_chatboxmessage[data-messageid="+a+"]").prev().remove(),$("span.jchat_chatboxmessagecontent span.filestatus","div.jchat_chatboxmessage[data-messageid="+a+"]").html(jchat_sent_file_downloaded_realtime)),JChatNotifications.playCompleteFile()}function injectSkypeControls(t){if(!t.skypeid||!skypeEnabled)return!1;var a=!0;return function(){if(a)e='<div class="jchat_skypecall"><a data-text="'+jchat_startskypecall+'" class="skypeicon" href="skype:'+t.skypeid+'?call"></a></div>';else var e='<div class="jchat_skypecall disabled"><a class="skypeicon" data-text="'+jchat_startskypedownload+'" href="http://www.skype.com/intl/en/get-skype/" target="_blank"></a></div>';$("#jchat_userlist_"+t.id).append(e),$("#jchat_userlist_"+t.id+" div.jchat_skypecall a").on("click",function(t){t.stopPropagation()}).on("mouseover",function(t){triggerGenericPopover("#jchat_skypecall",this)}).on("mouseout",function(t){$("#jchat_skypecall").css("display","none").remove()})}(),$("div.jchat_skypecall a").click(function(t){t.preventDefault();var a=200;jchatHasTouch()&&(a=1500),setTimeout(function(){$(t.target).trigger("mouseout"),window.location=$(t.target).attr("href")},a)}),a}function renderTicketForm(t){if(!$("#lamform","div.jchat_nousers").length){var a=$("<form/>").attr("name","lamform").attr("id","lamform").attr("class","ajaxform");$(t).append(a);var e=$("<label/>").text(jchat_lamform_required).attr("class","jchat_label_validate"),s=$("<label/>").text(jchat_lamform_name).attr("class","jchat_label_title"),o=$("<input/>").attr("name","lam_name").attr("data-validation","required");$(a).append(s).append($(e.clone(!0))).append(o);var i=$("<label/>").text(jchat_lamform_email).attr("class","jchat_label_title"),n=$("<input/>").attr("name","lam_email").attr("data-validation","required email");$(a).append(i).append($(e.clone(!0))).append(n);var c=$("<label/>").text(jchat_lamform_message).attr("class","jchat_label_title"),r=$("<textarea/>").attr("name","lam_message").attr("data-validation","required");$(a).append(c).append($(e.clone(!0))).append(r);var l=$("<div/>").text(jchat_lamform_submit).attr("class","jchat_submit_lam_form");$(a).append(l),$(l).on("click",function(t){sendTicketMessage(a)}),affectPublicChat&&$("#jchat_wall_popup").addClass("jchat_lamform_hidden"),$("#jchat_userstab_popup").css("min-height","220px"),$("#jchat_userstab_icon, #jchat_userstab_text").addClass("jchat_lamform"),$("#jchat_closesidebarbutton,#jchat_optionsbutton,#jchat_maximizebutton,#jchat_users_search,#jchat_myusername,span.jchat_privatechattitle").addClass("jchat_lamform"),$("span.jchat_lamform_title").remove(),$("div.jchat_userstabtitle").append('<span class="jchat_lamform_title">'+chatTitle+"</span>")}}function autoOpenAgentChatbox(){$("#jchat_userstab").hasClass("jchat_userstabclick")||window.sessionStorage.getItem("dummy_agent_message")||$(document).one("click","#jchat_userstab",function(t){var a=$("div.jchat_userlist");if(a.length){var e=a.length-1,s=Math.floor(Math.random()*(e+1)),o=$(a.get(s));o.trigger("click");var i=o.data("sessionid"),n=$("#jchat_userlist_"+i+" span.jchat_userscontentname > img").clone().prop("outerHTML")||"";$("#jchat_user_"+i+"_popup div.jchat_tabcontent.messagelist").append('<div class="jchat_agent_dummy_message"><span class="jchat_chatboxmessagefrom">'+n+'</span><span class="jchat_chatboxmessagecontent">'+autoOpenAgentboxDefaultMessage+"<br></span></div>"),window.sessionStorage.setItem("dummy_agent_message",1)}})}function updateGroupChatUsers(t,a){var e={task:t,id:a};$.ajax({url:jsonLiveSite,data:e,type:"post",cache:!1,dataType:"json",success:function(t){t.storing.status||showDebugMsgs(t.storing.details)}})}function refreshStream(){h=1,K>X&&(K=X,clearTimeout(U),U=setTimeout(function(){ajaxReceive()},X))}function hasWebRTCSupport(){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,a=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;return!(!t||!a)||!!webrtcFallbackEnabled}function buildUserPermissions(t,a){$.each(userPermissions,function(e,s){var o=t[e],i=$.map(o,function(t,a){return t});if("0"==i[0]||hasSuperUser)userPermissions[e]=!0;else{var n=$.map(a,function(t,a){return t}),c=$.grep(n,function(t){return $.inArray(String(t),i)>-1});userPermissions[e]=!!c.length}}),debugEnabled&&console.warn(userPermissions)}var jsonLiveSite=jchat_livesite+"index.php?option=com_jchat&format=json&tmpl=json&ajax=1",htmlLiveSite=jchat_livesite+"index.php?option=com_jchat&format=raw&tmpl=json&ajax=1",t={},s={},T="",r=0,o=0,J=!0,U,X=2e3,K=2e3,F=1e4,openedChatboxes={},nofluxChatBoxes={},minimizedIndexes={},emptyResponse=20,restartInterval=1,h=1,R=0,n=0,l=1,vars=null,targetElement="body",chatTitle="",privateChatTitle="",publicChatTitle="",chatStatus=null,forceBuddylistRefresh=0,wallMessagesAlertInterval=null,popupTooltipDependency=null,donotdisturb=0,audio=1,wallaudio=1,vibrate=1,notification=0,minimizedAllChatboxes=0,sound=!1,avatarUploadEnabled=!0,avatarEnabled=!0,attachmentsEnabled=!0,videoLength=9,tabLength=14,headLength=30,chatLength=20,buddyLength=18,chatRoomLength=30,chatTitleLength=26,buddyList={},publicChatStateClosed=!1,buddylistMaximized=!1,firstCall=!0,showSuggestionTooltip=!1,popupPositions=new Object,popupDimensions=new Object,positionmentChatboxes="middle",asyncSendMessage="before",popupState=new Object,popupMaximizedState=new Object,defaultPopupHeight=211,wallStartHeight=0,wallStartState=!0,isContentEditable=null,longname=null,shortname=null,my_username,my_email,my_avatar,fromPlaceholder,writeElement='<div contentEditable="true" class="jchat_textarea"></div>',writeElementWall='<div contentEditable="true" class="jchat_textarea jchat_textarea_wall"></div>',valFunction="html",guestEnabledMode=0,usersBanning=0,usersBanningMode="private",timeoutID=null,isTabFocused=!0,originalPageTitle=$("title").text(),microSplacementKonstant=2,doubleChatboxesDirection=!1,defaultSuggestionText=jchat_fallback_suggestion,chatFormLink=null,excludeOnMobile=!1,guestPrefix="Guest",notificationsAutoEnable=!1,addChatrooms=!1,deleteChatrooms=!1,wallHistoryDelayAutoload=!1,wallHistoryDelayAutoloadMap={},privateMessagingCounters={},originalSidebarWidth=260,wordsBanning=!1,wordsBanned="shit,fuck,cock,asshole",wordsBannedReplacement="banned",webrtcEnabled=!0,webrtcDirector=null,conferenceDirector=null,recorderDirector=null,webrtcRingingTone="skype",iceServers=null,timeoutStartCall=20,timeoutEndCall=20,webrtcFallbackEnabled=!0,hideWebcamWhenDisabled=1,showWebRTCStats=!0,showWebRTCVUMeter=!0,serverLoadReduction=!1,defaultMicVolume=.8,defaultAudioVolume=.8,videochatAutoMaximize=1024,autoQualityBandwidthMgmt=!1,recordingEnabled=!1,ticketsForm=!1,ticketsFormAlwaysVisible=!1,autoOpenRandomAgentBox=!1,autoOpenAgentboxDefaultMessage="",isChatAdmin=!1,affectPublicChat=!0,currentJoinedChatRoom=null,roomsAvailable=new Array,myChatRoomUsers=new Array,showChatroomsUsersDetails=!0,chatRoomLatestMessages=!0,autoClearConversation=!0,userAccessLevels={},joomlaAccessLevels={},currentScopedUsers={},defaultChatroom=null,skypeEnabled=!0,groupChat=1,buddyListVisible=!0,groupChatMode="chatroom",chatboxesOpenMode=!1,showSendButton=2,chatTemplate="default.css",chatTemplateTooltip="std",chatTemplateTooltipVariant="horiz",resizableChatboxes=!0,resizableSidebar=!0,searchFieldEnabled=!0,showMyUsername=!0,messagesHistory=!0,renderingMode="auto",baloonPosition="top",separateWidgets=!1,privateChatEnabled=!0,typingEnabled=!0,maximizeButton=1024,autoClosePopups=!0,geolocationEnabled=!1,geolocationService="geoip",gMapReference={},debugEnabled=!1,thirdPartyIntegration=null,PMIntegration=!1,facebookLoginActive=!1,googleLoginActive=!1,twitterLoginActive=!1,languageTranslationEnabled=!1,popupLanguages=new Object,defaultLanguage="en",defaultTranslateToLanguage="en",languageFallbacks={sourcelang:defaultLanguage,targetlang:defaultTranslateToLanguage},translateSelfMessages=!0,isGuest=!0,hasSuperUser=!1,allowGuestAvatarupload=!0,allowGuestFileupload=!0,allowGuestSkypeBridge=!0,allowGuestOverrideName=!0,allowGuestBanning=!0,allowGuestBuddylist=!0,allowMediaObjects=!0,allowChatroomsCreation=!1,allowChatroomsDeletion=!1,userPermissions={allow_videochat:null,allow_media_recorder:null,allow_media_recorder_save:null,moderation_groups:null},enableModeration=!1;return $("<div/>").attr("id","jchat_base").attr("dir","ltr").appendTo($(jchatTargetElement)),function(){if(jchat_excludeonmobile&&jchatDetectMobileDevice(jchat_excludeonmobile)){if(!$("#jchat_private_messaging").length)return!1;$("#jchat_base, #jchat_optionsbutton_popup, #jchat_wall_popup, #jchat_userstab_popup, #jchat_default_suggestion_tooltip, #jchat_tooltip").remove()}initializeOptionsDiv(),(isContentEditable=jchatSupportContentEditable())||(writeElement='<textarea class="jchat_textarea" ></textarea>',writeElementWall='<textarea class="jchat_textarea jchat_textarea_wall"></textarea>',valFunction="val"),initializeWall(),initializeDom(),$(window).on("resize scroll",popupsReposition),b("buddylist","1"),b("initialize","1"),b("updatesession","0"),$([window,document]).blur(function(){J=!1}).focus(function(){0==J&&(l=1),J=!0}),$.jStorage.get("popupPositions",!1)&&(popupPositions=$.jStorage.get("popupPositions")),$.jStorage.get("popupDimensions",!1)&&(popupDimensions=$.jStorage.get("popupDimensions")),$.jStorage.get("popupState",!1)&&(popupState=$.jStorage.get("popupState")),$.jStorage.get("popupMaximizedState",!1)&&(popupMaximizedState=$.jStorage.get("popupMaximizedState")),$.jStorage.get("nofluxchatboxes",!1)&&(nofluxChatBoxes=$.jStorage.get("nofluxchatboxes")),$.jStorage.get("minimizedIndexes",!1)&&(minimizedIndexes=$.jStorage.get("minimizedIndexes"));var t=null;if(parseInt(jchat_sidebar_default_width_override)>0&&(t=parseInt(jchat_sidebar_default_width_override),$("body > #jchat_wall_popup, #jchat_userstab_popup").width(t),$("#jchat_userstab").width(t-2)),$.jStorage.get("sidebarWidth",!1)){var a=parseInt($.jStorage.get("sidebarWidth"));(260!=a||t)&&($("#jchat_wall_popup, #jchat_userstab_popup").width(a),$("#jchat_userstab").width(a-2))}if($.jStorage.get("privateMessagingCounters",!1)&&(privateMessagingCounters=$.jStorage.get("privateMessagingCounters")),sessionStorage.getItem("popupLanguages")&&(popupLanguages=JSON.parse(sessionStorage.getItem("popupLanguages"))),window.sessionStorage&&(parseInt(jchat_userid)||2!=jchat_guestenabled||sessionStorage.getItem("jchat_joined")||($("#jchat_base").hide(),$("#jchat_wall_popup, #jchat_userstab_popup").removeClass("jchat_tabopen"))),ajaxReceive(),$("#jchat_privatemessaging_textarea").length){var e=function(t){var a=$(t.target).data("loggedid");if(13==t.keyCode&&0==t.shiftKey&&!a)return injectFloatingMsg(jchat_select_user_receiver),t.preventDefault(),!1;if(a){var e=$("div.jchat_userlist[data-loggedid="+a+"] span.jchat_contact","div.jchat_tabcontent.userslist").data("userid")||0;return sendMessage(t,this,e,a,!$("#jchat_user_"+e+"_popup").length)}};$(document).on("keydown","#jchat_privatemessaging_textarea",e),$("div.jchat_userslist_reply").on("click",function(t){t.keyCode=13,t.shiftKey=0,t.target=$("#jchat_privatemessaging_textarea").get(0),e.call(t.target,t)})}}(),function(){ajaxReceive()}}jQuery.jchat=jchatAlias,jQuery(function(t){window.jchatApplicationStreamActivate=t.jchat(t);var a=!1;jchatHasTouch()&&t(document).on("touchstart","body",function(e){a||(JChatNotifications.initPlayEmptySound(),a=!0),t(".jchat_generic_tooltip, #jchat_users_informations_tooltip, #jchat_tooltip, #jchat_avatartooltip").hide()})});