<?php/** * @package	HikaShop for Joomla! * @version	2.6.3 * @author	hikashop.com * @copyright	(C) 2010-2016 HIKARI SOFTWARE. All rights reserved. * @license	GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html */defined('_JEXEC') or die('Restricted access');?><?phpuse Joomla\Registry\Registry;class ProductController extends hikashopController {	public static $list_md5=null;	public function __construct($config = array(), $skip = false) {		parent::__construct($config, $skip);		$this->display = array_merge($this->display, array(			'ajax_get_list_product_by_category_id','ajax_get_wishlist'		));	}	public function ajax_get_list_product_by_category_id()	{		$input=JFactory::getApplication()->input;		$menu=JFactory::getApplication()->getMenu();		$menu_active=$menu->getActive();		$params=$menu_active->params;		$category=$params->get('hk_category.category');		$input->set('cid[]',$category);		$post=json_decode(file_get_contents('php://input'));		$view = &$this->getView('Product', 'json', 'ProductView');		$view->params=new Registry();		$view->params->set('data',$menu_active->params);		$view->listing();		$list=$view->rows;		$list1=array();		foreach($list as &$item){			$item1=new stdClass();			$item1->id=$item->product_id;			$item1->remote_id=$item->product_id;			$link='product&task=show&cid=' . $item->product_id . '&name=' . $item->alias . $item->itemid . $item->category_pathway;			$item1->url= hikashop_contentLink($link, $item);			$item1->name=$item->product_name;			$item1->category=$item->category_id;			//$item->description=JString::sub_string(strip_tags($item->product_description),200,'...') ;			$first_image=reset($item->images);			$img = $view->image->getThumbnail($first_image->file_path);			$item1->main_image=JUri::root().$img->url;			$list1[]=$item1;		}		$response=array(			metadata=>array(				links=>array(					first=>"first",					last=>"last",					prev=>null,					next=>null,					self=>"self"				),				records_count=>3			),			records=>$list1		);		echo json_encode($response);		die;	}	public function ajax_get_wishlist()	{		$input=JFactory::getApplication()->input;		$menu=JFactory::getApplication()->getMenu();		$menu_active=$menu->getActive();		$params=$menu_active->params;		$category=$params->get('hk_category.category');		$input->set('cid[]',$category);		$post=json_decode(file_get_contents('php://input'));		$view = &$this->getView('Product', 'json', 'ProductView');		$view->params=new Registry();		$view->params->set('data',$menu_active->params);		$view->listing();		$list=$view->rows;		$list1=array();		foreach($list as &$item){			$item1=new stdClass();			$item1->id=$item->product_id;			$item1->remote_id=$item->product_id;			$link='product&task=show&cid=' . $item->product_id . '&name=' . $item->alias . $item->itemid . $item->category_pathway;			$item1->url= hikashop_contentLink($link, $item);			$item1->name=$item->product_name;			$item1->category=$item->category_id;			//$item->description=JString::sub_string(strip_tags($item->product_description),200,'...') ;			$first_image=reset($item->images);			$img = $view->image->getThumbnail($first_image->file_path);			$item1->main_image=JUri::root().$img->url;			$list1[]=$item1;		}		$response=array(			metadata=>array(				links=>array(					first=>"first",					last=>"last",					prev=>null,					next=>null,					self=>"self"				),				records_count=>3			),			records=>$list1		);		echo json_encode($response);		die;	}}