<?php/** * @package	HikaShop for Joomla! * @version	2.6.3 * @author	hikashop.com * @copyright	(C) 2010-2016 HIKARI SOFTWARE. All rights reserved. * @license	GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html */defined('_JEXEC') or die('Restricted access');?><?phpuse Joomla\Registry\Registry;class ProductController extends hikashopController {	public static $list_md5=null;	public function __construct($config = array(), $skip = false) {		parent::__construct($config, $skip);		$this->display = array_merge($this->display, array(			'ajax_get_list_product_by_category_id','ajax_get_wishlist','ajax_get_cart','ajax_get_cart_info','ajax_get_product_by_id'		));	}	public function ajax_get_list_product_by_category_id()	{		$input=JFactory::getApplication()->input;		$menu=JFactory::getApplication()->getMenu();		$menu_active=$menu->getActive();		$params=$menu_active->params;		$category=$params->get('hk_category.category');		$input->set('cid[]',$category);		$post=json_decode(file_get_contents('php://input'));		$view = &$this->getView('Product', 'json', 'ProductView');		$view->params=new Registry();		$view->params->set('data',$menu_active->params);		$view->listing();		$list=$view->rows;		$list1=array();		foreach($list as &$item){			$item1=new stdClass();			$item1->id=$item->product_id;			$item1->remote_id=$item->product_id;			$link='product&task=show&cid=' . $item->product_id . '&name=' . $item->alias . $item->itemid . $item->category_pathway;			$item1->url= hikashop_contentLink($link, $item);			$item1->name=$item->product_name;			$item1->category=$item->category_id;			//$item->description=JString::sub_string(strip_tags($item->product_description),200,'...') ;			$first_image=reset($item->images);			$img = $view->image->getThumbnail($first_image->file_path);			$item1->main_image=JUri::root().$img->url;			$list1[]=$item1;		}		$response=array(			metadata=>array(				links=>array(					first=>"first",					last=>"last",					prev=>null,					next=>null,					self=>"self"				),				records_count=>3			),			records=>$list1		);		echo json_encode($response);		die;	}	public function ajax_get_cart_info()	{	    $html='{"product_count":5,"total_price":5945,"total_price_formatted":"$5,945.00"}';	    echo $html;	    die;    }	public function ajax_get_wishlist()	{	    $html=' {"id":58256,"product_count":5,"total_price":5945,"total_price_formatted":"$5,945.00","currency":"USD","items":[{"id":279491,"remote_id":"1","quantity":1,"total_item_price":99,"total_item_price_formatted":"$99.00","variant":{"id":6006954,"product_id":5999892,"remote_id":23605,"url":"http:\/\/cz.bfashion.com\/rukavice\/koton-d%C3%A1msk%C3%A9-rukavice-bez-prst%C5%AF-koton-23605","name":"Women mitts","price":349,"category":67030,"discount_price":99,"price_formatted":"$349.00","discount_price_formatted":"$99.00","currency":"USD","code":"A023605-024-004","description":"You can add a description of the product to the feed and it will appear exactly here.","main_image":"http:\/\/img.bfashion.com\/products\/presentation\/3b3292729ebb20e2de71dc4e5c617d4f4b94fa69.jpg","color":{"id":38334,"value":"Graphite","code":"#525657"},"size":{"id":36778,"value":"M"}},"expiration":0,"is_reservation":false},{"id":279682,"remote_id":"1","quantity":1,"total_item_price":1799,"total_item_price_formatted":"$1,799.00","variant":{"id":6015004,"product_id":6000601,"remote_id":36614,"url":"http:\/\/cz.bfashion.com\/pasky\/heine-d%C3%A1msk%C3%BD-p%C3%A1sek-36614","name":"Ladies belt","price":1999,"category":67071,"discount_price":1799,"price_formatted":"$1,999.00","discount_price_formatted":"$1,799.00","currency":"USD","code":"A036614-059-12","description":"You can add a description of the product to the feed and it will appear exactly here.","main_image":"http:\/\/img.bfashion.com\/products\/presentation\/223f4ad4b117941f7f58fec812047a58.jpg","color":{"id":38348,"value":"Light grey","code":"#d8d8d8"},"size":{"id":36785,"value":"M\/L"}},"expiration":0,"is_reservation":false},{"id":279734,"remote_id":"1","quantity":1,"total_item_price":2549,"total_item_price_formatted":"$2,549.00","variant":{"id":6010002,"product_id":6000183,"remote_id":29466,"url":"http:\/\/cz.bfashion.com\/kalhoty-a-sako\/class-International-d%C3%A1msk%C3%BD-kalhotov%C3%BD-kost%C3%BDm-29466","name":"Ladies pantsuit","price":2999,"category":67078,"discount_price":2549,"price_formatted":"$2,999.00","discount_price_formatted":"$2,549.00","currency":"USD","code":"U029466-002-13","description":"You can add a description of the product to the feed and it will appear exactly here.","main_image":"http:\/\/img.bfashion.com\/products\/presentation\/ae63bae56d0905493aad7c41d6d7e78f.jpg","color":{"id":38296,"value":"Black","code":"#000000"},"size":{"id":36807,"value":"L\/XL"}},"expiration":0,"is_reservation":false},{"id":279587,"remote_id":"1","quantity":2,"total_item_price":1498,"total_item_price_formatted":"$1,498.00","variant":{"id":6021993,"product_id":6001631,"remote_id":38449,"url":"http:\/\/cz.bfashion.com\/boty-z-prave-kuze\/tendenz-d%C3%A1msk%C3%A9-letn%C3%AD-boty-z-prav%C3%A9-k%C5%AF%C5%BEe-38449","name":"Female summer shoes made of genuine leather","price":749,"category":67049,"discount_price":749,"price_formatted":"$749.00","discount_price_formatted":"$749.00","currency":"USD","code":"D038449-023-37","description":"You can add a description of the product to the feed and it will appear exactly here.","main_image":"http:\/\/img.bfashion.com\/products\/presentation\/d75b8c22c8bc8c5ccbfe2bd7d9c192e5.jpg","color":{"id":38313,"value":"Dark blue","code":"#050350"},"size":{"id":36772,"value":"37"}},"expiration":0,"is_reservation":false}],"shipping":null,"discounts":[]}';	    echo $html;	    die;		$input=JFactory::getApplication()->input;		$menu=JFactory::getApplication()->getMenu();		$menu_active=$menu->getActive();		if(!$menu_active)		    $menu_active=$menu->getDefault();		$params=$menu_active->params;		$category=$params->get('hk_category.category');		$input->set('cid[]',$category);		$post=json_decode(file_get_contents('php://input'));		$view = &$this->getView('Product', 'json', 'ProductView');		$view->params=new Registry();		$view->params->set('data',$menu_active->params);		$view->listing();		$list=$view->rows;		$list1=array();		foreach($list as &$item){			$item1=new stdClass();			$item1->id=$item->product_id;			$item1->remote_id=$item->product_id;			$link='product&task=show&cid=' . $item->product_id . '&name=' . $item->alias . $item->itemid . $item->category_pathway;			$item1->url= hikashop_contentLink($link, $item);			$item1->name=$item->product_name;			$item1->category=$item->category_id;			//$item->description=JString::sub_string(strip_tags($item->product_description),200,'...') ;			$first_image=reset($item->images);			$img = $view->image->getThumbnail($first_image->file_path);			$item1->main_image=JUri::root().$img->url;			$list1[]=$item1;		}		$response=array(			metadata=>array(				links=>array(					first=>"first",					last=>"last",					prev=>null,					next=>null,					self=>"self"				),				records_count=>3			),			records=>$list1		);		echo json_encode($response);		die;	}	public function ajax_get_cart()	{	    $html='{"id":58256,"product_count":5,"total_price":5945,"total_price_formatted":"$5,945.00","currency":"USD","items":[{"id":279491,"remote_id":"1","quantity":1,"total_item_price":99,"total_item_price_formatted":"$99.00","variant":{"id":6006954,"product_id":5999892,"remote_id":23605,"url":"http:\/\/cz.bfashion.com\/rukavice\/koton-d%C3%A1msk%C3%A9-rukavice-bez-prst%C5%AF-koton-23605","name":"Women mitts","price":349,"category":67030,"discount_price":99,"price_formatted":"$349.00","discount_price_formatted":"$99.00","currency":"USD","code":"A023605-024-004","description":"You can add a description of the product to the feed and it will appear exactly here.","main_image":"http:\/\/img.bfashion.com\/products\/presentation\/3b3292729ebb20e2de71dc4e5c617d4f4b94fa69.jpg","color":{"id":38334,"value":"Graphite","code":"#525657"},"size":{"id":36778,"value":"M"}},"expiration":0,"is_reservation":false},{"id":279682,"remote_id":"1","quantity":1,"total_item_price":1799,"total_item_price_formatted":"$1,799.00","variant":{"id":6015004,"product_id":6000601,"remote_id":36614,"url":"http:\/\/cz.bfashion.com\/pasky\/heine-d%C3%A1msk%C3%BD-p%C3%A1sek-36614","name":"Ladies belt","price":1999,"category":67071,"discount_price":1799,"price_formatted":"$1,999.00","discount_price_formatted":"$1,799.00","currency":"USD","code":"A036614-059-12","description":"You can add a description of the product to the feed and it will appear exactly here.","main_image":"http:\/\/img.bfashion.com\/products\/presentation\/223f4ad4b117941f7f58fec812047a58.jpg","color":{"id":38348,"value":"Light grey","code":"#d8d8d8"},"size":{"id":36785,"value":"M\/L"}},"expiration":0,"is_reservation":false},{"id":279734,"remote_id":"1","quantity":1,"total_item_price":2549,"total_item_price_formatted":"$2,549.00","variant":{"id":6010002,"product_id":6000183,"remote_id":29466,"url":"http:\/\/cz.bfashion.com\/kalhoty-a-sako\/class-International-d%C3%A1msk%C3%BD-kalhotov%C3%BD-kost%C3%BDm-29466","name":"Ladies pantsuit","price":2999,"category":67078,"discount_price":2549,"price_formatted":"$2,999.00","discount_price_formatted":"$2,549.00","currency":"USD","code":"U029466-002-13","description":"You can add a description of the product to the feed and it will appear exactly here.","main_image":"http:\/\/img.bfashion.com\/products\/presentation\/ae63bae56d0905493aad7c41d6d7e78f.jpg","color":{"id":38296,"value":"Black","code":"#000000"},"size":{"id":36807,"value":"L\/XL"}},"expiration":0,"is_reservation":false},{"id":279587,"remote_id":"1","quantity":2,"total_item_price":1498,"total_item_price_formatted":"$1,498.00","variant":{"id":6021993,"product_id":6001631,"remote_id":38449,"url":"http:\/\/cz.bfashion.com\/boty-z-prave-kuze\/tendenz-d%C3%A1msk%C3%A9-letn%C3%AD-boty-z-prav%C3%A9-k%C5%AF%C5%BEe-38449","name":"Female summer shoes made of genuine leather","price":749,"category":67049,"discount_price":749,"price_formatted":"$749.00","discount_price_formatted":"$749.00","currency":"USD","code":"D038449-023-37","description":"You can add a description of the product to the feed and it will appear exactly here.","main_image":"http:\/\/img.bfashion.com\/products\/presentation\/d75b8c22c8bc8c5ccbfe2bd7d9c192e5.jpg","color":{"id":38313,"value":"Dark blue","code":"#050350"},"size":{"id":36772,"value":"37"}},"expiration":0,"is_reservation":false}],"shipping":null,"discounts":[]}';	    echo $html;	    die;		$input=JFactory::getApplication()->input;		$menu=JFactory::getApplication()->getMenu();		$menu_active=$menu->getActive();		if(!$menu_active)		    $menu_active=$menu->getDefault();		$params=$menu_active->params;		$category=$params->get('hk_category.category');		$input->set('cid[]',$category);		$post=json_decode(file_get_contents('php://input'));		$view = &$this->getView('Product', 'json', 'ProductView');		$view->params=new Registry();		$view->params->set('data',$menu_active->params);		$view->listing();		$list=$view->rows;		$list1=array();		foreach($list as &$item){			$item1=new stdClass();			$item1->id=$item->product_id;			$item1->remote_id=$item->product_id;			$link='product&task=show&cid=' . $item->product_id . '&name=' . $item->alias . $item->itemid . $item->category_pathway;			$item1->url= hikashop_contentLink($link, $item);			$item1->name=$item->product_name;			$item1->category=$item->category_id;			//$item->description=JString::sub_string(strip_tags($item->product_description),200,'...') ;			$first_image=reset($item->images);			$img = $view->image->getThumbnail($first_image->file_path);			$item1->main_image=JUri::root().$img->url;			$list1[]=$item1;		}		$response=array(			metadata=>array(				links=>array(					first=>"first",					last=>"last",					prev=>null,					next=>null,					self=>"self"				),				records_count=>3			),			records=>$list1		);		echo json_encode($response);		die;	}}